(function(globals){function __eval(t,e){"use strict";return e&&e.route.params,eval.call(window,t)}function obj_extend(t,e){for(var n in e)null!=e[n]&&(null==globals[n]||"object"!=typeof globals[n]||"object"!=typeof e[n]?t[n]=e[n]:obj_extend(globals[n],e[n]))}(function(t,e){"use strict";var n,r,i=!1;"undefined"==typeof exports||null!=t&&t!==exports&&t!==global||(n=global,i=!0),null==n&&(n="undefined"==typeof window?global:window),null==r&&(r=t||n),e(n,r),i&&(module.exports=r.Class)})(this,function(t,e){"use strict";function n(t){return"function"==typeof t}function r(t){return null!=t&&"number"==typeof t.length&&"function"==typeof t.slice}function i(t){return"string"==typeof t}function o(t){return"string"==typeof t&&""!==t}function l(t,e){if(s(t))for(var n=0,r=t.length;r>n;n++)e(t[n],n);else e(t)}function s(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}function u(t){return"function"==typeof t?t.prototype:t}function a(t,e,n){var r,i;for(r in t)i=t[r],h(i)&&(null!=e&&h(e.prototype[r])&&p(i,e.prototype[r]),null!=n&&l(n,function(t){t=u(t),h(t[r])&&p(i,t[r])}))}function c(t){"function"==typeof t&&(t=t.prototype);for(var e,n,r=1,i=arguments.length;i>r;r++){e="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in e)if("Static"!==n||null==t.Static)t[n]=e[n];else for(n in t.Static)t.Static[n]=t.Static[n]}return t}function f(t,e){if("object"!=typeof t||null==e)return t;for(var n,r=t,i=e.split("."),o=i.length,l=0;o>l;l++)if(n=i[l],r=r[n],null==r)return r;return r}function h(t){return null==t?!1:"object"!=typeof t?!1:t.constructor===Object}function p(t,e){for(var n in e)null==t[n]&&(t[n]=e[n]);return t}function d(t,e){for(var n in e)e[n]&&(t[n]=e[n]);return t}function g(t,e){return function(){switch(arguments.length){case 1:return t.call(e,arguments[0]);case 2:return t.call(e,arguments[0],arguments[1]);case 3:return t.call(e,arguments[0],arguments[1],arguments[2]);case 4:return t.call(e,arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return t.call(e,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}return t.apply(e,arguments)}}function v(t){return"function"==typeof t}function m(t){var e=Array.prototype.slice.call(arguments,1);return function(){return arguments.length>0&&(e=e.concat(arguments)),t.apply(null,e)}}function y(e){if(this===S||null==this||this===t){var n=function(t){y.call(this,t)};return n.prototype._props=e,d(n.prototype,y.prototype),n}null!=e&&this.deserialize(e)}function b(){}var _=Array.prototype.slice,x=Array.prototype.sort;"function"!=typeof Array.isArray&&(Array.isArray=function(t){return t instanceof Array?!0:null==t||"object"!=typeof t?!1:void 0!==t.length&&"function"==typeof t.slice});var w=function(){function t(t,e){if(null!=e){"function"==typeof t&&(t=t.prototype),"function"==typeof e&&(e=e.prototype);for(var n in e)t[n]=e[n]}}function e(t,e,n){var r=t[e],i=null==r?function(){}:function(t){return s(t)?r.apply(this,t):r.apply(this,arguments)};return function(){return this["super"]=i,n.apply(this,arguments)}}function n(n,r,o,s,u){var a=s,c=s;if(a.constructor=n.prototype.constructor,null!=o&&(c[i]={},l(o,function(e){t(c[i],e)}),c=c[i]),null!=r&&(c[i]=r.prototype),null!=u)for(var f in u)a[f]=e(a,f,u[f]);n.prototype=a}function r(e,n,r,i){if(null!=n){var o=function(){};o.prototype=n.prototype,e.prototype=new o,e.prototype.constructor=e}null!=r&&l(r,function(n){delete n.constructor,t(e,n)}),t(e,i)}var i="__proto__",o=Object.prototype.toString,s=function(t){return"[object Arguments]"===o.call(t)};return"__proto__"in Object.prototype==!0?n:r}(),C=function(t,e){if(null!=e)if("function"!=typeof e)if(Array.isArray(e))for(var n=e.length,r=0;0!==n--;)C(t,e[r++]);else if(e.Static){e=e.Static;for(var i in e)e.hasOwnProperty(i)&&null==t[i]&&(t[i]=e[i])}else;else for(var i in e)"function"==typeof e[i]&&e.hasOwnProperty(i)&&null==t[i]&&(t[i]=e[i])},O={toJSON:function(){var t,e,n={};for(t in this)(95!==t.charCodeAt(0)||"_id"===t)&&"Static"!==t&&"Validate"!==t&&(e=this[t],null!=e&&"function"!=typeof e&&(n[t]=e));return n},arrayToJSON:function(){for(var t,e=Array(this.length),r=0,i=this.length;i>r;r++){if(t=this[r],"object"!=typeof t)return e[r]=t,void 0;e[r]=n(t.toJSON)?t.toJSON():O.toJSON.call(t)}return e}},k={};l(["get"],function(t){k[t]=function(e,n){this.promise[t](e).then(function(t,e){return t?(n.onError(t,e),void 0):(n.onSuccess(e),void 0)})}}),l(["del","post","put"],function(t){k[t]=function(e,n,r){this.promise[t](e,n).then(function(t,e){r(t,e)})}}),function(t){function e(t,e){return function(){return t.apply(e,arguments)}}function n(){this._callbacks=[]}function r(t){function e(t){return function(e,n){i+=1,l[t]=e,s[t]=n,i===r&&o.done(l,s)}}for(var r=t.length,i=0,o=new n,l=[],s=[],u=0;r>u;u++)t[u]().then(e(u));return o}function i(t,e,r){var o=new n;return 0===t.length?o.done(e,r):t[0](e,r).then(function(e,n){t.splice(0,1),i(t,e,n).then(function(t,e){o.done(t,e)})}),o}function o(t){var e="";if("string"==typeof t)e=t;else{var n=encodeURIComponent;for(var r in t)t.hasOwnProperty(r)&&(e+="&"+n(r)+"="+n(t[r]))}return e}function l(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t}function s(e,r,i,s){function u(){a.abort(),f.done(t.promise.ETIMEOUT,"")}var a,c,f=new n;i=i||{},s=s||{};try{a=l()}catch(h){return f.done(-1,""),f}c=o(i),"GET"===e&&c&&(r+="?"+c,c=null),a.open(e,r),a.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var p in s)s.hasOwnProperty(p)&&a.setRequestHeader(p,s[p]);var d=t.promise.ajaxTimeout;if(d)var g=setTimeout(u,d);return a.onreadystatechange=function(){d&&clearTimeout(g),4===a.readyState&&(200===a.status?f.done(null,a.responseText):f.done(a.status,a.responseText))},a.send(c),f}function u(t){return function(e,n,r){return s(t,e,n,r)}}n.prototype.then=function(t,n){var r=e(t,n);this._isdone?r(this.error,this.result):this._callbacks.push(r)},n.prototype.done=function(t,e){this._isdone=!0,this.error=t,this.result=e;for(var n=0;this._callbacks.length>n;n++)this._callbacks[n](t,e);this._callbacks=[]};var a={Promise:n,join:r,chain:i,ajax:s,get:u("GET"),post:u("POST"),put:u("PUT"),del:u("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0};"function"==typeof define&&define.amd?define(function(){return a}):t.promise=a}(k),y.prototype={constructor:y,serialize:function(){return JSON.stringify(this)},deserialize:function(t){if(i(t))try{t=JSON.parse(t)}catch(e){return console.error("<json:deserialize>",t),this}{if(!r(t)||!n(this.push)){var o,l,s=this._props;for(o in t){if(null!=s&&(l=s[o],null!=l)){if(n(l)){this[o]=new l(t[o]);continue}var u=l.deserialize;if(n(u)){this[o]=u(t[o]);continue}}this[o]=t[o]}return this}this.length=0;for(var a=0,c=t.length;c>a;a++)this.push(t[a])}}};var N=function(){function t(t){this.route=r(t)}function e(t){var e=o.exec(t);return e?{optional:"?"===(e[2]||e[3]),parts:[e[1],e[4]]}:(e=l.exec(t))?{optional:"?"===e[3],parts:[e[1],e[4],e[5]]}:(console.error("Paths breadcrumbs should be matched by regexps"),{parts:[t]})}function n(t,n){for(var r=t.split(n),i=0,o=r.length;o>i;i++)r[i]=e(r[i]);return r}function r(t){var e=/[^\:\{]\?[^:]/.exec(t),r=null;return e&&(e=e.index+1,r=t.substring(e+1),t=t.substring(0,e)),{path:n(t,"/"),query:null==r?null:n(r,"&")}}function i(t,e,n){for(var r,i,o,l=[],s=0,u=t.length;u>s;s++)if(o=t[s],i=o.parts.slice(0),null!=i[1]){if(r=i[1],i[1]=e[r],null!=i[1])l.push(i.join(""));else if(!o.optional)return console.error("Object has no value, for not optional part - ",r),null}else l.push(i[0]);return l.join(n)}t.prototype={constructor:t,create:function(t){var e,n;return e=i(this.route.path,t,"/"),null==e?null:this.route.query&&(n=i(this.route.query,t,"&"),null==n)?null:e+(n?"?"+n:"")},hasAliases:function(t){for(var e,n=0,r=this.route.path.length;r>n;n++)if(e=this.route.path[n].parts[1],e&&null==t[e])return!1;return!0}};var o=/^([^:\?]*)(\??):(\??)([\w]+)$/,l=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return t}();b.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,deferr:function(){this._rejected=null,this._resolved=null},resolve:function(){this._fail=null,this._resolved=arguments;var t,e,n=this._done,r=this._always;if(this._done=null,this._always=null,null!=n){for(t=n.length,e=0;0!==t--;)n[e++].apply(this,arguments);n.length=0}if(null!=r)for(t=r.length,e=0;0!==t--;)r[e++].call(this,this);return this},reject:function(){this._done=null,this._rejected=arguments;var t,e,n=this._fail,r=this._always;if(this._fail=null,this._always=null,null!=n)for(t=n.length,e=0;0!==t--;)n[e++].apply(this,arguments);if(null!=r)for(t=r.length,e=0;0!==t--;)r[e++].call(this,this);return this},done:function(t){return null!=this._resolved?t.apply(this,this._resolved):(this._done||(this._done=[])).push(t),this},fail:function(t){return null!=this._rejected?t.apply(this,this._rejected):(this._fail||(this._fail=[])).push(t),this},always:function(t){return null!=this._rejected||null!=this._resolved?t.call(this,this):(this._always||(this._always=[])).push(t),this}};var j=function(){function t(){this._listeners={}}return t.prototype={constructor:t,on:function(t,e){return null!=e&&(this._listeners[t]||(this._listeners[t]=[])).push(e),this},once:function(t,e){return null!=e&&(e._once=!0,(this._listeners[t]||(this._listeners[t]=[])).push(e)),this},pipe:function(t){var e,n=this,r=Array.prototype.slice;return function(){e=r.call(arguments),e.unshift(t),n.trigger.apply(n,e)}},trigger:function(){var t,e,n=Array.prototype.slice.call(arguments),r=n.shift(),i=this._listeners[r],o=0;if(null==i)return this;for(e=i.length;e>o;o++)t=i[o],t.apply(this,n),t._once===!0&&(i.splice(o,1),o--,e--);return this},off:function(t,e){var n=this._listeners[t];if(null==n)return this;if(1===arguments.length)return n.length=0,this;for(var r=n.length,i=0;r>i;i++)n[i]===e&&n.splice(i,1),i--,r--;return this}},t}(),A=function(){function t(t,r,i){if(n(r))return r.call(t);var o,l;if(i){for(var s=0,u=i.length;u>s;s++)if(l=i[s],o=e(t,l,r[l]))return o}else for(l in r)if(o=e(t,l,r[l]))return o}function e(t,e,r){if(n(r)===!1)return"<validation> Function expected for "+e;var i=f(t,e);return r.call(t,i)}function r(e){var n,r;return arguments.length>1&&"string"==typeof arguments[1]&&(r=_.call(arguments,1)),null!=e.Validate&&(n=t(e,e.Validate,r))?n:void 0}return{validate:r}}(),S=function(t){var e,n=t.Base,i=t.Extends,o=t.Static,l=t.Construct,s=null,u=t.Store,c=t.Self,f=t.Override;if(null!=n&&delete t.Base,null!=i&&delete t.Extends,null!=o&&delete t.Static,null!=c&&delete t.Self,null!=l&&delete t.Construct,null!=u&&(null==i?i=u:r(i)?i.unshift(u):i=[u,i],delete t.Store),null!=f&&delete t.Override,void 0===t.toJSON&&(t.toJSON=O.toJSON),null==n&&null==i&&null==c){if(s=null==l?function(){}:l,t.constructor=s.prototype.constructor,null!=o)for(e in o)s[e]=o[e];return s.prototype=t,s}if(s=function(){if(null!=i)for(var t=i instanceof Array,e=t?i.length:1,r=null,o=0;t?e>o:1>o;o++)r=t?i[o]:i,"function"==typeof r&&r.apply(this,arguments);if(null!=n&&n.apply(this,arguments),null!=c)for(var s in c)this[s]=g(c[s],this);if(null!=l){var u=l.apply(this,arguments);if(null!=u)return u}return this},null!=o)for(e in o)s[e]=o[e];return null!=n&&C(s,n),null!=i&&C(s,i),a(t,n,i),w(s,n,i,t,f),t=null,o=null,s};S.bind=function(t){for(var e,n=arguments,r=1,i=arguments.length;i>r;r++)e=n[r],t[e]=t[e].bind(t);return t},S.Serializable=y,S.Deferred=b,S.EventEmitter=j,S.validate=A.validate,S.Collection=function(){function t(t,e){return e instanceof t?e:new t(e)}function e(t,e){return function(){return this.length=0,this._constructor=e,null!=t?t.apply(this,arguments):this}}function r(t,n){return n.Construct=e(n.Construct,t),c(n,o,i),S(n)}var i=function(){function e(t,e){if(null==e)return!1;if("function"==typeof e)return e(t);if("object"==typeof e){if(t.constructor===e.constructor&&t.constructor!==Object)return t===e;var n,r;for(var i in e){if(n=t[i],r=e[i],"string"==typeof r){var o=r[0],l=1;if("<"===o||">"===o)switch("="===r[1]&&(o+="=",l++),r=r.substring(l),o){case"<":if(n>=r)return!1;continue;case"<=":if(n>r)return!1;continue;case">":if(r>=n)return!1;continue;case">=":if(r>n)return!1;continue}}if(n!=r)return!1}return!0}return console.warn("No valid matcher",e),!1}var n={push:function(){for(var e=0,n=arguments.length;n>e;e++)this[this.length++]=t(this._constructor,arguments[e]);return this},pop:function(){var t=this[--this.length];return this[this.length]=null,t},shift:function(){if(0===this.length)return null;for(var t=this[0],e=this.length-1,n=0;e>n;n++)this[n]=this[n+1];return this[e]=null,this.length--,t},unshift:function(e){this.length++;for(var n=this.length;--n;)this[n]=this[n-1];return this[0]=t(this._constructor,e),this},splice:function(e,n){var r,i,o;if(e>=this.length)for(n=0,r=this.length,i=e;i>r;r++)this[r]=void 0;var l=n,s=e,u=e+l,a=arguments.length-2,c=this.length+a-l,f=u,h=this.length,p=c-this.length;if(p>0)for(r=h;--r>=f;)this[r+p]=this[r];if(0>p)for(r=f;h>r;)this[r+p]=this[r],r++;for(r=s,o=2;arguments.length>o;o)this[r++]=t(this._constructor,arguments[o++]);return this.length=c,this},slice:function(){return _.apply(this,arguments)},sort:function(t){return x.call(this,t),this},reverse:function(){for(var t=_.call(this,0),e=0,n=this.length;n>e;e++)this[e]=t[n-e-1];return this},toString:function(){return""+_.call(this,0)},each:function(t,e){for(var n=0,r=this.length;r>n;n++)t.call(e||this,this[n],n);return this},where:function(t){for(var n,r=new this.constructor,i=0,o=this.length;o>i;i++)n=this[i],e(n,t)&&(r[r.length++]=n);return r},remove:function(t){for(var n=-1,r=[],i=0,o=this.length;o>i;i++)e(this[i],t)?r.push(this[i]):this[++n]=this[i];for(i=++n;o>i;i++)this[i]=null;return this.length=n,r},first:function(t){if(null==t)return this[0];var e=this.indexOf(t);return-1!==e?this[e]:null},last:function(t){if(null==t)return this[this.length-1];var e=this.lastIndexOf(t);return-1!==e?this[e]:null},indexOf:function(t,n){if(null==t)return-1;if(null!=n){if(0>n&&(n=0),n>=this.length)return-1}else n=0;for(var r=this.length;r>n;n++)if(e(this[n],t))return n;return-1},lastIndexOf:function(t,n){if(null==t)return-1;if(null!=n){if(n>=this.length&&(n=this.length-1),0>n)return-1}else n=this.length-1;for(;n>-1;n--)if(e(this[n],t))return n;return-1}};return n}(),o={toArray:function(){for(var t=Array(this.length),e=0,n=this.length;n>e;e++)t[e]=this[e];return t},toJSON:function(){for(var t,e=Array(this.length),r=0,i=this.length;i>r;r++)t=this[r],null!=t&&(e[r]=n(this[r].toJSON)?this[r].toJSON():O.toJSON.call(this[r]));return e}};return r}();var T={deserialize:function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return console.error("<json:deserialize>",t),this}if(r(t)&&n(this.push)){for(var i=0,o=t.length;o>i;i++)this.push(t[i]);return this}for(var l in t)this[l]=t[l];return this},serialize:function(){var t=this;return v(t.toArray)&&(t=t.toArray()),JSON.stringify(t)},fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(t){return(new this).fetch(t)}}};S.Remote=function(){var t=function(t){this._route=new N(t)};return c(t,T,b,{serialize:function(){return r(this)?O.arrayToJSON.call(this):O.toJSON.call(this)},fetch:function(t){return k.get(this._route.create(t||this),this),this},save:function(t){var e=this,n=this.serialize(),r=this._route.create(this),i=this._route.hasAliases(this)?"put":"post";return this._resolved=null,this._rejected=null,k[i](r,n,function(n,r){return t&&t(n,r),n?e.reject(n):(e.resolve(r),void 0)}),this},del:function(t){var e=this,n=this.serialize(),r=this._route.create(this);return this._resolved=null,this._rejected=null,k.del(r,n,function(n,r){return t&&t(n,r),n?e.reject(n):(e.resolve(r),void 0)}),this},onSuccess:function(t){var e;try{e=JSON.parse(t)}catch(n){return this.onError(n),void 0}this.deserialize(e),this.resolve(this)},onError:function(t){this.reject({error:t})}}),function(e){return new t(e)}}(),S.MongoStore=function(){var t,e,n,i,l,u,a,f="127.0.0.1",h=27017,p=function(e){e.ip&&(f=e.ip),e.port&&(h=e.port),e.db&&(t=e.db)};(function(){var r,s;e=function(t,n,i){return null==r?c(m(e,t,n,i)):(n=p(n),r.collection(t).findOne(n,function(t,e){i(t,e)}),void 0)},n=function(t,e,i){return null==r?c(m(n,t,e,i)):(e=p(e),r.collection(t).find(e,function(t,e){return t?(i(t),void 0):(e.toArray(function(t,e){i(t,e)}),void 0)}),void 0)},i=function(t,e,n){return null==r?c(m(i,t,e,n)):(r.collection(t).insert(e,{safe:!0},n),void 0)},l=function(t,e,n){return null==r?c(m(l,t,e,n)):(r.collection(t).update({_id:p({_id:e._id})},e,{upsert:!0,multi:!1},function(t){n(t)}),void 0)},u=function(t,e,n){l(t,e.shift(),function(r){return r?n(r):0===e.length?n():(u(t,e,n),void 0)})},a=function(t,e,n,i){return null==r?c(a.bind(null,t,e,i)):(e=p(e),r.collection(t).remove(e,{justOne:n},function(t){i(t)}),void 0)};var c=function(){var e=[],n=!1;return function(i){if(r)return i();if(null==t)return i('Database is not set. Call Class.MongoStore.settings({db:"myDbName"})');if(e.push(i),!n){n=!0,s=require("mongodb");var o=s.MongoClient,l=s.Server;new o(new l(f,h,{auto_reconnect:!0})).open(function(n,i){r=i.db(t);for(var o,l=0,s=e.length;s>l;l++)o=e[l],o();e=null})}}}(),p=function(t){if(null==t)return 0!==arguments.length&&console.warn("<mongo> query should not be empty"),t;if(t.hasOwnProperty("$query")||t.hasOwnProperty("$limit"))return t;o(t._id)&&(t._id=s.ObjectID(t._id));var e={62:{0:"$gt",61:"$gte"},60:{0:"$lt",61:"$lte"}};for(var n in t){var r,i=t[n];if("string"==typeof i)switch(r=i.charCodeAt(0)){case 62:case 60:var l=e[r]["0"];61===i.charCodeAt(1)?(l=e[r]["61"],i=i.substring(2)):i=i.substring(1),t[n]={},t[n][l]=parseInt(i);continue}}return t}})();var d=function(){function t(t){t||console.error("<MongoStore> should define a collection name"),this._collection=t}c(t,T,b,{_busy:!1,fetch:function(t){return this._ensureFree()===!1?this:(e(this._collection,t,g(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;var t=this.serialize(),e=null==t._id?i:l;return e(this._collection,t,g(this._inserted,this)),this},del:function(){return this._ensureFree()===!1?this:(this._id?a(this._collection,{_id:this._id},!0,g(this._completed,this)):this._completed(),this)},Static:{fetch:function(t){return(new this).fetch(t)}},serialize:O.toJSON,_ensureFree:function(){return this._busy?(console.warn("<mongo:single> requested transport, but is busy by the same instance."),!1):(this._busy=!0,this._resolved=null,this._rejected=null,!0)},_completed:function(t){this._busy=!1,t?this.reject(t):this.resolve(this)},_fetched:function(t,e){this.deserialize(e),this._completed(t)},_inserted:function(t,e){null!=e&&null==this._id&&(r(e)&&1===e.length?this._id=e[0]._id:console.error("<mongo:insert-single> expection an array in callback")),this._completed(t)}});var n=function(e){return new t(e)};return n.prototype=t.prototype,n}(),y=function(){function t(t){t||console.error("<MongoStore> should define a collection name"),this._collection=t}function e(t,e){var n=t._constructor,r=new n(e);null==r._id&&v(r.deserialize)&&r.deserialize(e),t[t.length++]=r}function o(t,e){var n;return function(r){r&&(n=r),0===--t&&e(n)}}c(t,b,{fetch:function(t){return this._ensureFree()===!1?this:(n(this._collection,t,g(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;for(var t,e=[],n=[],r=[],l=this._collection,s=g(this._completed,this),a=0,c=this.length;c>a;a++)t=this[a],null!=t._id?r.push(t.serialize()):(e.push(t.serialize()),n.push(a));if(e.length&&r.length){var f=o(2,s);return i(l,e,this._insertedDelegate(this,f,n)),u(l,r,f),this}return e.length?(i(l,e,this._insertedDelegate(this,this._completed,n)),this):r.length?(u(l,r,s),this):this},del:function(t){if(null==t&&0!==arguments.length)return console.error("<MongoStore:del> - selector is specified, but is undefined"),this;if(this._ensureFree()===!1)return this;var e=null==t?this.toArray():this.remove(t);if(e&&e.length){for(var n,r=[],i=0,o=e.length;o>i;i++)n=e[i],n._id&&r.push(n._id);a(this._collection,{_id:{$in:r}},!1,g(this._completed,this))}else this._completed();return this},Static:{fetch:function(t){return(new this).fetch(t)}},_busy:!1,_ensureFree:function(){return this._busy?(console.warn("<mongo:collection> requested transport, but is busy by the same instance."),!1):(this._busy=!0,this._resolved=null,this._rejected=null,!0)},_completed:function(t){this._busy=!1,t?this.reject(t):this.resolve(this)},_fetched:function(t,n){if(s(n))for(var r,i=0,o=n.length;o>i;i++)r=n[i],e(this,r);else n&&e(this,n);this._completed(t)},_insertedDelegate:function(t,e,n){function i(){e.call(t)}return function(e,o){if(r(o)===!1)return console.error("<mongo:bulk insert> array expected"),i();if(o.length!==n.length)return console.error("<mongo:bul insert> count missmatch",o.length,n.length),i();for(var l,s=0,u=n.length;u>s;s++)l=n[s],t[l]._id=o[s]._id;i()}}});var l=function(e){return new t(e)};return l.prototype=t.prototype,l}();return{Single:d,Collection:y,settings:p}}(),function(){function t(t,e){if(t.length!==e.length)return!1;for(var n=t.length,r=0;n>r;r++)if(t[r]!==e[r])return!1;return!0}function e(e,n){if(0===n.length)return 0;for(var r=0,i=e.length;i>r;r++)if(t(e[r],n))return r+1;return e.push(n),e.length}function n(t){var n={},r=[];return function(){var i=e(r,arguments);return null==n[i]?n[i]=t.apply(this,arguments):n[i]}}function r(t,e,n){return function(){t[n]=arguments;for(var r,i=0,o=e[n].length;o>i;i++)r=e[n][i],r.apply(this,arguments);e[i]=null,t=null,e=null}}function i(t){var n={},i={},o=[];return function(){var l=Array.prototype.slice.call(arguments),s=l.pop(),u=e(o,l);return n[u]?(s.apply(this,n[u]),void 0):i[u]?(i[u].push(s),void 0):(i[u]=[s],l=Array.prototype.slice.call(l),l.push(r(n,i,u)),t.apply(this,l),void 0)}}S.Fn={memoize:n,memoizeAsync:i}}(),e.Class=S}),function(t,e){"use strict";var n,r,i;"undefined"==typeof exports||t!==exports&&null!=t||(n=r=global),null==n&&(n="undefined"==typeof window?global:window),null==r&&(r=t||n),i=n.document,e(n,r,i)}(this,function(global,exports,document){"use strict";function fn_proxy(t,e){return function(){t.apply(e,arguments)}}function fn_doNothing(t){"function"==typeof t&&t()}function obj_inherit(t){"function"==typeof t&&(t=t.prototype);for(var e,n,r=1,i=arguments.length;i>r;r++){e="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in e)t[n]=e[n]}return t}function arr_invoke(t,e,n){if(null!=t&&t instanceof Array!=!1)for(var r=0,i=t.length;i>r;r++)"function"==typeof t[r]&&(null==e?t[r].call(n):t[r].apply(n,e))}function arr_ensure(t,e){if(!e)return t;for(var n,r=e.split("."),i=r.length-1,o=0;i>o;o++)n=r[o],t=t[n]||(t[n]={});return n=r[i],t[n]||(t[n]=[])}function path_getDir(t){var e=t.lastIndexOf("/");return-1===e?"":t.substring(e+1,-e)}function path_resolveCurrent(){if(null==document)return"undefined"==typeof module?"":path_win32Normalize(module.parent.filename);var t=document.getElementsByTagName("script"),e=t[t.length-1],n=e&&e.getAttribute("src")||"";if("/"===n[0])return n;var r=window.location.pathname.replace(/\/[^\/]+\.\w+$/,"");return"/"!==r[r.length-1]&&(r+="/"),r+n}function path_win32Normalize(t){return t=t.replace(/\\/g,"/"),"file:"===t.substring(0,5)?t:"file:///"+t}function path_resolveUrl(t,e){switch(cfg.path&&"/"===t[0]&&(t=cfg.path+t.substring(1)),t.substring(0,5)){case"file:":case"http:":return t}for("./"===t.substring(0,2)&&(t=t.substring(2)),"/"===t[0]?(isWeb===!1||cfg.lockedToFolder===!0)&&(t=t.substring(1)):null!=e&&null!=e.location&&(t=e.location+t);-1!==t.indexOf("../");)t=t.replace(reg_subFolder,"");return t}function path_isRelative(t){var e=t.charCodeAt(0);switch(e){case 47:return!1;case 102:case 104:return/^file:|https?:/.test(t)===!1}return!0}function path_getExtension(t){var e=t.indexOf("?");return-1===e?t.substring(t.lastIndexOf(".")+1):t.substring(t.lastIndexOf(".",e)+1,e)}var bin={},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),reg_subFolder=/([^\/]+\/)?\.\.\//,cfg={path:null,loader:null,version:null,lockedToFolder:null,sync:null,eval:null==document},handler={},hasOwnProp={}.hasOwnProperty,emptyResponse={load:{}},__array_slice=Array.prototype.slice,XMLHttpRequest=global.XMLHttpRequest,Helper={reportError:function(t){console.error("IncludeJS Error:",t,t.message,t.url),"function"==typeof handler.onerror&&handler.onerror(t)}},XHR=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&e&&e(t,n.responseText)},n.open("GET","object"==typeof t?t.url:t,!0),n.send()},RoutesLib=function(){var t={},e=/([^\\\/]+)\.\w+$/;return{register:function(e,n,r){if("string"==typeof n&&path_isRelative(n)){var i=r||include,o=i.location||path_getDir(i.url||path_resolveCurrent());path_isRelative(o)&&(o="/"+o),n=o+n}t[e]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(e,n){var r,i,o,l,s,u,a,c,f=n.indexOf("?"),h=n.indexOf("::");if(-1!==h&&(r=n.substring(h+2),n=n.substring(0,h)),-1!==f){for(c=n.substring(f+1).split("&"),o={},s=0,a=c.length;a>s;s++)u=c[s].split("="),o[u[0]]=u[1];n=n.substring(0,f)}if(n=n.split("/"),l=t[e],null==l)return{path:n.join("/"),params:o,alias:r};for(i=l[0],s=1;l.length>s;s++)if(0===s%2)i+=l[s];else{var p=l[s]<<0;if(p>n.length-1&&(p=n.length-1),i+=n[p],s===l.length-2)for(p++;n.length>p;p++)i+="/"+n[p]}return{path:i,params:o,alias:r}},each:function(t,e,n,r,i){var o;if(null!=e)if("lazy"!==t||null!=i)if(e instanceof Array)for(var l=0;e.length>l;l++)this.each(t,e[l],n,r,i);else if("object"!=typeof e){if("string"==typeof e){var s=this.resolve(r,e);return r&&(r+="."+e),n(r,s,i),void 0}console.error("Include Package is invalid",arguments)}else for(o in e)hasOwnProp.call(e,o)&&this.each(t,e[o],n,o,i);else for(o in e)this.each(t,e[o],n,null,o)},getRoutes:function(){return t},parseAlias:function(t){var n=t.path,r=e.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(t){function e(){Events.ready=fn_doNothing,null!=n&&(arr_invoke(n),n=null)}if(null==t)return{ready:fn_doNothing,load:fn_doNothing};var n=[];return"onreadystatechange"in t?t.onreadystatechange=function(){/complete|interactive/g.test(t.readyState)!==!1&&e()}:t.addEventListener?t.addEventListener("DOMContentLoaded",e):window.onload=e,{ready:function(t){n.unshift(t)}}}(document),ScriptStack=function(){function t(t,e){var n=document.createElement("script");n.type="text/javascript",n.src=t,"onreadystatechange"in n?n.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&e()}:n.onload=n.onerror=e,(i||(i=document.getElementsByTagName("head")[0])).appendChild(n)}function e(){function n(t){t&&"error"===t.type&&console.log("Script Loaded Error",i.url);for(var n=0,r=s.length;r>n;n++)if(s[n]===i){s.splice(n,1);break}return n===r?(console.error("Loaded Resource not found in stack",i),void 0):(i.readystatechanged(3),o=null,e(),void 0)}if(!l){if(0===s.length)return r(),void 0;if(null==o){var i=o=s[0];if(1!==i.state)return i.state=1,global.include=i,global.iparams=i.route.params,i.source?(__eval(i.source,i),n(),void 0):(t(i.url,n),void 0)}}}function n(){if(!l){if(0===s.length)return r(),void 0;if(null==o){var t=s[0];if(!(2>t.state)){o=t,t.state=1,global.include=t,__eval(t.source,t);for(var e,i=0,u=s.length;u>i;i++)if(e=s[i],e===t){s.splice(i,1);break}t.readystatechanged(3),o=null,n()}}}}function r(){for(var t=-1,e=u.length;e>++t;)u[t]();u.length=0}var i,o,l,s=[],u=[];return{load:function(t,r,i){var o=!1;if(r)for(var l=0,u=s.length;u>l;l++)if(s[l]===r){s.splice(l,0,t),o=!0;break}return o||s.push(t),!cfg.eval||i?(e(),void 0):t.source?(t.state=2,n(),void 0):(XHR(t,function(t,e){e||console.error("Not Loaded:",t.url),t.source=e,t.state=2,n()}),void 0)},moveToParent:function(t,e){var n,r=s.length,i=-1,o=-1;for(n=0;r>n;n++)if(s[n]===t){o=n;break}if(-1!==o){for(n=0;r>n;n++)if(s[n]===e){i=n;break}-1!==i&&(i>o||(s.splice(o,1),s.splice(i,0,t)))}},pause:function(){l=!0},resume:function(){if(l=!1,null==o){var t=cfg.eval?n:e;t()}},complete:function(t){return l===!1&&0===s.length?(t(),void 0):(u.push(t),void 0)}}}(),IncludeDeferred=function(){this.callbacks=[],this.state=-1};IncludeDeferred.prototype={on:function(t,e,n){if(this===n&&-1===this.state)return e(this),this;var r=3>this.state||this===n?"unshift":"push";return this.state>=t?e(this):this.callbacks[r]({state:t,callback:e}),this},readystatechanged:function(t){var e,n,r,i;if(t>this.state&&(this.state=t),3===this.state){var o=this.includes;if(null!=o&&o.length)for(e=0;o.length>e;e++)if(4!==o[e].resource.state)return;this.state=4}if(e=0,n=this.callbacks.length,0!==n){for("js"===this.type&&4===this.state&&(i=global.include,global.include=this);n>e&&(r=this.callbacks[e],null==r||r.state>this.state||(this.callbacks.splice(e,1),n--,e--,r.callback(this),!(4>this.state)));e++);null!=i&&(global.include=i)}},ready:function(t){var e=this;return this.on(4,function(){Events.ready(function(){e.resolve(t)})},this)},done:function(t){var e=this;return this.on(4,function(){e.resolve(t)},this)},resolve:function(t){var e=this.includes,n=null==e?0:e.length;if(n>0&&null==this.response){this.response={};for(var r,i,o,l=0;n>l;l++)if(o=e[l],r=o.resource,i=o.route,void 0!==r.exports){var s=r.type;switch(s){case"js":case"load":case"ajax":var u=i.alias||Routes.parseAlias(i),a="js"===s?this.response:this.response[s]||(this.response[s]={});if(u){a[u]=r.exports;break}console.warn("Resource Alias is Not defined",r)}}}t(this.response||emptyResponse)}};var Include=function(IncludeDeferred){function Include(){IncludeDeferred.call(this)}function embedPlugin(source){eval(source)}function enableModules(){return Object.defineProperty===void 0?(console.warn("Browser do not support Object.defineProperty"),void 0):(Object.defineProperty(global,"module",{get:function(){return global.include}}),Object.defineProperty(global,"exports",{get:function(){var t=global.include;return t.exports||(t.exports={})},set:function(t){global.include.exports=t}}),void 0)}function includePackage(t,e,n){var r=1===n.length?n[0]:__array_slice.call(n);return t instanceof Resource?t.include(e,r):new Resource("js").include(e,r)}function createIncluder(t){return function(){return includePackage(this,t,arguments)}}function doNothing(){return this}function stub_freeze(t){t.js=t.css=t.load=t.ajax=t.embed=t.lazy=t.inject=doNothing}function stub_release(t){for(var e=["js","css","load","ajax","embed","lazy"],n=e.length;-1!==--n;)t[e[n]]=createIncluder(e[n]);t.inject=t.js}return stub_release(Include.prototype),obj_inherit(Include,IncludeDeferred,{setCurrent:function(t){var e=new Resource("js",{path:t.id},t.namespace,null,null,t.id);4!==e.state&&console.error("<include> Resource should be loaded",t),e.state=3,global.include=e},cfg:function(t){switch(typeof t){case"object":var e,n;for(e in t)switch(n=t[e],e){case"loader":for(var r in n)CustomLoader.register(r,n[r]);break;case"modules":n===!0&&enableModules();break;default:cfg[e]=n}break;case"string":if(1===arguments.length)return cfg[t];2===arguments.length&&(cfg[t]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(t){if(null==t)return Routes.getRoutes();if(2===arguments.length)return Routes.register(t,arguments[1]),this;for(var e in t)Routes.register(e,t[e]);return this},promise:function(t){for(var e=t.split("."),n=global;e.length;){var r=e.shift();n=n[r]||(n[r]={})}return n},register:function(t){for(var e in t)for(var n=0;t[e].length>n;n++){var r=t[e][n].id,i=t[e][n].url,o=t[e][n].namespace,l=new Resource;switch(i&&("/"===i[0]&&(i=i.substring(1)),l.location=path_getDir(i)),l.state=4,l.namespace=o,l.type=e,l.url=i||r,e){case"load":case"lazy":var s=document.querySelector("#includejs-"+r.replace(/\W/g,""));if(null==s){console.error('"%s" Data was not embedded into html',r);break}l.exports=s.innerHTML,CustomLoader.exists(l)&&(l.state=3,CustomLoader.load(l,function(t,e){t.exports=e,t.readystatechanged(4)}))}(bin[e]||(bin[e]={}))[r]=l}},instance:function(t){var e;return null==t?(e=new Include,e.state=4,e):(e=new Resource,e.state=4,e.location=path_getDir(t),e)
},getResource:function(t,e){var n=t;if(47!==t.charCodeAt(0)&&(n="/"+n),null!=e)return bin[e][n];for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null},getResources:function(){return bin},plugin:function(t,e){var n=[],r=0,i=0,o=0,l=function(t,n){i++,embedPlugin(n),i===r-1&&e&&(e(),e=null)};for(Routes.each("",t,function(t,e){n.push("/"===e.path[0]?e.path.substring(1):e.path)}),r=n.length;r>o;o++)XHR(n[o],l);return this},client:function(){return cfg.server===!0&&stub_freeze(this),this},server:function(){return cfg.server!==!0&&stub_freeze(this),this},pauseStack:ScriptStack.pause,resumeStack:ScriptStack.resume,allDone:ScriptStack.complete}),Include}(IncludeDeferred),CustomLoader=function(){function t(t){return"string"==typeof t?!1:"function"==typeof t.ready||"function"==typeof t.process}function e(e){var n=path_getExtension(e),r=cfg.loader[n];if(t(r))return r;var i,o=r;if("object"==typeof o)for(var l in o){i=l,o=o[l];break}return cfg.loader[n]=new Resource("js",Routes.resolve(i,o),i)}function n(t,e){return function(n){t(e,n)}}function r(t,e,r,i){var o=n(i,e),l=r.process(t,e,o);l!==void 0&&i(e,l)}function i(t,e,n){return"string"==typeof t.exports?(r(t.exports,t,e,n),void 0):(XHR(t,function(t,i){r(i,t,e,n)}),void 0)}var o={process:function(t){try{return JSON.parse(t)}catch(e){return console.error(e,t),null}}};return cfg.loader={json:o},{load:function(t,n){var r=e(t.url);return r.process?(i(t,r,n),void 0):(r.done(function(){i(t,r.exports,n)}),void 0)},exists:function(t){if(!t.url)return!1;var e=path_getExtension(t.url);return cfg.loader.hasOwnProperty(e)},register:function(t,e){if("string"==typeof e){var n=include;null==n.location&&(n={location:path_getDir(path_resolveCurrent())}),e=path_resolveUrl(e,n)}cfg.loader[t]=e}}}(),LazyModule={create:function(t,e){for(var n=t.split("."),r=global,i=n[n.length-1];n.length>1;){var o=n.shift();r=r[o]||(r[o]={})}n=null,Object.defineProperty(r,i,{get:function(){delete r[i];try{var n=__eval(e,global.include);null==n||n instanceof Resource||(r[i]=n)}catch(o){o.xpath=t,Helper.reportError(o)}finally{return e=null,t=null,r[i]}}})}},Resource=function(t,e,n,r){function i(t){var e=t.type,i=t.parent,l=t.url;if(null==document&&"css"===e)return t.state=4,t;if(r.exists(t)===!1)switch(e){case"js":case"embed":n.load(t,i,"embed"===e);break;case"ajax":case"load":case"lazy":XHR(t,o);break;case"css":t.state=4;var s=document.createElement("link");s.href=l,s.rel="stylesheet",s.type="text/css",document.getElementsByTagName("head")[0].appendChild(s)}else r.load(t,o);return t}function o(t,e){switch(e||console.warn("Resource cannt be loaded",t.url),t.type){case"js":case"embed":return t.source=e,n.load(t,t.parent,"embed"===t.type),void 0;case"load":case"ajax":t.exports=e;break;case"lazy":LazyModule.create(t.xpath,e);break;case"css":var r=document.createElement("style");r.type="text/css",r.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(r)}t.readystatechanged(4)}function l(t,e,n){if(null==t)return null;null==n&&(n=[]);for(var r,i=0,o=t.length;o>i;i++)r=t[i].resource,e===r.type&&n.push(r),null!=r.includes&&l(r.includes,e,n);return n}var s=function(e,r,o,l,s,u){t.call(this),this.childLoaded=fn_proxy(this.childLoaded,this);var a=r&&r.path;null!=a&&(this.url=a=path_resolveUrl(a,s)),this.route=r,this.namespace=o,this.type=e,this.xpath=l,this.parent=s,null==u&&a&&(u=("/"===a[0]?"":"/")+a);var c=bin[e]&&bin[e][u];return c?(4>c.state&&"js"===e&&n.moveToParent(c,s),c):null==a?(this.state=3,this.location=path_getDir(path_resolveCurrent()),this):(this.state=0,this.location=path_getDir(a),(bin[e]||(bin[e]={}))[u]=this,cfg.version&&(this.url+=(-1===this.url.indexOf("?")?"?":"&")+"v="+cfg.version),i(this))};return s.prototype=obj_inherit(s,t,{childLoaded:function(){var t=this,e=t.includes;if(e&&e.length){if(3>t.state)return;for(var n=0;e.length>n;n++)if(4!==e[n].resource.state)return}t.readystatechanged(4)},create:function(t,e,n,r,i){var o;return this.state=this.state>=3?3:2,this.response=null,null==this.includes&&(this.includes=[]),o=new s(t,e,n,r,this,i),this.includes.push({resource:o,route:e}),o},include:function(t,n){var r=this;return e.each(t,n,function(e,n,i){(null==r.route||r.route.path!==n.path)&&r.create(t,n,e,i).on(4,r.childLoaded)}),this},getNestedOfType:function(t){return l(this.includes,t)}}),s}(Include,Routes,ScriptStack,CustomLoader);exports.include=new Include,exports.includeLib={Routes:RoutesLib,Resource:Resource,ScriptStack:ScriptStack,registerLoader:CustomLoader.register},function(){function t(t){return t=t.replace("file://","").replace(/\\/g,"/").replace(/\?[^\n]+$/,""),/^\/\w+:\/[^\/]/i.test(t)?t.substring(1):t}function e(t){return t.substring(0,t.lastIndexOf("/"))}function n(t){var e;return function(){e&&clearTimeout(e),e=setTimeout(function(){var e;"object"==typeof cfg.autoreload&&(e=function(e){e!==!1&&cfg.autoreload.fileChanged(t,"include")}),o(t,e)},150)}}function r(t){if(null!=t){var e,n,i,o,l="string"==typeof t,s=l?t:t.url;for(e in bin)for(n in bin[e])if(o=bin[e][n],l!==!1){if(i=n.indexOf(s),-1!==i&&i===n.length-s.length)return delete bin[e][n],o.parent&&o.parent.url?r(o.parent):o}else if(o===t)return delete bin[e][n],o.parent&&o.parent.url?r(o.parent):o;console.warn("<include:res:remove> Resource is not in cache",s)}}function i(t){if(null!=t){t.content=null,t.exports=null;var e=t.parent;return e.create(t.type,t.route,t.namespace,t.xpath).on(4,e.childLoaded)}}function o(t,e){var n=r(t);return null==n?(e&&e(!1),void 0):i(n).done(e)}cfg.server=!0;var l,s,u,a=require("vm"),c=(global.module||module).constructor;(function(){function t(t){null!=n[t]&&(n[t].close(),n[t]=null)}var e=require("fs"),n={};s=function(t,n){if(cfg.sync)try{var r=e.readFileSync(t,"utf8");n(null,r)}catch(i){console.error("File Read - ",i)}else e.readFile(t,"utf8",n)},u=function(r,i){t(r),n[r]=e.watch(r,i)}})(),XMLHttpRequest=function(){},XMLHttpRequest.prototype={constructor:XMLHttpRequest,open:function(t,e){this.url=e},send:function(){-1!==this.url.indexOf("file://")&&(this.url=t(this.url));var e=this;s(this.url,function(t,r){t&&(console.error(">>",t.code,t.path),r=""),e.readyState=4,e.responseText=r,e.onreadystatechange(),null==t&&cfg.autoreload&&u(e.url,n(e.url))})}},__eval=function(n,r,i){module.exports={},global.include=r,global.require=require,global.exports=module.exports,global.__filename=t(r.url),global.__dirname=e(global.__filename),global.module=module,i!==!0&&(n="(function(){ "+n+"\n}())");try{a.runInThisContext(n,global.__filename)}catch(o){console.error("Module Evaluation Error",r.url),console.error(o.stack)}if(null==r.exports){var l=module.exports;("object"!=typeof l||Object.keys(l).length)&&(r.exports=module.exports)}},obj_inherit(Resource,{bin_remove:r,bin_tryReload:o,path_getFile:function(){return t(this.url)},path_getDir:function(){return e(t(this.url))},inject:function(){var t=1===arguments.length?arguments[0]:__array_slice.call(arguments),e=this;e.state=e.state>=3?3:2;var n=e.create();return n.url=this.url,n.location=this.location,n.load(t).done(function(t){var r,i;t.load;try{for(var o=0;n.includes.length>o;o++){var i=n.includes[o].resource,l=i.exports;i.exports=null,i.type="js",i.includes=null,i.state=3;for(var r in bin.load)if(bin.load[r]===i){delete bin.load[r];break}__eval(l,i,!0),i.readystatechanged(3)}}catch(s){console.error("Injected Script Error\n",s,r)}n.on(4,function(){e.includes.splice.apply(e.includes,[n,1].concat(n.includes)),e.readystatechanged(3)})}),e},instance:function(n){if("string"==typeof n){var r=module,i=new c(n,r);if(i.filename=t(n),i.paths=c._nodeModulePaths(e(i.filename)),!a){var o="win32"===process.platform?";":":",s=process.env.PATH||process.env.path;s||console.error("PATH not defined in env",process.env);var u=s.split(o),a=ruqq.arr.first(u,function(t){return/([\\\/]npm[\\\/])|([\\\/]npm$)/gi.test(t)});a?(a=a.replace(/\\/g,"/"),a+=("/"!==a[a.length-1]?"/":"")+"node_modules",l=io.env.applicationDir.toLocalDir()+"node_modules"):(console.error("Could not resolve global NPM Directory from system path"),console.log("searched with pattern /npm in",s,o))}i.paths.unshift(l),i.paths.unshift(a),module=i,require=i.require.bind(i)}var f=new Resource;return f.state=4,f}}),obj_inherit(Include,{bin_tryReload:o,bin_remove:r})}()}),function(t,e){"use strict";function n(t){null==t&&(t={});var n,i=e(r,t,o);for(n in t)i[n]=t[n];return i}var r,i,o;if("undefined"==typeof exports||null!=t&&t!==exports&&t!==global||(t=exports,r=global),null==r&&(r="undefined"==typeof window||null==window.document?global:window),o=r.document,i=t||r,"undefined"!=typeof exports&&exports===t)return module.exports=n(),void 0;if("function"==typeof define&&define.amd)return define(n),void 0;var l={},s=n(l);i.mask=s;for(var u in l)i[u]=l[u]}(this,function(global,exports,document){"use strict";function util_extend(t,e){null==t&&(t={});for(var n in e)hasOwnProp.call(e,n)!==!1&&(t[n]=e[n]);return t}function util_getProperty(t,e){if("."===e)return t;for(var n=t,r=e.split("."),i=-1,o=r.length;null!=n&&o>++i;)n=n[r[i]];return n}function util_interpolate(t,e,n,r,i,o,l){for(var s,u,a,c,f,h=t.length,p=0,d=null,g="",v=!0;h>p;p++)v===!0?null==d?g+=t[p]:d.push(t[p]):(c=t[p],u=null,a=c.indexOf(":"),-1===a?u=util_getProperty(n,c):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=fn_isFunction(f)?f(c,n,r,i,o,l,e):f.process(c,n,r,i,o,l,e)),null!=u&&("object"==typeof u&&null==d&&(d=[g]),null==d?g+=u:d.push(u))),v=!v;return null==d?g:d}function Template(t){this.template=t,this.index=0,this.length=t.length}function str_trim(t){for(var e,n=t.length,r=0,i=n-1;n>r&&(e=t.charCodeAt(r),33>e);r++);for(;i>=r&&(e=t.charCodeAt(i),33>e);i--);return 0===r&&i===n-1?t:t.substring(r,i+1)}function is_Function(t){return"function"==typeof t}function is_Object(t){return null!=t&&"object"==typeof t}function is_Array(t){return null!=t&&"number"==typeof t.length&&"function"==typeof t.slice}function obj_inherit(t){"function"==typeof t&&(t=t.prototype);for(var e,n,r,i=1,o=arguments.length;o>i;i++){e="function"==typeof arguments[i]?arguments[i].prototype:arguments[i];for(n in e)r=Object.getOwnPropertyDescriptor(e,n),null!=r&&(r.hasOwnProperty("value")?t[n]=r.value:Object.defineProperty(t,n,r))}return t}function obj_extend(t,e){if(null==t&&(t={}),null==e)return t;var n,r;for(n in e)r=e[n],null!=r&&(t[n]=e[n]);return t}function obj_getProperty(t,e){for(var n=t,r=e.split("."),i=-1,o=r.length;null!=n&&o>++i;)n=n[r[i]];return n}function fn_isFunction(t){return"function"==typeof t}function fn_empty(){return!1}function Node(t,e){this.type=Dom.NODE,this.tagName=t,this.parent=e,this.attr={}}function TextNode(t,e){this.content=t,this.parent=e,this.type=Dom.TEXTNODE}function Fragment(){this.nodes=[]}function Component(t,e,n){this.tagName=t,this.parent=e,this.controller=n,this.attr={}}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0};Template.prototype={skipWhitespace:function(){for(var t=this.template,e=this.index,n=this.length;n>e&&!(t.charCodeAt(e)>32);e++);return this.index=e,this},skipToAttributeBreak:function(){var t,e=this.template,n=this.index,r=this.length;do if(t=e.charCodeAt(++n),35===t&&123===e.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),this.index++,void 0;while(46!==t&&35!==t&&62!==t&&123!==t&&32!==t&&59!==t&&r>n);this.index=n},sliceToChar:function(t){for(var e,n,r=this.template,i=this.index,o=i,l=!1;(n=r.indexOf(t,i))>-1&&(i=n,92===r.charCodeAt(i-1));)l=!0,i++;return e=r.substring(o,i),this.index=i,l?e.replace(regexpEscapedChar[t],t):e}};var ConditionUtil=function(){function t(t,e){var n,r=e,i=t.index;if(null==r&&(t.skipWhitespace(),i=t.index,e=r=t.template.charCodeAt(t.index)),34===r||39===r)return t.index++,n=t.sliceToChar(39===r?"'":'"'),t.index++,n;do r=t.template.charCodeAt(++t.index);while(t.index<t.length&&32!==r&&33!==r&&60!==r&&61!==r&&62!==r&&40!==r&&41!==r&&38!==r&&124!==r);return n=t.template.substring(i,t.index),r=e,45===r||r>47&&58>r?n-0:116===r&&"true"===n?!0:102===r&&"false"===n?!1:{value:n}}function e(n,r){var i,o={assertions:null,join:null,left:null,right:null};null==r&&(r=[]),"string"==typeof n&&(n=new Template(n));t:for(;;){if(n.skipWhitespace(),n.index>=n.length)break;switch(i=n.template.charCodeAt(n.index)){case 61:case 60:case 62:case 33:var l=n.index;do i=n.template.charCodeAt(++n.index);while(n.index<n.length&&(60===i||61===i||62===i));o.sign=n.template.substring(l,n.index);continue;case 38:case 124:n.template.charCodeAt(++n.index)!==i&&console.error("Unary operation not valid"),o.join=38===i?"&&":"||",r.push(o),o={assertions:null,join:null,left:null,right:null},++n.index;continue;case 40:n.index++,e(n,o.assertions=[]);break;case 41:n.index++;break t;default:o[null==o.left?"left":"right"]=t(n,i);continue}}return(o.left||o.assertions)&&r.push(o),r}function n(n){if(null!=i[n])return i[n];var r=n.length,o={assertions:null,case1:null,case2:null},l=n.indexOf("?"),s=new Template(n);return-1!==l&&(s.length=l),o.assertions=e(s),-1!==l&&(s.length=r,s.index=l+1,o.case1=t(s),s.skipWhitespace(),58===s.template.charCodeAt(s.index)&&(s.index++,o.case2=t(s))),i[n]=o}function r(t,e){"string"==typeof t&&(t=n(t).assertions),null!=t.assertions&&(t=t.assertions);var i,o,l,s,u,a=!1;for(s=0,u=t.length;u>s;s++){if(i=t[s],i.assertions)a=r(i.assertions,e);else if(o="object"==typeof i.left?util_getProperty(e,i.left.value):i.left,null==i.right)a=o,"!"===i.sign&&(a=!a);else switch(l="object"==typeof i.right?util_getProperty(e,i.right.value):i.right,i.sign){case"<":a=l>o;break;case"<=":a=l>=o;break;case">":a=o>l;break;case">=":a=o>=l;break;case"!=":a=o!==l;break;case"==":a=o===l}if(a){if("&&"===i.join)continue;break}if("||"!==i.join&&"&&"===i.join)for(++s;u>s&&"||"!==t[s].join;s++);}return a}var i=[];return{condition:function(t,e){var i=n(t),o=r(i.assertions,e);return null!=i.case1&&(o=o?i.case1:i.case2),null==o?"":"object"==typeof o&&o.value?util_getProperty(e,o.value):o},isCondition:r,parse:n,out:{isCondition:r,parse:n}}}(),ExpressionUtil=function(){function t(t){this.parent=t,this.type=W,this.body=[],this.join=null}function e(t){this.parent=t}function n(t){this.type=Q,this.body=t,this.join=null}function r(t,e){this.parent=t,this.type=K,this.body=e,this.arguments=[],this.next=null}function i(t,e){this.parent=t,this.type=G,this.body=e,this.next=null}function o(t,e){this.parent=t,this.prefix=e}function l(e){this.body=e,this.case1=new t(this),this.case2=new t(this)}function s(t,e){null==t&&console.error("Undefined",t,e);var n=t.type;return W===n?(t.body.push(e),e):V===n||Y===n?t.body=e:G===n||K===n?t.next=e:(console.error("Unsupported - append:",t,e),e)}function u(){if(0===arguments.length)return null;var e=new t(arguments[0].parent);return e.join=arguments[arguments.length-1].join,e.body=Array.prototype.slice.call(arguments),e}function a(t){if(t.type!==W)return null!=t.body&&"object"==typeof t.body&&a(t.body),void 0;for(var e,n,r,i=t.body,o=0,l=i.length;l>o;o++)a(i[o]);for(o=1;l>o&&(e=i[o],n=i[o-1],!(ne[n.join]>ne[e.join]));o++);if(o!==l){for(r=[i[0]],o=1;l>o;o++)e=i[o],n=i[o-1],ne[n.join]>ne[e.join]&&l-1>o&&(e=u(i[o],i[++o])),r.push(e);t.body=r}}function c(t,e){console.error("Expression parser:",t,e,y.substring(_))}function f(t,e,n,r){var i,o,l=t,s=t.body;if(null==o&&null!=e&&(i=e,o=e[s]),null==o&&null!=n&&(i=n,o=n[s]),null==o&&null!=r)do i=r,o=r[s];while(null==o&&null!=(r=r.parent));if(null!=o)for(;;){if(l.type===K){for(var u,a=[],f=0,h=l.arguments.length;h>f;f++)u=l.arguments[f],a[f]=m(u,e,n,r);o=o.apply(i,a)}if(null==o||null==l.next)break;if(l=l.next,s=l.body,i=o,o=o[s],null==o)break}return null==o&&(null==l||null!=l.next)&&c("Mask - Accessor error - ",s),o}function h(t){for(var e,n,r=!1,i=39===t?"'":'"',o=_;(e=y.indexOf(i,_))>-1&&(_=e,92===y.charCodeAt(e-1));)r=!0,_++;return n=y.substring(o,_),r===!0&&(n=n.replace(regexpEscapedChar[i],i)),n}function p(){for(var t,e,n=_;;){if(t=y.charCodeAt(_),46===t){if(e===!0)return c("Unexpected punc"),null;e=!0}if(!((t>=48&&57>=t||46===t)&&x>_))break;_++}return+y.substring(n,_)}function d(){var t,e=_,n=y.charCodeAt(_);if(34===n||39===n)return _++,t=h(n),_++,t;for(;;){n=y.charCodeAt(_);{if(!(n>47&&58!==n&&60!==n&&61!==n&&62!==n&&63!==n&&124!==n&&x>_))break;_++}}return y.substring(e,_)}function g(t){if(null==t&&_===x)return null;switch(t){case 40:return U;case 41:return H;case 44:return F;case 46:return $;case 43:return O;case 45:return C;case 42:return N;case 47:return k;case 37:return j;case 61:return y.charCodeAt(++_)!==t?(c("Not supported (Apply directive) - view can only access model/controllers"),null):E;case 33:return 61===y.charCodeAt(_+1)?(_++,R):T;case 62:return 61===y.charCodeAt(_+1)?(_++,I):D;case 60:return 61===y.charCodeAt(_+1)?(_++,P):M;case 38:return y.charCodeAt(++_)!==t?(c("Single Binary Operator AND"),null):S;case 124:return y.charCodeAt(++_)!==t?(c("Single Binary Operator OR"),null):A;case 63:return z;case 58:return q}return t>=65&&90>=t||t>=97&&122>=t||95===t||36===t?B:t>=48&&57>=t?X:34===t||39===t?J:(c("Unexpected / Unsupported directive"),null)}function v(u){y=u,_=0,x=u.length,b=new t;var f,v,m=b,w=te;t:for(;;)if(x>_&&33>(f=y.charCodeAt(_)))_++;else{if(_>=x)break;if(v=g(f),null==v&&x>_)break;switch(v){case U:m=s(m,new e(m)),m=s(m,new t(m)),_++;continue;case H:var L=W;w===ee&&(w=te,L=K);do m=m.parent;while(null!=m&&m.type!==L);if(L===W&&(m=m.parent),null==m){c("OutOfAst Exception - body closed");break t}_++;continue;case F:if(w!==ee){c("Unexpected punctuation, comma");break t}do m=m.parent;while(null!=m&&m.type!==K);if(null==m){c("OutOfAst Exception - next argument");break t}m=m.newArgument(),_++;continue;case z:b=new l(b),m=b.case1,_++;continue;case q:m=b.case2,_++;continue;case $:f=y.charCodeAt(_+1),f>=48&&57>=f?v=X:(v=B,_++)}if(m.type===W&&(m=s(m,new e(m))),C!==v&&T!==v||null!=m.body)switch(v){case C:case O:case N:case k:case j:case S:case A:case E:case R:case D:case I:case M:case P:for(;m&&m.type!==V;)m=m.parent;if(null==m.body){c("Unexpected operator",m);break t}m.join=v;do m=m.parent;while(null!=m&&m.type!==W);null==m&&console.error("Unexpected parent",m),_++;continue;case J:case X:if(null!=m.body&&null==m.join){c("Directive Expected");break}J===v&&(_++,s(m,new n(h(f))),_++),X===v&&s(m,new n(p(f)));continue;case B:for(var G=d();x>_;){f=y.charCodeAt(_);{if(!(33>f))break;_++}}if(40===f){w=ee,_++;var Q=s(m,new r(m,G));m=Q.newArgument();continue}110===f&&"null"===G&&(G=null),102===f&&"false"===G&&(G=!1),116===f&&"true"===G&&(G=!0),m=s(m,"string"==typeof G?new i(m,G):new n(G))}else m=s(m,new o(m,v)),_++}return null==m.body&&m.type===V&&c("Unexpected end of expression"),a(b),b}function m(t,e,n,r){var i,o;if(null==t)return null;o="string"==typeof t?w.hasOwnProperty(t)===!0?w[t]:w[t]=v(t):t;var l,s,u,a=o.type;if(W===a){var c,h;t:for(l=0,u=o.body.length;u>l;l++)if(s=o.body[l],c=m(s,e,n,r),null!=h){if(h.join===S)if(i)i=c;else for(;u>l&&o.body[l].join!==A;l++);if(h.join===A){if(i)break t;if(c){i=c;break t}}switch(h.join){case C:i-=c;break;case O:i+=c;break;case k:i/=c;break;case N:i*=c;break;case j:i%=c;break;case R:i=i!=c;break;case E:i=i==c;break;case D:i=i>c;break;case I:i=i>=c;break;case M:i=c>i;break;case P:i=c>=i}h=s}else h=s,i=c}if(V===a)return m(o.body,e,n,r);if(Q===a)return o.body;if(G===a||K===a)return f(o,e,n,r);if(Y===a)switch(i=m(o.body,e,n,r),o.prefix){case C:i=-i;break;case T:i=!i}return Z===a&&(i=m(o.body,e,n,r),i=m(i?o.case1:o.case2,e,n,r)),i}var y,b,_=0,x=0,w={},C="-",O="+",k="/",N="*",j="%",A="||",S="&&",T="!",E="==",R="!=",D=">",I=">=",M="<",P="<=",L=".",U=20,H=21,F=22,$=23,z=24,q=25,B=30,J=31,X=32,W=1,V=2,G=3,K=4,Q=6,Y=9,Z=10,te=1,ee=2,ne={};ne[L]=1,ne[k]=2,ne[N]=2,ne[C]=3,ne[O]=3,ne[D]=4,ne[I]=4,ne[M]=4,ne[P]=4,ne[E]=5,ne[R]=5,ne[S]=6,ne[A]=6,e.prototype={constructor:e,type:V,join:null,body:null},r.prototype={constructor:r,newArgument:function(){var e=new t(this);return this.arguments.push(e),e}},o.prototype={constructor:o,type:Y,body:null},l.prototype={constructor:l,type:Z,case1:null,case2:null};var re=function(){function t(r){if(null==r)return null;var i,o;if(W===r.type)for(var l=0,s=r.body.length;s>l;l++)o=t(r.body[l]),i=e(i,o);if(G===r.type){for(var u=r.body,a=r.next;null!=a;){if(K===a.type)return t(a);if(G!==a.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;u+="."+a.body,a=a.next}return u}switch(r.type){case V:case Y:case Z:o=t(r.body),i=e(i,o)}if(Z===r.type&&(o=t(b.case1),i=e(i,o),o=t(b.case2),i=e(i,o)),K===r.type){for(var l=0,s=r.arguments.length;s>l;l++)o=t(r.arguments[l]),i=e(i,o);o=null;var c=r;t:for(;c=c.parent;)switch(c.type){case G:o=c.body+(null==o?"":"."+o);break;case W:case V:break t;default:o=null;break t}null!=o&&(i=e(i,o)),r.next&&(o=t(r.next),i=e(i,{accessor:n(r),ref:o}))}return i}function e(t,e){if(null==t)return e;if(null==e)return t;if(("object"!=typeof t||null==t.length)&&(t=[t]),"object"!=typeof e||null==e.length)return-1===t.indexOf(e)&&t.push(e),t;for(var n=0,r=e.length;r>n;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}function n(t){var e=t;t:for(;e.parent;){switch(e.parent.type){case W:case V:break t}e=e.parent}return r(e,t.next)}function r(t,e){if(t===e||null==t)return null;if("object"!=typeof t)return t;if(null!=t.length&&"function"==typeof t.splice){for(var n=[],i=0,o=t.length;o>i;i++)n[i]=r(t[i],e);return n}var l={};for(var s in t)null!=t[s]&&"parent"!==s&&(l[s]=r(t[s],e));return l}return function(e){return"string"==typeof e&&(e=v(e)),t(e)}}();return{parse:v,eval:m,varRefs:re}}(),custom_Utils={condition:ConditionUtil.condition,expression:function(t,e,n,r,i){return ExpressionUtil.eval(t,e,n,i)}},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={},Dom={NODE:1,TEXTNODE:2,FRAGMENT:3,COMPONENT:4,CONTROLLER:9,SET:10,Node:Node,TextNode:TextNode,Fragment:Fragment,Component:Component};Node.prototype={constructor:Node,type:Dom.NODE,tagName:null,parent:null,attr:null,nodes:null,__single:null},TextNode.prototype={type:Dom.TEXTNODE,content:null,parent:null},Fragment.prototype={constructor:Fragment,type:Dom.FRAGMENT,nodes:null},Component.prototype={constructor:Component,type:Dom.COMPONENT,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null};var Parser=function(t,e,n,r){function i(t){for(var e=-1;-1!==(e=t.indexOf(l,e))&&t.charCodeAt(e+1)!==a;)e++;if(-1===e)return t;for(var n,r=[],i=0,o=0;;){if(n=t.indexOf(s,e+2),-1===n)break;for(r[o++]=i===e?"":t.substring(i,e),r[o++]=t.substring(e+2,n),i=e=n+1;-1!==(e=t.indexOf(l,e))&&t.charCodeAt(e+1)!==a;)e++;if(-1===e)break}return t.length>i&&(r[o]=t.substring(i)),t=null,function(t,e,n,i,o,l){if(null==t){for(var s,u="",a=0,c=r.length;c>a;a++)s=r[a],u+=1===a%2?"~["+s+"]":s;return u}return util_interpolate(r,t,e,n,i,o,l)}}function o(t,e,n,r){var i={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n],o=t.substring(0,e).split("\n"),l=o.length,s=o[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",i,"]"];console.error(u.join(" "),{stopped:t.substring(e),template:t})}var l="~",s="]",u=126,a=91,c=93;return{parse:function(l){for(var s,f,h,p,d,g,v,m,y=new n,b=y,_=2,x=3,w=0,C=l.length,O=2,k=3,N=5,j=6,A=7,S=8,T=9;;)if(C>w&&33>(g=l.charCodeAt(w)))w++;else if(47!==g||47!==l.charCodeAt(w+1)){if(x===N&&(null!=s&&(y.attr["class"]=i(s),s=null),null!=h&&(y.attr[h]=h,h=null,f=null)),null!=f){if(_===N)null==h?h=f:p=f,null!=h&&null!=p&&("class"!==h?y.attr[h]=p:s=null==s?p:s+" "+p,h=null,p=null);else if(x===k)d=null!=custom_Tags[f]?new r(f,y,custom_Tags[f]):new t(f,y),null==y.nodes?y.nodes=[d]:y.nodes.push(d),y=d,_=N;else if(x===S){if(d=new e(f,y),null==y.nodes?y.nodes=[d]:y.nodes.push(d),y.__single===!0)do y=y.parent;while(null!=y&&null!=y.__single);_=O}f=null}if(w>=C){_===N&&(null!=s&&(y.attr["class"]=i(s)),null!=h&&(y.attr[h]=h));break}if(_===T){for(y=y.parent;null!=y&&null!=y.__single;)y=y.parent;_=O}switch(g){case 123:x=_,_=O,w++;continue;case 62:x=_,_=O,w++,y.__single=!0;continue;case 59:if(null!=y.nodes){w++;continue}case 125:w++,x=_,_=T;continue;case 39:case 34:_===j?_=N:x=_=S,w++;var E,R=!1,D=!1,I=39===g?"'":'"';for(v=w;(E=l.indexOf(I,w))>-1&&(w=E,92===l.charCodeAt(E-1));)R=!0,w++;v===w&&(m=l.charCodeAt(w+1),(124===m||m===g)&&(D=!0,v=w+2,w=E=l.indexOf((124===m?"|":I)+I+I,v),-1===w&&(w=C))),f=l.substring(v,w),R===!0&&(f=f.replace(regexpEscapedChar[I],I)),f=i(f),w+=D?3:1;continue}if(_===O){if(x=k,_=k,46===g||35===g){f="div";continue}}else if(_===N)if(46===g)w++,h="class",_=A;else if(35===g)w++,h="id",_=A;else{if(61===g){w++,_=j;continue}if(null!=h){f=h;continue}}(_===j||_===A)&&(x=_,_=N);var M=null;for(v=w;C>w;){if(g=l.charCodeAt(w),g===u&&l.charCodeAt(w+1)===a){M=!0,++w;do g=l.charCodeAt(++w);while(g!==c&&C>w)}if(39===g||34===g||47===g||60===g||44===g){o(l,w,_,String.fromCharCode(g));break}if(x!==j&&(46===g||35===g))break;if(61===g||62===g||123===g||33>g||59===g)break;w++}if(f=l.substring(v,w),!f){o(l,w,_,"*EMPTY*");break}if(M===!0&&_===k){o(l,w,_,"Tag Names cannt be interpolated (in dev)");break}M===!0&&(_===N&&"class"===h)==!1&&(f=i(f))}else for(w++;10!==g&&13!==g&&C>w;)g=l.charCodeAt(++w);return null!=y.parent&&y.parent!==b&&y.parent.__single!==!0&&null!=y.nodes&&console.warn("Mask - ",y.parent.tagName,JSON.stringify(y.parent.attr),"was not proper closed."),1===b.nodes.length?b.nodes[0]:b},cleanObject:function(t){if(t instanceof Array){for(var e=0;t.length>e;e++)this.cleanObject(t[e]);return t}return delete t.parent,delete t.__single,null!=t.nodes&&this.cleanObject(t.nodes),t},setInterpolationQuotes:function(t,e){return t&&2===t.length?e&&1===e.length?(u=t.charCodeAt(0),a=t.charCodeAt(1),c=e.charCodeAt(0),s=e,l=t.charAt(0),void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:i}}(Node,TextNode,Fragment,Component),Cache=function(){function t(t){this.__cacheInfo=new e(t.cache)}function e(t){if(t.byProperty){var e=t.byProperty,n=e.indexOf("."),r=e.substring(0,n);switch(e=e.substring(n+1),r){case"model":case"ctx":break;default:return console.error('[CompoCache] - property accessor not valid - should be "[model/ctx].[accessor]"'),null}this.propObjName=r,this.propAccessor=e}return this.expire=t.expire,this}var n=0,r=0,i={};return t.prototype={__null:null,__value:null},e.prototype={prop:void 0,propObjName:null,propAccessor:null,expire:null,getKey:function(t,e){if(null==this.propAccessor)return"__value";var n,r,i=this.propObjName,o=this.propAccessor;return"model"===i&&(n=t),"ctx"===i&&(n=e),r=obj_getProperty(n,o),r===void 0?"__value":null==r?"__null":r}},{get controllerID(){return n},get modelID(){return r},cacheCompo:function(e,o,l,s){if(__cfg.allowCache!==!1){var u=i[l];null==u&&(u=i[l]=new t(s));var a=u.__cacheInfo;null!=a&&(u[a.getKey(e,o)]=s,n=o._id,r=o._model._id)}},getCompo:function(t,e,n){if(__cfg.allowCache!==!1){var r=i[n];if(null==r)return null;var o=r.__cacheInfo,l=r[o.getKey(t,e)];return null==l||null==l.__cached?null:l}},getCache:function(){return i}}}(),builder_build=function(){function t(t,i,o,l){if(l=e(l),null==l.components||0===l.components.length)return""+t;var s=t.firstChild,u=n(s),a={model:o._model.stringify()},c={type:"m"},f=Meta.stringify(a,c),h=Meta.close(a,c);if(u){var p=r(u,"HTML");if(p){var d=r(p,"BODY");d?(d.insertBefore(new m(f),d.firstChild),d.appendChild(new m(h))):console.warn("Body not found")}return""+t}return f+(""+t)+h}function e(t,n){if(null==n&&(n={}),n.compoName=t.compoName,n.ID=t.ID,t.components){for(var r,i=[],o=t.components,l=0,s=o.length;s>l;l++)r=o[l],i.push(e(r));n.components=i}return n}function n(t,e){if(null==t)return null;if(t instanceof d==!1)return null;if(":document"===t.compoName)return t;if(null==e&&(e=0),4===e)return null;var r;return r=n(t.nextSibling,e),r?r:n(t.firstChild,++e)}function r(t,e){for(var n=t.firstChild;n&&n.tagName!==e;)n=n.nextSibling;return n}function i(t,e){if("object"==typeof t)return t;var n,r,i,l,u,a,c,f,h,p=0,d=t.length;for(n="up"===e?O:k;d>p;)u=t.charCodeAt(p),33>u||(a=s(t,p+1,d),46===u?(r="class",i=N,l=o(t.substring(p+1,a))):35===u?(r="id",i=N,l=t.substring(p+1,a)):91===u?(f=t.indexOf("=",p),-1===f&&console.error('Attribute Selector: should contain "="'),i=N,r=t.substring(p+1,f),u=t.charCodeAt(f+1),h=34===u||39===u?2:1,l=t.substring(f+h,a-h+1),a++):(i=null,r="tagName",l=t.substring(p,a).toUpperCase()),p=a,null!=c?(null==c.filters&&(c.filters=[]),c.filters.push({key:r,selector:l,prop:i})):c={key:r,prop:i,selector:l,nextKey:n,filters:null});return c}function o(t){return function(e){return-1!==l(e,t)}}function l(t,e,n){if(null==t)return-1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return-1;if(n>0&&t.charCodeAt(n-1)>32)return l(t,e,n+1);var r=t.length,i=e.length;return r-i>n&&t.charCodeAt(n+i)>32?l(t,e,n+1):n}function s(t,e,n){for(var r,i=!1,o=!1;n>e&&(r=t.charCodeAt(e),(34===r||39===r)&&(i=!i),92===r&&(o=!o),!(46===r||35===r||91===r||93===r||33>r)||i===!0||o===!0);)e++;return e}function u(t,e){"string"==typeof e&&(e=i(e));var n=e.prop?t[e.prop]:t,r=!1;if(null==n)return!1;if("function"==typeof e.selector?r=e.selector(n[e.key]):null!=e.selector.test?e.selector.test(n[e.key])&&(r=!0):n[e.key]===e.selector&&(r=!0),r===!0&&null!=e.filters)for(var o,l=0,s=e.filters.length;s>l;l++)if(o=e.filters[l],u(t,o)===!1)return!1;return r}function a(){}function c(t){this.doctype=t}function f(){}function h(t){this.tagName=t.toUpperCase(),this.attributes={}}function p(t){this.textContent=t}function d(t,e,n,r,i){var o,l,s,u,a=t.compoName||t.tagName,c=custom_Tags[a]||t.controller;if(null!=c&&(u=is_Function(c)?c.prototype.cache:c.cache),null!=u&&(o=Cache.getCompo(e,n,a,c)),null!=o)return this.compo=o,o.__cached&&(o.render=fn_empty),void 0;o=is_Function(c)?new c(e):c,null==o&&(o={model:t.model,modelRef:t.modelRef,container:t.container,mode:i.mode,modeModel:i.modeModel}),o.cache&&Cache.cacheCompo(e,n,a,o),this.compo=o,this.ID=this.compo.ID=++n._id,b===i.mode&&(o.mode=b),_===i.mode&&(o.mode=b),l=util_extend(o.attr,t.attr),void 0!==l["x-mode"]&&(o.mode=l["x-mode"]),void 0!==l["x-mode-model"]&&(o.modeModel=l["x-mode-model"]),this.compoName=o.compoName=a,o.attr=l,o.parent=i,n.debug&&n.debug.breakOn===o.compoName,null==o.nodes&&(o.nodes=t.nodes);for(s in l)"function"==typeof l[s]&&(l[s]=l[s]("attr",e,n,r,i,s));return"function"==typeof o.renderStart&&o.renderStart(e,n,r),i&&(i.components||(i.components=[])).push(o),o.async===!0?(o.await(g(o,e,n,this)),void 0):(null!=o.tagName&&o.tagName!==t.compoName&&(o.nodes={tagName:o.tagName,attr:o.attr,nodes:o.nodes,type:1}),"function"==typeof o.render&&o.render(e,n,this,o),void 0)}function g(t,e,n,r,i){var o=r.appendChild(A.createComment(""));return function(){return v(t,e,n,o,i)}}function v(t,e,n,r,i){null!=t.tagName&&t.tagName!==t.compoName&&(t.nodes={tagName:t.tagName,attr:t.attr,nodes:t.nodes,type:1}),null!=t.model&&(e=t.model);var o=t.nodes,l=[];if(null!=o){for(var s=is_Array(o),u=s===!0?o.length:1,a=0,c=null,f=A.createDocumentFragment();u>a;a++)c=s===!0?o[a]:o,1===c.type&&"server:all"!==t.mode&&(c.attr["x-compo-id"]=t.ID),y(c,e,n,f,t,l);r.parentNode.insertBefore(f,r)}if(null==t.tagName){var h,p=t.handlers&&t.handlers.attr;for(var d in t.attr)h=null,p&&is_Function(p[d])&&(h=p[d]),null==h&&is_Function(custom_Attributes[d])&&(h=custom_Attributes[d]),null!=h&&h(node,t.attr[d],e,n,l[0],t)}if(t.onRenderEndServer&&t.onRenderEndServer(l,e,n,r.parentNode),null!=i&&i!==l){var g=i.length,v=l.length;for(j=-1;v>++j;)i[g+j]=l[j]}}function m(t){this.textContent=t||"",this.textContent&&(this.textContent=this.textContent.replace("<!--","").replace("-->",""))}function y(t,e,n,r,i,o){if(null==t)return r;if(null!=n._redirect||null!=n._rewrite)return r;var l,s,u,a,c=t.type;if(10===c||is_Array(t)){for(u=0,a=t.length;a>u;u++)y(t[u],e,n,r,i);
return r}if(null==c&&(null!=t.tagName?c=1:null!=t.content&&(c=2)),1===c&&(r=T(t,e,n,r,i,o),o=null),2===c)return E(t,e,n,r,i),r;if(4===c){l=A.createComponent(t,e,n,r,i),r.appendChild(l),r=l;var f=l.compo;if(null!=f){if(f.model&&i.model!==f.model){e=f.model;var h=n._model.tryAppend(f);-1!==h&&(l.modelID=h)}if(f.async)return l;if(f.render)return l;i=f,t=f,s=[]}}var p=t.nodes;if(null!=p)for(var d,g=is_Array(p),v=g===!0?p.length:1,m=0;v>m;m++)d=g===!0?p[m]:p,4===c&&1===d.type&&"server:all"!==i.mode&&(d.attr["x-compo-id"]=l.ID),y(d,e,n,r,i,s);if(r.nodeType===Dom.COMPONENT&&i.onRenderEndServer&&i.async!==!0&&i.onRenderEndServer(s,e,n,r,i),null!=o&&s&&o!==s)for(var m=0,b=s.length;b>m;m++)o.push(s[m]);return r}var b="server:all",_="server:children",x="none",w=function(){function t(t,e){this._models={},this._id=e||0,this.append(t)}return t.prototype={append:function(t){return null===t?-1:(this._models[++this._id]=t,this._id)},tryAppend:function(t){if(b===t.mode)return-1;if(x===t.modeModel)return-1;var e;return void 0!==t.modelRef&&(e={__ref:t.modelRef}),null==e&&(e=t.model),this._models[++this._id]=e,this._id},stringify:function(){return JSON.stringify(this._models)}},t}();util_extend(Dom,{DOCTYPE:11});var C={area:1,base:1,br:1,col:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,menuitem:1,meta:1,param:1,source:1,track:1,wbr:1},O="parentNode",k="firstChild",N="attributes";(function(){a.prototype={parentNode:null,firstChild:null,lastChild:null,nextSibling:null,get length(){for(var t=0,e=this.firstChild;null!=e;)t++,e=e.nextSibling;return t},get childNodes(){for(var t=[],e=this.firstChild;null!=e;)t.push(e),e=e.nextSibling;return t},querySelector:function(t){var e=t;"string"==typeof t&&(e=i(t));for(var n,r=this.firstChild;null!=r;r=r.nextSibling)if(u(r,e))return r;if(null!=r)return r;for(r=this.firstChild;null!=r;r=r.nextSibling)if("function"==typeof r.querySelector&&(n=r.querySelector(e),null!=n))return n;return null},appendChild:function(t){if(null==t)return t;if(t.nodeType===Dom.FRAGMENT){var e=t;if(null==e.firstChild)return e;for(var n=e.firstChild;;){if(n.parentNode=this,null==n.nextSibling)break;n=n.nextSibling}return null==this.firstChild?this.firstChild=e.firstChild:e.lastChild.nextSibling=e.firstChild,e.lastChild=e.lastChild,e}return null==this.firstChild?this.firstChild=this.lastChild=t:(this.lastChild.nextSibling=t,this.lastChild=t),t.parentNode=this,t},insertBefore:function(t,e){var n=this.firstChild;if(n!==e)for(;null!=n&&n.nextSibling!==e;)n=n.nextSibling;if(null==n)return this.appendChild(t);if(t.nodeType===Dom.FRAGMENT){var r=t,i=r.firstChild;if(null==i)return r;for(;null!=i;)i.parentNode=this,i=i.nextSibling;return n===this.firstChild?(this.firstChild=r.firstChild,r.lastChild.nextSibling=n,r):(n.nextSibling=r.firstChild,r.lastChild.nextSibling=e,r)}return t.parentNode=this,n===this.firstChild?(this.firstChild=t,t.nextSibling=n,t):(n.nextSibling=t,t.nextSibling=e,t)}}})(),c.prototype={constructor:c,nodeType:Dom.DOCTYPE,toString:function(){return this.doctype}},f.prototype=obj_inherit(f,a,{nodeType:Dom.FRAGMENT,toString:function(){for(var t=this.firstChild,e="";null!=t;)e+=""+t,t=t.nextSibling;return e}}),function(){function t(t){null==t.attributes,this.attr=t.attributes,this.className=this.attr["class"]||""}t.prototype={get length(){return this.className.split(/\s+/).length},contains:function(t){return-1!==l(this.className,t)},remove:function(t){var e=l(this.className,t);if(-1!==e){var n=this.className;this.className=this.attr["class"]=n.substring(0,e)+n.substring(e+t.length)}},add:function(t){-1===l(this.className,t)&&(this.className=this.attr["class"]=this.className+(""===this.className?"":" ")+t)}},h.prototype=obj_inherit(h,a,{nodeType:Dom.NODE,setAttribute:function(t,e){this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]},get classList(){return new t(this)},toString:function(){var t,e,n=this.tagName.toLowerCase(),r=this.attributes,i="<"+n;for(var o in r)t=r[o],i+=" "+o+'="'+("string"==typeof t?t.replace(/"/g,"&quot;"):t)+'"';var l=1===C[n],e=this.firstChild;if(null==e)return i+(l?"/>":"></"+n+">");for(i+=l?"/>":">",l&&(i+="<!--~-->");null!=e;)i+=""+e,e=e.nextSibling;return l?i+"<!--/~-->":i+"</"+n+">"},get value(){return this.attributes.value},set value(t){this.attributes.value=t},get selected(){return this.attributes.selected},set selected(t){return t?(this.attributes.selected="selected",void 0):(delete this.attributes.selected,void 0)},get checked(){return this.attributes.checked},set checked(t){return t?(this.attributes.cheched="cheched",void 0):(delete this.attributes.cheched,void 0)}})}(),function(){p.prototype={constructor:p,nodeType:Dom.TEXTNODE,nextSibling:null,toString:function(){return this.textContent?t(this.textContent):""}};var t=function(){function t(t){return e[t]}var e={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"};return function(e){return e.replace(/[&"'\<\>]/g,t)}}()}(),d.prototype=obj_inherit(d,a,{nodeType:Dom.COMPONENT,compoName:null,instance:null,components:null,ID:null,toString:function(){var t=this.firstChild,e=this.compo;if(void 0!==e.__cached)return console.log("from Cache size: ",e.__cached.length),e.__cached;var n,r,i,o=e.mode;null!=e&&(n=e.compoName,r=e.attr,o=e.mode,i=e.nodes);var l={ID:this.ID,modelID:this.modelID,compoName:n,attr:r,mask:"client"===o?mask.stringify(i,0):null},s={single:null==this.firstChild,type:"t",mode:o},u=Meta.stringify(l,s);if(null!=e.toHtml)u+=e.toHtml();else for(var t=this.firstChild;null!=t;)u+=""+t,t=t.nextSibling;return"client"!==o&&(u+=Meta.close(l,s)),e.cache&&(e.__cached=u),u}}),m.prototype={nextSibling:null,parentNode:null,toString:function(){return""===this.textContent?"":"<!--"+this.textContent.replace(/>/g,"&gt;")+"-->"}};var A={createDocumentFragment:function(){return new f},createElement:function(t){return new h(t)},createTextNode:function(t){return new p(t)},createComment:function(t){return new m(t)},createComponent:function(t,e,n,r,i){return new d(t,e,n,r,i)}};(function(){function t(){}custom_Tags[":document"]=t,t.prototype={isDocument:!0,mode:"server",render:function(t,e,n){var r=this.attr,i=this.nodes,o=r.doctype||"html";delete r.doctype,n.appendChild(new c("<!DOCTYPE "+o+">"));for(var l,s,u,a,f={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},h=0,p=i.length;p>h;h++)a=i[h],"head"!==a.tagName?"body"!==a.tagName?u=!0:s=a:l=a;if(null==s&&(s={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=l&&f.nodes.push(l),null!=s&&f.nodes.push(s),u)for(var a,h=0,p=i.length;p>h;h++)a=i[h],"head"!==a.tagName&&"body"!==a.tagName&&s.nodes.push(a);var d=this.parent;return d.components=[],y(f,t,e,n,d),n}}})();var S=function(){function t(n){if(null==n)return null;var r;if(n instanceof Array){r=[];for(var i=0,o=n.length;o>i;i++)r[i]=t(n[i]);return r}if("object"==typeof n){if(~e.indexOf(n))return"[object Circular]";e.push(n),r={};for(var l in n)r[l]=t(n[l]);return r}return n}var e;return function(n){return"object"==typeof n&&null!=n&&(e=[],n=t(n),e=null),n}}(),T=function(){var t=function(t){return function(e){return t.createElement(e)}}(A);return function(e,n,r,i,o,l){var s,u=e.tagName,a=e.attr;try{s=t(u)}catch(c){return console.error(u,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),void 0}null!=l&&(l.push(s),a["x-compo-id"]=o.ID),null!=i&&i.appendChild(s);var f,h;for(f in a)fn_isFunction(a[f])?(h=a[f]("attr",n,r,s,o,f),h instanceof Array&&(h=h.join(""))):h=a[f],h&&(fn_isFunction(custom_Attributes[f])?custom_Attributes[f](e,h,n,r,s,o,i):s.setAttribute(f,h));return s}}(),E=function(){var t=function(t){return function(e,n){e.appendChild(t.createTextNode(n))}}(A);return function(e,n,r,i,o){var l=e.content;if(fn_isFunction(l)){var s=l("node",n,r,i,o);if("string"==typeof s)return t(i,s),void 0;for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(t(i,a),a=""),null==u.nodeType){a+=""+u;continue}i.appendChild(u)}return""!==a&&t(i,a),void 0}t(i,l)}}();return function(e,n,r,i,o){null==i&&(i=new f),null==o&&(o=new Component),null==r&&(r={}),r._model=new w(n,Cache.modelID),r._id=Cache.controllerID;var l;return y(e,n,r,i,o),r.async===!0?(r.done(function(){return r.page&&"tree"===r.page.query.debug?(r.resolve(JSON.stringify(S(i))),void 0):(l=t(i,n,r,o),r.resolve(l),void 0)}),null):r.page&&"tree"===r.page.query.debug?JSON.stringify(S(i)):l=t(i,n,r,o)}}(),cache={},Mask={render:function(t,e,n,r,i){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, cntx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof t&&(t=hasOwnProp.call(cache,t)?cache[t]:cache[t]=Parser.parse(t)),null==n&&(n={}),builder_build(t,e,n,r,i)},compile:Parser.parse,parse:Parser.parse,build:builder_build,registerHandler:function(t,e){custom_Tags[t]=e},getHandler:function(t){return null!=t?custom_Tags[t]:custom_Tags},registerAttrHandler:function(t,e,n){fn_isFunction(e)&&(n=e),custom_Attributes[t]=n},getAttrHandler:function(t){return null!=t?custom_Attributes[t]:custom_Attributes},registerUtil:function(t,e){return"function"==typeof e?(custom_Utils[t]=e,void 0):("function"!=typeof e.process&&(e.process=function(t,e,n,r,i,o,l){return"node"===l?(this.nodeRenderStart(t,e,n,r,i),this.node(t,e,n,r,i)):(this.attrRenderStart(t,e,n,r,i,o),this.attr(t,e,n,r,i,o))}),custom_Utils[t]=e,void 0)},getUtil:function(t){return null!=t?custom_Utils[t]:custom_Utils},registerUtility:function(t,e){console.warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",t),this.registerUtility=this.registerUtil,this.registerUtility(t,e)},getUtility:function(t){return console.warn("@getUtility - deprecated - use getUtil(utilName)",t),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(t){"string"==typeof t?delete cache[t]:cache={}},ValueUtils:{condition:ConditionUtil.condition,out:ConditionUtil},Utils:{Condition:ConditionUtil,Expression:ExpressionUtil,getProperty:util_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(t,e){null==listeners&&(listeners={}),(listeners[t]||(listeners[t]=[])).push(e)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,compoIndex:function(t){_controllerID=t},cfg:function(){var t=arguments;if(0===t.length)return __cfg;var e;if(2===t.length)return e=t[0],__cfg[e]=t[1],void 0;var n=t[0];if("object"==typeof n)for(e in n)__cfg[e]=n[e]}};Mask.renderDom=Mask.render;var Meta=function(){function t(e){return"string"!=typeof e?t(JSON.stringify(e)):e}function e(t){if("#"===o[r]){r++;var e=o.indexOf(s);-1===e&&(e=o.length),t.ID=parseInt(o.substring(r,e),10),r=e}}function n(t){if(r>i-5)return!1;if(o[r++]!==s||" "!==o[r++])return r=-1,!1;var e=r,n=o,l=n.indexOf(":",e),u=n.substring(e,l),a=n.indexOf(s+" ",l),c=n.substring(l+1,a);return"attr"===u&&(c=JSON.parse(c)),t[u]=c,r=a,!0}var r,i,o,l=30,s=String.fromCharCode(l),u="<!--",a="-->";return{stringify:function(e,n){switch(n.mode){case"server":case"server:all":return""}var r=n.type,i=n.single,o=u+r;e.ID&&(o+="#"+e.ID),o+=s+" ";for(var l in e)"ID"!==l&&null!=e[l]&&(o+=l+":"+t(e[l])+s+" ");return i&&(o+="/"),o+=a},close:function(t,e){switch(e.mode){case"server":case"server:all":return""}return u+"/"+e.type+(t.ID?"#"+t.ID:"")+a},parse:function(t){r=0,o=t,i=t.length;var l={},s=t[r];for("/"===s&&(l.end=!0,r++),l.type=t[r++],e(l);n(l););return-1===r?{}:("/"===t[i-1]&&(l.single=!0),l)}}}(),mock_AttrHandler=function(){function t(t,e,n){this.meta={ID:n,name:t,value:e}}return t.prototype={toString:function(){var t=this.meta,e={type:"a",single:!0};return Meta.stringify(t,e)}},{create:function(e,n,r){return function(i,o,l,s,u,a,c){return"server"!==r&&c.insertBefore(new t(e,o,++s._id),u),"client"!==r?n(i,o,l,s,u,a):""}}}}(),mock_TagHandler=function(){function t(){}return t.prototype={render:function(){},mode:"client"},{create:function(e,n,r){return"client"===r||"client"===n.prototype.mode?t:(n.prototype.mode=r,n)}}}(),mock_UtilHandler=function(){function t(t,e,n,r,i){this.meta={ID:i,utilType:t,utilName:e,value:n,attrName:r}}return t.prototype={toString:function(){for(var t=this.meta,e={type:"u",single:null==this.firstChild},n=Meta.stringify(t,e),r=this.firstChild;null!=r;)n+=""+r,r=r.nextSibling;return null!=this.firstChild&&(n+=Meta.close(this)),n}},{create:function(e,n,r){return function(i,o,l,s,u,a,c){return"server"!==r&&s.parentNode.insertBefore(new t(c,e,i,a,++l._id),s),"client"!==r?n(i,o,l,s,u,a,c):""}}}}();Mask.registerAttrHandler=function(t,e,n){if(null==n)return custom_Attributes[t]=e,void 0;if("string"==typeof n){var r=e;e=n,n=r}custom_Attributes[t]=mock_AttrHandler.create(t,n,e)},Mask.registerUtility=function(t,e,n){return null==n?(custom_Utils[t]=e,void 0):(custom_Utils[t]=mock_UtilHandler.create(t,e,n),void 0)},Mask.registerHandler=function(t,e){return custom_Tags_defs.hasOwnProperty(t)&&obj_extend(e.prototype,custom_Tags_defs[t]),"client"===e.prototype.mode?(custom_Tags[t]=mock_TagHandler.create(t,e,"client"),void 0):(custom_Tags[t]=e,void 0)},Mask.compoDefinitions=function(t){var e=custom_Tags,n=custom_Tags_defs;for(var r in t)n[r]=t[r],void 0===e[r]?e[r]=mock_TagHandler.create(r,null,"client"):obj_extend(e[r].prototype,t[r])},function(t){var e=function(){function e(t){for(var e="";t--;)e+=" ";return e}function n(t,n,i){var o,l;null==n&&(n=0),null==i&&(o=!0,i=[]);var s=i.length;if(t.type===f.FRAGMENT&&(t=t.nodes),t instanceof Array)for(l=0;t.length>l;l++)r(t[l],n,i);else r(t,n,i);var u=e(n);for(l=s;i.length>l;l++)i[l]=u+i[l];return o?i.join(0===c?"":"\n"):void 0}function r(t,e,r){return"string"==typeof t.content?(r.push(u(t.content)),void 0):"function"==typeof t.content?(r.push(u(t.content())),void 0):o(t)?(r.push(i(t)+";"),void 0):l(t)?(r.push(i(t)+" > "),n(s(t),c,r),void 0):(r.push(i(t)+"{"),n(t.nodes,c,r),r.push("}"),void 0)}function i(t){var e=t.tagName,n=t.attr.id||"",r=t.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var i="";for(var o in t.attr)if("id"!==o&&"class"!==o){var l=t.attr[o];"function"==typeof l&&(l=l()),(a===!1||/\s/.test(l))&&(l=u(l)),i+=" "+o+"="+l}return"div"===e&&(n||r)&&(e=""),e+n+r+i}function o(t){return null==t.nodes||t.nodes instanceof Array&&0===t.nodes.length}function l(t){return t.nodes&&(t.nodes instanceof Array==!1||1===t.nodes.length)}function s(t){return t.nodes instanceof Array?t.nodes[0]:t.nodes}function u(t){return-1===t.indexOf('"')?'"'+t.trim()+'"':-1===t.indexOf("'")?"'"+t.trim()+"'":'"'+t.replace(/"/g,'\\"').trim()+'"'}var a,c,f=t.Dom;return function(e,r){return null==e?"":("string"==typeof e&&(e=t.parse(e)),"number"==typeof r?(c=r,a=0===c):(c=r&&r.indent||4,a=0===c||r&&r.minimizeAttributes),n(e))}}();t.stringify=e}(Mask),function(t){function e(){this.attr={}}function n(t,e,n,r){null==t.nodes&&Compo!==void 0&&Compo.ensureTemplate(t);var l=t.attr.foreach||t.attr.each,s=util_getProperty(e,l),u=t.nodes,a=t.attr.index||"index";if(null==s)for(var c=t;null!=c&&null==s;)s=util_getProperty(c,l),c=c.parent;if(t.nodes=[],t.model=s,t.modelRef=l,t.template=u,t.container=r,null!=s&&"object"==typeof s&&null!=s.length){for(var f,h=0,p=s.length;p>h;h++)f=i(u,s[h],h,r,t),f[a]=h,t.nodes[h]=f;for(var d in o)t[d]=o[d]}}function r(t,e,n,r){var o,l=t.attr.repeat.split(".."),s=+l[0],u=+l[1],a=t.nodes;(isNaN(s)||isNaN(u))&&console.error("Repeat attribute(from..to) invalid",t.attr.repeat),t.nodes=[];for(var c=0;u>s;s++)o=i(a,e,s,r,t),o._repeatIndex=s,t.nodes[c++]=o}function i(t,e,n,r,i){var o=new Component;return o.nodes=t,o.model=e,o.container=r,o.parent=i,o.modelRef=n,o}t.registerHandler("%",e),e.prototype={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null,constructor:e,renderStart:function(t,e,i){var o=this.attr;if(null!=o.use){var l=o.use;return this.model=util_getProperty(t,l),this.modelRef=l,void 0}if(null==o["debugger"]){if(null!=o.visible){var s=ExpressionUtil.eval(o.visible,t,e,this.parent);return s||(this.nodes=null),void 0}if(null!=o.log){var u=o.log,a=util_getProperty(t,u);return console.log("Key: %s, Value: %s",u,a),void 0}if(null!=o.repeat&&r(this,t,e,i),null!=o["if"])return this.state=ExpressionUtil.eval(o["if"],t,e,this.parent),this.state||(this.nodes=null),void 0;if(null!=o["else"]){var c=this.parent.components,f=c&&c[c.length-1];return null!=f&&"%"===f.compoName&&null!=f.attr["if"]?(f.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",f,this.parent),void 0)}(null!=o.each||null!=o.foreach)&&n(this,t,e,i)}},render:null};var o={append:function(e){var n;n=new Component,n.nodes=this.template,n.model=e,t.render(n,e,null,this.container,this)}}}(Mask),function(t){function e(){}function n(){}function r(){}var i={};t.templates=i,t.registerHandler(":template",e),e.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(i[this.attr.id]=this.nodes,void 0)},t.registerHandler(":import",n),n.prototype={constructor:n,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=i[this.attr.id]),null==this.nodes){for(var t,e=this,n=":template[id="+this.attr.id+"]";null==t&&null!=(e=e.parent);)null!=e.nodes&&(t=jmask(e.nodes).filter(n).get(0));null!=t&&(this.nodes=t.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},t.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(t,e,n){var r=jmask(this.nodes).text(t,e,this);return r?n.insertAdjacentHTML?(n.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask);var Compo=exports.Compo=function(t){function e(t){return"string"!=typeof t?t:C(t)}function n(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)t[n]=e[n];return t}function r(t){var e={};for(var n in t)e[n]=t[n];return e}function i(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)}function o(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}function l(t,e){return function(){return t.apply(e,arguments)}}function s(t){return"function"==typeof t}function u(t,e,n){if(null==t&&console.warn("selector is null for type",e),"object"==typeof t)return t;var r,i,o;if(null==r)switch(t[0]){case"#":r="id",t=t.substring(1),i="attr";break;case".":r="class",t=c(t.substring(1)),i="attr";break;default:r=e===x.SET?"tagName":"compoName"}return o="up"===n?"parent":e===x.SET?"nodes":"components",{key:r,prop:i,selector:t,nextKey:o}}function a(t,e,n){"string"==typeof e&&(null==n&&(n=x[t.compoName?"CONTROLLER":"SET"]),e=u(e,n));var r=e.prop?t[e.prop]:t;if(null==r)return!1;if("function"==typeof e.selector)return e.selector(r[e.key]);if(null!=e.selector.test){if(e.selector.test(r[e.key]))return!0}else if(r[e.key]==e.selector)return!0;return!1}function c(t){return function(e){return f(e,t)}}function f(t,e,n){if("string"!=typeof t)return!1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return!1;if(n>0&&t.charCodeAt(n-1)>32)return f(t,e,n+1);var r=t.length,i=e.length;return r-i>n&&t.charCodeAt(n+i)>32?f(t,e,n+1):!0}function h(t,e){if(t instanceof Array){for(var n,r=0,i=t.length;i>r;r++){n=t[r];var o=h(n,e);if(null!=o)return o}return null}return a(t,e)===!0?t:(t=t[e.nextKey])&&h(t,e)}function p(t){if(t.hasAttribute("x-compo-id")){var e=t.getAttribute("x-compo-id"),n=S.getByID(e);return n&&compo_dispose(n),void 0}d(t)}function d(t){for(var e=t.firstChild;null!=e;)1===e.nodeType&&p(e),e=e.nextSibling}function g(t,e,n){return null!=N&&(e=N(e)),null!=_?(_(t).on(e,n),void 0):null!=t.addEventListener?(t.addEventListener(e,n,!1),void 0):(t.attachEvent&&t.attachEvent("on"+e,n),void 0)}function v(t,e){return t.filter(e).add(t.find(e))}function m(t,e,n,r){return null==n?t.on(e,r):(t.on(e,n,r),t.filter(n).on(e,r),t)}function y(){}var b,_=global.jQuery||global.Zepto||global.$,x=t.Dom,w=Array.prototype.slice,C=t.Utils.ensureTmplFn;null!=document&&null==_&&console.warn("jQuery / Zepto etc. was not loaded before compo.js, please use Compo.config.setDOMLibrary to define dom engine"),b=global.Class,null==b&&exports!==void 0&&(b=exports.Class),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1});var O={select:function(t,e){for(var n in e){var r=e[n],i=null,o=null;if(r instanceof Array&&(o=r[0],i=r.splice(1)),"string"==typeof r&&(o=r),null==r||null==o)return console.error("Unknown component child",n,e[n]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=o.indexOf(":"),s=o.substring(0,l);s=T.config.selectors[s],null==s?t.compos[n]=t.$[0].querySelector(o):(o=o.substring(++l).trim(),t.compos[n]=s(t,o));var u=t.compos[n];null!=i&&(null!=u.$&&(u=u.$),k.on(t,i,u))}}},k={on:function(t,e,n){null==n&&(n=t.$);for(var r,i=e instanceof Array,o=i?e.length:1,s=0;i?o>s:1>s;s++)if(r=i?e[s]:e,r instanceof Array)null!=N&&(r[0]=N(r[0])),n.on.apply(n,r);else for(var u in r){var a,c,f="string"==typeof r[u]?t[r[u]]:r[u],h=u.indexOf(":");-1!==h?(a=u.substring(0,h),c=u.substring(h+1).trim()):a=u,null!=N&&(a=N(a)),m(n,a,c,l(f,t))}}},N=null,j=function(){var t=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(t){return!1}}();return{touch:function(e){return t===!1?e:"click"===e?"touchend":"mousedown"===e?"touchstart":"mouseup"===e?"touchend":"mousemove"===e?"touchmove":e}}}(),A=function(){function e(t,e){return function(){new s(t).emit(e)}}function n(t,e){return null==e.pipes[t]?(console.error("Controller has no pipes to be added to collection",t,e),void 0):(null==u[t]&&(u[t]=[]),u[t].push(e),void 0)}function r(t,e){for(var n=u[t],r=n.length;--r;)n[r]===e&&(n.splice(r,1),r++)}function i(){var t=this,e=t.pipes;for(var n in e)r(n,t)}function l(t){var e=t.pipes;if(null==e)return console.error("Controller has no pipes",t),void 0;for(var r in e)n(r,t);T.attachDisposer(t,i.bind(t))}function s(t){return this instanceof s==!1?new s(t):(this.pipeName=t,this)}t.registerAttrHandler("x-pipe-signal",function(t,n,r,i,o){for(var l,s=n.split(";"),u=0,a=s.length;a>u;u++)if(l=s[u].trim(),""!==l){var c,f,h=l.substring(0,l.indexOf(":")),p=l.substring(l.indexOf(":")+1).trim(),d=p.indexOf(".");if(-1===d)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;c=p.substring(0,d),f=p.substring(++d);var v=e(c,f);!h&&console.error("Signal: event type is not set",n),g(o,h,v)}});var u={};return s.prototype={constructor:s,emit:function(t){var e,n=u[this.pipeName],r=this.pipeName;if(null==n)return console.warn("Pipe.emit: No signals were bound to:",r),void 0;2===arguments.length&&o(arguments[1])?e=arguments[1]:arguments.length>1&&(e=w.call(arguments,1));for(var i,l,s,a,c=n.length;-1!==--c;)i=n[c],l=i.pipes[r],null!=l&&(s=l[t],"function"==typeof s&&(s.apply(i,e),a=!0));a!==!0&&console.warn("No piped slot found for a signal",t,r)}},s.addController=l,s.removeController=i,{addController:l,removeController:i,pipe:s}}(),S=function(){var t={};return{create:function(e){return null==e.ID?(console.warn("Component should have an ID"),void 0):(t[e.ID]=e,void 0)},resolveCompo:function(e){if(null==e)return null;var n,r,i;do{if(r=e.getAttribute("x-compo-id"),r&&(null==n&&(n=r),i=t[r],null!=i&&(i=T.find(i,{key:"ID",selector:n,nextKey:"components"}),null!=i)))return i;e=e.parentNode}while(e&&1===e.nodeType);return n&&console.warn("No controller for ID",n),null},removeCompo:function(e){null!=e.ID&&delete t[e.ID]},getByID:function(e){return t[e]}}}(),T=function(){function i(t){if(this instanceof i)return null;var n;if(null==t&&(t={}),null!=t.attr)for(var r in t.attr)t.attr[r]=e(t.attr[r]);var o=t.slots;if(null!=o)for(var r in o)"string"==typeof o[r]&&("function"!=typeof t[o[r]]&&console.error("Not a Function @Slot.",o[r]),o[r]=t[o[r]]);t.hasOwnProperty("constructor")&&(n=t.constructor),n=f(n,t),null==n&&(n=function(){});for(var r in p)null==t[r]&&(t[r]=p[r]);return n.prototype=t,t=null,n}function l(t){null!=t.dispose&&t.dispose(),S.removeCompo(t);var e=0,n=t.components,r=n&&n.length;if(r)for(;r>e;e++)l(n[e])}function a(e){if(null==e.nodes){null!=e.attr.template&&(e.template=e.attr.template,delete e.attr.template);var n=e.template;if(null!=typeof n){if("string"==typeof n){if("#"===n[0]){var r=document.getElementById(n.substring(1));if(null==r)return console.error("Template holder not found by id:",n),void 0;n=r.innerHTML}n=t.parse(n)}"object"==typeof n&&(e.nodes=n)}}}function c(t,e){if("function"==typeof t.dispose){var n=t.dispose;return t.dispose=function(){e.call(this),n.call(this)},void 0}t.dispose=e}function f(t,e){var n=e.compos,i=e.pipes,o=e.attr;return null==n&&null==i&&null==e.attr?t:function(){null!=n&&(this.compos=r(this.compos)),null!=i&&A.addController(this),null!=o&&(this.attr=r(this.attr)),"function"==typeof t&&t.call(this)}}n(i,{create:function(t){var e;null==t&&(t={}),t.hasOwnProperty("constructor")&&(e=t.constructor),null==e&&(e=function(){});for(var n in p)null==t[n]&&(t[n]=p[n]);return e.prototype=t,e},createClass:function(t){if(null!=t.attr)for(var n in t.attr)t.attr[n]=e(t.attr[n]);var r=t.slots;if(null!=r)for(var n in r)"string"==typeof r[n]&&("function"!=typeof t[r[n]]&&console.error("Not a Function @Slot.",r[n]),r[n]=t[r[n]]);var i;t.hasOwnProperty("constructor")&&(i=t.constructor),null==i&&(i=t.Construct),t.Construct=f(i,t);var l=t.Extends;return null==l?t.Extends=p:o(l)?l.unshift(p):t.Extends=[p,l],b(t)},render:function(e,n,r,i){a(e);var o=[];return t.render(null==e.tagName?e.nodes:e,n,r,i,e,o),e.$=_(o),null!=e.events&&k.on(e,e.events),null!=e.compos&&O.select(e,e.compos),e},initialize:function(e,n,r,o,l){var s;null==o&&(r&&null!=r.nodeType?(o=r,r=null):n&&null!=n.nodeType&&(o=n,n=null)),"string"==typeof e&&(s=e,e=t.getHandler(s),e||console.error("Compo not found:",e));var u={controller:e,type:x.COMPONENT,tagName:s};null==l&&null!=o&&(l=S.resolveCompo(o)),null==l&&(l=new x.Component);var a=t.render(u,n,r,null,l),c=l.components[l.components.length-1];return null!=o&&(o.appendChild(a),i.signal.emitIn(c,"domInsert")),c},dispose:function(t){"function"==typeof t.dispose&&t.dispose();var e=0,n=t.components,r=n&&n.length;if(r)for(;r>e;e++)i.dispose(n[e])},find:function(t,e){return h(t,u(e,x.CONTROLLER,"down"))},closest:function(t,e){return h(t,u(e,x.CONTROLLER,"up"))},ensureTemplate:a,attachDisposer:c,config:{selectors:{$:function(t,e){var n=v(t.$,e);return 0===n.length&&console.error("Compo Selector - element not found -",e,t),n},compo:function(t,e){var n=i.find(t,e);return null==n&&console.error("Compo Selector - component not found -",e,t),n}},setDOMLibrary:function(t){_=t},eventDecorator:function(t){return"function"==typeof t?(N=t,void 0):"string"==typeof t?(N=j[t],void 0):"boolean"==typeof t&&t===!1?(N=null,void 0):void 0}},pipe:A.pipe,resource:function(t){for(var e=t;null!=e;){if(e.resource)return e.resource;e=e.parent}return include.instance()},Dom:{addEventListener:g}}),function(){function t(t,e,n){return null==t[e]&&(t[e]=[]),t[e].push(n),t}function e(t,e,n){var r=t[e];if(null!=r)for(var i,o=0,l=r.length;l>o;o++)i=r[o],null!=i&&(r[o]=null,null!=n?i.apply(this,n):i())}var n={done:function(e){return t(this,"_cbs_done",e)},fail:function(e){return t(this,"_cbs_fail",e)},always:function(e){return t(this,"_cbs_always",e)},resolve:function(){this.async=!1,e(this,"_cbs_done",arguments),e(this,"_cbs_always",arguments)},reject:function(){this.async=!1,e(this,"_cbs_fail",arguments),e(this,"_cbs_always")}},r={async:!0,await:function(t){this.resume=t}};i.pause=function(t,e){if(null==e.async){e.defers=[],e._cbs_done=null,e._cbs_fail=null,e._cbs_always=null;for(var o in n)e[o]=n[o]}e.async=!0;for(var o in r)t[o]=r[o];return e.defers.push(t),function(){i.resume(t,e)}},i.resume=function(t,e){t.resume&&t.resume(),t.async=!1;for(var n,r=!1,i=0,o=e.defers.length;o>i;i++)n=e.defers[i],n!==t?r===!1&&(r=null!=n):e.defers[i]=null;r===!1&&e.resolve()}}();var p={type:x.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(t,e,n){if(1===arguments.length&&null!=t&&t instanceof Array==!1&&null!=t[0]){var r=arguments[0];t=r[0],e=r[1],n=r[2]}null==this.nodes&&a(this),s(this.onRenderStart)&&this.onRenderStart(t,e,n)},renderEnd:function(t,e,n,r){if(1===arguments.length&&t instanceof Array==!1){var i=arguments[0];t=i[0],e=i[1],n=i[2],r=i[3]}S.create(this,t),this.$=_(t),null!=this.events&&k.on(this,this.events),null!=this.compos&&O.select(this,this.compos),s(this.onRenderEnd)&&this.onRenderEnd(t,e,n,r)},appendTo:function(t){var e="string"==typeof t?document.querySelector(t):t;if(null==e)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=this.$,r=0,i=n.length;i>r;r++)e.appendChild(n[r]);return this.emitIn("domInsert"),this},append:function(e,n,r){var i;if(null==this.$){var o="string"==typeof e?t.compile(e):e;return i=r?h(this,u(r,x.CONTROLLER,"down")):this,null==i.nodes?(this.nodes=o,this):(i.nodes=[this.nodes,o],this)}var l=t.render(e,n,null,null,this);return i=r?this.$.find(r):this.$,i.append(l),this.emitIn("domInsert"),this},find:function(t){return h(this,u(t,x.CONTROLLER,"down"))},closest:function(t){return h(this,u(t,x.CONTROLLER,"up"))},on:function(){var t=w.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&k.on(this,[t]),null==this.events?this.events=[t]:o(this.events)?this.events.push(t):this.events=[t,this.events],this)},remove:function(){if(null!=this.$){this.$.remove();var t=this.parent&&this.parent.elements;if(null!=t)for(var e,n=0,r=t.length;r>n;n++){e=t[n];for(var i=0,o=this.$.length;o>i;i++)e===this.$[i]&&(t.splice(n,1),n--,r--)}this.$=null}l(this);var s=this.parent&&this.parent.components;if(null!=s){var n=s.indexOf(this);if(-1===n)return console.warn("Compo::remove - parent doesnt contains me",this),this;s.splice(n,1)}return this},slotState:function(t,e){i.slot.toggle(this,t,e)},signalState:function(t,e){i.signal.toggle(this,t,e)},emitOut:function(t){i.signal.emitOut(this,t,this,arguments.length>1?w.call(arguments,1):null)},emitIn:function(t){i.signal.emitIn(this,t,this,arguments.length>1?w.call(arguments,1):null)}};return i.prototype=p,i}();return function(){function e(t,n,r,i,o){if(null==t)return!1;var l=!1,s=null!=t.slots&&t.slots[n];if("string"==typeof s&&(s=t[s]),"function"==typeof s){l=!0;var u=null!=t.slots.__disabled&&t.slots.__disabled[n];if(u!==!0){var a=null==i?s.call(t,r):s.apply(t,[r].concat(i));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(i=a)}}if(-1===o&&null!=t.parent)return e(t.parent,n,r,i,o)||l;if(1===o&&null!=t.components)for(var c,f=t.components,h=f.length,p=0;h>p;p++)c=e(f[p],n,r,i,o),!l&&(l=c);return l}function r(t,e,n,i){if(null==t)return!1;var o=t.slots;if(null!=o&&null!=o[e]&&("string"==typeof o[e]&&(o[e]=t[o[e]]),"function"==typeof o[e])){if(i!==!0)return!0;if(null==o.__disabled||o.__disabled[e]!==!0)return!0}if(-1===n&&null!=t.parent)return r(t.parent,e,n);if(1===n&&null!=t.components)for(var l=0,s=t.components.length;s>l;l++)if(r(t.components[l],e,n))return!0;return!1}function i(t,n){return r(t,n,-1)===!1?null:function(r){var i=arguments.length>1?w.call(arguments,1):null;e(t,n,r,i,-1)}}function o(t,e,n){var r=t.slots;null!=r&&r.hasOwnProperty(e)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[e]=n===!1)}function l(t,e,n){if(o(t,e,n),null!=t.components)for(var r=0,i=t.components.length;i>r;r++)l(t.components[r],e,n)}function s(t,e,n){return null==t.$?(console.warn("Controller has no elements to toggle state"),void 0):(_().add(t.$.filter("[data-signals]")).add(t.$.find("[data-signals]")).each(function(t,r){var i=r.getAttribute("data-signals");
null!=i&&-1!==i.indexOf(e)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function u(t,e,n){for(var r=t,i=t;null!=(r=r.parent);)o(r,e,n),null!=r.$&&0!==r.$.length&&(i=r);l(t,e,n),s(i,e,n)}function a(t,e,n){o(t,e,n),(n||!r(t,e,-1,!0)&&!r(t,e,1,!0))&&s(t,e,n)}t.registerAttrHandler("x-signal","client",function(t,e,n,r,o,l){for(var s,u=e.split(";"),a="",c=0,f=u.length;f>c;c++)if(s=u[c].trim(),""!==s){var h=s.substring(0,s.indexOf(":")),p=s.substring(s.indexOf(":")+1).trim(),d=i(l,p);!h&&console.error("Signal: event type is not set",e),d&&(a+=","+p+",",g(o,h,d)),!d&&console.warn("No slot found for signal",p,l)}""!==a&&o.setAttribute("data-signals",a)}),n(T,{signal:{toggle:u,emitOut:function(t,n,r,i){var o=e(t,n,r,i,-1);!o&&console.warn("Signal %c%s","font-weight:bold;",n,"was not captured")},emitIn:function(t,n,r,i){e(t,n,r,i,1)},enable:function(t,e){u(t,e,!0)},disable:function(t,e){u(t,e,!1)}},slot:{toggle:a,enable:function(t,e){a(t,e,!0)},disable:function(t,e){a(t,e,!1)},invoke:function(t,e,n,r){var i=t.slots;return null==i||"function"!=typeof i[e]?(console.error("Slot not found",e,t),null):null==r?i[e].call(t,n):i[e].apply(t,[n].concat(r))}}})}(),function(){null!=_&&null!=_.fn&&(_.fn.compo=function(t){if(0===this.length)return null;var e=S.resolveCompo(this[0]);return null==t?e:h(e,u(t,x.CONTROLLER,"up"))},_.fn.model=function(t){var e=this.compo(t);if(null==e)return null;for(var n=e.model;null==n&&e.parent;)e=e.parent,n=e.model;return n},function(){var e=["append","prepend","insertAfter","insertBefore"];i(["appendMask","prependMask","insertMaskBefore","insertMaskAfter"],function(n,r){_.fn[n]=function(n,i,o,l){null==o&&(o=2>r?this.compo():this.parent().compo()),null==o&&console.warn("$.***Mask - controller not found, this can lead to memory leaks if template contains compos");var s=t.render(n,i,l,null,o);return this[e[r]](s)}})}(),function(){function t(t,e){p(e)}function e(t,e){d(e)}var n=_.fn.remove,r=_.fn.empty;_.fn.removeAndDispose=function(){return this.each(t),n.call(this)},_.fn.emptyAndDispose=function(){return this.each(e),r.call(this)}}())}(),t.registerHandler(":slot",y),y.prototype={constructor:y,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;t.Utils.Expression.eval(e,this.model,global,this)}},T}(Mask),jmask=exports.jmask=function(t){function e(t){return"string"!=typeof t?t:_(t)}function n(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)t[n]=e[n];return t}function r(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)}function i(t,e){if(null==t)return console.error("Can not remove myself from parent",e),void 0;var n=t.indexOf(e);return-1===n?(console.error("Can not remove myself from parent",e,n),void 0):(t.splice(n,1),void 0)}function o(t){return null!=t&&"object"==typeof t&&null!=t.length&&"function"==typeof t.slice}function l(t,e,n){if(null==t&&console.warn("selector is null for type",e),"object"==typeof t)return t;var r,i,o,l,u,c,f,h,p,d=0,g=t.length;for(r="up"===n?C:e===m.SET?O:k;g>d;)u=t.charCodeAt(d),33>u||(c=a(t,d+1,g),46===u?(i="class",o=N,l=s(t.substring(d+1,c))):35===u?(i="id",o=N,l=t.substring(d+1,c)):91===u?(h=t.indexOf("=",d),-1===h&&console.error('Attribute Selector: should contain "="'),o=N,i=t.substring(d+1,h),u=t.charCodeAt(h+1),p=34===u||39===u?2:1,l=t.substring(h+p,c-p+1),c++):(o=null,i=e===m.SET?"tagName":"compoName",l=t.substring(d,c)),d=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:i,selector:l,prop:o})):f={key:i,prop:o,selector:l,nextKey:r,filters:null});return f}function s(t){return function(e){return u(e,t)}}function u(t,e,n){if("string"!=typeof t)return!1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return!1;if(n>0&&t.charCodeAt(n-1)>32)return u(t,e,n+1);var r=t.length,i=e.length;return r-i>n&&t.charCodeAt(n+i)>32?u(t,e,n+1):!0}function a(t,e,n){for(var r,i=!1,o=!1;n>e&&(r=t.charCodeAt(e),(34===r||39===r)&&(i=!i),92===r&&(o=!o),!(46===r||35===r||91===r||93===r||33>r)||i===!0||o===!0);)e++;return e}function c(t,e,n){"string"==typeof e&&(null==n&&(n=m[t.compoName?"CONTROLLER":"SET"]),e=l(e,n));var r=e.prop?t[e.prop]:t,i=!1;if(null==r)return!1;if("function"==typeof e.selector?i=e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key])&&(i=!0):r[e.key]===e.selector&&(i=!0),i===!0&&null!=e.filters)for(var o,s=0,u=e.filters.length;u>s;s++)if(o=e.filters[s],c(t,o,n)===!1)return!1;return i}function f(t,e){if(null==e)return t;for(var n,r=[],i=0,o=t.length;o>i;i++)n=t[i],c(n,e)&&r.push(n);return r}function h(t,e,n){if(null==t)return n;if(null==n&&(n=[]),t instanceof Array){for(var r=0,i=t.length;i>r;r++)h(t[r],e,n);return n}c(t,e)&&n.push(t);var o=t[e.nextKey];return null!=o&&h(o,e,n),n}function p(t,e){var r={type:1,tagName:1,compoName:1,controller:1},i={parent:e};for(var o in t)1===r[o]&&(i[o]=t[o]);t.attr&&(i.attr=n({},t.attr));var l=t.nodes;if(null!=l&&l.length>0){i.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)i.nodes[a]=p(s===!0?l[a]:l,i)}return i}function d(t){for(var e,n=t;null!=n;)e=n,n=n.nodes&&n.nodes[0];return e}function g(t,e,n,r){if(m.TEXTNODE===t.type)return"function"==typeof t.content?t.content("node",e,n,null,r):t.content;var i="";if(null!=t.nodes)for(var o,l=0,s=t.nodes.length;s>l;l++)o=t.nodes[l],i+=g(o,e,n,r);return i}function v(t){return this instanceof v==!1?new v(t):null==t?this:t.type===m.SET?t:this.add(t)}var m=t.Dom,y=t.render,b=t.parse,_=t.Utils.ensureTmplFn,x=(global.Compo||t.Compo||Compo).signal.emitIn,w=function(){function t(t,n){return t===n?(e=!0,0):1}var e=!1;return function(n){var r,i,o,l;if(e=!1,n.sort(t),e===!1)return n;for(r=[],i=0,o=0,l=n.length-1;l>i;)n[i++]===n[i]&&(r[o++]=i);for(;o--;)n.splice(r[o],1);return n}}(),C="parent",O="nodes",k="components",N="attr";return v.prototype={constructor:v,type:m.SET,length:0,components:null,add:function(t){var e,n;if("string"==typeof t&&(t=b(t)),o(t)){for(e=0,n=t.length;n>e;e++)this.add(t[e]);return this}"function"==typeof t&&null!=t.prototype.type&&(t={controller:t,type:m.COMPONENT});var r=t.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",t),this;if(r===m.FRAGMENT){var i=t.nodes;for(e=0,n=i.length;n>e;)this[this.length++]=i[e++];return this}if(r===m.CONTROLLER){if(null!=t.nodes&&t.nodes.length)for(e=t.nodes.length;0!==e;)t.nodes[--e].parent=t;null!=t.$&&(this.type=m.CONTROLLER)}return this[this.length++]=t,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(t,e,n,r){if(this.components=[],1===this.length)return y(this[0],t,e,n,r||this);null==n&&(n=document.createDocumentFragment());for(var i=0,o=this.length;o>i;i++)y(this[i],t,e,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(t){var e;return e=v(t),e.prevObject=this,e},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(e){if(null!=e)return this.empty().append(e);if(arguments.length)return this;var n;if(0===this.length)n=new m.Node;else if(1===this.length)n=this[0];else{n=new m.Fragment;for(var r=0,i=this.length;i>r;r++)n.nodes[r]=this[r]}return t.stringify(n)},text:function(t,e,n){if("string"==typeof t&&1===arguments.length){for(var r,i=[new m.TextNode(t)],o=0,l=this.length;l>o;o++)r=this[o],r.nodes=i;return this}for(var r,s="",o=0,l=this.length;l>o;o++)r=this[o],s+=g(r,t,e,n);return s}},r(["append","prepend"],function(t){v.prototype[t]=function(e){for(var n,r,i=v(e),o=0,l=this.length;l>o;o++){r=this[o],n=i.toArray();for(var s=0,u=n.length;u>s;s++)n[s].parent=r;r.nodes=null!=r.nodes?"append"===t?r.nodes.concat(n):n.concat(r.nodes):n}return this}}),r(["appendTo"],function(t){v.prototype[t]=function(t,e,n,r){return null==r&&(r=this),null!=t.nodeType&&"function"==typeof t.appendChild?(t.appendChild(this.render(e,n,null,r)),x(r,"domInsert"),this):(v(t).append(this),this)}}),function(){function t(t){for(var e,n,r=t.split(";"),i={},o=0,l=r.length;l>o;o++)n=r[o],e=n.indexOf(":"),i[n.substring(0,e).trim()]=n.substring(e+1).trim();return i}function i(t){var e=[],n=0;for(var r in t)e[n++]=r+":"+t[r];return e.join(";")}r(["add","remove","toggle","has"],function(t){v.prototype[t+"Class"]=function(e){var n,r,i,o,l,s=this.length,u=0;if("string"!=typeof e){if("remove"===t)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(o=this[u],null!=o.attr){if(l=o.attr["class"],null==l)l=e;else{for(l=" "+l+" ",null==n&&(n=e.split(" "),i=n.length),r=0;i>r;r++)if(n[r]){var a=l.indexOf(" "+n[r]+" ")>-1;if("has"!==t)a!==!1||"add"!==t&&"toggle"!==t?a!==!0||"remove"!==t&&"toggle"!==t||(l=l.replace(" "+n[r]+" "," ")):l+=n[r]+" ";else if(a)return!0}l=l.trim()}"has"!==t&&(o.attr["class"]=l)}return"has"===t?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(t){v.prototype[t]=function(n,r){if(!n)return this;for(var i,o=this.length,l=0,s=arguments.length;o>l;l++)switch(i=this[l],t){case"attr":case"prop":if(1===s){if("string"==typeof n)return i.attr[n];for(var u in n)i.attr[u]=e(n[u])}else 2===s&&(i.attr[n]=e(r));break;case"removeAttr":case"removeProp":i.attr[n]=null}return this}}),n(v.prototype,{tag:function(t){if("string"==typeof t){for(var e=0,n=this.length;n>e;e++)this[e].tagName=t;return this}return this[0]&&this[0].tagName},css:function(e,n){var r,o,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof e)return 0===u?null:"string"==typeof this[0].attr.style?t(this[0].attr.style)[e]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof e){if(null==l){this[a].attr.style=i(e);continue}r=t(l);for(o in e)r[o]=e[o];this[a].attr.style=i(r)}if(2===s){if(null==l){this[a].attr.style=e+":"+n;continue}r=t(l),r[e]=n,this[a].attr.style=i(r)}}return this}})}(),n(v.prototype,{clone:function(){for(var t=[],e=0,n=this.length;n>e;e++)t[e]=p(this[0]);return v(t)},wrap:function(t){var e,n=v(t),r=[];if(0===n.length)return console.log("Not valid wrapper",t),this;for(var i=0,o=this.length;o>i;i++){e=o>0?n.clone():n,d(e[0]).nodes=[this[i]],r[i]=e[0];var l=this[i].parent&&this[i].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[i]){l.splice(s,1,r[i]);break}}return v(r)},wrapAll:function(t){var e=v(t);return 0===e.length?(console.error("Not valid wrapper",t),this):(this.parent().mask(e),d(e[0]).nodes=this.toArray(),this.pushStack(e))}}),r(["empty","remove"],function(t){v.prototype[t]=function(){for(var e,n=0,r=this.length;r>n;n++)e=this[n],"empty"!==t?"remove"!==t||null!=e.parent&&i(e.parent.nodes,e):e.nodes=null;return this}}),n(v.prototype,{each:function(t,e){for(var n=0;this.length>n;n++)t.call(e||this,this[n],n);return this},eq:function(t){return-1===t?this.slice(t):this.slice(t,t+1)},get:function(t){return 0>t?this[this.length-t]:this[t]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(t){v.prototype[t]=function(e){var n,r,i=[],o=null==e?null:l(e,this.type,"closest"===t?"up":"down");switch(t){case"filter":return v(f(this,o));case"children":for(n=0;this.length>n;n++)r=this[n],null!=r.nodes&&(i=i.concat(null==o?r.nodes:f(r.nodes,o)));break;case"parent":for(n=0;this.length>n;n++)r=this[n].parent,!r||r.type===m.FRAGMENT||o&&c(r,o)||i.push(r);w(i);break;case"closest":case"find":if(null==o)break;for(n=0;this.length>n;n++)h(this[n][o.nextKey],o,i);break;case"first":case"last":var s;for(n=0;this.length>n;n++)if(s="first"===t?n:this.length-n-1,r=this[s],null==o||c(r,o)){i[0]=r;break}}return this.pushStack(i)}}),v}(Mask);return function(t,e){function n(t,e){for(var n=0,r=e.length-1;r>n;n++){var i=e[n];null==t[i]&&(t[i]={}),t=t[i]}return t}function r(t,e){for(var n=e.split("."),r=n.length,i=0;r>i;i++){if(null==t)return null;t=t[n[i]]}return t}function i(t,e,n){for(var r=e.split("."),i=r.length,o=0,l=null;i-1>o;o++)l=r[o],null==t[l]&&(t[l]={}),t=t[l];t[r[o]]=n}function o(t,e,n){for(var i=e.split("."),o=i.length,s=0,u=t;o--&&(u=u[i[s++]],null!=u);)if(null!=u.__observers){var a=i.slice(s).join(".");if(u.__observers[a])return u.__observers[a].push(n),p(t,e,n),void 0}var c=p(t,e,n);1===c.length&&l(t,e,c,i,!0);var f=r(t,e);d(f)&&v(f,n)}function l(t,e,r,i){var o=i.length,l=o>1?n(t,i):t,u=i[o-1],a=l[u];return o>1&&s(t,i),"length"===u&&d(l)?(v(l,callback),a):(Object.defineProperty(l,u,{get:function(){return a},set:function(t){var n=0,i=r.length;if(t!==a){if(a=t,d(t))for(n=0;i>n;n++)v(t,r[n]);if(null!=r.__dirties)return r.__dirties[e]=1,void 0;for(n=0;i>n;n++)r[n](t)}},configurable:!0}),a)}function s(t,e){for(var n,r=a(t),i="",o=0,l=e.length-1;l>o;o++)n=e[o],i+=n+".",u(i,t,n,r),t=t[n]}function u(t,e,n,r){var i,o=e[n];Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(i=o,o=e,r(t,i))},configurable:!0})}function a(t){return function(e,n){var i=t.__observers;if(null!=i)for(var l in i)if(0===l.indexOf(e)){var s=i[l].slice(0),u=s.length,a=0;if(0!==u){var f,h,p=r(t,l);for(a=0;u>a;a++)f=s[a],c(t,l,f),h=l.substring(e.length),c(n,h,f);for(a=0;u>a;a++)s[a](p);for(a=0;u>a;a++)o(t,l,s[a])}}}}function c(t,e,n){for(var i=e.split("."),o=i.length,l=0,s=t;o--&&(s=s[i[l++]],null!=s);)if(null!=s.__observers){c(s,i.slice(l).join("."),n);break}if(null!=t.__observers&&null!=t.__observers[e]){var u=r(t,e);if(2===arguments.length)return t.__observers[e].length=0,void 0;g(t.__observers[e],n),d(u)&&m(u,n)}}function f(t,e){if(null==e)return t;null==t&&(t={});for(var n in e)t[n]=e[n];return t}function h(t,e){if(null==t)return!1;for(var n=e.split("."),r=n.length,i=0;r--;)if(null==(t=t[n[i++]]))return!1;return!0}function p(t,e,n){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{__dirty:null},enumerable:!1});var r=t.__observers;return null!=r[e]?r[e].push(n):r[e]=[n],r[e]}function d(t){return null!=t&&"object"==typeof t&&null!=t.length&&"function"==typeof t.splice}function g(t){if(null==t)return!1;for(var e,n=0,r=t.length,i=1,o=arguments.length,l=0;r>n;n++)for(e=t[n],i=1;o>i;i++)if(arguments[i]===e){t.splice(n,1),n--,r--,l++;break}return l+1===o}function v(t,e){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{__dirty:null},enumerable:!1});var n=t.__observers.__array;if(null==n&&(n=t.__observers.__array=[]),0===n.length)for(var r,i=0,o=["push","unshift","splice","pop","shift","reverse","sort"],l=o.length;l>i;i++)r=o[i],t[r]=y(t,t[r],r);n[n.length++]=e}function m(t,e){var n=t.__observers&&t.__observers.__array;if(null!=n)for(var r=0,i=n.length;i>r;r++)if(n[r]===e){n[r]=null;for(var o=r;i>o;o++)n[o]=n[o+1];i--,n.length--}}function y(t,e,n){return function(){return b(t,e,n,J.call(arguments))}}function b(t,e,n,r){var i=t.__observers&&t.__observers.__array,o=e.apply(t,r);if(null==i||0===i.length)return o;if(null!=t.__observers.__dirty)return t.__observers.__dirty=!0,o;for(var l,s=0,u=i.length;u>s;s++)l=i[s],"function"==typeof l&&l(t,n,r);return o}function _(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n])}function x(t){return t.parentNode.removeChild(t)}function w(t){if(null!=t)for(var e=0,n=t.length;n>e;e++)x(t[e])}function C(t,e){return e.parentNode.insertBefore(t,e.nextSibling)}function O(t,e){return e.parentNode.insertBefore(t,e)}function k(t,e,n){if(null==t.components)return C(n,t.placeholder);for(var r,i=t.components,o=null,l=!0,s=i.length,u=e;s>u;u++)if(r=i[u].elements,r&&r.length){o=r[0];break}if(null==o)for(l=!1,u=s>e?e:s;--u>-1;)if(r=i[u].elements,r&&r.length){o=r[r.length-1];break}return null==o&&(o=t.placeholder),l?O(n,o):C(n,o)}function N(e,n,r,i,o){return t.render(n,r,i,o,e)}function j(t,e){if(null==t)return!1;w(t.elements),t.elements=null,null!=F&&F.dispose(t);var n=e&&e.components||t.parent&&t.parent.components;return null==n?(console.error("Parent Components Collection is undefined"),!1):g(n,t)}function A(t){null!=F&&F.signal.emitIn(t,"domInsert")}function S(t,e){if("function"==typeof t.dispose){var n=t.dispose;return t.dispose=function(){e.call(this),n.call(this)},void 0}t.dispose=e}function T(t,e,n,r,i){if("."===t)return d(e)&&v(e,i),void 0;var l,s=G(t),u=K(s);if(null!=u){if("string"==typeof u)return h(e,u)&&(l=e),null==l&&h(r,u)&&(l=r),null==l&&(l=e),o(l,u,i),void 0;for(var a,c=null!=u.length&&"function"==typeof u.splice,f=c===!0?u.length:1,p=0;f>p;p++)if(a=c?u[p]:u,null!=a){if("object"==typeof a){if(l=W(a.accessor,e,n,r),null==l||"object"!=typeof l){console.error("Binding failed to an object over accessor",a);continue}a=a.ref}else l=h(e,a)?e:h(r,a)?r:e;o(l,a,i)}}}function E(t,e,n,r){if("function"==typeof n&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===t)return m(e,r),void 0;var i,o=K(t);if(null!=o){if("string"==typeof o)return h(e,o)&&c(e,o,r),h(n,o)&&c(n,o,r),void 0;for(var i,l=null!=o.length&&"function"==typeof o.splice,s=l===!0?o.length:1,u=0;s>u;u++)if(i=l?o[u]:o,null!=i)if("object"!=typeof i)h(e,i)&&c(e,i,r),h(n,i)&&c(n,i,r);else{var a=W(i.accessor,e,null,n);a&&c(a,i.ref,r)}}}function R(t,e,n,r,i){var o=0;return function(){if(o++>10)return console.warn("Concurent binder detected",t),void 0;var l=V(t,e,n,r);if(arguments.length>1){var s=J.call(arguments);s[0]=l,i.apply(this,s)}else i(l);o--}}function D(t,e,n){for(var r,i,o,l,s=t.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(o=2==r.length?r[0]:n,i=r[2==r.length?1:0],l=I(i.trim(),o,e),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u}function I(t,e,n){if(n!==!0)return{signal:t,type:e};var r=t.indexOf(".");return-1===r?(console.error("No pipe name in a signal",t),null):{signal:t.substring(r+1),pipe:t.substring(0,r),type:e}}function M(){}function P(){}function L(){}function U(t,e){if(null==e&&(e=[]),null==t.components)return e;for(var n,r=t.components,i=0,o=r.length;o>i;i++)n=r[i],"validate"!==n.compoName?U(n):e.push(n);return e}var H=global.jQuery||global.Zepto||global.$,F=e!==void 0?e:t.Compo||global.Compo,$=F.Dom.addEventListener,z=t.registerHandler,q=t.registerAttrHandler,B=t.registerUtil,J=Array.prototype.slice,X=t.Utils.Expression,W=X.eval,V=function(t,e,n,r){if("."===t)return e;var i=W(t,e,n,r);return null==i?"":i},G=X.parse,K=X.varRefs,Q=function(){function e(t,e,n,r){null==r&&(r=":bind"===n.compoName?"single":"dual");var i,o=n.attr;if(this.node=n,this.controller=n,this.model=t,this.element=e,this.value=o.value,this.property=o.property,this.setter=n.attr.setter,this.getter=n.attr.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property)switch(e.tagName){case"INPUT":if(i=e.getAttribute("type"),"checkbox"===i){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=u.SELECT;break;default:this.property="element.innerHTML"}if(o.log&&(this.log=!0,"log"!==o.log&&(this.logExpression=o.log)),o["x-signal"]){var l=D(o["x-signal"],null,"dom")[0];l&&("dom"===l.type?this.signal_domChanged=l.signal:"object"===l.type?this.signal_objectChanged=l.signal:console.error("Type is not supported",l))}if(o["x-pipe-signal"]){var l=D(o["x-pipe-signal"],!0,"dom")[0];l&&("dom"===l.type?this.pipe_domChanged=l:"object"===l.type?this.pipe_objectChanged=l:console.error("Type is not supported",l))}if(o["dom-slot"]){this.slots={};var s=n.parent,a=s.parent;s.parent=this,this.parent=a,this.slots[o["dom-slot"]]=function(t,e){this.domChanged(t,e)}}var c=o["object-pipe-slot"]||o["x-pipe-slot"];if(c){var f=c,h=f.indexOf("."),p=f.substring(0,h),l=f.substring(h+1);this.pipes={},this.pipes[p]={},this.pipes[p][l]=function(){this.objectChanged()},F.pipe.addController(this)}if(o.expression){if(this.expression=o.expression,null==this.value&&"single"!==r){var d=K(this.expression);"string"==typeof d?this.value=d:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function n(t){var e=t.expression,n=t.model,r=t.objectChanged=t.objectChanged.bind(t);if(t.binder=R(e,n,t.cntx,t.node,r),T(e,n,t.cntx,t.node,t.binder),"dual"===t.bindingType){var i=t.node.attr;if(!i["change-slot"]&&!i["change-pipe-event"]){var o=t.element,l=i["change-event"]||i.changeEvent||"change",s=t.domChanged.bind(t);$(o,l,s)}}return t.objectChanged(),t}function l(t,e,n){var r=t.slots;(null==r||"function"!=typeof r[e]||r[e].apply(t,n)!==!1)&&null!=t.parent&&l(t.parent,e,n)}var s={};t.registerBinding=function(t,e){s[t]=e},t.BindingProvider=e,e.create=function(t,n,r,i){var o,l=r.attr.bindingProvider,u=null==l?null:s[l];return"function"==typeof u?new u(t,n,r,i):(o=new e(t,n,r,i),null!=u&&f(o,u),o)},e.bind=function(t){return n(t)},e.prototype={constructor:e,dispose:function(){E(this.expression,this.model,this.controller,this.binder)},objectChanged:function(t){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==t&&(t=this.objectWay.get(this,this.expression)),this.domWay.set(this,t),this.log&&console.log("[BindingProvider] objectChanged -",t),this.signal_objectChanged&&l(this.node,this.signal_objectChanged,[t]),this.pipe_objectChanged){var e=this.pipe_objectChanged;F.pipe(e.pipe).emit(e.signal)}this.locked=!1}},domChanged:function(t,e){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var n=e||this.domWay.get(this),r=!0;if(this.node.validations)for(var i,o=0,s=this.node.validations.length;s>o;o++)if(i=this.node.validations[o],i.validate(n,this.element,this.objectChanged.bind(this))===!1){r=!1;break}if(r&&(this.dismiss=1,this.objectWay.set(this.model,this.value,n),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",n),this.signal_domChanged&&l(this.node,this.signal_domChanged,[n]),this.pipe_domChanged)){var u=this.pipe_domChanged;F.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(t,e){return V(e,t.model,t.cntx,t.controller)},set:function(t,e,n){i(t,e,n)}},domWay:{get:function(t){if(t.getter){var e=t.node.parent;return null==e||"function"!=typeof e[t.getter]?(console.error("Mask.bindings: Getter should be a function",t.getter,t),null):e[t.getter]()}return r(t,t.property)},set:function(t,e){if(t.setter){var n=t.node.parent;if(null==n||"function"!=typeof n[t.setter])return console.error("Mask.bindings: Setter should be a function",t.setter,t),void 0;n[t.setter](e)}else i(t,t.property,e)}}};var u={SELECT:{get:function(t){var e=t.element;return-1===e.selectedIndex?"":e.options[e.selectedIndex].getAttribute("name")},set:function(t,e){for(var n,r=t.element,i=0,o=r.options.length;o>i;i++)if(n=r.options[i],n.getAttribute("name")==e)return r.selectedIndex=i,void 0}}};return f(e,{addObserver:o,removeObserver:c}),e}();z(":visible",M),M.prototype={constructor:M,refresh:function(t,e){e.style.display=V(this.attr.check,t)?"":"none"},renderStart:function(t,e,n){this.refresh(t,n),this.attr.bind&&o(t,this.attr.bind,this.refresh.bind(this,t,n))}},function(){function t(){}z(":bind",t),t.prototype={constructor:t,renderStart:function(t,e,n){this.provider=Q.create(t,n,this,"single"),this.provider.objectChanged()}}}(),z(":dualbind",P),P.prototype={constructor:P,renderStart:function(t,e,n,r){this.provider=Q.create(e,r,this),this.provider.objectChanged()},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function n(){}function i(t,e){this.fn=t,this.message=e}function o(t,e,n){console.warn("Validate Notification:",t,e);var r=H(t).next("."+s);return 0===r.length&&(r=H("<div>").addClass(s).html("<span></span><button>cancel</button>").insertAfter(t)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(e).end().show()}function l(t){return H(t).next("."+s).hide()}var s="-validate-invalid";t.registerValidator=function(t,e){u[t]=e},z(":validate",n),n.prototype={constructor:n,attr:{},renderStart:function(t,e,r){if(this.element=r,this.attr.value){var o=n.resolveFromModel(t,this.attr.value);o&&(this.validators=[new i(o)])}},validate:function(t,e,n){null==e&&(e=this.element),this.attr&&(null==t&&this.attr.getter&&(t=r({node:this,element:e},this.attr.getter)),null==t&&this.attr.value&&(t=r(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var i,o=0,l=this.validators.length;l>o;o++)if(i=this.validators[o].validate(t),i&&!this.attr.silent)return this.notifyInvalid(e,i,n),!1;return this.makeValid(e),!0},notifyInvalid:function(t,e,n){return o(t,e,n)},makeValid:function(t){return l(t)},initValidators:function(){this.validators=[];for(var t in this.attr){switch(t){case"message":case"value":case"getter":continue}if(t in u!=!1){var e=u[t];this.validators.push(new i(e(this.attr[t],this),this.attr.message))}else console.error("Unknown Validator:",t,this)}}},n.resolveFromModel=function(t,e){return r(t.Validate,e)},n.createCustom=function(t,e){var r=new n;return r.element=t,r.validators=[new i(e)],r},i.prototype.validate=function(t){var e=this.fn(t);return e===!1?this.message||"Invalid - "+t:e},z(":validate:message",e({template:"div."+s+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(t){"string"==typeof t&&(t={message:t}),t.cancel||(t.cancel="cancel"),this.model=t},compos:{button:"$: button"},show:function(t,e){var n=this;this.model.message=t,this.compos.button.off().on(function(){n.hide(),e&&e()}),this.$.show()},hide:function(){this.$.hide()}}));var u={match:function(t){return function(e){return RegExp(t).test(e)}},unmatch:function(t){return function(e){return!RegExp(t).test(e)}},minLength:function(t){return function(e){return e.length>=parseInt(t,10)}},maxLength:function(t){return function(e){return e.length<=parseInt(t,10)}},check:function(t,e){return function(n){return V("x"+t,e.model,{x:n},e)}}}}(),z(":validate:group",L),L.prototype={constructor:L,validate:function(){for(var t,e=U(this),n=0,r=e.length;r>n;n++)if(t=e[n],!t.validate())return!1;return!0}},function(){function t(t,e,n){return t?null==e||""===e?t+" "+n:t.replace(e,n):n}function e(e,n,r,i,o){return function(n){switch(e){case"node":r.textContent=n;break;case"attr":var l,s,u=typeof r[o];if("boolean"===u)return i=r[o]=!!n,void 0;if("string"===u)return i=r[o]=t(r[o],i,n),void 0;l=r.getAttribute(o),s=t(l,i,n),r.setAttribute(o,s),i=n}}}function n(t,n,r,i,o,l,s,u){var a=e(u,n,o,t,s),c=R(n,r,i,l,a);T(n,r,i,l,c),S(l,function(){E(n,r,l,c)})}B("bind",{current:null,element:null,nodeRenderStart:function(t,e,n,r,i){var o=V(t,e,n,i);this.current=o,this.element=document.createTextNode(o)},node:function(t,e,r,i,o){return n(this.current,t,e,r,this.element,o,null,"node"),this.element},attrRenderStart:function(t,e,n,r,i){this.current=V(t,e,n,i)},attr:function(t,e,r,i,o,l){return n(this.current,t,e,r,i,o,l,"attr"),this.current}})}(),q("xx-visible",function(t,e,n,r,i,o){var l=R(e,n,r,o,function(t){i.style.display=t?"":"none"});T(e,n,r,o,l),S(o,function(){E(e,n,o,l)}),V(e,n,r,o)||(i.style.display="none")}),q("x-toggle","client",function(t,e,n,r,o,l){var s=e.substring(0,e.indexOf(":")),u=e.substring(s.length+1),a=K(u);"string"!=typeof a&&(a=a[0]),$(o,s,function(){var t=V(u,n,r,l);i(n,a,t)})}),function(t){function n(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}t.registerHandler("%%",n);var r=function(){var t={refresh:function(t){this.model=t,this.elements&&(w(this.elements),this.elements=[]),null!=F&&F.dispose(this),O(N(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){E(this.expr,this.originalModel,this,this.binder)}};return function(e,n,r,i){var o=e.attr.use;f(e,{expr:o,placeholder:document.createComment(""),binder:R(o,n,r,e,t.refresh.bind(e)),originalModel:n,model:V(o,n,r,e),dispose:t.dispose}),T(o,n,r,e,e.binder),i.appendChild(e.placeholder)}}(),i=function(){return function(t,e,n){function r(t){console.log("Logger > Key: %s, Value: %s",i,t)}var i=t.attr.log,o=R(i,e,n,t,r),l=V(i,e,n,t);T(i,e,n,t,o),S(t,function(){E(i,e,t,o)}),r(l)}}(),o=function(){function t(t,e){return function(){return t.apply(e,arguments)}}var e={refresh:function(t){(null!=this.elements||t)&&(null==this.elements?(O(N(this,this.template,this.model,this.cntx),this.placeholder),this.$=H(this.elements)):(null==this.$&&(this.$=H(this.elements)),this.$[t?"show":"hide"]()),this.onchange&&this.onchange(t))},dispose:function(){E(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(n,r,i,o){var l=n.attr["if"];f(n,{expr:l,template:n.nodes,placeholder:document.createComment(""),binder:R(l,r,i,n,t(e.refresh,n)),state:!!V(l,r,i,n)}),n.state||(n.nodes=null),T(l,r,i,n,n.binder),o.appendChild(n.placeholder)}}(),l=function(){var t={refresh:function(t){if(null!=this.elements||!t){if(null==this.elements)return O(N(this,this.template,this.model,this.cntx)),this.$=H(this.elements),void 0;null==this.$&&(this.$=H(this.elements)),this.$[t?"hide":"show"]()}}};return function(e,n,r,i){var o=e.parent.components,l=o&&o[o.length-1];return e.template=e.nodes,e.placeholder=document.createComment(""),null==l||"%%"!==l.compoName||null==l.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(l.onchange=t.refresh.bind(e),l.state&&(e.nodes=null),i.appendChild(e.placeholder),void 0)}}(),s=function(){function n(t,e){var n=[];if(null==e||"object"!=typeof e||null==e.length)return n;for(var r,i=0,o=e.length;o>i;i++){switch(r=e[i],typeof r){case"string":case"number":case"boolean":r=e[i]=Object(r)}n[i]=new l(t.template,r,t)}return n}function r(t,e){for(var n=t.components,r=0,i=n.length,o=0,l=null,s=null,u=null,a=document.createDocumentFragment(),c=[];i>r;r++)if(u=n[r],null!=u.elements&&0!==u.elements.length)for(o=0,l=u.elements.length;l>o;o++)s=u.elements[o],s.parentNode.removeChild(s);t:for(o=0,l=e.length;l>o;o++){for(r=0;i>r;r++)if(e[o]===n[r].model){c[o]=n[r];continue t}console.warn("No Model Found for",e[o])}for(r=0,i=c.length;i>r;r++)if(u=c[r],null!=u.elements&&0!==u.elements.length)for(o=0,l=u.elements.length;l>o;o++)s=u.elements[o],a.appendChild(s);t.components=c,O(a,t.placeholder)}function i(t,e,r,i,l){if(null!=e&&null!=r){var s=e,u=e+r;for(u>t.components.length&&(u=t.components.length);u>s;s++)j(t.components[s],t)&&(s--,u--)}if(null!=i&&l&&l.length){var a=new o,c=n(t,l),f=N(a,c),h=a.components;k(t,i,f),A(a),null==t.components&&(t.components=[]),t.components.splice.apply(t.components,[i,0].concat(h))}}var o=t.Dom.Component,l=function(){function t(t,e,n){this.nodes=t,this.model=e,this.parent=n}var e=o.prototype;t.prototype={constructor:s,renderEnd:function(t){this.elements=t}};for(var n in e)t.prototype[n]=e[n];return t}(),s={append:function(e){var n=new l(this.template,e,this);t.render(n,e,null,this.container,this)}},u={refresh:function(t,e,o){var l,s,u=0;if(null==e){if(null!=this.components)for(u=0,s=this.components.length;s>u;u++)l=this.components[u],j(l,this)&&(u--,s--);return this.components=[],this.nodes=n(this,t),O(N(this,this.nodes),this.placeholder),_(this.components,A),void 0}for(s=t.length;s>u;u++)switch(l=t[u],typeof l){case"string":case"number":case"boolean":t[u]=Object(l)}switch(e){case"push":i(this,null,null,t.length,t.slice(t.length-1));break;case"pop":i(this,t.length,1);break;case"unshift":i(this,null,null,0,t.slice(0,1));break;case"shift":i(this,0,1);break;case"splice":var a=o[0],c=1===o.length?this.components.length:o[1],f=o.length>2?t.slice(o[0],o.length-2+o[0]):null;i(this,a,c,a,f);break;case"sort":case"reverse":r(this,t)}},dispose:function(){E(this.expr,this.model,this,this.refresh)}};return function(t,r,i,o){null==t.nodes&&e!==void 0&&e.ensureTemplate(t);var l=t.attr.each||t.attr.foreach,a=V(l,r,i,t);f(t,{expr:l,binder:R(l,r,i,t,u.refresh.bind(t)),template:t.nodes,container:o,placeholder:document.createComment(""),dispose:u.dispose}),o.appendChild(t.placeholder),T(t.expr,r,i,t,t.binder);for(var c in s)t[c]=s[c];t.nodes=n(t,a)}}(),u=function(){var t={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;
for(var t=V(this.expr,this.model,this.cntx,this),e=0,n=this.elements.length;n>e;e++)this.elements[e].style.display=t?"":"none";this.refreshing=!1}},dispose:function(){E(this.expr,this.model,this,this.binder)}};return function(e,n,r){var i=e.attr.visible;f(e,{expr:i,binder:R(i,n,r,e,t.refresh.bind(e)),dispose:t.dispose}),T(i,n,r,e,e.binder),t.refresh.call(e)}}();n.prototype={constructor:n,elements:null,renderStart:function(t,e,n){var u=this.attr;if(null==u["debugger"])return null!=u.use?(r(this,t,e,n),void 0):null!=u.log?(i(this,t,e,n),void 0):(this.model=t,null!=u["if"]?(o(this,t,e,n),void 0):null!=u["else"]?(l(this,t,e,n),void 0):((null!=u.each||null!=u.foreach)&&s(this,t,e,n),void 0))},render:null,renderEnd:function(t){this.elements=t,null!=this.attr.visible&&u(this,this.model,this.cntx)}}}(t)}(Mask,Compo),Mask}),function(t,e){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=e(t)}(this,function(t){"use strict";function e(t){for(var e=t.length,n=0,r=e-1;e>n&&"/"===t[n];n++);for(;r>n&&"/"===t[r];r--);return t.substring(n,r+1)}function n(t){return t=e(t),""===t?[]:t.split("/")}function r(t){var e=t.indexOf("?"),r=-1===e?t:t.substring(0,e);return n(r)}function i(t,e){null==e&&(e="/");for(var n,r={},i=t.split(e),o=0,l=i.length;l>o;o++)n=i[o].split("="),r[n[0]]=decodeURIComponent(n[1]);return r}function o(t){if("^"===t[0])return RegExp(t);for(var e=t.split("|"),n=0,r=e.length;r>n;n++)e[n]="^"+e[n]+"$";return RegExp(e.join("|"))}function l(){return null==s&&(s=new f(h)),s}var s,u=t.mask||Mask,a=!0,c=function(){function t(t,e){var n=e.charCodeAt(0);switch(n){case 33:t.strict=!0,e=e.substring(1);break;case 94:t.strict=!1,e=e.substring(1);break;case 40:var r=1,i=e.length-1;return 41!==e.charCodeAt(e.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),i++),t.match=RegExp(e.substring(r,i)),void 0}for(var l,s,u,a,c,f,h,p=e.split("/"),d=0,g=p.length,v=!0,m=t.parts=[];g>d;d++)if(l=p[d],""!==l){s=l.charCodeAt(0),a=l.charCodeAt(1),c=63===s,f=58===(c?a:s),u=0,c&&u++,f&&u++,0!==u&&(l=l.substring(u)),!c&&!v&&console.log("<ruta> strict part found after optional",e),c&&(v=!1);var y=l.indexOf("(");if(f&&-1!==y){var i=l.length-1;")"!==l[i]&&(i+=1),h=RegExp(o(l.substring(y+1,i))),l=l.substring(0,y)}c||f?f&&m.push({alias:l,matcher:h,optional:c}):m.push(l)}}function e(t,e){var r=e.indexOf("?"),o=-1===r?null:e.substring(r+1),l={path:e,params:null==o?{}:i(o,"&")};-1!==r&&(e=e.substring(0,r));for(var s,u,a=n(e),c=t.parts,f=c.length,h=a.length,p=0;h>p;p++)if(s=a[p],u=f>p?c[p]:null){if("string"==typeof u)continue;if(u.alias){l.params[u.alias]=s;continue}}return l}function l(t,n,i){for(var o,l=r(t),u=0,a=n.length;a>u;u++)if(o=n[u],s(l,o,i))return null==o.parts?(o.current={params:{}},o):(o.current=e(o,t),o);return null}function s(t,e,n){if(null!=n&&null!=e.method&&e.method!==n)return!1;if(e.match)return e.match.test("string"==typeof t?t:t.join("/"));"string"==typeof t&&(t=r(t));for(var i,o=e.parts,l=o.length,s=0,u=t.length;u>s;s++){if(i=o[s],s>=l)return e.strict!==!0;if("string"==typeof i){if(t[s]===i)continue;return!1}if(i.matcher&&i.matcher.test(t[s])===!1)return!1;if(i.optional)return!0;if(!i.alias)return!1}return l>s?o[s].optional===!0:!0}function u(e,n){this.method=36===e.charCodeAt(0)?e.substring(1,e.indexOf(" ")).toUpperCase():null,null!=this.method&&(e=e.substring(this.method.length+2)),this.strict=a,this.value=n,this.definition=e,t(this,e)}function c(){this.routes=[]}return u.prototype={parts:null,value:null,current:null},c.prototype={add:function(t,e){return this.routes.push(new u(t,e)),this},get:function(t,e){return l(t,this.routes,e)}},c.parse=function(n,r){var i={};return t(i,n),e(i,r)},c}(),f=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var e=this;return e.listener=t,window.onhashchange=function(){e.changed(location.hash)},e}function e(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var e=this;return e.listener=t,e.initial=location.pathname,window.onpopstate=function(){return e.initial===location.pathname?(e.initial=null,void 0):(e.changed(),void 0)},e}function n(n,r){if(this.collection=n||new c,r){var i="hash"===r?t:e;this.emitter=new i(this)}null==this.emitter&&(this.emitter=new e(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function e(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){location.hash=t},changed:function(t){this.listener.changed(e(t))},current:function(){return e(location.hash)}}}(),function(){e.prototype={navigate:function(t){history.pushState({},null,t),this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),n.prototype={changed:function(t){var e=this.collection.get(t);e&&this.action(e)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},n)}(),h=new c,p={Collection:c,setRouterType:function(t){return null==s&&(s=new f(h,t)),this},setStrictBehaviour:function(t){a=t},add:function(t,e){return l(),h.add(t,e)},get:function(t){return h.get(t)},navigate:function(t){l().navigate(t)},current:function(){return l().current()},parse:c.parse};return function(){function t(t){t.preventDefault(),t.stopPropagation(),p.navigate(this.href)}u.registerAttrHandler("x-dynamic",function(e,n,r,i,o){o.onclick=t},"client")}(),p}),function(t){"use strict";function e(t,e){if("object"!=typeof t||null==e)return t;for(var n,r=t,i=e.split("."),o=i.length,l=0;o>l;l++)if(n=i[l],r=r[n],null==r)return r;return r}function n(t,e){for(var n in e)e[n]&&(t[n]=e[n]);return t}function r(t,n,r,i){if("function"==typeof n)return n(t)?t:null;if(r===void 0)return t==n?t:null;var o=null!=n?e(t,n):t,l=r,s=i;switch(l){case">":return o>s?t:null;case"<":return s>o?t:null;case">=":return o>=s?t:null;case"<=":return s>=o?t:null;case"!=":return o!=s?t:null;case"==":return o==s?t:null}return console.error("InvalidArgumentException: arr.js:check",arguments),null}function i(t){this.items=t}function o(t){i.prototype[t]=function(){var e=arguments.length,n=s[t](this.items,e>0?arguments[0]:null,e>1?arguments[1]:null,e>2?arguments[2]:null,e>3?arguments[3]:null);return n instanceof Array?(this.items=n,this):n}}var l=t.ruqq||(t.ruqq={}),s={where:function(t,e,n,i){var o=[];if(null==t)return o;for(var l,s=0,u=t.length;u>s;s++)l=t[s],null!=r(l,e,n,i)&&o.push(l);return o},each:Array.prototype.forEach!==void 0?function(t,e){return null==t?t:(t.forEach(e),t)}:function(t,e){if(null==t)return t;for(var n=0,r=t.length;r>n;n++)e(t[n]);return t},remove:function(t,e,n,i){for(var o=0,l=t.length;l>o;o++)null!=r(t[o],e,n,i)&&(t.splice(o,1),o--,l--);return t},invoke:function(){for(var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift(),r=[],i=0;e.length>i;i++)"function"==typeof e[i][n]?r.push(e[i][n].apply(e[i],t)):r.push(null);return r},last:function(t,e,n,i){if(null==t)return null;if(null==e)return t[t.length-1];for(var o=t.length;o>-1;--o)if(null!=r(t[o],e,n,i))return t[o];return null},first:function(t,e,n,i){if(null==e)return t[0];for(var o=0,l=t.length;l>o;o++)if(null!=r(t[o],e,n,i))return t[o];return null},any:function(t,e,n,i){for(var o=0,l=t.length;l>o;o++)if(null!=r(t[o],e,n,i))return!0;return!1},isIn:function(t,e){for(var n=0;t.length>n;n++)if(e==t[n])return!0;return!1},map:Array.prototype.map!==void 0?function(t,e){return null==t?[]:t.map(e)}:function(t,e){var n=[];if(null==t)return n;for(var r=0,i=t.length;i>r;r++)n.push(e(t[r],r));return n},aggr:function(t,e,n){for(var r=0,i=t.length;i>r;r++){var o=n(t[r],e,r);null!=o&&(e=o)}return e},select:function(t,e){if(null==t)return[];for(var n,r=[],i=0,o=t.length;o>i;i++)if(n=t[i],"string"==typeof e)r.push(n[e]);else if("function"==typeof e)r.push(e(n));else if(e instanceof Array){for(var l={},s=0;e.length>s;s++)l[e[s]]=t[i][e[s]];r.push(l)}return r},indexOf:function(t,e,n,i){for(var o=0,l=t.length;l>o;o++)if(null!=r(t[o],e,n,i))return o;return-1},count:function(t,e,n,i){for(var o=0,l=0,s=t.length;s>l;l++)null!=r(t[l],e,n,i)&&o++;return o},distinct:function(t,e){var n=[];if(null==t)return n;for(var r=0,i=t.length;i>r;r++){for(var o=!0,l=0;n.length>l;l++)if(e&&e(t[r],n[l])||null==e&&t[r]==n[l]){o=!1;break}o&&n.push(t[r])}return n}};s.each(["min","max"],function(t){s[t]=function(n,r){if(null==n)return null;for(var i=null,o=0,l=n.length;l>o;o++){var s=e(n[o],r);null!=i?"max"===t&&s>i?i=s:"min"===t&&i>s&&(i=s):i=s}return i}}),l.arr=function(t){return new i(t)},n(l.arr,s);for(var u in s)o(u)}("undefined"!=typeof window?window:global),function(t,e){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),null==t.net&&(t.net={}),t.net.Uri=e(t)}(this,function(){"use strict";function t(t){return t&&"object"==typeof t&&"function"==typeof t.combine}function e(){for(var t,e="",n=0,r=arguments.length;r>n;n++)t=arguments[n],t&&(e?("/"!==e[e.length-1]&&(e+="/"),e+="/"===t[0]?t.substring(1):t):e=t);return e}function n(t){return"/"===t[t.length-1]?t.substring(0,t.length-1):t}function r(t){var e,n=new d;for(e in t)"string"==typeof t[e]&&(n[e]=t[e]);return n}function i(t){return t.replace(/\\/g,"/").replace(/^\.\//,"").replace(/^(\w+):\/([^\/])/,"/$1:/$2")}function o(t){return p.test(t)&&"/"===t[0]?t.substring(1):t}function l(t){var e=c.exec(t.value);null==e&&"/"===t.value[0]&&(t.protocol="file"),null!=e&&(t.protocol=e[1],t.value=t.value.substring(e[0].length))}function s(t){if(null!=t.protocol){if("file"===t.protocol){var e=p.exec(t.value);return e&&(t.host=e[1],t.value=t.value.substring(t.host.length)),void 0}var n=t.value.indexOf("/",2);t.host=~n?t.value.substring(0,n):t.value,t.value=t.value.replace(t.host,"")}}function u(t){var e=t.value.indexOf("?");-1!==e&&(t.search=t.value.substring(e),t.value=t.value.substring(0,e))}function a(t){var e=f.exec(t.value),r=null==e?null:e[1];null!=r&&(t.file=r,t.value=t.value.substring(0,t.value.length-r.length),t.value=n(t.value),e=h.exec(r),t.extension=null==e?null:e[1])}var c=/^([a-zA-Z]+):\/\//,f=/([^\/]+(\.[\w\d]+)?)$/i,h=/\.([\w\d]+)$/i,p=/(^\/?\w+:)\/[^\/]/,d=function(e){return null==e?this:t(e)?e.combine(""):(e=i(e),this.value=e,l(this),s(this),u(this),a(this),this.path=n(this.value),/^[\w]+:\//.test(this.path)&&(this.path="/"+this.path),this)};return d.prototype={cdUp:function(){return this.path?"/"===this.path?this:/^\/?[a-zA-Z]+:\/?$/.test(this.path)?this:(this.path=this.path.replace(/\/?[^\/]+\/?$/i,""),this):this},combine:function(i){if(t(i)&&(i=""+i),!i)return r(this);if(p.test(i))return new d(i);var o=r(this);if(o.value=i,u(o),a(o),!o.value)return o;if(i=o.value.replace(/^\.\//i,""),"/"===i[0])return o.path=i,o;for(;/^(\.\.\/?)/gi.test(i);)o.cdUp(),i=i.substring(3);return o.path=n(e(o.path,i)),o},toString:function(){var t=this.protocol?this.protocol+"://":"";return t+=e(this.host,this.path,this.file)+(this.search||""),this.file||this.search||(t+="/"),t},toPathAndQuery:function(){return e(this.path,this.file)+(this.search||"")},toRelativeString:function(t){if("string"==typeof t&&(t=new d(t)),0===this.path.indexOf(t.path)){var n=this.path?this.path.replace(t.path,""):"";return"/"===n[0]&&(n=n.substring(1)),e(n,this.file)+(this.search||"")}for(var r=this.path.split("/"),i=t.path.split("/"),o="",l=0,s=Math.min(r.length,i.length);s>l&&r[l]===i[l];l++);if(l>0&&(o=r.splice(0,l).join("/")),o){for(var u,a="",c=t.path;c;){if(0==this.path.indexOf(c)){u=this.path.replace(c,"");break}c=c.replace(/\/?[^\/]+\/?$/i,""),a+="../"}return e(a,u,this.file)}return""+this},toLocalFile:function(){var t=e(this.host,this.path,this.file);return o(t)},toLocalDir:function(){var t=e(this.host,this.path,"/");return o(t)},toDir:function(){var t=this.protocol?this.protocol+"://":"";return t+e(this.host,this.path,"/")},isRelative:function(){return!(this.protocol||this.host)},getName:function(){return this.file.replace("."+this.extension,"")}},d.combinePathes=e,d.combine=e,d}),function(){var t={};String.format=function(e){if(~e.indexOf("#{")){for(var n="",r=0,i=arguments[1];;){var o=e.indexOf("#{",r);if(-1==o)break;n+=e.substring(r,o);var l=e.indexOf("}",o);n+=Object.getProperty(i,e.substring(o+2,l)),r=++l}return n+=e.substring(r)}for(var s=1;arguments.length>s;s++){var u=t[s]||(t[s]=RegExp("%"+s,"g"));e=e.replace(u,arguments[s])}return e},Object.defaults=function(t,e){for(var n in e)null==t[n]&&(t[n]=e[n]);return t},Object.clear=function(t,e){if(e instanceof Array)for(var n,r=0,i=e.length;i>r;r++)n=e[r],n in t&&delete t[n];else if("object"==typeof e)for(var o in e)o in t&&delete t[o];return t},Object.extend=function(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)null!=e[n]&&(t[n]=e[n]);return t},Object.getProperty=function(t,e){if("."===e)return t;for(var n=t,r="string"==typeof e?e.split("."):e,i=-1,o=r.length;null!=n&&o>++i;)n=n[r[i]];return n},Object.setProperty=function(t,e,n){for(var r=e.split("."),i=t,o=r[r.length-1];r.length>1;){var l=r.shift();i=i[l]||(i[l]={})}i[o]=n},Object.lazyProperty=function(t,e,n){if("object"!=typeof e){for(var r=e.split("."),i=t,o=r[r.length-1];r.length>1;){var l=r.shift();i=i[l]||(i[l]={})}r=null,i.__defineGetter__(o,function(){return delete i[o],i[o]=n(),n=null,i[o]})}else for(var s in e)Object.lazyProperty(t,s,e[s])},Object.clone=function(t){if(null==t)return null;switch(typeof t){case"number":case"string":case"function":return t}if(t instanceof Array){for(var e=[],n=0,r=t.length;r>n;n++)e[n]=Object.clone(t[n]);return e}var i=t.constructor;if("function"==typeof i&&(i===String||i===Number||i===RegExp||i===Date))return new i(t);var o={};for(var l in t)o[l]=Object.clone(t[l]);return o},Object.observe=function(t,e,n){if(null==t.__observers&&Object.defineProperty(t,"__observers",{value:{},enumerable:!1}),t.__observers[e])return t.__observers[e].push(n),void 0;(t.__observers[e]||(t.__observers[e]=[])).push(n);var r=e.split("."),i=t,o=e;r.length>1&&(o=r.pop(),i=Object.getProperty(t,r));var l=i[o];Object.defineProperty(i,o,{get:function(){return l},set:function(n){l=n;for(var r=t.__observers[e],i=0,o=r.length;o>i;i++)r[i](n)}})},Date.format=function(t,e){function n(t){return t>9?t:"0"+t}e||(e="MM/dd/yyyy"),e=e.replace("MM",n(t.getMonth()+1));var r=t.getFullYear();return e.indexOf("yyyy")>-1?e=e.replace("yyyy",r):e.indexOf("yy")>-1&&(e=e.replace("yy",(""+r).substr(2,2))),e=e.replace("dd",n(t.getDate())),e.indexOf("HH")>-1&&(e=e.replace("HH",n(t.getHours()))),e.indexOf("mm")>-1&&(e=e.replace("mm",n(t.getMinutes()))),e.indexOf("ss")>-1&&(e=e.replace("ss",n(t.getSeconds()))),e},RegExp.fromString=function(t,e){return RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e)},Function.invoke=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return function(){return e[n].apply(e,t)}}}(),function(t){function e(){}function n(){}function r(t,e,n){if(t instanceof Array){for(var i,o=[],l=0,s=t.length;s>l;l++)i=r(t[l],e,n),t[l].tagName===u&&s-1>l&&t[l+1].tagName===a&&(l+=1,null==i&&(i=r(t[l].nodes,e,n))),null!=i&&(i instanceof Array?o=o.concat(i):o.push(i));return o}if(null!=t.content)return{content:t.content,type:t.type};if(t.tagName===u){var c=t.attr.id?e[t.attr.id]:n;return c?null==t.nodes?c:r(t.nodes,e,c):null}var f={tagName:t.tagName||t.compoName,attr:t.attr,type:t.type,controller:t.controller};return t.nodes&&(f.nodes=r(t.nodes,e,n)),f}function i(t,e){if(null==e&&(e={}),t instanceof Array){for(var n=t,r=0,l=n.length;l>r;r++)i(n[r],e);return e}var u=t.tagName;if(null!=u&&u===s){var a=t.attr.id;!a&&console.error("@content has no id specified",t),e[a]&&console.error("@content already exists",a),e[a]=o(t)}return null!=t.nodes&&i(t.nodes,e),e}function o(t){for(var e,n=t.parent;null!=n&&n.tagName!==c;){var r={type:n.type,tagName:n.tagName,attr:n.attr,controller:n.controller,nodes:null};null==e?(e=r,e.nodes=t.nodes):e.nodes=[r],n=n.parent}return null!=e?e:t.nodes}var l=t.mask||Mask,s="@content",u="@placeholder",a="@else",c="layout:view",f="layout:master",h={};e.prototype={constructor:e,render:function(){h[this.attr.id]=this}},l.registerHandler(f,e),n.prototype={constructor:n,renderStart:function(){var t=h[this.attr.master];return null==t?(console.error("Master Layout is not defined for",this),void 0):(null==this.contents&&(this.contents=i(this.nodes),Object.keys&&0===Object.keys(this.contents).length&&console.warn("no contents: @content #someID")),this.nodes=r(t,this.contents).nodes,void 0)}},l.registerHandler(c,n)}(this),obj_extend(globals,this)}).call({},"undefined"!=typeof global?global:window);