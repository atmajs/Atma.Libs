(function(globals){function __eval(t,e){"use strict";return e&&e.route.params,eval.call(window,t)}function obj_extend(t,e){for(var n in e)null!=e[n]&&(null==globals[n]||"object"!=typeof globals[n]||"object"!=typeof e[n]?t[n]=e[n]:obj_extend(globals[n],e[n]))}/*!
 * ClassJS v1.0.47
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2014 Atma.js and other contributors
 */
(function(t,e){"use strict";function n(){return e(o,r)}var r,o="undefined"==typeof window||null==window.navigator?global:window;return r=t||o,"function"==typeof define&&define.amd?define(n):(n(),"undefined"!=typeof module&&(module.exports=r.Class),void 0)})(this,function(t,e){"use strict";function n(t){return"function"==typeof t}function r(t){return null!=t&&"object"==typeof t}function o(t){return null!=t&&"number"==typeof t.length&&"function"==typeof t.slice}function i(t){return"string"==typeof t}function l(t){return null==t?!1:"object"!=typeof t?!1:t.constructor===Object}function s(e){return void 0===e||e===t}function u(t,e){if(a(t))for(var n=0,r=t.length;r>n;n++)e(t[n],n);else e(t)}function a(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}function c(t,e){return function(){return f(t,e,arguments)}}function f(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);case 4:return t.call(e,n[0],n[1],n[2],n[3]);case 5:return t.call(e,n[0],n[1],n[2],n[3],n[4])}return t.apply(e,n)}function h(t){return"function"==typeof t}function d(t){var e=m.call(arguments,1);return function(){return arguments.length>0&&(e=e.concat(m.call(arguments))),f(t,null,e)}}function p(){}function g(e){if(this===J||null==this||this===t){var n=function(t){g.call(this,t)};return n.prototype._props=e,n}null!=e&&(this.deserialize?this.deserialize(e):g.deserialize(this,e))}function v(){}var m=Array.prototype.slice,y=Array.prototype.sort,b={ModelHost:null},_="__$class__";"function"!=typeof Array.isArray&&(Array.isArray=function(t){return t instanceof Array?!0:null==t||"object"!=typeof t?!1:void 0!==t.length&&"function"==typeof t.slice});var x,C,w,j,k;(function(){function t(t,n){if(null==n||"object"!=typeof n)return n;var r=this,o=r[t];return o[_]&&o.toJSON?e(o[_],n):n}function e(t,e){var n={};return n.json=e,n[_]=t,n}function r(t,e){var n;return null!=e&&"object"==typeof e&&e[_]&&(n=J(e[_]),"function"==typeof n?e=new n(e.json):console.error("<class:parse> Class was not registered",e[_])),e}x=function(t,e){R(b.ModelHost||J.Model,t,e)},C=function(t){return D(b.ModelHost||J.Model,t)},w=function(t,e){var r=i(t)?C(t):t;return!n(r)&&console.error("<class:patch> Not a Function",t),e.Base=r,r=J(e),i(t)&&x(t,r),r},j=function(e){return JSON.stringify(e,t)},k=function(t){return JSON.parse(t,r)}})();var O,N,A;(function(){function t(t,e){if(null!=e){"function"==typeof t&&(t=t.prototype),"function"==typeof e&&(e=e.prototype);var n,r;for(n in e)r=e[n],null!=r&&(t[n]=r)}}function e(t,e){var n;return n=t?function(e){var n=1===arguments.length&&c(e)?e:arguments;return f(t,this,n)}:p,function(){return this["super"]=n,f(e,this,arguments)}}function r(n,r,o,i,l){var a=i,c=i;if(a.constructor=n.prototype.constructor,null!=o&&(c[s]={},u(o,function(e){t(c[s],e)}),c=c[s]),null!=r&&(c[s]=r.prototype),null!=l)for(var f in l)a[f]=e(a[f],l[f]);n.prototype=a}function o(n,r,o,i,l){if(null!=r){var s=function(){};s.prototype=r.prototype,n.prototype=new s,n.prototype.constructor=n}if(null!=o&&u(o,function(e){delete e.constructor,t(n,e)}),null!=l){var a=n.prototype;for(var c in l)a[c]=e(a[c],l[c])}t(n,i)}function i(t){return n(t)?t.prototype:t}var s="__proto__",a=Object.prototype.toString,c=function(t){return"[object Arguments]"===a.call(t)};O=s in Object.prototype?r:o,N=function(t,e){if(null!=e)if(n(e))for(var r in e)n(e[r])&&e.hasOwnProperty(r)&&null==t[r]&&(t[r]=e[r]);else if(Array.isArray(e))for(var o=e.length,i=-1;o>++i;)N(t,e[i]);else if(e.Static){e=e.Static;for(var r in e)e.hasOwnProperty(r)&&null==t[r]&&(t[r]=e[r])}else;},A=function(t,e,n){var r,o;for(r in t)o=t[r],l(o)&&(null!=e&&l(e.prototype[r])&&I(o,e.prototype[r]),null!=n&&u(n,function(t){t=i(t),l(t[r])&&I(o,t[r])}))}})();var S,E;(function(){S=function(){var t,e,n=this,r={};for(t in n)if(95!==t.charCodeAt(0)&&"Static"!==t&&"Validate"!==t&&(e=n[t],null!=e)){switch(typeof e){case"function":continue;case"object":var o=e.toJSON;if(null==o)break;if(o===S||o===E){r[t]=e.toJSON();continue}}r[t]=e}return null!=n._id&&(r._id=n._id),r},E=function(){for(var t,e=this,n=e.length,r=0,o=Array(n);n>r;r++){if(t=e[r],null!=t&&"object"==typeof t){var i=t.toJSON;if(i===S||i===E){o[r]=t.toJSON();continue}if(null==i){o[r]=S.call(t);continue}}o[r]=t}return o}})();var T,D,R,I,P;(function(){T=function(t){n(t)&&(t=t.prototype);for(var e,r,o=1,i=arguments.length;i>o;o++){e=n(arguments[o])?arguments[o].prototype:arguments[o];for(r in e)if("Static"!==r||null==t.Static)t[r]=e[r];else for(r in e.Static)t.Static[r]=e.Static[r]}return t},D=function(t,e){for(var n=e.split("."),r=n.length,o=-1;r>++o;){if(null==t)return null;t=t[n[o]]}return t},R=function(t,e,n){for(var r,o=e.split("."),i=o.length,l=-1;i-1>++l;)r=o[l],null==t[r]&&(t[r]={}),t=t[r];t[o[l]]=n},I=function(t,e){for(var n in e)null==t[n]&&(t[n]=e[n]);return t},P=function(t,e){for(var n in e)null!=e[n]&&(t[n]=e[n]);return t}})();var M;(function(){function t(t,e,n){for(var r in e)n(D(t,r),e[r],r)}function e(t,e,n){for(var r in e)R(t,r,n(D(t,r),e[r],r))}function n(){var t=arguments;return function(e,n,r){for(var o,i=0,l=t.length;l>i;i++)if(o=t[i],o(e,n,r)===!1)return}}function r(t,e,n){return a(t)===!1?(console.warn("<patch> property is not an array",n),!1):void 0}function o(t,e){if(e.hasOwnProperty("$each"))for(var n=0,r=e.$each.length;r>n;n++)t.push(e.$each[n]);else t.push(e)}function i(t,e){t[e>0?"pop":"shift"]()}function l(t,e){return console.error("<patch> pull Not Implemented")}function s(t,e){return t+e}function u(t,e){return e}function c(){return void 0}var f=0,h=1,d={$push:[t,n(r,o)],$pop:[t,n(r,i)],$pull:[t,n(r,l)],$inc:[e,s],$set:[e,u],$unset:[e,c],$bit:[e,c]};M=function(t,e){for(var n in e){var r=d[n];r?r[f](t,e[n],r[h]):console.error("Unknown or not implemented patcher",n)}return t}})();var L={};(function(){(function(t){function e(){this._callbacks=[]}function n(t){function n(t){return function(){i+=1,o[t]=Array.prototype.slice.call(arguments),i===l&&r.done(o)}}var r=new e,o=[];if(!t||!t.length)return r.done(o),r;for(var i=0,l=t.length,s=0;l>s;s++)t[s].then(n(s));return r}function r(t,n){var o=new e;return 0===t.length?o.done.apply(o,n):t[0].apply(null,n).then(function(){t.splice(0,1),r(t,arguments).then(function(){o.done.apply(o,arguments)})}),o}function o(t){var e="";if("string"==typeof t)e=t;else{var n=encodeURIComponent;for(var r in t)t.hasOwnProperty(r)&&(e+="&"+n(r)+"="+n(t[r]))}return e}function i(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t}function l(t,n,r,l){function s(){p.abort(),g.done(f,"",p)}var p,g=new e,v=l&&l["Content-Type"]||d.contentType;try{p=i()}catch(m){return g.done(c,""),g}if(r)if("GET"===t)n+="?"+o(r),r=null;else switch(v){case u:r=o(r);break;case a:try{r=JSON.stringify(r)}catch(y){return g.done(h,""),g}default:r=o(r)}p.open(t,n),r&&p.setRequestHeader("Content-Type",v);for(var b in l)l.hasOwnProperty(b)&&p.setRequestHeader(b,l[b]);var _=d.ajaxTimeout;if(_)var x=setTimeout(s,_);return p.onreadystatechange=function(){if(_&&clearTimeout(x),4===p.readyState){var t=!p.status||(200>p.status||p.status>=300)&&304!==p.status;g.done(t,p.responseText,p)}},p.send(r),g}function s(t){return function(e,n,r){return l(t,e,n,r)}}var u="application/x-www-form-urlencoded",a="application/json",c=1,f=2,h=3;e.prototype.then=function(t,n){var r;return this._isdone?r=t.apply(n,this.result):(r=new e,this._callbacks.push(function(){var e=t.apply(n,arguments);e&&"function"==typeof e.then&&e.then(r.done,r)})),r},e.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var t=0;this._callbacks.length>t;t++)this._callbacks[t].apply(null,arguments);this._callbacks=[]};var d={Promise:e,join:n,chain:r,ajax:l,get:s("GET"),post:s("POST"),put:s("PUT"),del:s("DELETE"),patch:s("PATCH"),ENOXHR:c,ETIMEOUT:f,E_PREPAIR_DATA:h,ajaxTimeout:0,contentType:a};"function"==typeof define&&define.amd?define(function(){return d}):t.promise=d})(this)}).call(L),u(["get"],function(t){L[t]=function(e,n){this.promise[t](e).then(function(t,e,r){return t?(n.onError(t,e,r),void 0):(n.onSuccess(e),void 0)})}}),u(["del","post","put","patch"],function(t){L[t]=function(e,n,r){this.promise[t](e,n).then(function(t,e,n){r(t,e,n)})}}),g.serialize=function(t){return n(t.toJSON)?t.toJSON():S.call(t)},g.deserialize=function(t,e){if(i(e))try{e=JSON.parse(e)}catch(r){return console.error("<json:deserialize>",e),t}if(o(e)&&n(t.push)){t.length=0;for(var l=0,s=e.length;s>l;l++)t.push(e[l]);return t}var u,a,c,f=t._props;for(u in e){if(a=e[u],null!=f&&(c=f.hasOwnProperty(u)?f[u]:null,null!=c)){if(n(c)){t[u]=a instanceof c?a:new c(a);continue}var h=c.deserialize;if(n(h)){t[u]=h(a);continue}}t[u]=a}return t};var $=function(){function t(t){this.route=r(t)}function e(t){var e=i.exec(t);return e?{optional:"?"===(e[2]||e[3]),parts:[e[1],e[4]]}:(e=l.exec(t))?{optional:"?"===e[3],parts:[e[1],e[4],e[5]]}:(console.error("Paths breadcrumbs should be matched by regexps"),{parts:[t]})}function n(t,n){for(var r=t.split(n),o=0,i=r.length;i>o;o++)r[o]=e(r[o]);return r}function r(t){var e=/[^\:\{]\?[^:]/.exec(t),r=null;return e&&(e=e.index+1,r=t.substring(e+1),t=t.substring(0,e)),{path:n(t,"/"),query:null==r?null:n(r,"&")}}function o(t,e,n){for(var r,o,i,l=[],s=0,u=t.length;u>s;s++)if(i=t[s],o=i.parts.slice(0),null!=o[1]){if(r=o[1],o[1]=e[r],null!=o[1])l.push(o.join(""));else if(!i.optional)return console.error("Object has no value, for not optional part - ",r),null}else l.push(o[0]);return l.join(n)}t.prototype={constructor:t,create:function(t){var e,n;return e=o(this.route.path,t,"/"),null==e?null:this.route.query&&(n=o(this.route.query,t,"&"),null==n)?null:e+(n?"?"+n:"")},hasAliases:function(t){for(var e,n=0,r=this.route.path.length;r>n;n++)if(e=this.route.path[n].parts[1],e&&null==t[e])return!1;return!0}};var i=/^([^:\?]*)(\??):(\??)([\w]+)$/,l=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return t}();(function(){function t(t,e,n,r){return null==r?t:(null!=e?f(r,t,e):n.push(r),t)}function e(t){t._done=null,t._fail=null,t._always=null}function n(t,e,n){if(null!=t){for(var r,o=t.length,i=-1;o>++i;)r=t[i],r&&f(r,e,n);t.length=0}}v.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,defer:function(){this._rejected=null,this._resolved=null},resolve:function(){var t=this._done,r=this._always;return this._resolved=arguments,e(this),n(t,this,arguments),n(r,this,[this]),this},reject:function(){var t=this._fail,r=this._always;return this._rejected=arguments,e(this),n(t,this,arguments),n(r,this,[this]),this},resolveDelegate:function(){return c(this.resolve,this)},rejectDelegate:function(){return c(this.reject,this)},then:function(t,e){return this.done(t).fail(e)},done:function(e){return t(this,this._resolved,this._done||(this._done=[]),e)},fail:function(e){return t(this,this._rejected,this._fail||(this._fail=[]),e)},always:function(e){return t(this,this._rejected||this._resolved,this._always||(this._always=[]),e)}}})();var F,U,H,z,q=function(){function t(){this._listeners={}}return t.prototype={constructor:t,on:function(t,e){return null!=e&&(this._listeners[t]||(this._listeners[t]=[])).push(e),this},once:function(t,e){return null!=e&&(e._once=!0,(this._listeners[t]||(this._listeners[t]=[])).push(e)),this},pipe:function(t){var e,n=this;return function(){e=m.call(arguments),e.unshift(t),f(n.trigger,n,e)}},trigger:function(){var t,e,n=m.call(arguments),r=n.shift(),o=this._listeners[r],i=0;if(null==o)return this;for(e=o.length;e>i;i++)t=o[i],f(t,this,n),t._once===!0&&(o.splice(i,1),i--,e--);return this},off:function(t,e){var n=this._listeners[t];if(null==n)return this;if(1===arguments.length)return n.length=0,this;for(var r=n.length,o=-1;r>++o;)n[o]===e&&(n.splice(o,1),o--,r--);return this}},t}(),B=function(){function t(t,r,o){if(n(r))return r.call(t);var i,l;if(o){for(var s=0,u=o.length;u>s;s++)if(l=o[s],i=e(t,l,r[l]))return i}else for(l in r)if(i=e(t,l,r[l]))return i}function e(t,e,r){if(n(r)===!1)return"<validation> Function expected for "+e;var o=D(t,e);return r.call(t,o)}function r(e){var n,r;return arguments.length>1&&"string"==typeof arguments[1]&&(r=m.call(arguments,1)),null!=e.Validate&&(n=t(e,e.Validate,r))?n:void 0}return{validate:r}}(),J=function(t){var e,n;if(i(t)){if(e=t,1===arguments.length)return C(t);n=arguments[1],n[_]=e}else n=t;var r,l=n.Base,u=n.Extends,a=n.Static,h=n.Construct,d=null,p=n.Store,g=n.Self,v=n.Override;if(null!=l&&delete n.Base,null!=u&&delete n.Extends,null!=a&&delete n.Static,null!=g&&delete n.Self,null!=h&&delete n.Construct,null!=p&&(null==u?u=p:o(u)?u.unshift(p):u=[p,u],delete n.Store),null!=v&&delete n.Override,void 0===n.toJSON&&(n.toJSON=S),null==l&&null==u&&null==g){if(d=null==h?function(){}:h,n.constructor=d.prototype.constructor,null!=a)for(r in a)d[r]=a[r];return d.prototype=n,null!=e&&x(e,d),d}if(d=function(){if(null!=u)for(var t=u instanceof Array,e=t?u.length:1,n=0,r=null;e>n;n++)r=t?u[n]:u,"function"==typeof r&&f(r,this,arguments);if(null!=l&&f(l,this,arguments),null!=g&&s(this)===!1)for(var o in g)this[o]=c(g[o],this);if(null!=h){var i=f(h,this,arguments);if(null!=i)return i}return this["super"]=null,this},null!=e&&x(e,d),null!=a)for(r in a)d[r]=a[r];return null!=l&&N(d,l),null!=u&&N(d,u),A(n,l,u),O(d,l,u,n,v),n=null,a=null,d},X=function(){function t(t,n,r){null==r&&(r=!0),t._timeout&&clearTimeout(t._timeout),t.defer(),t._wait++,n&&(t._result||(t._result={}),n in t._result&&console.warn("<await>",n,"already awaiting"),t._result[n]=null);var o=d(e,t,n,r);return t._timeout=setTimeout(o,X.TIMEOUT),o}function e(t,e,n){if(0===arguments.length)return t._wait=0,t.reject("408: Timeout"),void 0;if(0!==t._wait){var r=t._result;if(e){var o=m.call(arguments,3);r[e]={error:n?o.shift():null,arguments:o}}else n&&null!=arguments[3]&&(null==r&&(r=t._result={}),r.__error=arguments[3]);if(0===--t._wait){clearTimeout(t._timeout);var i,l,s=r&&r.__error;if(null==s)for(l in r)if(i=r[l],s=i&&i.error)break;if(s)return t.reject(s,r),void 0;t.resolve(r)}}}return J({Base:v,_wait:0,_timeout:null,_result:null,_resolved:[],delegate:function(e,n){return t(this,e,n)},deferred:function(e){var n,r=new v,o=t(this,e,!0);return r.done(function(){n=m.call(arguments),n.unshift(null),o.apply(null,n)}).fail(function(t){o(t)})},Static:{TIMEOUT:2e3}})}(),W={fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(t){return(new this).fetch(t)}}};(function(){function t(t,n){return function(){var r=null==t._rejected,o=r?t._resolved:t._rejected,s=r?i:l;e([s,t,n].concat(o))}}function e(t){s.trigger.apply(s,t)}var n,r,o="start",i="fulfilled",l="rejected",s=new q;F=function(t){s.on(o,t),n=!0},U=function(t,e){s.on(i,t).on(l,e),r=!0},H=function(t){s.off(i,t).off(l,t).off(o,t)},z=function(i){return v.prototype.defer.call(this),n&&e([o,this,i]),r&&this.always(t(this,i)),this}})(),J.Remote=function(){function t(t,n){var r;try{r=JSON.parse(n)}catch(o){return e(t,o),void 0}t.deserialize(r),t.resolve(t)}function e(t,e){t.reject(e)}function n(t,n,i){return function(u,a,c){var f=c.getResponseHeader(l),h=null!=f&&-1!==f.toLowerCase().indexOf(s);if(h)try{a=JSON.parse(a)}catch(u){return console.error("<XHR> invalid json response",a),e(t,a,c)}if(n&&n(u,a),u)return e(t,a,c);if("save"===i&&r(a)){if(o(t))for(var d=t.length,p=a.length,v=-1;d>++v&&p>v;)g.deserialize(t[v],a[v]);else t.deserialize(a);return t.resolve(t)}t.resolve(a)}}function i(t){return new u(t)}var l="content-type",s="json",u=function(t){this._route=new $(t)};return T(u,W,g,v,{defer:z,serialize:function(){return o(this)?E.call(this):S.call(this)},deserialize:function(t){return g.deserialize(this,t)},fetch:function(t){return this.defer("fetch"),L.get(this._route.create(t||this),this),this},save:function(t){this.defer("save");var e=this.serialize(),r=this._route.create(this),o=this._route.hasAliases(this)?"put":"post";return L[o](r,e,n(this,t,"save")),this},patch:function(t){return this.defer("patch"),M(this,t),L.patch(this._route.create(this),t,n(this)),this},del:function(t){this.defer("del");var e=this.serialize(),r=this._route.create(this);return L.del(r,e,n(this,t)),this},onSuccess:function(e){t(this,e)},onError:function(t,n,r){e(this,n,r)}}),i.onBefore=F,i.onAfter=U,i}(),J.MongoStore=function(){function t(t,e){var n;return function(r){r&&(n=r),0===--t&&e(n)}}function e(){return l?l:n?"mongodb://"+A+":"+E+"/"+n:null}var n,l,s,u,d,p,y,b,_,x,C,w,j,k,O,N,A="127.0.0.1",E=27017,D={auto_reconnect:!0,native_parser:!0,w:1},R=function(t){t.ip&&(A=t.ip),t.port&&(E=t.port),t.db&&(n=t.db),t.params&&(D=t.params),l=t.connection};(function(){var t,r;u=function(e,n){if(null==t)return o(a(u,e,n));var r=t.collection(e);return null==r?n("<mongo> Collection Not Found: "+e):(n(null,r),void 0)},O=function(t){var e=new J.Deferred;return u(t,function(t,n){return t?e.reject(t):(e.resolve(n),void 0)}),e},s=function(e){return null==t?o(a(s,e)):(e(null,t),void 0)},N=function(){var t=new v;return s(function(e,n){return e?t.reject(e):(t.resolve(n),void 0)}),t},d=function(e,n,r){return null==t?o(a(d,e,n,r)):(n=l(n),t.collection(e).findOne(n,function(t,e){r(t,e)}),void 0)},p=function(e,n,r){return null==t?o(a(p,e,n,r)):(n=l(n),t.collection(e).find(n,function(t,e){return t?r(t):(e.toArray(function(t,e){r(t,e)}),void 0)}),void 0)},y=function(e,n,r){return null==t?o(a(y,e,n,r)):(t.collection(e).insert(n,{safe:!0},r),void 0)},b=function(e,n,r){return null==t?o(a(b,e,n,r)):null==n._id?r("<mongo:update> invalid ID"):(t.collection(e).update({_id:C(n._id)},n,{upsert:!0,multi:!1},function(t){r(t)}),void 0)},_=function(t,e,n){b(t,e.shift(),function(r){return r?n(r):0===e.length?n():(_(t,e,n),void 0)})},w=function(e,n,r,i){return null==t?o(a(w,e,n,r,i)):(t.collection(e).update({_id:C(n)},r,function(t){i(t)}),void 0)},x=function(e,n,r,i){return null==t?o(x.bind(null,e,n,i)):(n=l(n),t.collection(e).remove(n,{justOne:r},function(t){i(t)}),void 0)},j=function(e,n,r){return null==t?o(a(j,e,n,r)):(t.collection(e).ensureIndex(n,r),void 0)},C=function(t){return i(t)&&24===t.length?k().ObjectID(t):t},k=function(){return k=function(){return r},r=require("mongodb"),k()};var o=function(){var o,i=[],l=!1;return function(s){function u(e,n){null==e&&(t=n);for(var r=i.length,o=-1;r>++o;)i[o](e);i.length=0,l=!1}return t?s():null==n?s('Database is not set. Call Class.MongoStore.settings({db:"myDbName"})'):(i.push(s),l?void 0:(k(),l=!0,(o=e())?(r.MongoClient.connect(o,D,u),void 0):s("<mongo> Invalid connection string")))}}(),l=function(t){if(null==t)return 0!==arguments.length&&console.warn("<mongo> query should not be empty"),t;if(t.hasOwnProperty("$query")||t.hasOwnProperty("$limit"))return t;t.hasOwnProperty("_id")&&(t._id=C(t._id));var e={62:{0:"$gt",61:"$gte"},60:{0:"$lt",61:"$lte"}};for(var n in t){var r,o=t[n];if("string"==typeof o)switch(r=o.charCodeAt(0)){case 62:case 60:var i=e[r]["0"];61===o.charCodeAt(1)?(i=e[r]["61"],o=o.substring(2)):o=o.substring(1),t[n]={},t[n][i]=parseInt(o);continue}}return t},a=function(t){var e=m.call(arguments,1),n=e[e.length-1];return function(r){return r?n(r):(arguments.length>0&&(e=e.concat(arguments)),f(t,null,e))}}})();var I=function(){function t(t){var e,n;i(t)?e=t:r(t)&&(e=t.collection,n=t.indexes),!e&&console.error("<MongoStore> should define a collection name"),this._coll=e,this._indexes=n}T(t,W,g,v,{_busy:!1,fetch:function(t){return this._ensureFree()===!1?this:(d(this._coll,t,c(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;var t=this.serialize(),e=null==t._id?y:b;return e(this._coll,t,c(this._inserted,this)),this},del:function(){return this._ensureFree()===!1?this:(this._id?x(this._coll,{_id:this._id},!0,c(this._completed,this)):this._completed("<class:patch> `_id` is not defined"),this)},patch:function(t){return this._ensureFree()===!1?this:null==this._id?this._completed("<class:patch> `_id` is not defined"):(M(this,t),w(this._coll,this._id,t,c(this._completed,this)),this)},Static:{fetch:function(t){return(new this).fetch(t)},resolveCollection:function(){return O((new this)._coll)}},serialize:function(){return S.call(this)},deserialize:function(t){return g.deserialize(this,t),this._id&&(this._id=C(this._id)),this},_ensureFree:function(){return this._busy?(console.warn("<mongo:single> transport requested, but is busy for the same instance."),!1):(this.defer(),this._busy=!0,!0)},_completed:function(t){return this._busy=!1,t?this.reject(t):this.resolve(this)},_fetched:function(t,e){this.deserialize(e),this._completed(t)},_inserted:function(t,e){null!=e&&null==this._id&&(o(e)&&1===e.length?this._id=e[0]._id:console.error("<mongo:insert-single> expected an array in callback")),this._completed(t)}});var e=function(e){return new t(e)};return e.prototype=t.prototype,e}(),P=function(){function e(t){t||console.error("<MongoStore> should define a collection name"),this._coll=t}function n(t,e){var n=t._ctor,r=new n(e);null==r._id&&h(r.deserialize)&&r.deserialize(e),t[t.length++]=r}T(e,v,{fetch:function(t){return this._ensureFree()===!1?this:(p(this._coll,t,c(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;for(var e,n=[],r=[],o=[],i=this._coll,l=c(this._completed,this),s=0,u=this.length;u>s;s++)e=this[s],null!=e._id?o.push(e.serialize()):(n.push(e.serialize()),r.push(s));if(n.length&&o.length){var a=t(2,l);return y(i,n,this._insertedDelegate(this,a,r)),_(i,o,a),this}return n.length?(y(i,n,this._insertedDelegate(this,this._completed,r)),this):o.length?(_(i,o,l),this):this},del:function(t){if(null==t&&0!==arguments.length)return console.error("<MongoStore:del> - selector is specified, but is undefined"),this;if(this._ensureFree()===!1)return this;var e=null==t?this.toArray():this.remove(t);if(e&&e.length){for(var n,r=[],o=0,i=e.length;i>o;o++)n=e[o],n._id&&r.push(n._id);x(this._coll,{_id:{$in:r}},!1,c(this._completed,this))}else this._completed();return this},Static:{fetch:function(t){return(new this).fetch(t)}},_busy:!1,_ensureFree:function(){return this._busy?(console.warn("<mongo:collection> requested transport, but is busy by the same instance."),!1):(this._busy=!0,this._resolved=null,this._rejected=null,!0)},_completed:function(t){this._busy=!1,t?this.reject(t):this.resolve(this)},_fetched:function(t,e){if(a(e))for(var r,o=0,i=e.length;i>o;o++)r=e[o],n(this,r);else e&&n(this,e);this._completed(t)},_insertedDelegate:function(t,e,n){function r(){e.call(t)}return function(e,i){if(o(i)===!1)return console.error("<mongo:bulk insert> array expected"),r();if(i.length!==n.length)return console.error("<mongo:bul insert> count missmatch",i.length,n.length),r();for(var l,s=0,u=n.length;u>s;s++)l=n[s],t[l]._id=i[s]._id;r()}}});var r=function(t){return new e(t)};return r.prototype=e.prototype,r}();return{Single:I,Collection:P,settings:R,resolveDb:N,resolveCollection:O,createId:function(t){return C(t)},ensureIndexes:function(e){function n(t){return t?u.reject(t):(u.resolve(),void 0)}var r=e.prototype,o=r._indexes,i=r._coll;if(null==o)return console.error("<class:mongodb> No indexes>",e),void 0;for(var l=-1,s=o.length,u=new v,a=t(s-1,n);s>++l;)j(i,o[l],a)}}}(),J.bind=function(t){for(var e,n=arguments,r=1,o=arguments.length;o>r;r++)e=n[r],t[e]=t[e].bind(t);return t},J.cfg=function(t,e){if(i(t))return 1===arguments.length?b[t]:(b[t]=e,void 0);if(r(t))for(var n in t)J.cfg(n,t[n])},J.Model={},J.Serializable=g,J.Deferred=v,J.EventEmitter=q,J.Await=X,J.validate=B.validate,J.stringify=j,J.parse=k,J.patch=w,J.Collection=function(){function t(t,e){return e instanceof t?e:new t(e)}function e(){var t,e=arguments.length,o=arguments[e-1],i=arguments[e-2];return e>2&&(t=arguments[0]),o._ctor=i,T(o,r,n),null==t?J(o):J(t,o)}var n=function(){function e(t,e){if(null==e)return!1;if("function"==typeof e)return e(t);if("object"==typeof e){if(t.constructor===e.constructor&&t.constructor!==Object)return t===e;var n,r;for(var o in e){if(n=t[o],r=e[o],"string"==typeof r){var i=r[0],l=1;if("<"===i||">"===i)switch("="===r[1]&&(i+="=",l++),r=r.substring(l),i){case"<":if(n>=r)return!1;continue;case"<=":if(n>r)return!1;continue;case">":if(r>=n)return!1;continue;case">=":if(r>n)return!1;continue}}if(n!=r)return!1}return!0}return console.warn("No valid matcher",e),!1}function n(t,e){for(var n=this.length,r=-1;n>++r;)t.call(e||this,this[r],r);return this}var r={length:0,push:function(){for(var e=arguments.length,n=-1;e>++n;)this[this.length++]=t(this._ctor,arguments[n]);return this},pop:function(){var t=this[--this.length];return this[this.length]=null,t},shift:function(){if(0===this.length)return null;for(var t=this[0],e=this.length-1,n=0;e>n;n++)this[n]=this[n+1];return this[e]=null,this.length--,t},unshift:function(e){this.length++;for(var n=this.length;--n;)this[n]=this[n-1];return this[0]=t(this._ctor,e),this},splice:function(e,n){var r,o,i,l=this.length;if(e>=l)for(n=0,r=l,o=e;o>r;r++)this[r]=void 0;var s=n,u=e,a=e+s,c=arguments.length-2,f=l+c-s,h=a,d=l,p=f-l;if(p>0)for(r=d;--r>=h;)this[r+p]=this[r];if(0>p)for(r=h;d>r;)this[r+p]=this[r],r++;for(r=u,i=2;arguments.length>i;i)this[r++]=t(this._ctor,arguments[i++]);return this.length=f,this},slice:function(){return f(m,this,arguments)},sort:function(t){return y.call(this,t),this},reverse:function(){for(var t=m.call(this),e=this.length,n=-1;e>++n;)this[n]=t[e-n-1];return this},toString:function(){return""+m.call(this,0)},each:n,forEach:n,where:function(t){for(var n,r=new this.constructor,o=0,i=this.length;i>o;o++)n=this[o],e(n,t)&&(r[r.length++]=n);return r},remove:function(t){for(var n=-1,r=[],o=0,i=this.length;i>o;o++)e(this[o],t)?r.push(this[o]):this[++n]=this[o];for(o=++n;i>o;o++)this[o]=null;return this.length=n,r},first:function(t){if(null==t)return this[0];var e=this.indexOf(t);return-1!==e?this[e]:null},last:function(t){if(null==t)return this[this.length-1];var e=this.lastIndexOf(t);return-1!==e?this[e]:null},indexOf:function(t,n){if(null==t)return-1;if(null!=n){if(0>n&&(n=0),n>=this.length)return-1}else n=0;for(var r=this.length;r>n;n++)if(e(this[n],t))return n;return-1},lastIndexOf:function(t,n){if(null==t)return-1;if(null!=n){if(n>=this.length&&(n=this.length-1),0>n)return-1}else n=this.length-1;for(;n>-1;n--)if(e(this[n],t))return n;return-1},map:function(t){for(var e=[],n=this.length,r=-1;n>++r;)e[r]=t(this[r]);return e},filter:function(t,e){for(var n=new this.constructor,r=this.length,o=-1;r>++o;)t.call(e||this,this[o])&&n.push(this[o]);return n}};return r}(),r={toArray:function(){for(var t=Array(this.length),e=0,n=this.length;n>e;e++)t[e]=this[e];return t},toJSON:E};return e}(),function(){function t(t,e){if(t.length!==e.length)return!1;for(var n=t.length,r=0;n>r;r++)if(t[r]!==e[r])return!1;return!0}function e(e,n){if(0===n.length)return 0;for(var r=0,o=e.length;o>r;r++)if(t(e[r],n))return r+1;return e.push(n),e.length}function n(t){var n={},r=[];return function(){var o=e(r,arguments);return null==n[o]?n[o]=f(t,this,arguments):n[o]}}function r(t,e,n){return function(){t[n]=arguments;for(var r,o=0,i=e[n].length;i>o;o++)r=e[n][o],f(r,this,arguments);e[o]=null,t=null,e=null}}function o(t){var n={},o={},i=[];return function(){var l=m.call(arguments),s=l.pop(),u=e(i,l);return n[u]?(f(s,this,n[u]),void 0):o[u]?(o[u].push(s),void 0):(o[u]=[s],l=m.call(l),l.push(r(n,o,u)),f(t,this,l),void 0)}}J.Fn={memoize:n,memoizeAsync:o}}(),e.Class=J}),function(t,e){"use strict";var n,r,o;"undefined"==typeof exports||t!==exports&&null!=t||(n=r=global),null==n&&(n="undefined"==typeof window?global:window),null==r&&(r=t||n),o=n.document,e(n,r,o)}(this,function(global,exports,document){"use strict";function fn_proxy(t,e){return function(){t.apply(e,arguments)}}function fn_doNothing(t){"function"==typeof t&&t()}function obj_inherit(t){"function"==typeof t&&(t=t.prototype);for(var e,n,r=1,o=arguments.length;o>r;r++){e="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in e)t[n]=e[n]}return t}function obj_getProperty(t,e){for(var n=e.split("."),r=n.length,o=0;r>o;o++){if(null==t)return null;t=t[n[o]]}return t}function arr_invoke(t,e,n){if(null!=t&&t instanceof Array!=!1)for(var r=0,o=t.length;o>r;r++)"function"==typeof t[r]&&(null==e?t[r].call(n):t[r].apply(n,e))}function arr_ensure(t,e){if(!e)return t;for(var n,r=e.split("."),o=r.length-1,i=0;o>i;i++)n=r[i],t=t[n]||(t[n]={});return n=r[o],t[n]||(t[n]=[])}var bin={js:{},css:{},load:{}},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),reg_subFolder=/([^\/]+\/)?\.\.\//,cfg={path:null,loader:null,version:null,lockedToFolder:null,sync:null,eval:null==document},handler={},hasOwnProp={}.hasOwnProperty,emptyResponse={load:{}},__array_slice=Array.prototype.slice,XMLHttpRequest=global.XMLHttpRequest,Helper={reportError:function(t){console.error("IncludeJS Error:",t,t.message,t.url),"function"==typeof handler.onerror&&handler.onerror(t)}},XHR=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&e&&e(t,n.responseText)},n.open("GET","object"==typeof t?t.url:t,!0),n.send()},path_getDir,path_getFile,path_getExtension,path_resolveCurrent,path_normalize,path_win32Normalize,path_resolveUrl,path_combine,path_isRelative;(function(){path_getDir=function(t){return t.substring(0,t.lastIndexOf("/")+1)},path_getFile=function(t){return t=t.replace("file://","").replace(/\\/g,"/").replace(/\?[^\n]+$/,""),/^\/\w+:\/[^\/]/i.test(t)?t.substring(1):t},path_getExtension=function(t){var e=t.indexOf("?");return-1===e?t.substring(t.lastIndexOf(".")+1):t.substring(t.lastIndexOf(".",e)+1,e)},path_resolveCurrent=function(){if(null==document)return"undefined"==typeof module?"":path_win32Normalize(module.parent.filename);var t=document.getElementsByTagName("script"),e=t[t.length-1],n=e&&e.getAttribute("src")||"";if("/"===n[0])return n;var r=window.location.pathname.replace(/\/[^\/]+\.\w+$/,"");return"/"!==r[r.length-1]&&(r+="/"),r+n},path_normalize=function(t){return t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")},path_win32Normalize=function(t){return t=t.replace(/\\/g,"/"),"file:"===t.substring(0,5)?t:"file:///"+t},path_resolveUrl=function(t,e){switch(cfg.path&&"/"===t[0]&&(t=cfg.path+t.substring(1)),t.substring(0,5)){case"file:":case"http:":return t}for("./"===t.substring(0,2)&&(t=t.substring(2)),"/"===t[0]?(isWeb===!1||cfg.lockedToFolder===!0)&&(t=t.substring(1)):null!=e&&null!=e.location&&(t=e.location+t);-1!==t.indexOf("../");)t=t.replace(reg_subFolder,"");return t},path_isRelative=function(t){var e=t.charCodeAt(0);switch(e){case 47:return!1;case 102:case 104:return/^file:|https?:/.test(t)===!1}return!0},path_combine=function(){for(var t,e="",n=arguments.length,r=-1;n>++r;)t=arguments[r],t&&(t=path_normalize(t),""!==e?("/"!==e[e.length-1]&&(e+="/"),"/"===t[0]&&(t=t.substring(1)),e+=t):e=t);return e}})();var tree_resolveUsage;(function(){function t(e,n){if(null==n)return console.warn("<include:use> Not Found. Ensure to have it included before with correct alias",e),void 0;for(var r,o=n.includes,i=-1,l=o.length;l>++i;)if(r=o[i],r.route.alias===e)return r.resource.exports;return t(e,n.parent)}tree_resolveUsage=function(e,n){for(var r,o,i,l,s=[],u=n.length,a=-1;u>++a;)i=o=n[a],l=o.indexOf("."),-1!==l&&(i=o.substring(0,l),o=o.substring(l+1)),r=t(i,e.parent),i!==o&&(r=obj_getProperty(r,o)),"object"==typeof r&&null==r&&console.warn("<include:use> Used resource has no exports",i,e.url),s[a]=r;return s}})();var RoutesLib=function(){var t={},e=/([^\\\/]+)\.\w+$/;return{register:function(e,n,r){if("string"==typeof n&&path_isRelative(n)){var o=r||include,i=o.location||path_getDir(o.url||path_resolveCurrent());path_isRelative(i)&&(i="/"+i),n=i+n}t[e]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(e,n){var r,o,i,l,s,u,a,c,f=n.indexOf("?"),h=n.indexOf("::");if(-1!==h&&(r=n.substring(h+2),n=n.substring(0,h)),-1!==f){for(c=n.substring(f+1).split("&"),i={},s=0,a=c.length;a>s;s++)u=c[s].split("="),i[u[0]]=u[1];n=n.substring(0,f)}if(n=n.split("/"),l=t[e],null==l)return{path:n.join("/"),params:i,alias:r};
for(o=l[0],s=1;l.length>s;s++)if(0===s%2)o+=l[s];else{var d=l[s]<<0;if(d>n.length-1&&(d=n.length-1),o+=n[d],s===l.length-2)for(d++;n.length>d;d++)o+="/"+n[d]}return{path:o,params:i,alias:r}},each:function(t,e,n,r,o){var i;if(null!=e)if("lazy"!==t||null!=o)if(e instanceof Array)for(var l=0;e.length>l;l++)this.each(t,e[l],n,r,o);else if("object"!=typeof e){if("string"==typeof e){var s=this.resolve(r,e);return r&&(r+="."+e),n(r,s,o),void 0}console.error("Include Package is invalid",arguments)}else for(i in e)hasOwnProp.call(e,i)&&this.each(t,e[i],n,i,o);else for(i in e)this.each(t,e[i],n,null,i)},getRoutes:function(){return t},parseAlias:function(t){var n=t.path,r=e.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(t){function e(){Events.ready=fn_doNothing,null!=n&&(arr_invoke(n),n=null)}if(null==t)return{ready:fn_doNothing,load:fn_doNothing};var n=[];return"onreadystatechange"in t?t.onreadystatechange=function(){/complete|interactive/g.test(t.readyState)!==!1&&e()}:t.addEventListener?t.addEventListener("DOMContentLoaded",e):window.onload=e,{ready:function(t){n.unshift(t)}}}(document),ScriptStack=function(){function t(t,e){var n=document.createElement("script");n.type="text/javascript",n.src=t,"onreadystatechange"in n?n.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&e()}:n.onload=n.onerror=e,(o||(o=document.getElementsByTagName("head")[0])).appendChild(n)}function e(){function n(t){t&&"error"===t.type&&console.log("Script Loaded Error",o.url);for(var n=0,r=s.length;r>n;n++)if(s[n]===o){s.splice(n,1);break}return n===r?(console.error("Loaded Resource not found in stack",o),void 0):(2.5!==o.state&&o.readystatechanged(3),i=null,e(),void 0)}if(!l){if(0===s.length)return r(),void 0;if(null==i){var o=i=s[0];if(1!==o.state)return o.state=1,global.include=o,global.iparams=o.route.params,o.source?(__eval(o.source,o),n(),void 0):(t(o.url,n),void 0)}}}function n(){if(!l){if(0===s.length)return r(),void 0;if(null==i){var t=s[0];if(!(2>t.state)){i=t,t.state=1,global.include=t,__eval(t.source,t);for(var e,o=0,u=s.length;u>o;o++)if(e=s[o],e===t){s.splice(o,1);break}2.5!==t.state&&t.readystatechanged(3),i=null,n()}}}}function r(){for(var t=-1,e=u.length;e>++t;)u[t]();u.length=0}var o,i,l,s=[],u=[];return{load:function(t,r,o){return this.add(t,r),!cfg.eval||o?(e(),void 0):t.source?(t.state=2,n(),void 0):(XHR(t,function(t,e){e||console.error("Not Loaded:",t.url),t.source=e,t.state=2,n()}),void 0)},add:function(t,e){if(1===t.priority)return s.unshift(t);if(null==e)return s.push(t);for(var n=s.length,r=-1;n>++r;)if(s[r]===e)return s.splice(r,0,t);s.push(t)},moveToParent:function(t,e){var n,r=s.length,o=-1,i=-1;for(n=0;r>n;n++)if(s[n]===t){i=n;break}if(-1!==i){for(n=0;r>n;n++)if(s[n]===e){o=n;break}-1!==o&&(o>i||(s.splice(i,1),s.splice(o,0,t)))}},pause:function(){l=!0},resume:function(){l=!1,null==i&&this.touch()},touch:function(){var t=cfg.eval?n:e;t()},complete:function(t){return l===!1&&0===s.length?(t(),void 0):(u.push(t),void 0)}}}(),IncludeDeferred=function(){this.callbacks=[],this.state=-1};IncludeDeferred.prototype={on:function(t,e,n,r){return this===n&&-1===this.state?(e(this),this):(null==r&&(r=3>this.state||this===n?"unshift":"push"),this.state>=t?e(this):this.callbacks[r]({state:t,callback:e}),this)},readystatechanged:function(t){var e,n,r,o;if(t>this.state&&(this.state=t),3===this.state){var i=this.includes;if(null!=i&&i.length)for(e=0;i.length>e;e++)if(4!==i[e].resource.state)return;this.state=4}if(e=0,n=this.callbacks.length,0!==n){for("js"===this.type&&4===this.state&&(o=global.include,global.include=this);n>e&&(r=this.callbacks[e],null==r||r.state>this.state||(this.callbacks.splice(e,1),n--,e--,r.callback(this),!(4>this.state)));e++);null!=o&&(global.include=o)}},ready:function(t){var e=this;return this.on(4,function(){Events.ready(function(){e.resolve(t)})},this)},done:function(t){var e=this;return this.on(4,function(){e.resolve(t)},this)},resolve:function(t){var e=this.includes,n=null==e?0:e.length;if(n>0&&null==this.response){this.response={};for(var r,o,i,l=0;n>l;l++)if(i=e[l],r=i.resource,o=i.route,void 0!==r.exports){var s=r.type;switch(s){case"js":case"load":case"ajax":var u=o.alias||Routes.parseAlias(o),a="js"===s?this.response:this.response[s]||(this.response[s]={});if(u){a[u]=r.exports;break}console.warn("Resource Alias is Not defined",r)}}}var c=this.response||emptyResponse;return this._use?t.apply(null,[c].concat(this._use)):(t(c),void 0)}};var Include=function(IncludeDeferred){function Include(){IncludeDeferred.call(this)}function incl_getResource(t,e){var n=t;if(47!==t.charCodeAt(0)&&(n="/"+n),null!=e)return bin[e][n];for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null}function embedPlugin(source){eval(source)}function enableModules(){return Object.defineProperty===void 0?(console.warn("Browser do not support Object.defineProperty"),void 0):(Object.defineProperty(global,"module",{get:function(){return global.include}}),Object.defineProperty(global,"exports",{get:function(){var t=global.include;return t.exports||(t.exports={})},set:function(t){global.include.exports=t}}),void 0)}function includePackage(t,e,n){var r=1===n.length?n[0]:__array_slice.call(n);return t instanceof Resource?t.include(e,r):new Resource("js").include(e,r)}function createIncluder(t){return function(){return includePackage(this,t,arguments)}}function doNothing(){return this}function stub_freeze(t){t.js=t.css=t.load=t.ajax=t.embed=t.lazy=t.inject=doNothing}function stub_release(t){for(var e=["js","css","load","ajax","embed","lazy"],n=e.length;-1!==--n;)t[e[n]]=createIncluder(e[n]);t.inject=t.js}return stub_release(Include.prototype),obj_inherit(Include,IncludeDeferred,{isBrowser:!0,isNode:!1,setCurrent:function(t){var e=new Resource("js",{path:t.id},t.namespace,null,null,t.id);3>e.state&&console.error("<include> Resource should be loaded",t),e.state=3,global.include=e},cfg:function(t){switch(typeof t){case"object":var e,n;for(e in t)switch(n=t[e],e){case"loader":for(var r in n)CustomLoader.register(r,n[r]);break;case"modules":n===!0&&enableModules();break;default:cfg[e]=n}break;case"string":if(1===arguments.length)return cfg[t];2===arguments.length&&(cfg[t]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(t){if(null==t)return Routes.getRoutes();if(2===arguments.length)return Routes.register(t,arguments[1]),this;for(var e in t)Routes.register(e,t[e]);return this},promise:function(t){for(var e=t.split("."),n=global;e.length;){var r=e.shift();n=n[r]||(n[r]={})}return n},register:function(t){var e,n,r,o,i;for(e in t)for(r=t[e],o=r.length,i=-1;o>++i;){n=r[i];var l=n.id,s=n.url,u=n.namespace,a=n.parent&&incl_getResource(n.parent,"js"),c=new Resource,f=n.state;switch(s&&("/"===s[0]&&(s=s.substring(1)),c.location=path_getDir(s)),c.state=null==f?"js"===e?3:4:f,c.namespace=u,c.type=e,c.url=s||l,c.parent=a,e){case"load":case"lazy":var h=document.querySelector("#includejs-"+l.replace(/\W/g,""));if(null==h){console.error('"%s" Data was not embedded into html',l);break}c.exports=h.innerHTML,CustomLoader.exists(c)&&(c.state=3,CustomLoader.load(c,function(t,e){t.exports=e,t.readystatechanged(4)}))}(bin[e]||(bin[e]={}))[l]=c}},instance:function(t){var e;return null==t?(e=new Include,e.state=4,e):(e=new Resource,e.state=4,e.location=path_getDir(t),e)},getResource:incl_getResource,getResources:function(){return bin},plugin:function(t,e){var n=[],r=0,o=0,i=0,l=function(t,n){o++,embedPlugin(n),o===r-1&&e&&(e(),e=null)};for(Routes.each("",t,function(t,e){n.push("/"===e.path[0]?e.path.substring(1):e.path)}),r=n.length;r>i;i++)XHR(n[i],l);return this},client:function(){return cfg.server===!0&&stub_freeze(this),this},server:function(){return cfg.server!==!0&&stub_freeze(this),this},use:function(){return null==this.parent?(console.error("<include.use> Parent resource is undefined"),this):(this._use=tree_resolveUsage(this,arguments),this)},pauseStack:fn_proxy(ScriptStack.pause,ScriptStack),resumeStack:fn_proxy(ScriptStack.resume,ScriptStack),allDone:ScriptStack.complete}),Include}(IncludeDeferred),CustomLoader=function(){function t(t){return"string"==typeof t?!1:"function"==typeof t.ready||"function"==typeof t.process}function e(e){var n=path_getExtension(e),r=cfg.loader[n];if(t(r))return r;var o,i=r;if("object"==typeof i)for(var l in i){o=l,i=i[l];break}return cfg.loader[n]=new Resource("js",Routes.resolve(o,i),o,null,null,null,1)}function n(t,e){return function(n){t(e,n)}}function r(t,e,r,o){if(null==r.process)return o(e,t),void 0;var i=n(o,e),l=r.process(t,e,i);l!==void 0&&o(e,l)}function o(t,e,n){function o(t,o){r(o,t,e,n)}return"string"==typeof t.exports?(r(t.exports,t,e,n),void 0):e.load?e.load(t,o):(XHR(t,o),void 0)}var i={process:function(t){try{return JSON.parse(t)}catch(e){return console.error(e,t),null}}};return cfg.loader={json:i},{load:function(t,n){var r=e(t.url);return r.process?(o(t,r,n),void 0):(r.on(4,function(){o(t,r.exports,n)},null,"push"),void 0)},exists:function(t){if(!t.url)return!1;var e=path_getExtension(t.url);return cfg.loader.hasOwnProperty(e)},register:function(t,e){if("string"==typeof e){var n=include;null==n.location&&(n={location:path_getDir(path_resolveCurrent())}),e=path_resolveUrl(e,n)}cfg.loader[t]=e}}}(),LazyModule={create:function(t,e){for(var n=t.split("."),r=global,o=n[n.length-1];n.length>1;){var i=n.shift();r=r[i]||(r[i]={})}n=null,Object.defineProperty(r,o,{get:function(){delete r[o];try{var n=__eval(e,global.include);null==n||n instanceof Resource||(r[o]=n)}catch(i){i.xpath=t,Helper.reportError(i)}finally{return e=null,t=null,r[o]}}})}},Resource=function(t,e,n,r){function o(t){var e=t.type,o=t.parent,l=t.url;if(null==document&&"css"===e)return t.state=4,t;if(r.exists(t)===!1)switch(e){case"js":case"embed":n.load(t,o,"embed"===e);break;case"ajax":case"load":case"lazy":XHR(t,i);break;case"css":t.state=4;var s=document.createElement("link");s.href=l,s.rel="stylesheet",s.type="text/css",document.getElementsByTagName("head")[0].appendChild(s)}else("js"===e||"embed"===e)&&n.add(t,t.parent),r.load(t,i);return t}function i(t,e){switch(e||console.warn("Resource cannt be loaded",t.url),t.type){case"js":case"embed":return t.source=e,t.state=2,n.touch(),void 0;case"load":case"ajax":t.exports=e;break;case"lazy":LazyModule.create(t.xpath,e);break;case"css":var r=document.createElement("style");r.type="text/css",r.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(r)}t.readystatechanged(4)}function l(t,e,n){if(null==t)return null;null==n&&(n=[]);for(var r,o=0,i=t.length;i>o;o++)r=t[o].resource,e===r.type&&n.push(r),null!=r.includes&&l(r.includes,e,n);return n}var s=function(e,r,i,l,s,u,a){t.call(this),this.childLoaded=fn_proxy(this.childLoaded,this);var c=r&&r.path;null!=c&&(this.url=c=path_resolveUrl(c,s)),this.type=e,this.xpath=l,this.route=r,this.parent=s,this.priority=a,this.namespace=i,null==u&&c&&(u=("/"===c[0]?"":"/")+c);var f=bin[e]&&bin[e][u];return f?(4>f.state&&"js"===e&&n.moveToParent(f,s),f):null==c?(this.state=3,this.location=path_getDir(path_resolveCurrent()),this):(this.state=0,this.location=path_getDir(c),(bin[e]||(bin[e]={}))[u]=this,cfg.version&&(this.url+=(-1===this.url.indexOf("?")?"?":"&")+"v="+cfg.version),o(this))};return s.prototype=obj_inherit(s,t,{childLoaded:function(){var t=this,e=t.includes;if(e&&e.length){if(3>t.state)return;for(var n=0;e.length>n;n++)if(4!==e[n].resource.state)return}t.readystatechanged(4)},create:function(t,e,n,r,o){var i;return this.state=this.state>=3?3:2,this.response=null,null==this.includes&&(this.includes=[]),i=new s(t,e,n,r,this,o),this.includes.push({resource:i,route:e}),i},include:function(t,n){var r=this;return e.each(t,n,function(e,n,o){(null==r.route||r.route.path!==n.path)&&r.create(t,n,e,o).on(4,r.childLoaded)}),this},pause:function(){this.state=2.5;var t=this;return function(){t.readystatechanged(3)}},getNestedOfType:function(t){return l(this.includes,t)}}),s}(Include,Routes,ScriptStack,CustomLoader);exports.include=new Include,exports.includeLib={Routes:RoutesLib,Resource:Resource,ScriptStack:ScriptStack,registerLoader:CustomLoader.register},function(){cfg.server=!0;var t,e,n=require("vm"),r=(global.module||module).constructor;(function(){function n(t){null!=o[t]&&(o[t].close(),o[t]=null)}var r=require("fs"),o={};t=function(t,e){if(cfg.sync)try{var n=r.readFileSync(t,"utf8");e(null,n)}catch(o){console.error("File Read - ",o)}else r.readFile(t,"utf8",e)},e=function(t,e){n(t),o[t]=r.watch(t,e)}})();var o,i,l;(function(){function t(t){if(null!=t){t.content=null,t.exports=null;var e=t.parent;return e.create(t.type,t.route,t.namespace,t.xpath).on(4,e.childLoaded)}}function e(t,e){var n=bin[t][e],r=n.includes;delete bin[t][e],null!=r&&r.forEach(function(t){var e=t.resource,n=e.type,r=e.url;"/"!==r[0]&&(r="/"+r),delete bin[n][r]})}o=function(t){var e;return function(){e&&clearTimeout(e),e=setTimeout(function(){var e;"object"==typeof cfg.autoreload&&(e=function(e){e!==!1&&cfg.autoreload.fileChanged(t,"include")}),l(t,e)},150)}},i=function(t){if(null!=t){var n,r,o,l,s=[];for(n in bin)for(r in bin[n])l=bin[n][r],o=r.indexOf(t),-1!==o&&o===r.length-t.length&&(e(n,r),s.push(l.parent&&l.parent.url?i(l.parent.url):l));return 0===s.length&&console.warn("<include:res:remove> Resource is not in cache",t),s}},l=function(e,n){var r=i(e).filter(function(t){return null!=t});if(0===r.length)return n&&n(!1),void 0;for(var o=r.length,l=l,s=-1;l>++s;)t(r[s]).done(function(){0===--o&&n()})}})(),XMLHttpRequest=function(){},XMLHttpRequest.prototype={constructor:XMLHttpRequest,open:function(t,e){this.url=e},send:function(){-1!==this.url.indexOf("file://")&&(this.url=path_getFile(this.url));var n=this;t(this.url,function(t,r){t&&(console.error(">>",t.code,t.path),r=""),n.readyState=4,n.responseText=r,n.onreadystatechange(),null==t&&cfg.autoreload&&e(n.url,o(n.url))})}},__eval=function(t,e,o){module.exports={},global.include=e,global.require=require,global.exports=module.exports,global.__filename=path_getFile(e.url),global.__dirname=path_getDir(global.__filename),global.module=module,o!==!0&&(t="(function(){ "+t+"\n}())");try{if(o)n.runInThisContext(t,global.__filename);else{var i=global.__filename;module=new r(i,module),module.paths=r._nodeModulePaths(path_getDir(i)),module.filename=i,module._compile(t,i),module.loaded=!0}}catch(l){console.error("Module Evaluation Error",e.url),console.error(l.stack)}if(null==e.exports){var s=module.exports;("object"!=typeof s||Object.keys(s).length)&&(e.exports=module.exports)}},function(){function t(e,n){if(n>=e.includes.length)return e.readystatechanged(4);var r=e.includes[n],o=r.resource,i=r.route.alias,l=o.exports;o.exports=null,o.type="js",o.includes=null,o.state=3,o.parent=null;for(var s in bin.load)if(bin.load[s]===o){delete bin.load[s];break}try{__eval(l,o,!0)}catch(u){console.error("<inject> Evaluation error",o.url,u),o.state=4}o.readystatechanged(3),o.on(4,function(){o.exports&&i&&(global[i]=o.exports),t(e,++n)})}var e;obj_inherit(Resource,{isBrowser:!1,isNode:!0,bin_remove:i,bin_tryReload:l,path_getFile:function(){return path_getFile(this.url)},path_getDir:function(){return path_getDir(path_getFile(this.url))},inject:function(){var e=1===arguments.length?arguments[0]:__array_slice.call(arguments);this.state=this.state>=3?3:2;var n=this,r=n.create();return r.url=this.url,r.location=this.location,r.load(e).done(function(){r.state=3,r.on(4,function(){var t=1,e=ruqq.arr.indexOf(n.includes,function(t){return t.resource===r});-1===e&&(e=n.includes.length-1,t=0),n.includes.splice.apply(n.includes,[e,t].concat(r.includes)),n.readystatechanged(3)}),t(r,0)}),n},instance:function(t){if("string"==typeof t){var n=module,o=new r(t,n);if(o.filename=path_getFile(t),o.paths=r._nodeModulePaths(path_getDir(o.filename)),null==i){for(var i,l=process.env.PATH||process.env.path,s=require("path").delimiter,u=l.split(s),a=u.length,c=/([\\\/]npm[\\\/])|([\\\/]npm$)/gi;--a>-1;)if(c.test(u[a])){i=u[a];break}i?(i=path_combine(i,"node_modules"),e=path_combine(path_getDir(path_normalize(process.mainModule.filename)),"node_modules")):console.warn("Could not resolve global NPM Directory from system path (%s)",s,l)}o.paths.unshift(e),o.paths.unshift(i),global.module=module=o,global.require=require=o.require.bind(o)}var f=new Resource;return f.state=4,f}})}(),obj_inherit(Include,{isBrowser:!1,isNode:!0,bin_tryReload:l,bin_remove:i})}()}),function(t,e){"use strict";function n(){return e(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=t&&t!==exports&&t!==i||(t=exports),o=i.document,r=t||i,"function"==typeof define&&define.amd?define(n):n()}(this,function(global,exports,document){"use strict";function util_interpolate(t,e,n,r,o,i,l){for(var s,u,a,c,f,h=t.length,d=-1,p=null,g="",v=!0;h>++d;)v===!0?null==p?g+=t[d]:p.push(t[d]):(c=t[d],u=null,a=c.indexOf(":"),-1===a?u=obj_getPropertyEx(c,n,r,i):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=f(c,n,r,o,i,l,e)),null!=u&&("object"==typeof u&&null==p&&(p=[g]),null==p?g+=u:p.push(u))),v=!v;return null==p?g:p}function Template(t){this.template=t,this.index=0,this.length=t.length}function fn_proxy(t,e){return function(){return fn_apply(t,e,arguments)}}function fn_apply(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);case 4:return t.call(e,n[0],n[1],n[2],n[3])}return t.apply(e,n)}function fn_doNothing(){}function str_trim(t){for(var e,n=t.length,r=0,o=n-1;n>r&&(e=t.charCodeAt(r),33>e);r++);for(;o>=r&&(e=t.charCodeAt(o),33>e);o--);return 0===r&&o===n-1?t:t.substring(r,o+1)}function is_Function(t){return"function"==typeof t}function is_Object(t){return null!=t&&"object"==typeof t}function is_Array(t){return null!=t&&"number"==typeof t.length&&"function"==typeof t.slice}function obj_inherit(t){"function"==typeof t&&(t=t.prototype);for(var e,n,r,o=1,i=arguments.length;i>o;o++){e="function"==typeof arguments[o]?arguments[o].prototype:arguments[o];for(n in e)r=Object.getOwnPropertyDescriptor(e,n),null!=r&&(r.hasOwnProperty("value")?t[n]=r.value:Object.defineProperty(t,n,r))}return t}function obj_extend(t,e){if(null==t&&(t={}),null==e)return t;var n,r;for(n in e)r=e[n],null!=r&&(t[n]=e[n]);return t}function obj_getProperty(t,e){for(var n=t,r=e.split("."),o=-1,i=r.length;null!=n&&i>++o;)n=n[r[o]];return n}function fn_isFunction(t){return"function"==typeof t}function fn_empty(){return!1}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0},_Array_slice=Array.prototype.slice;Template.prototype={skipWhitespace:function(){for(var t=this.template,e=this.index,n=this.length;n>e&&!(t.charCodeAt(e)>32);e++);return this.index=e,this},skipToAttributeBreak:function(){var t,e=this.template,n=this.index,r=this.length;do if(t=e.charCodeAt(++n),35===t&&123===e.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),this.index++,void 0;while(46!==t&&35!==t&&62!==t&&123!==t&&32!==t&&59!==t&&r>n);this.index=n},sliceToChar:function(t){for(var e,n,r=this.template,o=this.index,i=o,l=!1;(n=r.indexOf(t,o))>-1&&(o=n,92===r.charCodeAt(o-1));)l=!0,o++;return e=r.substring(i,o),this.index=o,l?e.replace(regexpEscapedChar[t],t):e}};var is_Function,is_Array;(function(){is_Function=function(t){return"function"==typeof t},is_Array=function(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}})();var obj_extend,obj_getProperty,obj_getPropertyEx,obj_toDictionary;(function(){function t(t,e,n,r){for(var o=t;r>n&&null!=o;)o=o[e[n]],n++;return o}obj_extend=function(t,e){null==t&&(t={});for(var n in e)hasOwnProp.call(e,n)!==!1&&(t[n]=e[n]);return t},obj_getProperty=function(t,e){if("."===e)return t;for(var n=t,r=e.split("."),o=-1,i=r.length;null!=n&&i>++o;)n=n[r[o]];return n},obj_getPropertyEx=function(e,n,r,o){if("."===e)return n;var i,l=e.split("."),s=n,u=-1,a=l.length,c=l[0];for("$c"===c?(s=o,u++):"$a"===c?(s=o&&o.attr,u++):"$u"===c?(s=customUtil_$utils,u++):"$ctx"===c&&(s=r,u++),i=u;null!=s&&a>++u;)s=s[l[u]];if(null==s&&-1===i)for(var f;;){if(null==o)break;if(f=o.scope,null!=f&&(s=t(f,l,0,a),null!=s))return s;o=o.parent}return s},obj_toDictionary=function(t){var e,n=[],r=0;for(e in t)n[r++]={key:e,value:t[e]};return n}})();var ExpressionUtil=function(){function t(t){for(var e,n,r=!1,o=39===t?"'":'"',i=u;(e=l.indexOf(o,u))>-1&&(u=e,92===l.charCodeAt(e-1));)r=!0,u++;return n=l.substring(i,u),r===!0&&(n=n.replace(regexpEscapedChar[o],o)),n}function e(){for(var t,e,n=u;;){if(t=l.charCodeAt(u),46===t){if(e===!0)return re("Unexpected punc"),null;e=!0}if(!((t>=48&&57>=t||46===t)&&a>u))break;u++}return+l.substring(n,u)}function n(){var e,n=u,r=l.charCodeAt(u);if(34===r||39===r)return u++,e=t(r),u++,e;for(;;){if(u===a)break;if(r=l.charCodeAt(u),36!==r){if(!(r>47&&58!==r&&60!==r&&61!==r&&62!==r&&63!==r&&124!==r))break;u++}else u++}return l.substring(n,u)}function r(t){if(null==t&&u===a)return null;switch(t){case 40:return A;case 41:return S;case 44:return E;case 46:return T;case 43:return h;case 45:return f;case 42:return p;case 47:return d;case 37:return g;case 61:return l.charCodeAt(++u)!==t?(re("Not supported (Apply directive) - view can only access model/controllers"),null):l.charCodeAt(u+1)===t?(u++,_):b;case 33:return 61===l.charCodeAt(u+1)?(u++,61===l.charCodeAt(u+1)?(u++,C):x):y;case 62:return 61===l.charCodeAt(u+1)?(u++,j):w;case 60:return 61===l.charCodeAt(u+1)?(u++,O):k;case 38:return l.charCodeAt(++u)!==t?(re("Single Binary Operator AND"),null):m;case 124:return l.charCodeAt(++u)!==t?(re("Single Binary Operator OR"),null):v;case 63:return D;case 58:return R}return t>=65&&90>=t||t>=97&&122>=t||95===t||36===t?I:t>=48&&57>=t?M:34===t||39===t?P:(re("Unexpected / Unsupported directive"),null)}function o(o){l=o,u=0,a=o.length,s=new W;var i,c,N=s,F=B;t:for(;;)if(a>u&&33>(i=l.charCodeAt(u)))u++;else{if(u>=a)break;if(c=r(i),null==c&&a>u)break;switch(c){case A:N=ne(N,new K(N)),N=ne(N,new W(N)),u++;continue;case S:var H=L;F===J&&(F=B,H=U);do N=N.parent;while(null!=N&&N.type!==H);if(H===L&&(N=N.parent),null==N){re("OutOfAst Exception - body closed");break t}u++;continue;case E:if(F!==J){F=B;do N=N.parent;while(null!=N&&N.type!==L);if(u++,null==N){re("Unexpected punctuation, comma");break t}continue}do N=N.parent;while(null!=N&&N.type!==U);if(null==N){re("OutOfAst Exception - next argument");break t}N=N.newArgument(),u++;continue;case D:s=new te(s),N=s.case1,u++;continue;case R:N=s.case2,u++;continue;case T:i=l.charCodeAt(u+1),i>=48&&57>=i?c=M:(c=I,u++)}if(N.type===L&&(N=ne(N,new K(N))),f!==c&&y!==c||null!=N.body)switch(c){case f:case h:case p:case d:case g:case m:case v:case b:case _:case x:case C:case w:case j:case k:case O:for(;N&&N.type!==$;)N=N.parent;if(null==N.body){re("Unexpected operator",N);break t}N.join=c;do N=N.parent;while(null!=N&&N.type!==L);null==N&&console.error("Unexpected parent",N),u++;continue;case P:case M:if(null!=N.body&&null==N.join){re("Directive Expected");break t}P===c&&(u++,ne(N,new V(t(i))),u++),M===c&&ne(N,new V(e(i)));continue;case I:var z=n();if("null"===z&&(z=null),"false"===z&&(z=!1),"true"===z&&(z=!0),"string"!=typeof z){ne(N,new V(z));continue}for(;a>u;){i=l.charCodeAt(u);{if(!(33>i))break;u++}}if(40===i){F=J,u++;var q=ne(N,new G(N,z));N=q.newArgument();continue}N=ne(N,new Q(N,z))}else N=ne(N,new Z(N,c)),u++}return null==N.body&&N.type===$&&re("Unexpected end of expression"),ee(s),s}function i(t,e,n,r){var l,s;if(null==t)return null;s="string"==typeof t?c.hasOwnProperty(t)===!0?c[t]:c[t]=o(t):t;var u,a,N,A=s.type;if(L===A){var S,E;t:for(u=0,N=s.body.length;N>u;u++)if(a=s.body[u],S=i(a,e,n,r),null!=E&&null!=E.join){if(E.join===m)if(l)l=S;else for(;N>u&&s.body[u].join!==v;u++);if(E.join===v){if(l)break t;if(S){l=S;break t}}switch(E.join){case f:l-=S;break;case h:l+=S;break;case d:l/=S;break;case p:l*=S;break;case g:l%=S;break;case x:l=l!=S;break;case C:l=l!==S;break;case b:l=l==S;break;case _:l=l===S;break;case w:l=l>S;break;case j:l=l>=S;break;case k:l=S>l;break;case O:l=S>=l}E=a}else E=a,l=S}if($===A)return i(s.body,e,n,r);if(H===A)return s.body;if(F===A||U===A)return oe(s,e,n,r);if(z===A)switch(l=i(s.body,e,n,r),s.prefix){case f:l=-l;break;case y:l=!l}return q===A&&(l=i(s.body,e,n,r),l=i(l?s.case1:s.case2,e,n,r)),l}var l,s,u=0,a=0,c={},f="-",h="+",d="/",p="*",g="%",v="||",m="&&",y="!",b="==",_="===",x="!=",C="!==",w=">",j=">=",k="<",O="<=",N=".",A=20,S=21,E=22,T=23,D=24,R=25,I=30,P=31,M=32,L=1,$=2,F=3,U=4,H=6,z=9,q=10,B=1,J=2,X={};X[N]=1,X[d]=2,X[p]=2,X[f]=3,X[h]=3,X[w]=4,X[j]=4,X[k]=4,X[O]=4,X[b]=5,X[_]=5,X[x]=5,X[C]=5,X[m]=6,X[v]=6;var W,K,V,G,Q,Y,Z,te;(function(){W=function(t){this.parent=t,this.type=L,this.body=[],this.join=null},K=function(t){this.parent=t},K.prototype={constructor:K,type:$,join:null,body:null},V=function(t){this.type=H,this.body=t,this.join=null},G=function(t,e){this.parent=t,this.type=U,this.body=e,this.arguments=[],this.next=null},G.prototype={constructor:G,newArgument:function(){var t=new W(this);return this.arguments.push(t),t}},Q=function(t,e){this.parent=t,this.type=F,this.body=e,this.next=null},Y=function(t,e){this.parent=t,this.body=e,this.next=null},Z=function(t,e){this.parent=t,this.prefix=e},Z.prototype={constructor:Z,type:z,body:null},te=function(t){this.body=t,this.case1=new W(this),this.case2=new W(this)},te.prototype={constructor:te,type:q,case1:null,case2:null}})();var ee,ne;(function(){function t(t){if(0===t.length)return null;var e=new W(t[0].parent);return e.join=t[t.length-1].join,e.body=t,e}ne=function(t,e){null==t&&console.error("<Mask:Ast> Current undefined",e);var n=t.type;return L===n?(t.body.push(e),e):$===n||z===n?t.body=e:F===n||U===n?t.next=e:(console.error("Unsupported - append:",t,e),e)},ee=function(e){if(e.type!==L)return null!=e.body&&"object"==typeof e.body&&ee(e.body),void 0;for(var n,r,o,i=e.body,l=0,s=i.length;s>l;l++)ee(i[l]);for(l=1;s>l&&(n=i[l],r=i[l-1],!(X[r.join]>X[n.join]));l++);if(l!==s){for(o=[i[0]],l=1;s>l;l++){n=i[l],r=i[l-1];var u=X[r.join];if(u>X[n.join]&&s-1>l){for(var a,c,f=l;s>++l&&(a=i[l].join,null!=a)&&!(X[a]>=u););c=i.slice(f,l+1),n=t(c),ee(n)}o.push(n)}e.body=o}}})();var re,oe;(function(){oe=function(t,e,n,r){var o,l,s,u,a,c=t,f=t.body;if("$c"===f){l=r;var h=c.next;null!=h&&h.type===U&&null==l[h.body]&&"function"==typeof Compo.prototype[h.body]&&(o=r,l=Compo.prototype[h.body],c=h)}else if("$a"===f)l=r&&r.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=n;else if(null!=e&&(o=e,l=e[f]),null==l)for(;null!=r&&(o=r.scope,null!=o&&(l=o[f]),null==l);)r=r.parent;if(null!=l)for(;;){if(c.type===U){for(s=[],u=-1,a=c.arguments.length;a>++u;)s[u]=i(c.arguments[u],e,n,r);l=l.apply(o,s)}if(null==l||null==c.next)break;if(c=c.next,f=c.body,o=l,l=l[f],null==l)break}return null==l&&(null==c||null!=c.next)&&re("Mask - Accessor error - ",f),l},re=function(t,e){console.error("Expression parser:",t,e,l.substring(u))}})();var ie=function(){function t(r){if(null==r)return null;var o,i;if(L===r.type)for(var l=0,u=r.body.length;u>l;l++)i=t(r.body[l]),o=e(o,i);if(F===r.type){for(var a=r.body,c=r.next;null!=c;){if(U===c.type)return t(c);if(F!==c.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;a+="."+c.body,c=c.next}return a}switch(r.type){case $:case z:case q:i=t(r.body),o=e(o,i)}if(q===r.type&&(i=t(s.case1),o=e(o,i),i=t(s.case2),o=e(o,i)),U===r.type){for(var l=0,u=r.arguments.length;u>l;l++)i=t(r.arguments[l]),o=e(o,i);i=null;var f=r;t:for(;f=f.parent;)switch(f.type){case F:i=f.body+(null==i?"":"."+i);break;case L:case $:break t;default:i=null;break t}null!=i&&(o=e(o,i)),r.next&&(i=t(r.next),o=e(o,{accessor:n(r),ref:i}))}return o}function e(t,e){if(null==t)return e;if(null==e)return t;if(("object"!=typeof t||null==t.length)&&(t=[t]),"object"!=typeof e||null==e.length)return-1===t.indexOf(e)&&t.push(e),t;for(var n=0,r=e.length;r>n;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}function n(t){var e=t;t:for(;e.parent;){switch(e.parent.type){case L:case $:break t}e=e.parent}return r(e,t.next)}function r(t,e){if(t===e||null==t)return null;if("object"!=typeof t)return t;if(null!=t.length&&"function"==typeof t.splice){for(var n=[],o=0,i=t.length;i>o;o++)n[o]=r(t[o],e);return n}var l={};for(var s in t)null!=t[s]&&"parent"!==s&&(l[s]=r(t[s],e));return l}return function(e){return"string"==typeof e&&(e=o(e)),t(e)}}();return{parse:o,eval:i,varRefs:ie,evalStatements:function(t,e,n,r){for(var l=o(t).body,s=[],u=l.length,a=-1;u>++a;)s[a]=i(l[a],e,n,r);return s}}}(),customUtil_register,customUtil_get,customUtil_$utils={};(function(){function t(t){return"parsed"!==t.arguments?fn_proxy(t.process||e,t):n(t.process)}function e(t,e,n,r,o,i,l){return"node"===l?(this.nodeRenderStart(t,e,n,r,o),this.node(t,e,n,r,o)):(this.attrRenderStart(t,e,n,r,o,i),this.attr(t,e,n,r,o,i))}function n(t){return function(e,n,r,o,i){var l=ExpressionUtil.evalStatements(e,n,r,i);return t.apply(null,l)}}customUtil_register=function(e,n){return is_Function(n)?(custom_Utils[e]=n,void 0):(custom_Utils[e]=t(n),"parsed"===n.arguments&&(customUtil_$utils[e]=n.process),void 0)},customUtil_get=function(t){return null!=t?custom_Utils[t]:custom_Utils}})();var custom_Utils={expression:function(t,e,n,r,o){return ExpressionUtil.eval(t,e,n,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={},Dom;(function(){function t(t){if(null==this.nodes)return this.nodes=[t],void 0;this.nodes.push(t);var e=this.nodes[this.nodes.length-2];e.nextSibling=t}function e(t,e){this.type=Dom.NODE,this.tagName=t,this.parent=e,this.attr={}}function n(t,e){this.content=t,this.parent=e}function r(t,e,n){this.tagName=t,this.parent=e,this.controller=n,this.attr={}}function o(){}var i=1,l=2,s=3,u=4,a=9,c=10,f=15;e.prototype={constructor:e,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:t,__single:null},n.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:u,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:s,nodes:null,appendChild:t},Dom={NODE:i,TEXTNODE:l,FRAGMENT:s,COMPONENT:u,CONTROLLER:a,SET:c,STATEMENT:f,Node:e,TextNode:n,Fragment:o,Component:r}})();var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;(function(t,e,n){function r(t){for(var e=-1;-1!==(e=t.indexOf(s,e))&&t.charCodeAt(e+1)!==f;)e++;if(-1===e)return t;for(var n,r=[],o=0,i=0;;){if(n=t.indexOf(a,e+2),-1===n)break;for(r[i++]=o===e?"":t.substring(o,e),r[i++]=t.substring(e+2,n),o=e=n+1;-1!==(e=t.indexOf(s,e))&&t.charCodeAt(e+1)!==f;)e++;if(-1===e)break}return t.length>o&&(r[i]=t.substring(o)),t=null,function(t,e,n,o,i,l){if(null==t){for(var c,f="",h=r.length,d=-1;h>++d;)c=r[d],f+=1===d%2?s+u+c+a:c;return f}return util_interpolate(r,t,e,n,o,i,l)}}function o(t,e,n,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n],i=t.substring(0,e).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:t.substring(e),template:t})}var i,l,s="~",u="[",a="]",c=126,f=91,h=93;(function(){i=function(t,e,n,r,i){for(var s,u=0;n>e;e++)if(s=t.charCodeAt(e),34!==s)if(s!==r){if(s===i&&-1===--u)return e}else u++;else e=l(t,e+1,n,'"');return o(t,e,null,"Not closed brackets `"+String.fromCharCode(r)+"`"),e},l=function(t,e,n,r){for(var o;-1!==(o=t.indexOf(r,e))&&(e=o,92===t.charCodeAt(o-1));)e++;return e}})();var d=2,p=3,g=5,v=6,m=7,y=8,b=9;Parser={parse:function(l){for(var s,u,a,_,x,C,w,j,k=new n,O=k,N=d,A=p,S=0,E=l.length;;)if(E>S&&33>(C=l.charCodeAt(S)))S++;
else{if(47===C){if(j=l.charCodeAt(S+1),47===j){for(S++;10!==C&&13!==C&&E>S;)C=l.charCodeAt(++S);continue}if(42===j){S=l.indexOf("*/",S+2)+2,1===S&&(console.warn("<mask:parse> block comment has no end"),S=E);continue}}if(A===g&&(null!=s&&(k.attr["class"]=r(s),s=null),null!=a&&(k.attr[a]=a,a=null,u=null)),null!=u){if(N===g)null==a?a=u:_=u,null!=a&&null!=_&&("class"!==a?k.attr[a]=_:s=null==s?_:s+" "+_,a=null,_=null);else if(A===p)x=new t(u,k),k.appendChild(x),k=x,N=g;else if(A===y){if(x=new e(u,k),k.appendChild(x),k.__single===!0)do k=k.parent;while(null!=k&&null!=k.__single);N=d}u=null}if(S>=E){N===g&&(null!=s&&(k.attr["class"]=r(s)),null!=a&&(k.attr[a]=a));break}if(N===b){for(k=k.parent;null!=k&&null!=k.__single;)k=k.parent;N=d}switch(C){case 123:A=N,N=d,S++;continue;case 62:A=N,N=d,S++,k.__single=!0;continue;case 59:if(null!=k.nodes){S++;continue}case 125:S++,A=N,N=b;continue;case 39:case 34:N===v?N=g:A=N=y,S++;var T,D=!1,R=!1,I=39===C?"'":'"';for(w=S;(T=l.indexOf(I,S))>-1&&(S=T,92===l.charCodeAt(T-1));)D=!0,S++;w===S&&(j=l.charCodeAt(S+1),(124===j||j===C)&&(R=!0,w=S+2,S=T=l.indexOf((124===j?"|":I)+I+I,w),-1===S&&(S=E))),u=l.substring(w,S),D===!0&&(u=u.replace(regexpEscapedChar[I],I)),u=r(u),S+=R?3:1;continue}if(N===d){if(A=p,N=p,46===C||35===C){u="div";continue}}else if(N===g)if(46===C)S++,a="class",N=m;else if(35===C)S++,a="id",N=m;else{if(61===C){S++,N=v;continue}if(40===C){w=1+S,S=1+i(l,w,E,C,41),k.expression=l.substring(w,S-1),k.type=Dom.STATEMENT;continue}if(null!=a){u=a;continue}}(N===v||N===m)&&(A=N,N=g);var P=null;for(w=S;E>S;){if(C=l.charCodeAt(S),C===c&&l.charCodeAt(S+1)===f){P=!0,++S;do C=l.charCodeAt(++S);while(C!==h&&E>S)}if(39===C||34===C||47===C||60===C||44===C){o(l,S,N,String.fromCharCode(C));break}if(A!==v&&(46===C||35===C))break;if(61===C||62===C||123===C||33>C||59===C||40===C)break;S++}if(u=l.substring(w,S),!u){o(l,S,N,"<empty token>");break}if(P===!0&&N===p){o(l,S,N,"Tag Names cannt be interpolated (in dev)");break}P===!0&&(N===g&&"class"===a)==!1&&(u=r(u))}return null!=k.parent&&k.parent!==O&&k.parent.__single!==!0&&null!=k.nodes&&console.warn("Mask - ",k.parent.tagName,JSON.stringify(k.parent.attr),"was not proper closed."),null!=O.nodes&&1===O.nodes.length?O.nodes[0]:O},cleanObject:function(t){if(t instanceof Array){for(var e=0;t.length>e;e++)this.cleanObject(t[e]);return t}return delete t.parent,delete t.__single,null!=t.nodes&&this.cleanObject(t.nodes),t},setInterpolationQuotes:function(t,e){return t&&2===t.length?e&&1===e.length?(c=t.charCodeAt(0),f=t.charCodeAt(1),h=e.charCodeAt(0),s=t[0],u=t[1],a=e,void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes})(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component);var cache={},Mask={render:function(t,e,n,r,o){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, ctx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof t&&(t=hasOwnProp.call(cache,t)?cache[t]:cache[t]=parser_parse(t)),null==n&&(n={}),builder_build(t,e,n,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,registerHandler:function(t,e){custom_Tags[t]=e},getHandler:function(t){return null!=t?custom_Tags[t]:custom_Tags},registerStatement:function(t,e){custom_Statements[t]=is_Function(e)?{render:e}:e},getStatement:function(t){return null!=t?custom_Statements[t]:custom_Statements},registerAttrHandler:function(t,e,n){is_Function(e)&&(n=e),custom_Attributes[t]=n},getAttrHandler:function(t){return null!=t?custom_Attributes[t]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(t,e){console.warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",t),this.registerUtility=this.registerUtil,this.registerUtility(t,e)},getUtility:function(t){return console.warn("@getUtility - deprecated - use getUtil(utilName)",t),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(t){"string"==typeof t?delete cache[t]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:obj_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(t,e){null==listeners&&(listeners={}),(listeners[t]||(listeners[t]=[])).push(e)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(t){builder_componentID=t},cfg:function(){var t=arguments;if(0===t.length)return __cfg;var e;if(2===t.length)return e=t[0],__cfg[e]=t[1],void 0;var n=t[0];if("object"==typeof n)for(e in n)__cfg[e]=n[e]}};Mask.renderDom=Mask.render;var Compo=exports.Compo=function(mask){function _mask_ensureTmplFn(t){return"string"!=typeof t?t:_mask_ensureTmplFnOrig(t)}function is_Function(t){return"function"==typeof t}function is_Object(t){return null!=t&&"object"==typeof t}function is_Array(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}function is_String(t){return"string"==typeof t}function is_notEmptyString(t){return"string"==typeof t&&""!==t}function is_rawObject(t){return null==t?!1:"object"!=typeof t?!1:t.constructor===Object}function domLib_initialize(){null!=domLib&&null!=domLib.fn&&(domLib.fn.compo=function(t){if(0===this.length)return null;var e=Anchor.resolveCompo(this[0]);return null==t?e:find_findSingle(e,selector_parse(t,Dom.CONTROLLER,"up"))},domLib.fn.model=function(t){var e=this.compo(t);if(null==e)return null;for(var n=e.model;null==n&&e.parent;)e=e.parent,n=e.model;return n},function(){var t=["append","prepend","before","after"];arr_each(["appendMask","prependMask","beforeMask","afterMask"],function(e,n){domLib.fn[e]=function(r,o,i,l){if(0===this.length)return console.warn("<jcompo> $.",e,"- no element was selected(found)"),this;this.length>1&&console.warn("<jcompo> $.",e," can insert only to one element. Fix is comming ..."),null==i&&(i=2>n?this.compo():this.parent().compo()),null==i&&(i={},console.warn("$.***Mask - controller not found, this can lead to memory leaks if template contains compos")),null==i.components&&(i.components=[]);for(var s=i.components,u=s.length,a=mask.render(r,o,l,null,i),c=this[t[n]](a),f=s.length;f>u;u++)Compo.signal.emitIn(s[u],"domInsert");return c}})}(),function(){function t(t,e){node_tryDispose(e)}function e(t,e){node_tryDisposeChildren(e)}var n=domLib.fn.remove,r=domLib.fn.empty;domLib.fn.removeAndDispose=function(){return this.each(t),n.call(this)},domLib.fn.emptyAndDispose=function(){return this.each(e),r.call(this)}}())}function SlotHandler(){}var Dom=mask.Dom,_array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_mask_ensureTmplFnOrig=mask.Utils.ensureTmplFn,domLib,Class;(function(){function t(){for(var t,n,r,o=arguments,i=e.length;--i>-1;)if(t=e[i],null!=t)for(r=o.length;--r>-1;)if(n=t[o[r]],null!=n)return n}var e=[global.atma,exports,global];domLib=t("jQuery","Zepto","$"),Class=t("Class")})(),null!=document&&null==domLib&&console.warn("jQuery-Zepto-Kimbo etc. was not loaded before MaskJS:Compo, please use Compo.config.setDOMLibrary to define dom engine"),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1});var obj_extend,obj_copy;(function(){obj_extend=function(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)t[n]=e[n];return t},obj_copy=function(t){var e,n={};for(e in t)n[e]=t[e];return n}})();var arr_each,arr_remove;(function(){arr_each=function(t,e){for(var n=t.length,r=-1;n>++r;)e(t[r],r)},arr_remove=function(t,e){if(null==t)return console.error("Can not remove myself from parent",e),void 0;var n=t.indexOf(e);return-1===n?(console.error("Can not remove myself from parent",e,n),void 0):(t.splice(n,1),void 0)}})();var fn_proxy,fn_apply;(function(){fn_proxy=function(t,e){return function(){return fn_apply(t,e,arguments)}},fn_apply=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);case 4:return t.call(e,n[0],n[1],n[2],n[3])}return t.apply(e,n)}})();var selector_parse,selector_match;(function(){function t(t){return function(n){return e(n,t)}}function e(t,n,r){if("string"!=typeof t)return!1;if(null==r&&(r=0),r=t.indexOf(n,r),-1===r)return!1;if(r>0&&t.charCodeAt(r-1)>32)return e(t,n,r+1);var o=t.length,i=n.length;return o-i>r&&t.charCodeAt(r+i)>32?e(t,n,r+1):!0}selector_parse=function(e,n,r){if(null==e&&console.error("<compo>selector is undefined",n),"object"==typeof e)return e;var o,i,l;if(null==o)switch(e[0]){case"#":o="id",e=e.substring(1),i="attr";break;case".":o="class",e=t(e.substring(1)),i="attr";break;default:o=n===Dom.SET?"tagName":"compoName"}return l="up"===r?"parent":n===Dom.SET?"nodes":"components",{key:o,prop:i,selector:e,nextKey:l}},selector_match=function(t,e,n){is_String(e)&&(null==n&&(n=Dom[t.compoName?"CONTROLLER":"SET"]),e=selector_parse(e,n));var r=e.prop?t[e.prop]:t;return null==r?!1:is_Function(e.selector)?e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key]):r[e.key]==e.selector}})();var find_findSingle;(function(){find_findSingle=function(t,e){if(is_Array(t)){for(var n,r=t.length,o=-1;r>++o;)if(n=find_findSingle(t[o],e),null!=n)return n;return null}return selector_match(t,e)?t:(t=t[e.nextKey],null==t?null:find_findSingle(t,e))}})();var dom_addEventListener,node_tryDispose,node_tryDisposeChildren;(function(){dom_addEventListener=function(t,e,n){return null!=EventDecorator&&(e=EventDecorator(e)),null!=domLib?domLib(t).on(e,n):null!=t.addEventListener?t.addEventListener(e,n,!1):(t.attachEvent&&t.attachEvent("on"+e,n),void 0)},node_tryDispose=function(t){if(t.hasAttribute("x-compo-id")){var e=t.getAttribute("x-compo-id"),n=Anchor.getByID(e);if(n){if(null==n.$||1===n.$.length)return compo_dispose(n),compo_detachChild(n),void 0;var r=_Array_indexOf.call(n.$,t);-1!==r&&_Array_splice.call(n.$,r,1)}}node_tryDisposeChildren(t)},node_tryDisposeChildren=function(t){for(var e=t.firstChild;null!=e;)1===e.nodeType&&node_tryDispose(e),e=e.nextSibling}})();var domLib_find,domLib_on;(function(){domLib_find=function(t,e){return t.filter(e).add(t.find(e))},domLib_on=function(t,e,n,r){return null==n?t.on(e,r):(t.on(e,n,r).filter(n).on(e,r),t)}})();var Children_={select:function(t,e){for(var n in e){var r=e[n],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",n,e[n]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=i.indexOf(":"),s=i.substring(0,l);s=Compo.config.selectors[s],null==s?t.compos[n]=t.$[0].querySelector(i):(i=i.substring(++l).trim(),t.compos[n]=s(t,i));var u=t.compos[n];null!=o&&(null!=u.$&&(u=u.$),Events_.on(t,o,u))}}},Events_={on:function(t,e,n){null==n&&(n=t.$);for(var r,o=e instanceof Array,i=o?e.length:1,l=0;o?i>l:1>l;l++)if(r=o?e[l]:e,r instanceof Array)null!=EventDecorator&&(r[0]=EventDecorator(r[0])),n.on.apply(n,r);else for(var s in r){var u,a,c="string"==typeof r[s]?t[r[s]]:r[s],f=s.indexOf(":");-1!==f?(u=s.substring(0,f),a=s.substring(f+1).trim()):u=s,null!=EventDecorator&&(u=EventDecorator(u)),domLib_on(n,u,a,fn_proxy(c,t))}}},EventDecorator=null,EventDecos=function(){var t=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(t){return!1}}();return{touch:function(e){return t===!1?e:"click"===e?"touchend":"mousedown"===e?"touchstart":"mouseup"===e?"touchend":"mousemove"===e?"touchmove":e}}}(),Pipes=function(){function t(t,e){return function(n){new i(t).emit(e,n)}}function e(t,e){return null==e.pipes[t]?(console.error("Controller has no pipes to be added to collection",t,e),void 0):(null==l[t]&&(l[t]=[]),l[t].push(e),void 0)}function n(t,e){for(var n=l[t],r=n.length;--r>-1;)n[r]===e&&n.splice(r,1)}function r(){var t=this,e=t.pipes;for(var r in e)n(r,t)}function o(t){var n=t.pipes;if(null==n)return console.error("Controller has no pipes",t),void 0;for(var o in n)e(o,t);Compo.attachDisposer(t,r.bind(t))}function i(t){return this instanceof i==!1?new i(t):(this.pipeName=t,this)}var l={};return mask.registerAttrHandler("x-pipe-signal","client",function(e,n,r,o,i){for(var l,s=n.split(";"),u=s.length,a=-1;u>++a;)if(l=s[a].trim(),""!==l){var c,f,h=l.indexOf(":"),d=l.substring(0,h),p=l.substring(h+1).trim(),g=p.indexOf(".");if(-1===g)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;c=p.substring(0,g),f=p.substring(++g);var v=t(c,f);!d&&console.error("Signal: event type is not set",n),dom_addEventListener(i,d,v)}}),i.prototype={constructor:i,emit:function(t){var e,n=l[this.pipeName],r=this.pipeName;if(null==n)return console.warn("Pipe.emit: No signals were bound to:",r),void 0;2===arguments.length&&is_Array(arguments[1])?e=arguments[1]:arguments.length>1&&(e=_array_slice.call(arguments,1));for(var o,i,s,u,a=n.length;-1!==--a;)o=n[a],i=o.pipes[r],null!=i&&(s=i[t],is_Function(s)&&(s.apply(o,e),u=!0));u||console.warn("Pipe `%s` has not slots for `%s`",r,t)}},i.addController=o,i.removeController=r,{addController:o,removeController:r,pipe:i}}(),Anchor=function(){var t={};return{create:function(e){return null==e.ID?(console.warn("Component should have an ID"),void 0):(t[e.ID]=e,void 0)},resolveCompo:function(e){if(null==e)return null;var n,r,o;do{if(r=e.getAttribute("x-compo-id"),r&&(null==n&&(n=r),o=t[r],null!=o&&(o=Compo.find(o,{key:"ID",selector:n,nextKey:"components"}),null!=o)))return o;e=e.parentNode}while(e&&1===e.nodeType);return n&&console.warn("No controller for ID",n),null},removeCompo:function(e){null!=e.ID&&delete t[e.ID]},getByID:function(e){return t[e]}}}(),Compo=function(){function Compo(t){if(this instanceof Compo)return null;var e;if(null==t&&(t={}),hasInclude&&global.include&&(t.__resource=global.include.url),null!=t.attr)for(var n in t.attr)t.attr[n]=_mask_ensureTmplFn(t.attr[n]);var r=t.slots;if(null!=r)for(var n in r)"string"==typeof r[n]&&("function"!=typeof t[r[n]]&&console.error("Not a Function @Slot.",r[n]),r[n]=t[r[n]]);t.hasOwnProperty("constructor")&&(e=t.constructor),e=compo_createConstructor(e,t),null==e&&(e=function(){});for(var n in Proto)null==t[n]&&(t[n]=Proto[n]);return e.prototype=t,t=null,e}var hasInclude=!!(global.include||global.atma!==void 0&&global.atma.include||exports!==void 0&&exports.include),compo_dispose,compo_detachChild,compo_ensureTemplate,compo_attachDisposer,compo_createConstructor;(function(){compo_dispose=function(t){null!=t.dispose&&t.dispose(),Anchor.removeCompo(t);for(var e=t.components,n=e&&e.length||0;--n>-1;)compo_dispose(e[n])},compo_detachChild=function(t){var e=t.parent;if(null!=e){var n,r=t.$,o=e.$||e.elements;if(o&&r){var i,l,s=r.length;for(n=o.length;--n>-1;)for(i=o[n],l=s;--l>-1;)if(i===r[l]){o.splice(n,1);break}}var u=e.components;if(null!=u){for(n=u.length;--n>-1;)if(u[n]===t){u.splice(n,1);break}-1===n&&console.warn("<compo:remove> - i`m not in parents collection",t)}}},compo_ensureTemplate=function(t){if(null==t.nodes){null!=t.attr.template&&(t.template=t.attr.template,delete t.attr.template);var e=t.template;if(null!=e){if(is_String(e)){if(35===e.charCodeAt(0)&&/^#[\w\d_-]+$/.test(e)){var n=document.getElementById(e.substring(1));if(null==n)return console.error("<compo> Template holder not found by id:",e),void 0;e=n.innerHTML}e=mask.parse(e)}"object"==typeof e&&(t.nodes=e)}}},compo_attachDisposer=function(t,e){if(null==t.dispose)return t.dispose=e,void 0;var n=t.dispose;t.dispose=function(){e.call(this),n.call(this)}},compo_createConstructor=function(t,e){var n=e.compos,r=e.pipes,o=e.attr;return null==n&&null==r&&null==e.attr?t:function(){null!=n&&(this.compos=obj_copy(this.compos)),null!=r&&Pipes.addController(this),null!=o&&(this.attr=obj_copy(this.attr)),is_Function(t)&&t.call(this)}}})(),obj_extend(Compo,{create:function(t){var e;null==t&&(t={}),t.hasOwnProperty("constructor")&&(e=t.constructor),null==e&&(e=function(){});for(var n in Proto)null==t[n]&&(t[n]=Proto[n]);return e.prototype=t,e},createClass:function(t){if(null!=t.attr)for(var e in t.attr)t.attr[e]=_mask_ensureTmplFn(t.attr[e]);hasInclude&&global.include&&(t.__resource=global.include.url);var n=t.slots;if(null!=n)for(var e in n)"string"==typeof n[e]&&("function"!=typeof t[n[e]]&&console.error("Not a Function @Slot.",n[e]),n[e]=t[n[e]]);var r;t.hasOwnProperty("constructor")&&(r=t.constructor),null==r&&(r=t.Construct),t.Construct=compo_createConstructor(r,t);var o=t.Extends;return null==o?t.Extends=Proto:is_Array(o)?o.unshift(Proto):t.Extends=[Proto,o],Class(t)},render:function(t,e,n,r){compo_ensureTemplate(t);var o=[];return mask.render(null==t.tagName?t.nodes:t,e,n,r,t,o),t.$=domLib(o),null!=t.events&&Events_.on(t,t.events),null!=t.compos&&Children_.select(t,t.compos),t},initialize:function(t,e,n,r,o){var i;null==r&&(n&&null!=n.nodeType?(r=n,n=null):e&&null!=e.nodeType&&(r=e,e=null)),"string"==typeof t&&(i=t,t=mask.getHandler(i),t||console.error("Compo not found:",t));var l={controller:t,type:Dom.COMPONENT,tagName:i};null==o&&null!=r&&(o=Anchor.resolveCompo(r)),null==o&&(o=new Dom.Component);var s=mask.render(l,e,n,null,o),u=o.components[o.components.length-1];return null!=r&&(r.appendChild(s),Compo.signal.emitIn(u,"domInsert")),u},find:function(t,e){return find_findSingle(t,selector_parse(e,Dom.CONTROLLER,"down"))},closest:function(t,e){return find_findSingle(t,selector_parse(e,Dom.CONTROLLER,"up"))},dispose:compo_dispose,ensureTemplate:compo_ensureTemplate,attachDisposer:compo_attachDisposer,config:{selectors:{$:function(t,e){var n=domLib_find(t.$,e);return 0===n.length&&console.error("<compo-selector> - element not found -",e,t),n},compo:function(t,e){var n=Compo.find(t,e);return null==n&&console.error("<compo-selector> - component not found -",e,t),n}},setDOMLibrary:function(t){domLib!==t&&(domLib=t,domLib_initialize())},eventDecorator:function(t){return"function"==typeof t?(EventDecorator=t,void 0):"string"==typeof t?(EventDecorator=EventDecos[t],void 0):"boolean"==typeof t&&t===!1?(EventDecorator=null,void 0):void 0}},pipe:Pipes.pipe,resource:function(t){for(var e=t;null!=e;){if(e.resource)return e.resource;e=e.parent}return include.instance()},plugin:function(source){eval(source)},Dom:{addEventListener:dom_addEventListener}}),function(){function t(t,e,n){return null==t[e]&&(t[e]=[]),t[e].push(n),t}function e(t,e,n){var r=t[e];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=n?o.apply(this,n):o())}var n={done:function(e){return t(this,"_cbs_done",e)},fail:function(e){return t(this,"_cbs_fail",e)},always:function(e){return t(this,"_cbs_always",e)},resolve:function(){this.async=!1,e(this,"_cbs_done",arguments),e(this,"_cbs_always",arguments)},reject:function(){this.async=!1,e(this,"_cbs_fail",arguments),e(this,"_cbs_always")}},r={async:!0,await:function(t){this.resume=t}};Compo.pause=function(t,e){if(null==e.async){e.defers=[],e._cbs_done=null,e._cbs_fail=null,e._cbs_always=null;for(var o in n)e[o]=n[o]}e.async=!0;for(var o in r)t[o]=r[o];return e.defers.push(t),function(){Compo.resume(t,e)}},Compo.resume=function(t,e){t.resume&&t.resume(),t.async=!1;for(var n,r=!1,o=0,i=e.defers.length;i>o;o++)n=e.defers[o],n!==t?r===!1&&(r=null!=n):e.defers[o]=null;r===!1&&e.resolve()}}();var Proto={type:Dom.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(t,e,n){if(1===arguments.length&&null!=t&&t instanceof Array==!1&&null!=t[0]){var r=arguments[0];t=r[0],e=r[1],n=r[2]}null==this.nodes&&compo_ensureTemplate(this),is_Function(this.onRenderStart)&&this.onRenderStart(t,e,n)},renderEnd:function(t,e,n,r){if(1===arguments.length&&t instanceof Array==!1){var o=arguments[0];t=o[0],e=o[1],n=o[2],r=o[3]}Anchor.create(this,t),this.$=domLib(t),null!=this.events&&Events_.on(this,this.events),null!=this.compos&&Children_.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(t,e,n,r)},appendTo:function(t){var e="string"==typeof t?document.querySelector(t):t;if(null==e)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=this.$,r=0,o=n.length;o>r;r++)e.appendChild(n[r]);return this.emitIn("domInsert"),this},append:function(t,e,n){var r;if(null==this.$){var o="string"==typeof t?mask.compile(t):t;return r=n?find_findSingle(this,selector_parse(n,Dom.CONTROLLER,"down")):this,null==r.nodes?(this.nodes=o,this):(r.nodes=[this.nodes,o],this)}var i=mask.render(t,e,null,null,this);return r=n?this.$.find(n):this.$,r.append(i),this.emitIn("domInsert"),this},find:function(t){return find_findSingle(this,selector_parse(t,Dom.CONTROLLER,"down"))},closest:function(t){return find_findSingle(this,selector_parse(t,Dom.CONTROLLER,"up"))},on:function(){var t=_array_slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&Events_.on(this,[t]),null==this.events?this.events=[t]:is_Array(this.events)?this.events.push(t):this.events=[t,this.events],this)},remove:function(){return null!=this.$&&this.$.remove(),compo_detachChild(this),compo_dispose(this),this.$=null,this},slotState:function(t,e){return Compo.slot.toggle(this,t,e),this},signalState:function(t,e){return Compo.signal.toggle(this,t,e),this},emitOut:function(t){return Compo.signal.emitOut(this,t,this,arguments.length>1?_array_slice.call(arguments,1):null),this},emitIn:function(t){return Compo.signal.emitIn(this,t,this,arguments.length>1?_array_slice.call(arguments,1):null),this}};return Compo.prototype=Proto,Compo}();return function(){function t(e,n,r,o,i){if(null==e)return!1;var l=!1,s=null!=e.slots&&e.slots[n];if("string"==typeof s&&(s=e[s]),"function"==typeof s){l=!0;var u=null!=e.slots.__disabled&&e.slots.__disabled[n];if(u!==!0){var a=null==o?s.call(e,r):s.apply(e,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=e.parent)return t(e.parent,n,r,o,i)||l;if(1===i&&null!=e.components)for(var c,f=e.components,h=f.length,d=0;h>d;d++)c=t(f[d],n,r,o,i),!l&&(l=c);return l}function e(t,n,r,o){if(null==t)return!1;var i=t.slots;if(null!=i&&null!=i[n]&&("string"==typeof i[n]&&(i[n]=t[i[n]]),"function"==typeof i[n])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[n]!==!0)return!0}if(-1===r&&null!=t.parent)return e(t.parent,n,r);if(1===r&&null!=t.components)for(var l=0,s=t.components.length;s>l;l++)if(e(t.components[l],n,r))return!0;return!1}function n(n,r){return e(n,r,-1)===!1?null:function(e){var o=arguments.length>1?_array_slice.call(arguments,1):null;t(n,r,e,o,-1)}}function r(t,e,n){var r=t.slots;null!=r&&r.hasOwnProperty(e)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[e]=n===!1)}function o(t,e,n){if(r(t,e,n),null!=t.components)for(var i=0,l=t.components.length;l>i;i++)o(t.components[i],e,n)}function i(t,e,n){return null==t.$?(console.warn("Controller has no elements to toggle state"),void 0):(domLib().add(t.$.filter("[data-signals]")).add(t.$.find("[data-signals]")).each(function(t,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(e)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function l(t,e,n){for(var l=t,s=t;null!=(l=l.parent);)r(l,e,n),null!=l.$&&0!==l.$.length&&(s=l);o(t,e,n),i(s,e,n)}function s(t,n,o){r(t,n,o),(o||!e(t,n,-1,!0)&&!e(t,n,1,!0))&&i(t,n,o)}mask.registerAttrHandler("x-signal","client",function(t,e,r,o,i,l){for(var s,u=e.split(";"),a="",c=u.length,f=-1;c>++f;)if(s=u[f].trim(),""!==s){var h=s.indexOf(":"),d=s.substring(0,h),p=s.substring(h+1).trim(),g=n(l,p);!d&&console.error("Signal: event type is not set",e),g&&(a+=","+p+",",dom_addEventListener(i,d,g)),!g&&console.warn("No slot found for signal",p,l)}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(Compo,{signal:{toggle:l,emitOut:function(e,n,r,o){var i=t(e,n,r,o,-1);!i&&console.warn("Signal %c%s","font-weight:bold;",n,"was not captured")},emitIn:function(e,n,r,o){t(e,n,r,o,1)},enable:function(t,e){l(t,e,!0)},disable:function(t,e){l(t,e,!1)}},slot:{toggle:s,enable:function(t,e){s(t,e,!0)},disable:function(t,e){s(t,e,!1)},invoke:function(t,e,n,r){var o=t.slots;return null==o||"function"!=typeof o[e]?(console.error("Slot not found",e,t),null):null==r?o[e].call(t,n):o[e].apply(t,[n].concat(r))}}})}(),domLib_initialize(),mask.registerHandler(":slot",SlotHandler),SlotHandler.prototype={constructor:SlotHandler,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var t=this.expression;mask.Utils.Expression.eval(t,this.model,global,this)}},Compo}(Mask),jmask=exports.jmask=function(t){function e(t){return"string"!=typeof t?t:_(t)}function n(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)t[n]=e[n];return t}function r(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)}function o(t,e){if(null==t)return console.error("Can not remove myself from parent",e),void 0;var n=t.indexOf(e);return-1===n?(console.error("Can not remove myself from parent",e,n),void 0):(t.splice(n,1),void 0)}function i(t){return null!=t&&"object"==typeof t&&null!=t.length&&"function"==typeof t.slice}function l(t,e,n){if(null==t&&console.warn("selector is null for type",e),"object"==typeof t)return t;var r,o,i,l,u,c,f,h,d,p=0,g=t.length;for(r="up"===n?w:e===m.SET?j:k;g>p;)u=t.charCodeAt(p),33>u||(c=a(t,p+1,g),46===u?(o="class",i=O,l=s(t.substring(p+1,c))):35===u?(o="id",i=O,l=t.substring(p+1,c)):91===u?(h=t.indexOf("=",p),-1===h&&console.error('Attribute Selector: should contain "="'),i=O,o=t.substring(p+1,h),u=t.charCodeAt(h+1),d=34===u||39===u?2:1,l=t.substring(h+d,c-d+1),c++):(i=null,o=e===m.SET?"tagName":"compoName",l=t.substring(p,c)),p=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(t){return function(e){return u(e,t)}}function u(t,e,n){if("string"!=typeof t)return!1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return!1;if(n>0&&t.charCodeAt(n-1)>32)return u(t,e,n+1);var r=t.length,o=e.length;return r-o>n&&t.charCodeAt(n+o)>32?u(t,e,n+1):!0}function a(t,e,n){for(var r,o=!1,i=!1;n>e&&(r=t.charCodeAt(e),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)e++;return e}function c(t,e,n){"string"==typeof e&&(null==n&&(n=m[t.compoName?"CONTROLLER":"SET"]),e=l(e,n));var r=e.prop?t[e.prop]:t,o=!1;if(null==r)return!1;if("function"==typeof e.selector?o=e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key])&&(o=!0):r[e.key]===e.selector&&(o=!0),o===!0&&null!=e.filters)for(var i,s=0,u=e.filters.length;u>s;s++)if(i=e.filters[s],c(t,i,n)===!1)return!1;return o}function f(t,e){if(null==e)return t;for(var n,r=[],o=0,i=t.length;i>o;o++)n=t[o],c(n,e)&&r.push(n);return r}function h(t,e,n){if(null==t)return n;if(null==n&&(n=[]),t instanceof Array){for(var r=0,o=t.length;o>r;r++)h(t[r],e,n);return n}c(t,e)&&n.push(t);var i=t[e.nextKey];return null!=i&&h(i,e,n),n}function d(t,e){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:e};for(var i in t)1===r[i]&&(o[i]=t[i]);t.attr&&(o.attr=n({},t.attr));var l=t.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=d(s===!0?l[a]:l,o)}return o}function p(t){for(var e,n=t;null!=n;)e=n,n=n.nodes&&n.nodes[0];return e}function g(t,e,n,r){if(m.TEXTNODE===t.type)return"function"==typeof t.content?t.content("node",e,n,null,r):t.content;var o="";if(null!=t.nodes)for(var i,l=0,s=t.nodes.length;s>l;l++)i=t.nodes[l],o+=g(i,e,n,r);return o}function v(t){return this instanceof v==!1?new v(t):null==t?this:t.type===m.SET?t:this.add(t)}var m=t.Dom,y=t.render,b=t.parse,_=t.Utils.ensureTmplFn,x=(global.Compo||t.Compo||Compo).signal.emitIn,C=function(){function t(t,n){return t===n?(e=!0,0):1}var e=!1;return function(n){var r,o,i,l;if(e=!1,n.sort(t),e===!1)return n;for(r=[],o=0,i=0,l=n.length-1;l>o;)n[o++]===n[o]&&(r[i++]=o);for(;i--;)n.splice(r[i],1);return n}}(),w="parent",j="nodes",k="components",O="attr";return v.prototype={constructor:v,type:m.SET,length:0,components:null,add:function(t){var e,n;if("string"==typeof t&&(t=b(t)),i(t)){for(e=0,n=t.length;n>e;e++)this.add(t[e]);return this}"function"==typeof t&&null!=t.prototype.type&&(t={controller:t,type:m.COMPONENT});var r=t.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",t),this;if(r===m.FRAGMENT){var o=t.nodes;for(e=0,n=o.length;n>e;)this[this.length++]=o[e++];return this}if(r===m.CONTROLLER){if(null!=t.nodes&&t.nodes.length)for(e=t.nodes.length;0!==e;)t.nodes[--e].parent=t;null!=t.$&&(this.type=m.CONTROLLER)}return this[this.length++]=t,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(t,e,n,r){if(this.components=[],1===this.length)return y(this[0],t,e,n,r||this);null==n&&(n=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)y(this[o],t,e,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(t){var e;return e=v(t),e.prevObject=this,e},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(e){if(null!=e)return this.empty().append(e);if(arguments.length)return this;var n;if(0===this.length)n=new m.Node;else if(1===this.length)n=this[0];else{n=new m.Fragment;for(var r=0,o=this.length;o>r;r++)n.nodes[r]=this[r]}return t.stringify(n)},text:function(t,e,n){if("string"==typeof t&&1===arguments.length){for(var r,o=[new m.TextNode(t)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=g(r,t,e,n);return s}},r(["append","prepend"],function(t){v.prototype[t]=function(e){for(var n,r,o=v(e),i=0,l=this.length;l>i;i++){r=this[i],n=o.toArray();for(var s=0,u=n.length;u>s;s++)n[s].parent=r;r.nodes=null!=r.nodes?"append"===t?r.nodes.concat(n):n.concat(r.nodes):n}return this}}),r(["appendTo"],function(t){v.prototype[t]=function(t,e,n,r){return null==r&&(r=this),null!=t.nodeType&&"function"==typeof t.appendChild?(t.appendChild(this.render(e,n,null,r)),x(r,"domInsert"),this):(v(t).append(this),this)}}),function(){function t(t){for(var e,n,r=t.split(";"),o={},i=0,l=r.length;l>i;i++)n=r[i],e=n.indexOf(":"),o[n.substring(0,e).trim()]=n.substring(e+1).trim();return o}function o(t){var e=[],n=0;for(var r in t)e[n++]=r+":"+t[r];return e.join(";")}r(["add","remove","toggle","has"],function(t){v.prototype[t+"Class"]=function(e){var n,r,o,i,l,s=this.length,u=0;if("string"!=typeof e){if("remove"===t)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=e;else{for(l=" "+l+" ",null==n&&(n=e.split(" "),o=n.length),r=0;o>r;r++)if(n[r]){var a=l.indexOf(" "+n[r]+" ")>-1;if("has"!==t)a!==!1||"add"!==t&&"toggle"!==t?a!==!0||"remove"!==t&&"toggle"!==t||(l=l.replace(" "+n[r]+" "," ")):l+=n[r]+" ";else if(a)return!0}l=l.trim()}"has"!==t&&(i.attr["class"]=l)}return"has"===t?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(t){v.prototype[t]=function(n,r){if(!n)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],t){case"attr":case"prop":if(1===s){if("string"==typeof n)return o.attr[n];for(var u in n)o.attr[u]=e(n[u])}else 2===s&&(o.attr[n]=e(r));break;case"removeAttr":case"removeProp":o.attr[n]=null}return this}}),n(v.prototype,{tag:function(t){if("string"==typeof t){for(var e=0,n=this.length;n>e;e++)this[e].tagName=t;return this}return this[0]&&this[0].tagName
},css:function(e,n){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof e)return 0===u?null:"string"==typeof this[0].attr.style?t(this[0].attr.style)[e]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof e){if(null==l){this[a].attr.style=o(e);continue}r=t(l);for(i in e)r[i]=e[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=e+":"+n;continue}r=t(l),r[e]=n,this[a].attr.style=o(r)}}return this}})}(),n(v.prototype,{clone:function(){for(var t=[],e=0,n=this.length;n>e;e++)t[e]=d(this[0]);return v(t)},wrap:function(t){var e,n=v(t),r=[];if(0===n.length)return console.log("Not valid wrapper",t),this;for(var o=0,i=this.length;i>o;o++){e=i>0?n.clone():n,p(e[0]).nodes=[this[o]],r[o]=e[0];var l=this[o].parent&&this[o].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[o]){l.splice(s,1,r[o]);break}}return v(r)},wrapAll:function(t){var e=v(t);return 0===e.length?(console.error("Not valid wrapper",t),this):(this.parent().mask(e),p(e[0]).nodes=this.toArray(),this.pushStack(e))}}),r(["empty","remove"],function(t){v.prototype[t]=function(){for(var e,n=0,r=this.length;r>n;n++)e=this[n],"empty"!==t?"remove"!==t||null!=e.parent&&o(e.parent.nodes,e):e.nodes=null;return this}}),n(v.prototype,{each:function(t,e){for(var n=0;this.length>n;n++)t.call(e||this,this[n],n);return this},eq:function(t){return-1===t?this.slice(t):this.slice(t,t+1)},get:function(t){return 0>t?this[this.length-t]:this[t]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(t){v.prototype[t]=function(e){var n,r,o=[],i=null==e?null:l(e,this.type,"closest"===t?"up":"down");switch(t){case"filter":return v(f(this,i));case"children":for(n=0;this.length>n;n++)r=this[n],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(n=0;this.length>n;n++)r=this[n].parent,!r||r.type===m.FRAGMENT||i&&c(r,i)||o.push(r);C(o);break;case"closest":case"find":if(null==i)break;for(n=0;this.length>n;n++)h(this[n][i.nextKey],i,o);break;case"first":case"last":var s;for(n=0;this.length>n;n++)if(s="first"===t?n:this.length-n-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),v}(Mask),Cache=function(){function t(t){this.__cacheInfo=new e(t.cache)}function e(t){if(t.byProperty){var e=t.byProperty,n=e.indexOf("."),r=e.substring(0,n);switch(e=e.substring(n+1),r){case"model":case"ctx":break;default:return console.error('[CompoCache] - property accessor not valid - should be "[model/ctx].[accessor]"'),null}this.propObjName=r,this.propAccessor=e}return this.expire=t.expire,this}var n=0,r=0,o={};return t.prototype={__null:null,__value:null},e.prototype={prop:void 0,propObjName:null,propAccessor:null,expire:null,getKey:function(t,e){if(null==this.propAccessor)return"__value";var n,r,o=this.propObjName,i=this.propAccessor;return"model"===o&&(n=t),"ctx"===o&&(n=e),r=obj_getProperty(n,i),r===void 0?"__value":null==r?"__null":r}},{get controllerID(){return n},get modelID(){return r},cacheCompo:function(e,i,l,s){if(__cfg.allowCache!==!1){var u=o[l];null==u&&(u=o[l]=new t(s));var a=u.__cacheInfo;null!=a&&(u[a.getKey(e,i)]=s,n=i._id,r=i._model._id)}},getCompo:function(t,e,n){if(__cfg.allowCache!==!1){var r=o[n];if(null==r)return null;var i=r.__cacheInfo,l=r[i.getKey(t,e)];return null==l||null==l.__cached?null:l}},getCache:function(){return o}}}(),builder_build=function(){function t(t,o,i,l){if(l=e(l),null==l.components||0===l.components.length)return""+t;var s=t.firstChild,u=n(s),a={model:i._model.stringify(),ID:i._id},c={type:"m"},f=Meta.stringify(a,c),h=Meta.close(a,c);if(u){var d=r(u,"HTML");if(d){var p=r(d,"BODY");p?(p.insertBefore(new m(f),p.firstChild),p.appendChild(new m(h))):console.warn("Body not found")}return""+t}return f+(""+t)+h}function e(t,n){if(null==n&&(n={}),n.compoName=t.compoName,n.ID=t.ID,t.components){for(var r,o=[],i=t.components,l=0,s=i.length;s>l;l++)r=i[l],o.push(e(r));n.components=o}return n}function n(t,e){if(null==t)return null;if(t instanceof p==!1)return null;if(":document"===t.compoName)return t;if(null==e&&(e=0),4===e)return null;var r;return r=n(t.nextSibling,e),r?r:n(t.firstChild,++e)}function r(t,e){for(var n=t.firstChild;n&&n.tagName!==e;)n=n.nextSibling;return n}function o(t,e){if("object"==typeof t)return t;var n,r,o,l,u,a,c,f,h,d=0,p=t.length;for(n="up"===e?O:N;p>d;)u=t.charCodeAt(d),33>u||(a=s(t,d+1,p),46===u?(r="class",o=A,l=i(t.substring(d+1,a))):35===u?(r="id",o=A,l=t.substring(d+1,a)):91===u?(f=t.indexOf("=",d),-1===f&&console.error('Attribute Selector: should contain "="'),o=A,r=t.substring(d+1,f),u=t.charCodeAt(f+1),h=34===u||39===u?2:1,l=t.substring(f+h,a-h+1),a++):(o=null,r="tagName",l=t.substring(d,a).toUpperCase()),d=a,null!=c?(null==c.filters&&(c.filters=[]),c.filters.push({key:r,selector:l,prop:o})):c={key:r,prop:o,selector:l,nextKey:n,filters:null});return c}function i(t){return function(e){return-1!==l(e,t)}}function l(t,e,n){if(null==t)return-1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return-1;if(n>0&&t.charCodeAt(n-1)>32)return l(t,e,n+1);var r=t.length,o=e.length;return r-o>n&&t.charCodeAt(n+o)>32?l(t,e,n+1):n}function s(t,e,n){for(var r,o=!1,i=!1;n>e&&(r=t.charCodeAt(e),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)e++;return e}function u(t,e){"string"==typeof e&&(e=o(e));var n=e.prop?t[e.prop]:t,r=!1;if(null==n)return!1;if("function"==typeof e.selector?r=e.selector(n[e.key]):null!=e.selector.test?e.selector.test(n[e.key])&&(r=!0):n[e.key]===e.selector&&(r=!0),r===!0&&null!=e.filters)for(var i,l=0,s=e.filters.length;s>l;l++)if(i=e.filters[l],u(t,i)===!1)return!1;return r}function a(){}function c(t){this.doctype=t}function f(){}function h(t){this.tagName=t.toUpperCase(),this.attributes={}}function d(t){this.textContent=t}function p(t,e,n,r,o){var i,l,s,u,a=t.compoName||t.tagName,c=custom_Tags[a]||t.controller;if(null!=c&&(u=is_Function(c)?c.prototype.cache:c.cache),null!=u&&(i=Cache.getCompo(e,n,a,c)),null!=i)return this.compo=i,i.__cached&&(i.render=fn_empty),void 0;i=is_Function(c)?new c(e):c,null==i&&(i={model:t.model,modelRef:t.modelRef,container:t.container,mode:o.mode,modeModel:o.modeModel}),i.cache&&Cache.cacheCompo(e,n,a,i),this.compo=i,this.ID=this.compo.ID=++n._id,b===o.mode&&(i.mode=b),_===o.mode&&(i.mode=b),l=obj_extend(i.attr,t.attr),void 0!==l["x-mode"]&&(i.mode=l["x-mode"]),void 0!==l["x-mode-model"]&&(i.modeModel=l["x-mode-model"]),this.compoName=i.compoName=a,i.attr=l,i.parent=o,n.debug&&n.debug.breakOn===i.compoName,null==i.nodes&&(i.nodes=t.nodes);for(s in l)"function"==typeof l[s]&&(l[s]=l[s]("attr",e,n,r,o,s));return"function"==typeof i.renderStart&&i.renderStart(e,n,r),o&&(o.components||(o.components=[])).push(i),i.async===!0?(i.await(g(i,e,n,this)),void 0):(null!=i.tagName&&i.tagName!==t.compoName&&(i.nodes={tagName:i.tagName,attr:i.attr,nodes:i.nodes,type:1}),"function"==typeof i.render&&i.render(e,n,this,i),void 0)}function g(t,e,n,r,o){var i=r.appendChild(document.createComment(""));return function(){return v(t,e,n,i,o)}}function v(t,e,n,r,o){null!=t.tagName&&t.tagName!==t.compoName&&(t.nodes={tagName:t.tagName,attr:t.attr,nodes:t.nodes,type:1}),null!=t.model&&(e=t.model);var i=t.nodes,l=[];if(null!=i){for(var s=is_Array(i),u=s===!0?i.length:1,a=0,c=null,f=document.createDocumentFragment();u>a;a++)c=s===!0?i[a]:i,1===c.type&&"server:all"!==t.mode&&(c.attr["x-compo-id"]=t.ID),y(c,e,n,f,t,l);r.parentNode.insertBefore(f,r)}if(null==t.tagName){var h,d=t.handlers&&t.handlers.attr;for(var p in t.attr)h=null,d&&is_Function(d[p])&&(h=d[p]),null==h&&is_Function(custom_Attributes[p])&&(h=custom_Attributes[p]),null!=h&&h(node,t.attr[p],e,n,l[0],t)}if(t.onRenderEndServer&&t.onRenderEndServer(l,e,n,r.parentNode),null!=o&&o!==l){var g=o.length,v=l.length;for(j=-1;v>++j;)o[g+j]=l[j]}}function m(t){this.textContent=t||"",this.textContent&&(this.textContent=this.textContent.replace("<!--","").replace("-->",""))}function y(t,e,n,r,o,i){if(null==t)return r;if(null!=n._redirect||null!=n._rewrite)return r;var l,s,u,a,c=t.type;if(10===c||is_Array(t)){for(u=0,a=t.length;a>u;u++)y(t[u],e,n,r,o);return r}if(null==c&&(null!=t.tagName?c=1:null!=t.content&&(c=2)),15===c){var f=custom_Statements[t.tagName];return is_Function(f)?f(t,e,n,r,o,i):console.error("<mask: statement is undefined",t.tagName),r}if(1==c&&null!=custom_Tags[t.tagName]&&(c=4),1===c&&(":"===t.tagName[0]?(c=4,t.mode=x,t.controller=mock_TagHandler.create(t.tagName,null,x)):(r=E(t,e,n,r,o,i),i=null)),2===c)return T(t,e,n,r,o),r;if(4===c){l=document.createComponent(t,e,n,r,o),r.appendChild(l),r=l;var h=l.compo;if(null!=h){if(h.model&&o.model!==h.model){e=h.model;var d=n._model.tryAppend(h);-1!==d&&(l.modelID=d)}if(h.async)return l;if(h.render)return l;o=h,t=h,s=[]}}var p=t.nodes;if(null!=p)for(var g,v=is_Array(p),m=v===!0?p.length:1,b=0;m>b;b++)g=v===!0?p[b]:p,4===c&&1===g.type&&"server:all"!==o.mode&&(g.attr["x-compo-id"]=l.ID),y(g,e,n,r,o,s);if(r.nodeType===Dom.COMPONENT&&o.onRenderEndServer&&o.async!==!0&&o.onRenderEndServer(s,e,n,r,o),null!=i&&s&&i!==s)for(var b=0,_=s.length;_>b;b++)i.push(s[b]);return r}var b="server:all",_="server:children",x="client",C="none",w=function(){function t(t,e){this._models={},this._id=e||0,this.append(t)}return t.prototype={append:function(t){if(null===t)return-1;var e="m"+ ++this._id;return this._models[e]=t,e},tryAppend:function(t){if(b===t.mode)return-1;if(C===t.modeModel)return-1;var e;void 0!==t.modelRef&&(e={__ref:t.modelRef}),null==e&&(e=t.model);var n="m"+ ++this._id;return this._models[n]=e,n},stringify:function(){return Class.stringify(this._models)}},t}();obj_extend(Dom,{DOCTYPE:11});var k={area:1,base:1,br:1,col:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,menuitem:1,meta:1,param:1,source:1,track:1,wbr:1},O="parentNode",N="firstChild",A="attributes";(function(){a.prototype={parentNode:null,firstChild:null,lastChild:null,nextSibling:null,get length(){for(var t=0,e=this.firstChild;null!=e;)t++,e=e.nextSibling;return t},get childNodes(){for(var t=[],e=this.firstChild;null!=e;)t.push(e),e=e.nextSibling;return t},querySelector:function(t){var e=t;"string"==typeof t&&(e=o(t));for(var n,r=this.firstChild;null!=r;r=r.nextSibling)if(u(r,e))return r;if(null!=r)return r;for(r=this.firstChild;null!=r;r=r.nextSibling)if("function"==typeof r.querySelector&&(n=r.querySelector(e),null!=n))return n;return null},appendChild:function(t){if(null==t)return t;if(t.nodeType===Dom.FRAGMENT){var e=t;if(null==e.firstChild)return e;for(var n=e.firstChild;;){if(n.parentNode=this,null==n.nextSibling)break;n=n.nextSibling}return null==this.firstChild?this.firstChild=e.firstChild:e.lastChild.nextSibling=e.firstChild,e.lastChild=e.lastChild,e}return null==this.firstChild?this.firstChild=this.lastChild=t:(this.lastChild.nextSibling=t,this.lastChild=t),t.parentNode=this,t},insertBefore:function(t,e){var n=this.firstChild;if(n!==e)for(;null!=n&&n.nextSibling!==e;)n=n.nextSibling;if(null==n)return this.appendChild(t);if(t.nodeType===Dom.FRAGMENT){var r=t,o=r.firstChild;if(null==o)return r;for(;null!=o;)o.parentNode=this,o=o.nextSibling;return n===e&&n===this.firstChild?(this.firstChild=r.firstChild,r.lastChild.nextSibling=n,r):(n.nextSibling=r.firstChild,r.lastChild.nextSibling=e,r)}return t.parentNode=this,n===e&&n===this.firstChild?(this.firstChild=t,t.nextSibling=n,t):(n.nextSibling=t,t.nextSibling=e,t)}}})(),c.prototype={constructor:c,nodeType:Dom.DOCTYPE,toString:function(){return this.doctype}},f.prototype=obj_inherit(f,a,{nodeType:Dom.FRAGMENT,toString:function(){for(var t=this.firstChild,e="";null!=t;)e+=""+t,t=t.nextSibling;return e}}),function(){function t(t){null==t.attributes,this.attr=t.attributes,this.className=this.attr["class"]||""}t.prototype={get length(){return this.className.split(/\s+/).length},contains:function(t){return-1!==l(this.className,t)},remove:function(t){var e=l(this.className,t);if(-1!==e){var n=this.className;this.className=this.attr["class"]=n.substring(0,e)+n.substring(e+t.length)}},add:function(t){-1===l(this.className,t)&&(this.className=this.attr["class"]=this.className+(""===this.className?"":" ")+t)}},h.prototype=obj_inherit(h,a,{nodeType:Dom.NODE,setAttribute:function(t,e){this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]},get classList(){return new t(this)},toString:function(){var t,e,n=this.tagName.toLowerCase(),r=this.attributes,o="<"+n;for(var i in r)t=r[i],o+=" "+i+'="'+("string"==typeof t?t.replace(/"/g,"&quot;"):t)+'"';var l=1===k[n],e=this.firstChild;if(null==e)return o+(l?"/>":"></"+n+">");for(o+=l?"/>":">",l&&(o+="<!--~-->");null!=e;)o+=""+e,e=e.nextSibling;return l?o+"<!--/~-->":o+"</"+n+">"},get value(){return this.attributes.value},set value(t){this.attributes.value=t},get selected(){return this.attributes.selected},set selected(t){return t?(this.attributes.selected="selected",void 0):(delete this.attributes.selected,void 0)},get checked(){return this.attributes.checked},set checked(t){return t?(this.attributes.cheched="cheched",void 0):(delete this.attributes.cheched,void 0)}})}(),function(){d.prototype={constructor:d,nodeType:Dom.TEXTNODE,nextSibling:null,toString:function(){return this.textContent?t(this.textContent):""}};var t=function(){function t(t){return e[t]}var e={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"};return function(e){return e.replace(/[&"'\<\>]/g,t)}}()}(),p.prototype=obj_inherit(p,a,{nodeType:Dom.COMPONENT,compoName:null,instance:null,components:null,ID:null,toString:function(){var t=this.firstChild,e=this.compo;if(void 0!==e.__cached)return console.log("from Cache size: ",e.__cached.length),e.__cached;var n,r,o,i=e.mode;null!=e&&(n=e.compoName,r=e.attr,i=e.mode,o=e.nodes);var l={ID:this.ID,modelID:this.modelID,compoName:n,attr:r,mask:"client"===i?mask.stringify(o,0):null},s={single:null==this.firstChild,type:"t",mode:i},u=Meta.stringify(l,s);if(null!=e.toHtml)u+=e.toHtml();else for(var t=this.firstChild;null!=t;)u+=""+t,t=t.nextSibling;return"client"!==i&&(u+=Meta.close(l,s)),e.cache&&(e.__cached=u),u}}),m.prototype={nextSibling:null,parentNode:null,toString:function(){return""===this.textContent?"":"<!--"+this.textContent.replace(/>/g,"&gt;")+"-->"}},document={createDocumentFragment:function(){return new f},createElement:function(t){return new h(t)},createTextNode:function(t){return new d(t)},createComment:function(t){return new m(t)},createComponent:function(t,e,n,r,o){return new p(t,e,n,r,o)}},function(){function t(){}custom_Tags[":document"]=t,t.prototype={isDocument:!0,mode:"server",render:function(t,e,n){var r=this.attr,o=this.nodes,i=r.doctype||"html";delete r.doctype,n.appendChild(new c("<!DOCTYPE "+i+">"));for(var l,s,u,a,f={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},h=0,d=o.length;d>h;h++)a=o[h],"head"!==a.tagName?"body"!==a.tagName?u=!0:s=a:l=a;if(null==s&&(s={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=l&&f.nodes.push(l),null!=s&&f.nodes.push(s),u)for(var a,h=0,d=o.length;d>h;h++)a=o[h],"head"!==a.tagName&&"body"!==a.tagName&&s.nodes.push(a);var p=this.parent;return p.components=[],y(f,t,e,n,p),n}}}();var S=function(){function t(n){if(null==n)return null;var r;if(n instanceof Array){r=[];for(var o=0,i=n.length;i>o;o++)r[o]=t(n[o]);return r}if("object"==typeof n){if(~e.indexOf(n))return"[object Circular]";e.push(n),r={};for(var l in n)r[l]=t(n[l]);return r}return n}var e;return function(n){return"object"==typeof n&&null!=n&&(e=[],n=t(n),e=null),n}}(),E=function(){var t=function(t){return function(e){try{return t.createElement(e)}catch(n){return console.error(e,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),null}}}(document);return function(e,n,r,o,i,l){var s=e.tagName,u=e.attr,a=t(s);if(null!=a){null!=l&&(l.push(a),u["x-compo-id"]=i.ID),null!=o&&o.appendChild(a);var c,f;for(c in u)is_Function(u[c])?(f=u[c]("attr",n,r,a,i,c),f instanceof Array&&(f=f.join(""))):f=u[c],f&&(is_Function(custom_Attributes[c])?custom_Attributes[c](e,f,n,r,a,i,o):a.setAttribute(c,f));return a}}}(),T=function(){var t=function(t){return function(e,n){e.appendChild(t.createTextNode(n))}}(document);return function(e,n,r,o,i){var l=e.content;if(is_Function(l)){var s=l("node",n,r,o,i);if("string"==typeof s)return t(o,s),void 0;for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(t(o,a),a=""),null==u.nodeType){a+=""+u;continue}o.appendChild(u)}return""!==a&&t(o,a),void 0}t(o,l)}}();return function(e,n,r,o,i){null==o&&(o=new f),null==i&&(i=new Dom.Component),null==r&&(r={}),r._model=new w(n,Cache.modelID),r._id=Cache.controllerID;var l;return y(e,n,r,o,i),r.async===!0?(r.done(function(){return r.page&&"tree"===r.page.query.debug?(r.resolve(JSON.stringify(S(o))),void 0):(l=t(o,n,r,i),r.resolve(l),void 0)}),null):r.page&&"tree"===r.page.query.debug?JSON.stringify(S(o)):l=t(o,n,r,i)}}(),Meta,mock_TagHandler;(function(){Meta=function(){function t(e){return"string"!=typeof e?t(JSON.stringify(e)):e}function e(t){if("#"===i[r]){r++;var e=i.indexOf(s);-1===e&&(e=i.length),t.ID=parseInt(i.substring(r,e),10),r=e}}function n(t){if(r>o-5)return!1;if(i[r++]!==s||" "!==i[r++])return r=-1,!1;var e=r,n=i,l=n.indexOf(":",e),u=n.substring(e,l),a=n.indexOf(s+" ",l),c=n.substring(l+1,a);return"attr"===u&&(c=JSON.parse(c)),t[u]=c,r=a,!0}var r,o,i,l=30,s=String.fromCharCode(l),u="<!--",a="-->";return{stringify:function(e,n){switch(n.mode){case"server":case"server:all":return""}var r=n.type,o=n.single,i=u+r;e.ID&&(i+="#"+e.ID),i+=s+" ";for(var l in e)"ID"!==l&&null!=e[l]&&(i+=l+":"+t(e[l])+s+" ");return o&&(i+="/"),i+=a},close:function(t,e){switch(e.mode){case"server":case"server:all":return""}return u+"/"+e.type+(t.ID?"#"+t.ID:"")+a},parse:function(t){r=0,i=t,o=t.length;var l={},s=t[r];for("/"===s&&(l.end=!0,r++),l.type=t[r++],e(l);n(l););return-1===r?{}:("/"===t[o-1]&&(l.single=!0),l)}}}();var t=function(){function t(t,e,n){this.meta={ID:n,name:t,value:e}}return t.prototype={toString:function(){var t=this.meta,e={type:"a",single:!0};return Meta.stringify(t,e)}},{create:function(e,n,r){return function(o,i,l,s,u,a,c){return"server"!==r&&c.insertBefore(new t(e,i,++s._id),u),"client"!==r?n(o,i,l,s,u,a):""}}}}();mock_TagHandler=function(){function t(){}return t.prototype={render:function(){},mode:"client"},{create:function(e,n,r){return"client"===r||"client"===n.prototype.mode?t:(n.prototype.mode=r,n)}}}();var e=function(){function t(t,e,n,r,o){this.meta={ID:o,utilType:t,utilName:e,value:n,attrName:r}}t.prototype={toString:function(){for(var t=this.meta,e={type:"u",single:null==this.firstChild},n=Meta.stringify(t,e),r=this.firstChild;null!=r;)n+=""+r,r=r.nextSibling;return null!=this.firstChild&&(n+=Meta.close(this)),n}};var e={node:"nodeRenderStart",attr:"attrRenderStart"};return{create:function(n,r,o){return function(i,l,s,u,a,c,f){if("server"!==o&&(u.parentNode.insertBefore(new t(f,n,i,c,++s._id),u),"partial"===o)){var h=e[f];if(is_Function(r[h]))return r[h](i,l,s,u,a)}return"client"!==o?r(i,l,s,u,a,c,f):""}}}}(),n=Mask.registerUtil;Mask.registerAttrHandler=function(e,n,r){if(null==r)return custom_Attributes[e]=n,void 0;if("string"==typeof r){var o=n;n=r,r=o}custom_Attributes[e]=t.create(e,r,n)},Mask.registerUtil=function(t,r,o){null==o&&is_Object(r)&&(o=r.mode),n(t,null==o?r:e.create(t,r,o))},Mask.registerUtility=Mask.registerUtil,Mask.registerHandler=function(t,e){return custom_Tags_defs.hasOwnProperty(t)&&obj_extend(e.prototype,custom_Tags_defs[t]),"client"===e.prototype.mode?(custom_Tags[t]=mock_TagHandler.create(t,e,"client"),void 0):(custom_Tags[t]=e,void 0)},Mask.compoDefinitions=function(t,e,n){var r=custom_Tags,o=custom_Tags_defs;for(var i in t)o[i]=t[i],void 0===r[i]?r[i]=mock_TagHandler.create(i,null,"client"):obj_extend(r[i].prototype,t[i]);for(var l in e)"client"===e[l].mode&&Mask.registerUtil(l,function(){},"client");for(var l in n)"client"===n[l].mode&&Mask.registerAttrHandler(l,function(){},"client")}})(),function(t){var e;(function(){function n(t){for(var e="";t--;)e+=" ";return e}function r(t,e,r){var i,l;null==e&&(e=0),null==r&&(i=!0,r=[]);var s=r.length;if(t.type===h.FRAGMENT&&(t=t.nodes),t instanceof Array)for(l=0;t.length>l;l++)o(t[l],e,r);else o(t,e,r);var u=n(e);for(l=s;r.length>l;l++)r[l]=u+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(t,e,n){if("string"==typeof t.content)return n.push(a(t.content)),void 0;if("function"==typeof t.content)return n.push(a(t.content())),void 0;if(l(t))return n.push(i(t)+";"),void 0;if(s(t)){var o=c?">":" > ";return n.push(i(t)+o),r(u(t),f,n),void 0}n.push(i(t)+"{"),r(t.nodes,f,n),n.push("}")}function i(t){var e=t.tagName,n=t.attr.id||"",r=t.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var o="";for(var i in t.attr)if("id"!==i&&"class"!==i){var l=t.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===e&&(n||r)&&(e="");var s="";return t.expression&&(s="("+t.expression+")"),e+n+r+o+s}function l(t){return null==t.nodes||t.nodes instanceof Array&&0===t.nodes.length}function s(t){return t.nodes&&(t.nodes instanceof Array==!1||1===t.nodes.length)}function u(t){return t.nodes instanceof Array?t.nodes[0]:t.nodes}function a(t){return-1===t.indexOf("'")?"'"+t.trim()+"'":-1===t.indexOf('"')?'"'+t.trim()+'"':'"'+t.replace(/"/g,'\\"').trim()+'"'}e=function(e,n){return null==e?"":("string"==typeof e&&(e=t.parse(e)),null==n?(f=0,c=!0):"number"==typeof n?(f=n,c=0===f):(f=n&&n.indent||4,c=0===f||n&&n.minimizeAttributes),r(e))};var c,f,h=t.Dom})(),t.stringify=e}(Mask),function(t){function e(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null},this.model=null,this.modelRef=null,this.nodes=null,this.parent=null,this.container=null,this.template=null}function n(t,e,n,r){null==t.nodes&&Compo.ensureTemplate(t);var l=t.attr.each||t.attr.foreach,s=obj_getPropertyEx(l,e,n,t),u=t.nodes;if(t.nodes=null,null!=s){"number"!=typeof s.length&&(s=obj_toDictionary(s)),t.nodes=[],t.model=s,t.modelRef=l,t.template=u,t.container=r;var a=s.length,c=-1;if(null!=a){for(;a>++c;)t.nodes[c]=o("%.each.item",u,s[c],c,r,t);t.append=i.append}}}function r(t,e,n,r){var i=t.attr.repeat.split(".."),l=+i[0],s=+i[1],u=t.nodes;(isNaN(l)||isNaN(s))&&console.error("Repeat attribute(from..to) invalid",t.attr.repeat),t.nodes=[];for(var a=-1;s>++a;)t.nodes[a]=o("%.repeat.item",u,e,a,r,t)}function o(t,e,n,r,o,i){return{type:Dom.COMPONENT,compoName:t,attr:{},nodes:e,model:n,container:o,parent:i,index:r}}t.registerHandler("%",e),e.prototype={renderStart:function(t,e,o){var i=this.attr;if(null!=i.each||null!=i.foreach)return n(this,t,e,o),void 0;if(null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],t,e,this.parent),this.state||(this.nodes=null),void 0;if(null!=i["else"]){var l=this.parent.components,s=l&&l[l.length-1];return null!=s&&"%"===s.compoName&&null!=s.attr["if"]?(s.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",s,this.parent),void 0)}if(null!=i.use){var u=i.use;return this.model=obj_getProperty(t,u),this.modelRef=u,void 0}if(null==i["debugger"]){if(null!=i.visible){var a=ExpressionUtil.eval(i.visible,t,e,this.parent);return a||(this.nodes=null),void 0}if(null!=i.log){var c=i.log,f=obj_getProperty(t,c);return console.log("Key: %s, Value: %s",c,f),void 0}null!=i.repeat&&r(this,t,e,o)}},render:null,renderEnd:null,append:null};var i={append:function(e){var n=new Component;n.nodes=this.template,n.model=e,t.render(n,e,null,this.container,this)}}}(Mask),function(t){function e(){}function n(){}function r(){}var o={};t.templates=o,t.registerHandler(":template",e),e.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},t.registerHandler(":import",n),n.prototype={constructor:n,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var t,e=this,n=":template[id="+this.attr.id+"]";null==t&&null!=(e=e.parent);)null!=e.nodes&&(t=jmask(e.nodes).filter(n).get(0));null!=t&&(this.nodes=t.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},t.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(t,e,n){var r=jmask(this.nodes).text(t,e,this);return r?n.insertAdjacentHTML?(n.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask),function(t,e){function n(t){return null!=t&&"object"==typeof t&&null!=t.length&&"function"==typeof t.splice}function r(t){if(null==t)return!1;for(var e,n=0,r=t.length,o=1,i=arguments.length,l=0;r>n;n++)for(e=t[n],o=1;i>o;o++)if(arguments[o]===e){t.splice(n,1),n--,r--,l++;break}return l+1===i}function o(t,e){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{__dirty:null},enumerable:!1});var n=t.__observers.__array;if(null==n&&(n=t.__observers.__array=[]),0===n.length)for(var r,o,i=0,l=["push","unshift","splice","pop","shift","reverse","sort","remove"],s=l.length;s>i;i++)o=l[i],r=t[o],null!=r&&(t[o]=u(t,r,o));n[n.length++]=e}function i(t,e){var n=t.__observers&&t.__observers.__array;if(null!=n)for(var r=0,o=n.length;o>r;r++)if(n[r]===e){n[r]=null;for(var i=r;o>i;i++)n[i]=n[i+1];o--,n.length--}}function l(t){null!=t.__observers&&(t.__observers.__dirty=!1)}function s(t){var e=t.__observers,n=e&&e.__array;if(null!=n&&e.__dirty===!0){for(var r,o=0,i=n.length;i>o;o++)r=n[o],"function"==typeof r&&r(t);e.__dirty=null}}function u(t,e,n){return function(){return a(t,e,n,$.call(arguments))}}function a(t,e,n,r){var o=t.__observers&&t.__observers.__array,i=e.apply(t,r);if(null==o||0===o.length)return i;if(null!=t.__observers.__dirty)return t.__observers.__dirty=!0,i;for(var l,s=0,u=o.length;u>s;s++)l=o[s],"function"==typeof l&&l(t,n,r,i);return i}function c(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n])}function f(t){return t.parentNode.removeChild(t)}function h(t){if(null!=t)for(var e=0,n=t.length;n>e;e++)f(t[e])}function d(t,e){return e.parentNode.insertBefore(t,e.nextSibling)}function p(t,e){return e.parentNode.insertBefore(t,e)}function g(t,e,n){if(null==t.components)return d(n,t.placeholder);for(var r,o=t.components,i=null,l=!0,s=o.length,u=e;s>u;u++)if(r=o[u].elements,r&&r.length){i=r[0];break}if(null==i)for(l=!1,u=s>e?e:s;--u>-1;)if(r=o[u].elements,r&&r.length){i=r[r.length-1];break}return null==i&&(i=t.placeholder),l?p(n,i):d(n,i)}function v(e,n,r,o,i){return t.render(n,r,o,i,e)}function m(t,e){if(null==t)return!1;h(t.elements),t.elements=null,null!=R&&R.dispose(t);var n=e&&e.components||t.parent&&t.parent.components;return null==n?(console.error("Parent Components Collection is undefined"),!1):r(n,t)}function y(t){null!=R&&R.signal.emitIn(t,"domInsert")}function b(t,e){if("function"==typeof t.dispose){var n=t.dispose;return t.dispose=function(){e.call(this),n.call(this)},void 0}t.dispose=e}function _(){}function x(){}function C(){}function w(t,e){if(null==e&&(e=[]),null==t.components)return e;for(var n,r=t.components,o=0,i=r.length;i>o;o++)n=r[o],"validate"!==n.compoName?w(n):e.push(n);return e}var j,k,O,N,A,S,E,T,D=global.jQuery||global.Zepto||global.$,R=e!==void 0?e:t.Compo||global.Compo,I=R.Dom.addEventListener,P=t.registerHandler,M=t.registerAttrHandler,L=t.registerUtil,$=Array.prototype.slice;(function(){function t(t,e){for(var n,r=-1,o=e.length-1;o>++r;)n=e[r],null==t[n]&&(t[n]={}),t=t[n];return t}function e(e,r,i,l){var s=l.length,a=s>1?t(e,l):e,c=l[s-1],f=a[c];return s>1&&u(e,l),"length"===c&&n(a)?(o(a,function(t,e,n,r){for(var o=i.length,l=-1;o>++l;)i[l](t,e,n,r)}),f):(Object.defineProperty(a,c,{get:function(){return f},set:function(t){var e=0,l=i.length;if(t!==f){if(f=t,n(t))for(e=0;l>e;e++)o(t,i[e]);if(null!=i.__dirties)return i.__dirties[r]=1,void 0;for(e=0;l>e;e++)i[e](t)}},configurable:!0}),f)}function u(t,e){for(var n,r=c(t),o="",i=0,l=e.length-1;l>i;i++)n=e[i],o+=n+".",a(o,t,n,r),t=t[n]}function a(t,e,n,r){var o,i=e[n];Object.defineProperty(e,n,{get:function(){return i},set:function(e){e!==i&&(o=i,i=e,r(t,o))},configurable:!0})}function c(t){return function(e,n){var r=t.__observers;if(null!=r)for(var o in r)if(0===o.indexOf(e)){var i=r[o].slice(0),l=i.length,s=0;if(0!==l){var u,a,c=j(t,o);for(s=0;l>s;s++)u=i[s],N(t,o,u),a=o.substring(e.length),N(n,a,u);for(s=0;l>s;s++)i[s](c);for(s=0;l>s;s++)O(t,o,i[s])}}}}function f(t,e,n){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{__dirty:null},enumerable:!1});var r=t.__observers;return null!=r[e]?r[e].push(n):r[e]=[n],r[e]}j=function(t,e){for(var n=e.split("."),r=n.length,o=-1;r>++o;){if(null==t)return null;t=t[n[o]]}return t},k=function(t,e,n){for(var r,o=e.split("."),i=o.length-1,l=-1;i>++l;)r=o[l],null==t[r]&&(t[r]={}),t=t[r];t[o[l]]=n},O=function(t,r,i){for(var l=r.split("."),s=l.length,u=-1,a=t;s>++u&&(a=a[l[u]],null!=a);)if(null!=a.__observers){var c=l.slice(u+1).join(".");if(a.__observers[c])return a.__observers[c].push(i),f(t,r,i),void 0}var h=f(t,r,i);1===h.length&&e(t,r,h,l,!0);var d=j(t,r);n(d)&&o(d,i)},N=function(t,e,o){for(var l=e.split("."),s=l.length,u=-1,a=t;s>++u&&(a=a[l[u]],null!=a);)if(null!=a.__observers){N(a,l.slice(u).join("."),o);break}if(null!=t.__observers&&null!=t.__observers[e]){var c=j(t,e);if(2===arguments.length)return t.__observers[e].length=0,void 0;r(t.__observers[e],o),n(c)&&i(c,o)}},A=function(t){if(n(t))return l(t),void 0;var e=t.__observers;null!=e&&(e.__dirties={})},S=function(t){if(n(t))return s(t),void 0;var e=t.__observers,r=null==e?null:e.__dirties;if(null!=r){for(var o in r){var i=t.__observers[o],l=j(t,o);if(null!=i)for(var u=0,a=i.length;a>u;u++)i[u](l)}e.__dirties=null}},E=function(t,e){if(null==e)return t;null==t&&(t={});for(var n in e)t[n]=e[n];return t},T=function(t,e){if(null==t)return!1;for(var n=e.split("."),r=n.length,o=-1;r>++o;)if(null==(t=t[n[o]]))return!1;return!0}})();var F,U,H,z,q,B;(function(){var e=t.Utils.Expression,r=e.eval;q=e.parse,B=e.varRefs,F=function(t,e,n,o){if("."===t)return e;var i=r(t,e,n,o);return null==i?"":i},U=function(t,e,i,l,s){if("."===t)return n(e)&&o(e,s),void 0;var u,a=q(t),c=B(a);if(null!=c){if("string"==typeof c)return T(e,c)&&(u=e),null==u&&T(l,c)&&(u=l),null==u&&(u=e),O(u,c,s),void 0;for(var f,h=null!=c.length&&"function"==typeof c.splice,d=h===!0?c.length:1,p=0;d>p;p++)if(f=h?c[p]:c,null!=f){if("object"==typeof f){if(u=r(f.accessor,e,i,l),null==u||"object"!=typeof u){console.error("Binding failed to an object over accessor",f);continue}f=f.ref}else u=T(e,f)?e:T(l,f)?l:e;null!=f&&"$c"!==f&&O(u,f,s)}}},H=function(t,e,n,o){if("function"==typeof n&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===t)return i(e,o),void 0;var l,s=B(t);if(null!=s){if("string"==typeof s)return T(e,s)&&N(e,s,o),T(n,s)&&N(n,s,o),void 0;for(var l,u=null!=s.length&&"function"==typeof s.splice,a=u===!0?s.length:1,c=0;a>c;c++)if(l=u?s[c]:s,null!=l)if("object"!=typeof l)T(e,l)&&N(e,l,o),T(n,l)&&N(n,l,o);else{var f=r(l.accessor,e,null,n);f&&N(f,l.ref,o)}}},z=function(t,e,n,r,o){var i=0;return function(){if(i++>10)return console.warn("Concurent binder detected",t),void 0;var l=F(t,e,n,r);if(arguments.length>1){var s=$.call(arguments);s[0]=l,o.apply(this,s)}else o(l);i--}}})();var J,X;(function(){J=function(t,e,n){for(var r,o,i,l,s=t.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(i=2==r.length?r[0]:n,o=r[2==r.length?1:0],l=X(o.trim(),i,e),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u},X=function(t,e,n){if(n!==!0)return{signal:t,type:e};var r=t.indexOf(".");return-1===r?(console.error("No pipe name in a signal",t),null):{signal:t.substring(r+1),pipe:t.substring(0,r),type:e}}})();var W=function(){function e(t,e,n,r){null==r&&(r=":bind"===n.compoName?"single":"dual");
var o,l=n.attr;if(this.node=n,this.controller=n,this.model=t,this.element=e,this.value=l.value,this.property=l.property,this.setter=l.setter,this.getter=l.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(e.tagName){case"INPUT":if(o=e.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=i.SELECT;break;default:this.property="element.innerHTML"}if(l.log&&(this.log=!0,"log"!==l.log&&(this.logExpression=l.log)),l["x-signal"]){var s=J(l["x-signal"],null,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["signal_"+u+"Changed"]=s.signal;break;default:console.error("Signal typs is not supported",s)}}if(l["x-pipe-signal"]){var s=J(l["x-pipe-signal"],!0,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["pipe_"+u+"Changed"]=s;break;default:console.error("Pipe type is not supported")}}if(l["dom-slot"]){this.slots={};var a=n.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[l["dom-slot"]]=function(t,e){this.domChanged(t,e)}}var f=l["object-pipe-slot"]||l["x-pipe-slot"];if(f){var h=f,d=h.indexOf("."),p=h.substring(0,d),s=h.substring(d+1);this.pipes={},this.pipes[p]={},this.pipes[p][s]=function(){this.objectChanged()},R.pipe.addController(this)}if(l.expression){if(this.expression=l.expression,null==this.value&&"single"!==r){var g=B(this.expression);"string"==typeof g?this.value=g:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function n(t){var e=t.expression,n=t.model,r=t.objectChanged=t.objectChanged.bind(t);if(t.binder=z(e,n,t.cntx,t.node,r),U(e,n,t.cntx,t.node,t.binder),"dual"===t.bindingType){var o=t.node.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=t.element,l=o["change-event"]||o.changeEvent||"change",s=t.domChanged.bind(t);I(i,l,s)}if(!t.objectWay.get(t,t.expression))return setTimeout(function(){t.domWay.get(t)&&t.domChanged()}),t}return t.objectChanged(),t}function r(t,e,n){var o=t.slots;(null==o||"function"!=typeof o[e]||o[e].apply(t,n)!==!1)&&null!=t.parent&&r(t.parent,e,n)}var o={};t.registerBinding=function(t,e){o[t]=e},t.BindingProvider=e,e.create=function(t,n,r,i){var l,s=r.attr.bindingProvider,u=null==s?null:o[s];return"function"==typeof u?new u(t,n,r,i):(l=new e(t,n,r,i),null!=u&&E(l,u),l)},e.bind=function(t){return n(t)},e.prototype={constructor:e,dispose:function(){H(this.expression,this.model,this.controller,this.binder)},objectChanged:function(t){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==t&&(t=this.objectWay.get(this,this.expression)),this.domWay.set(this,t),this.log&&console.log("[BindingProvider] objectChanged -",t),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[t]),this.pipe_objectChanged){var e=this.pipe_objectChanged;R.pipe(e.pipe).emit(e.signal)}this.locked=!1}},domChanged:function(t,e){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var n=e||this.domWay.get(this),o=!0;if(this.node.validations)for(var i,l=0,s=this.node.validations.length;s>l;l++)if(i=this.node.validations[l],i.validate(n,this.element,this.objectChanged.bind(this))===!1){o=!1;break}if(o&&(this.dismiss=1,this.objectWay.set(this.model,this.value,n),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",n),this.signal_domChanged&&r(this.node,this.signal_domChanged,[n]),this.pipe_domChanged)){var u=this.pipe_domChanged;R.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(t,e){return F(e,t.model,t.cntx,t.controller)},set:function(t,e,n){k(t,e,n)}},domWay:{get:function(t){if(t.getter){var e=t.node.parent;return null==e||"function"!=typeof e[t.getter]?(console.error("Mask.bindings: Getter should be a function",t.getter,t),null):e[t.getter]()}return j(t,t.property)},set:function(t,e){if(t.setter){var n=t.node.parent;if(null==n||"function"!=typeof n[t.setter])return console.error("Mask.bindings: Setter should be a function",t.setter,t),void 0;n[t.setter](e)}else k(t,t.property,e)}}};var i={SELECT:{get:function(t){var e=t.element;return-1===e.selectedIndex?"":e.options[e.selectedIndex].getAttribute("name")},set:function(t,e){for(var n,r=t.element,o=0,i=r.options.length;i>o;o++)if(n=r.options[o],n.getAttribute("name")==e)return r.selectedIndex=o,void 0}}};return E(e,{addObserver:O,removeObserver:N}),e}();P(":visible",_),_.prototype={constructor:_,refresh:function(t,e){e.style.display=F(this.attr.check,t)?"":"none"},renderStart:function(t,e,n){this.refresh(t,n),this.attr.bind&&O(t,this.attr.bind,this.refresh.bind(this,t,n))}},function(){function t(){}P(":bind",t),t.prototype={constructor:t,renderStart:function(t,e,n){this.provider=W.create(t,n,this,"single"),this.provider.objectChanged()}}}(),P(":dualbind",x),x.prototype={constructor:x,renderStart:function(t,e,n,r){this.provider=W.create(e,r,this),this.provider.objectChanged()},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function n(){}function r(t,e){this.fn=t,this.message=e}function o(t,e,n){console.warn("Validate Notification:",t,e);var r=D(t).next("."+l);return 0===r.length&&(r=D("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(t)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(e).end().show()}function i(t){return D(t).next("."+l).hide()}var l="-validate-invalid";t.registerValidator=function(t,e){s[t]=e},P(":validate",n),n.prototype={constructor:n,attr:{},renderStart:function(t,e,o){if(this.element=o,this.attr.value){var i=n.resolveFromModel(t,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(t,e,n){null==e&&(e=this.element),this.attr&&(null==t&&this.attr.getter&&(t=j({node:this,element:e},this.attr.getter)),null==t&&this.attr.value&&(t=j(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(t),r&&!this.attr.silent)return this.notifyInvalid(e,r,n),!1;return this.makeValid(e),!0},notifyInvalid:function(t,e,n){return o(t,e,n)},makeValid:function(t){return i(t)},initValidators:function(){this.validators=[];for(var t in this.attr){switch(t){case"message":case"value":case"getter":continue}if(t in s!=!1){var e=s[t];this.validators.push(new r(e(this.attr[t],this),this.attr.message))}else console.error("Unknown Validator:",t,this)}}},n.resolveFromModel=function(t,e){return j(t.Validate,e)},n.createCustom=function(t,e){var o=new n;return o.element=t,o.validators=[new r(e)],o},r.prototype.validate=function(t){var e=this.fn(t);return e===!1?this.message||"Invalid - "+t:e},P(":validate:message",e({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(t){"string"==typeof t&&(t={message:t}),t.cancel||(t.cancel="cancel"),this.model=t},compos:{button:"$: button"},show:function(t,e){var n=this;this.model.message=t,this.compos.button.off().on(function(){n.hide(),e&&e()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(t){return function(e){return RegExp(t).test(e)}},unmatch:function(t){return function(e){return!RegExp(t).test(e)}},minLength:function(t){return function(e){return e.length>=parseInt(t,10)}},maxLength:function(t){return function(e){return e.length<=parseInt(t,10)}},check:function(t,e){return function(n){return F("x"+t,e.model,{x:n},e)}}}}(),P(":validate:group",C),C.prototype={constructor:C,validate:function(){for(var t,e=w(this),n=0,r=e.length;r>n;n++)if(t=e[n],!t.validate())return!1;return!0}},function(){function t(t,e,n){return t?null==e||""===e?t+" "+n:t.replace(e,n):n}function e(e,n,r,o,i){return function(n){switch(e){case"node":r.textContent=n;break;case"attr":var l,s,u=typeof r[i];if("boolean"===u)return o=r[i]=!!n,void 0;if("string"===u)return o=r[i]=t(r[i],o,n),void 0;l=r.getAttribute(i),s=t(l,o,n),r.setAttribute(i,s),o=n}}}function n(t,n,r,o,i,l,s,u){var a=e(u,n,i,t,s),c=z(n,r,o,l,a);U(n,r,o,l,c),b(l,function(){H(n,r,l,c)})}L("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(t,e,n,r,o){var i=F(t,e,n,o);return this.element=document.createTextNode(i),this.current=i},node:function(t,e,r,o,i){return n(this.current,t,e,r,this.element,i,null,"node"),this.element},attrRenderStart:function(t,e,n,r,o){return this.current=F(t,e,n,o)},attr:function(t,e,r,o,i,l){return n(this.current,t,e,r,o,i,l,"attr"),this.current}})}(),M("xx-visible",function(t,e,n,r,o,i){var l=z(e,n,r,i,function(t){o.style.display=t?"":"none"});U(e,n,r,i,l),b(i,function(){H(e,n,i,l)}),F(e,n,r,i)||(o.style.display="none")}),M("x-toggle","client",function(t,e,n,r,o,i){var l=e.substring(0,e.indexOf(":")),s=e.substring(l.length+1),u=B(s);"string"!=typeof u&&(u=u[0]),I(o,l,function(){var t=F(s,n,r,i);k(n,u,t)})}),M("x-class-toggle","client",function(t,e,n,r,o){var i=e.substring(0,e.indexOf(":")),l=e.substring(i.length+1).trim();I(o,i,function(){D(o).toggleClass(l)})}),function(t){function n(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}t.registerHandler("%%",n),function(){function e(t,e,r,o,i,l){var s;t.attr["if"]&&(s=n);var u=s(t,e,r,o,i,l);null!=u&&builder_build(u,e,r,o,i,l)}var n;(function(){n=function(t){return t.nodes}})(),t.registerStatement("+",e)}();var r=function(){var t={refresh:function(t){this.model=t,this.elements&&(h(this.elements),this.elements=[]),null!=R&&R.dispose(this),p(v(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){H(this.expr,this.originalModel,this,this.binder)}};return function(e,n,r,o){var i=e.attr.use;E(e,{expr:i,placeholder:document.createComment(""),binder:z(i,n,r,e,t.refresh.bind(e)),originalModel:n,model:F(i,n,r,e),dispose:t.dispose}),U(i,n,r,e,e.binder),o.appendChild(e.placeholder)}}(),o=function(){return function(t,e,n){function r(t){console.log("Logger > Key: %s, Value: %s",o,t)}var o=t.attr.log,i=z(o,e,n,t,r),l=F(o,e,n,t);U(o,e,n,t,i),b(t,function(){H(o,e,t,i)}),r(l)}}(),i=function(){function t(t,e){return function(){return t.apply(e,arguments)}}var e={refresh:function(t){(null!=this.elements||t)&&(null==this.elements?(p(v(this,this.template,this.model,this.cntx),this.placeholder),this.$=D(this.elements)):(null==this.$&&(this.$=D(this.elements)),this.$[t?"show":"hide"]()),this.onchange&&this.onchange(t))},dispose:function(){H(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(n,r,o,i){var l=n.attr["if"];E(n,{expr:l,template:n.nodes,placeholder:document.createComment(""),binder:z(l,r,o,n,t(e.refresh,n)),state:!!F(l,r,o,n)}),n.state||(n.nodes=null),U(l,r,o,n,n.binder),i.appendChild(n.placeholder)}}(),l=function(){var t={refresh:function(t){if(null!=this.elements||!t){if(null==this.elements)return p(v(this,this.template,this.model,this.cntx)),this.$=D(this.elements),void 0;null==this.$&&(this.$=D(this.elements)),this.$[t?"hide":"show"]()}}};return function(e,n,r,o){var i=e.parent.components,l=i&&i[i.length-1];return e.template=e.nodes,e.placeholder=document.createComment(""),null==l||"%%"!==l.compoName||null==l.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(l.onchange=t.refresh.bind(e),l.state&&(e.nodes=null),o.appendChild(e.placeholder),void 0)}}(),s=function(){function n(t,e){var n=[];if(null==e||"object"!=typeof e||null==e.length)return n;for(var r,o=0,i=e.length;i>o;o++){switch(r=e[o],typeof r){case"string":case"number":case"boolean":r=e[o]=Object(r)}n[o]=new s(t.template,r,t)}return n}function r(t,e){for(var n=t.components,r=0,o=n.length,i=0,l=null,s=null,u=null,a=document.createDocumentFragment(),c=[];o>r;r++)if(u=n[r],null!=u.elements&&0!==u.elements.length)for(i=0,l=u.elements.length;l>i;i++)s=u.elements[i],s.parentNode.removeChild(s);t:for(i=0,l=e.length;l>i;i++){for(r=0;o>r;r++)if(e[i]===n[r].model){c[i]=n[r];continue t}console.warn("No Model Found for",e[i])}for(r=0,o=c.length;o>r;r++)if(u=c[r],null!=u.elements&&0!==u.elements.length)for(i=0,l=u.elements.length;l>i;i++)s=u.elements[i],a.appendChild(s);t.components=c,p(a,t.placeholder)}function o(t,e,r,o,i){if(null!=e&&null!=r){var s=e,u=e+r;for(u>t.components.length&&(u=t.components.length);u>s;s++)m(t.components[s],t)&&(s--,u--)}if(null!=o&&i&&i.length){var a=new l,c=n(t,i),f=v(a,c),h=a.components;g(t,o,f),y(a),null==t.components&&(t.components=[]),t.components.splice.apply(t.components,[o,0].concat(h))}}function i(t,e){for(var n,r=t.components,o=r.length;--o>-1;)n=r[o],-1!==e.indexOf(n.model)&&m(n,t)}var l=t.Dom.Component,s=function(){function t(t,e,n){this.nodes=t,this.model=e,this.parent=n}var e=l.prototype;t.prototype={compoName:"%%.each.item",constructor:u,renderEnd:function(t){this.elements=t}};for(var n in e)t.prototype[n]=e[n];return t}(),u={append:function(e){var n=new s(this.template,e,this);t.render(n,e,null,this.container,this)}},a={refresh:function(t,e,l,s){var u,a,f=0;if(null==e){if(null!=this.components)for(f=0,a=this.components.length;a>f;f++)u=this.components[f],m(u,this)&&(f--,a--);return this.components=[],this.nodes=n(this,t),p(v(this,this.nodes),this.placeholder),c(this.components,y),void 0}for(a=t.length;a>f;f++)switch(u=t[f],typeof u){case"string":case"number":case"boolean":t[f]=Object(u)}switch(e){case"push":o(this,null,null,t.length,t.slice(t.length-1));break;case"pop":o(this,t.length,1);break;case"unshift":o(this,null,null,0,t.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var h=l[0],d=1===l.length?this.components.length:l[1],g=l.length>2?t.slice(l[0],l.length-2+l[0]):null;o(this,h,d,h,g);break;case"sort":case"reverse":r(this,t);break;case"remove":null!=s&&s.length&&i(this,s)}},dispose:function(){H(this.expr,this.model,this,this.refresh)}};return function(t,r,o,i){null==t.nodes&&e!==void 0&&e.ensureTemplate(t);var l=t.attr.each||t.attr.foreach,s=F(l,r,o,t);E(t,{expr:l,binder:z(l,r,o,t,a.refresh.bind(t)),template:t.nodes,container:i,placeholder:document.createComment(""),dispose:a.dispose}),i.appendChild(t.placeholder),U(t.expr,r,o,t,t.binder);for(var c in u)t[c]=u[c];t.nodes=n(t,s)}}(),u=function(){var t={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var t=F(this.expr,this.model,this.cntx,this),e=0,n=this.elements.length;n>e;e++)this.elements[e].style.display=t?"":"none";this.refreshing=!1}},dispose:function(){H(this.expr,this.model,this,this.binder)}};return function(e,n,r){var o=e.attr.visible;E(e,{expr:o,binder:z(o,n,r,e,t.refresh.bind(e)),dispose:t.dispose}),U(o,n,r,e,e.binder),t.refresh.call(e)}}();n.prototype={constructor:n,elements:null,renderStart:function(t,e,n){var u=this.attr;if(null==u["debugger"])return null!=u.use?(r(this,t,e,n),void 0):null!=u.log?(o(this,t,e,n),void 0):(this.model=t,null!=u["if"]?(i(this,t,e,n),void 0):null!=u["else"]?(l(this,t,e,n),void 0):((null!=u.each||null!=u.foreach)&&s(this,t,e,n),void 0))},render:null,renderEnd:function(t){this.elements=t,null!=this.attr.visible&&u(this,this.model,this.cntx)}}}(t)}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask}),function(t,e){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=e(t)}(this,function(t){"use strict";function e(){return null==g&&(g=new m(y)),g}var n,r,o,i,l=t.mask||Mask,s=!0;(function(){function t(t){for(var e,n,r=t.trim().split(/\s+/),o=r.length,i=-1;o>++i;)if(n=r[i],0!==n.length&&(e=n[0],'"'===e||"'"===e))for(var l=i;o>i;i++)if(n=r[i],n[n.length-1]===e){var s=r.splice(l,i-l+1).join(" ").slice(1,-1);r.splice(l,0,s),o=r.length;break}return r}function e(t){for(var e,n,r,o=t.length,i=0,l={},s=[];o>i;i++)r=t[i],"-"!==r[0]?s.push(r):(e=r.replace(/^[\-]+/,""),o-1>i&&"-"!==t[i+1][0]?(n=t[i+1],i++):n=!0,l[e]=n);return{path:s,query:l}}n=function(t){for(var e=t.length,n=0,r=e-1;e>n&&"/"===t[n];n++);for(;r>n&&"/"===t[r];r--);return t.substring(n,r+1)},r=function(t){return t=n(t),""===t?[]:t.split("/")},o=function(t){return"/"+t.join("/")},i=function(n){"string"==typeof n&&(n=t(n));var r=e(n);return d(r)}})();var u,a;(function(){u=function(t,e){null==e&&(e="/");for(var n,r={},o=t.split(e),i=0,l=o.length;l>i;i++)n=o[i].split("="),r[n[0]]=null==n[1]?"":decodeURIComponent(n[1]);return r},a=function(t,e){null==e&&(e="/");var n,r="";for(n in t)r=(r?e:"")+n+"="+encodeURIComponent(t[n]);return r}})();var c,f,h;(function(){c=function(t,e){return RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e)},f=function(t){if("^"===t[0])return RegExp(t);for(var e=t.split("|"),n=0,r=e.length;r>n;n++)e[n]="^"+e[n]+"$";return RegExp(e.join("|"))},h=function(t){var e=t.indexOf("("),n=t.lastIndexOf(")");if(-1===e||-1===n)return console.error("<ruta> Expected alias part with regexp",t),null;var r=t.substring(e+1,n);return{alias:t.substring(1,e),matcher:f(r)}}})();var d,p;(function(){d=function(t){var e=o(t.path);return null==t.query?e:e+"?"+a(t.query,"&")},p=function(t){var e=t.indexOf("?"),n=-1===e?t:t.substring(0,e);return{path:r(n),query:-1===e?null:u(t.substring(e+1),"&")}}})();var g,v=function(){function t(t,e){this.method=36===t.charCodeAt(0)?t.substring(1,t.indexOf(" ")).toUpperCase():null,null!=this.method&&(t=t.substring(this.method.length+2)),this.strict=s,this.value=e,this.definition=t,n(this,t)}function e(){this.routes=[]}var n,o;(function(){function t(t,e){for(var n in t)if(e.test(n))return t[n]}n=function(t,e){var n=e.charCodeAt(0);switch(n){case 33:t.strict=!0,e=e.substring(1);break;case 94:t.strict=!1,e=e.substring(1);break;case 40:var r=1,o=e.length-1;return 41!==e.charCodeAt(e.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),o++),t.match=RegExp(e.substring(r,o)),void 0}var i,l,s,u,a,c,h=e.split("/"),d=0,p=h.length,g=h[p-1];l=g.indexOf("?"),l>(1===p?-1:0)&&(i=g.substring(l+1),h[p-1]=g.substring(0,l));for(var v,m,y,b=!0,_=t.path=[];p>d;d++)if(s=h[d],""!==s){u=s.charCodeAt(0),c=s.charCodeAt(1),v=63===u,m=58===(v?c:u),a=0,v&&a++,m&&a++,0!==a&&(s=s.substring(a)),!v&&!b&&console.log("<ruta> strict part found after optional",e),v&&(b=!1);var x=s.indexOf("(");if(m&&-1!==x){var o=s.length-1;")"!==s[o]&&(o+=1),y=RegExp(f(s.substring(x+1,o))),s=s.substring(0,x)}v||m?m&&_.push({alias:s,matcher:y,optional:v}):_.push(s)}if(i){var C=t.query={};h=i.split("&"),d=-1,p=h.length;for(var w,j,k,O;p>++d;)k=h[d],O=k.indexOf("="),-1!==O?(w=k.substring(0,O),j=k.substring(O+1),40===j.charCodeAt(0)&&(j=RegExp(f(j))),C[w]=j):C[k]="";0===t.path.length&&(t.strict=!1)}},o=function(e,n){var o=n.indexOf("?"),i=-1===o?null:n.substring(o+1),l={path:n,params:null==i?{}:u(i,"&")};if(e.query)for(var s in e.query)if("?"===s[0]&&(s=s.substring(1)),":"===s[0]){var a=h(s),c=a.alias;l.params[c]=t(l.params,a.matcher)}if(-1!==o&&(n=n.substring(0,o)),null!=e.path)for(var f,d,p=r(n),g=e.path,v=g.length,m=p.length,y=0;m>y;y++)if(f=p[y],d=v>y?g[y]:null){if("string"==typeof d)continue;if(d.alias){l.params[d.alias]=f;continue}}return l}})();var i,l;return function(){function t(t,e){for(var n in t)if(e.test(n))return!0;return!1}i=function(t,e,n){for(var r,i=p(t),s=0,u=e.length;u>s;s++)if(r=e[s],l(i,r,n))return r.current=o(r,t),r;return null},l=function(e,n,r){if(null!=r&&null!=n.method&&n.method!==r)return!1;if(n.match)return n.match.test("string"==typeof e?e:d(e));if("string"==typeof e&&(e=p(e)),n.query){var o,i,l=e.query;if(null==l)return!1;for(o in n.query){i=n.query[o];var s=o[0];if(":"!==s){if("?"!==s)if("string"!=typeof i){if(i.test&&!i.test(l[o]))return!1}else{if(null==l[o])return!1;if(i&&l[o]!==i)return!1}}else{var u=h(o);if(null==u||t(l,u.matcher)===!1)return!1}}}var a=n.path,c=a.length;if(0===c)return n.strict?0===e.path.length:!0;for(var f,g=0,v=e.path.length;v>g;g++){if(f=a[g],g>=c)return n.strict!==!0;if("string"==typeof f){if(e.path[g]===f)continue;return!1}if(f.matcher&&f.matcher.test(e.path[g])===!1)return!1;if(f.optional)return!0;if(!f.alias)return!1}return c>g?a[g].optional===!0:!0}}(),t.prototype={path:null,query:null,value:null,current:null},e.prototype={add:function(e,n){return this.routes.push(new t(e,n)),this},get:function(t,e){return i(t,this.routes,e)},clear:function(){return this.routes.length=0,this}},e.parse=function(t,e){var r={};return n(r,t),o(r,e)},e}(),m=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var e=this;return e.listener=t,window.onhashchange=function(){e.changed(location.hash)},e}function e(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var e=this;return e.listener=t,e.initial=location.pathname,window.onpopstate=function(){return e.initial===location.pathname?(e.initial=null,void 0):(e.changed(),void 0)},e}function n(n,r){if(this.collection=n||new v,r){var o="hash"===r?t:e;this.emitter=new o(this)}null==this.emitter&&(this.emitter=new e(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function e(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){location.hash=t},changed:function(t){this.listener.changed(e(t))},current:function(){return e(location.hash)}}}(),function(){e.prototype={navigate:function(t){history.pushState({},null,t),this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),n.prototype={changed:function(t){var e=this.collection.get(t);e&&this.action(e)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},n)}(),y=new v,b={Collection:v,setRouterType:function(t){return null==g&&(g=new m(y,t)),this},setStrictBehaviour:function(t){s=t},add:function(t,n){return e(),y.add(t,n)},get:function(t){return y.get(t)},navigate:function(t){e().navigate(t)},current:function(){return e().current()},parse:v.parse,$utils:{pathFromCLI:i}};return function(){function t(t){t.preventDefault(),t.stopPropagation(),b.navigate(this.href)}l.registerAttrHandler("x-dynamic",function(e,n,r,o,i){i.onclick=t},"client")}(),b}),function(t){"use strict";function e(t,e){if("object"!=typeof t||null==e)return t;for(var n,r=t,o=e.split("."),i=o.length,l=0;i>l;l++)if(n=o[l],r=r[n],null==r)return r;return r}function n(t,e){for(var n in e)e[n]&&(t[n]=e[n]);return t}function r(t,n,r,o){if("function"==typeof n)return n(t)?t:null;if(r===void 0)return t==n?t:null;var i=null!=n?e(t,n):t,l=r,s=o;switch(l){case">":return i>s?t:null;case"<":return s>i?t:null;case">=":return i>=s?t:null;case"<=":return s>=i?t:null;case"!=":return i!=s?t:null;case"==":return i==s?t:null}return console.error("InvalidArgumentException: arr.js:check",arguments),null}function o(t){this.items=t}function i(t){o.prototype[t]=function(){var e=arguments.length,n=s[t](this.items,e>0?arguments[0]:null,e>1?arguments[1]:null,e>2?arguments[2]:null,e>3?arguments[3]:null);return n instanceof Array?(this.items=n,this):n}}var l=t.ruqq||(t.ruqq={}),s={where:function(t,e,n,o){var i=[];if(null==t)return i;for(var l,s=0,u=t.length;u>s;s++)l=t[s],null!=r(l,e,n,o)&&i.push(l);return i},each:Array.prototype.forEach!==void 0?function(t,e){return null==t?t:(t.forEach(e),t)}:function(t,e){if(null==t)return t;for(var n=0,r=t.length;r>n;n++)e(t[n]);return t},remove:function(t,e,n,o){for(var i=0,l=t.length;l>i;i++)null!=r(t[i],e,n,o)&&(t.splice(i,1),i--,l--);return t},invoke:function(){for(var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift(),r=[],o=0;e.length>o;o++)"function"==typeof e[o][n]?r.push(e[o][n].apply(e[o],t)):r.push(null);return r},last:function(t,e,n,o){if(null==t)return null;if(null==e)return t[t.length-1];for(var i=t.length;i>-1;--i)if(null!=r(t[i],e,n,o))return t[i];return null},first:function(t,e,n,o){if(null==e)return t[0];for(var i=0,l=t.length;l>i;i++)if(null!=r(t[i],e,n,o))return t[i];return null},any:function(t,e,n,o){for(var i=0,l=t.length;l>i;i++)if(null!=r(t[i],e,n,o))return!0;return!1},isIn:function(t,e){for(var n=0;t.length>n;n++)if(e==t[n])return!0;return!1},map:Array.prototype.map!==void 0?function(t,e){return null==t?[]:t.map(e)}:function(t,e){var n=[];if(null==t)return n;for(var r=0,o=t.length;o>r;r++)n.push(e(t[r],r));return n},aggr:function(t,e,n){for(var r=0,o=t.length;o>r;r++){var i=n(t[r],e,r);null!=i&&(e=i)}return e},select:function(t,e){if(null==t)return[];for(var n,r=[],o=0,i=t.length;i>o;o++)if(n=t[o],"string"==typeof e)r.push(n[e]);else if("function"==typeof e)r.push(e(n));else if(e instanceof Array){for(var l={},s=0;e.length>s;s++)l[e[s]]=t[o][e[s]];r.push(l)}return r},indexOf:function(t,e,n,o){for(var i=0,l=t.length;l>i;i++)if(null!=r(t[i],e,n,o))return i;return-1},count:function(t,e,n,o){for(var i=0,l=0,s=t.length;s>l;l++)null!=r(t[l],e,n,o)&&i++;return i},distinct:function(t,e){var n=[];if(null==t)return n;for(var r=0,o=t.length;o>r;r++){for(var i=!0,l=0;n.length>l;l++)if(e&&e(t[r],n[l])||null==e&&t[r]==n[l]){i=!1;break}i&&n.push(t[r])}return n},groupBy:function(t,e){for(var n,r,o,i=[],l=t.length,s=-1,u={};l>++s;)if(u[s]!==!0){for(o=t[s],n=[o],r=s;l>++r;)u[r]!==!0&&e(o,t[r])&&(u[r]=!0,n.push(t[r]));i.push(n)}return i}};s.each(["min","max"],function(t){s[t]=function(n,r){if(null==n)return null;for(var o=null,i=0,l=n.length;l>i;i++){var s=e(n[i],r);null!=o?"max"===t&&s>o?o=s:"min"===t&&o>s&&(o=s):o=s}return o}}),l.arr=function(t){return new o(t)},n(l.arr,s);for(var u in s)i(u)}("undefined"!=typeof window?window:global),function(t,e){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),null==t.net&&(t.net={}),t.net.Uri=e(t)}(this,function(){"use strict";function t(t){return t&&"object"==typeof t&&"function"==typeof t.combine}function e(){for(var t,e="",n=0,r=arguments.length;r>n;n++)t=arguments[n],t&&(e?("/"!==e[e.length-1]&&(e+="/"),e+="/"===t[0]?t.substring(1):t):e=t);return e}function n(t){return"/"===t[t.length-1]?t.substring(0,t.length-1):t}function r(t){var e,n=new p;for(e in t)"string"==typeof t[e]&&(n[e]=t[e]);return n}function o(t){return t.replace(/\\/g,"/").replace(/^\.\//,"").replace(/^(\w+):\/([^\/])/,"/$1:/$2")}function i(t){return d.test(t)&&"/"===t[0]?t.substring(1):t}function l(t){var e=c.exec(t.value);null==e&&"/"===t.value[0]&&(t.protocol="file"),null!=e&&(t.protocol=e[1],t.value=t.value.substring(e[0].length))}function s(t){if(null!=t.protocol){if("file"===t.protocol){var e=d.exec(t.value);return e&&(t.host=e[1],t.value=t.value.substring(t.host.length)),void 0}var n=t.value.indexOf("/",2);t.host=~n?t.value.substring(0,n):t.value,t.value=t.value.replace(t.host,"")}}function u(t){var e=t.value.indexOf("?");-1!==e&&(t.search=t.value.substring(e),t.value=t.value.substring(0,e))}function a(t){var e=f.exec(t.value),r=null==e?null:e[1];null!=r&&(t.file=r,t.value=t.value.substring(0,t.value.length-r.length),t.value=n(t.value),e=h.exec(r),t.extension=null==e?null:e[1])}var c=/^([a-zA-Z]+):\/\//,f=/([^\/]+(\.[\w\d]+)?)$/i,h=/\.([\w\d]+)$/i,d=/(^\/?\w+:)\/[^\/]/,p=function(e){return null==e?this:t(e)?e.combine(""):(e=o(e),this.value=e,l(this),s(this),u(this),a(this),this.path=n(this.value),/^[\w]+:\//.test(this.path)&&(this.path="/"+this.path),this)};return p.prototype={cdUp:function(){return this.path?"/"===this.path?this:/^\/?[a-zA-Z]+:\/?$/.test(this.path)?this:(this.path=this.path.replace(/\/?[^\/]+\/?$/i,""),this):this},combine:function(o){if(t(o)&&(o=""+o),!o)return r(this);if(d.test(o))return new p(o);var i=r(this);if(i.value=o,u(i),a(i),!i.value)return i;if(o=i.value.replace(/^\.\//i,""),"/"===o[0])return i.path=o,i;for(;/^(\.\.\/?)/gi.test(o);)i.cdUp(),o=o.substring(3);return i.path=n(e(i.path,o)),i},toString:function(){var t=this.protocol?this.protocol+"://":"";return t+=e(this.host,this.path,this.file)+(this.search||""),this.file||this.search||(t+="/"),t},toPathAndQuery:function(){return e(this.path,this.file)+(this.search||"")},toRelativeString:function(t){if("string"==typeof t&&(t=new p(t)),0===this.path.indexOf(t.path)){var n=this.path?this.path.replace(t.path,""):"";return"/"===n[0]&&(n=n.substring(1)),e(n,this.file)+(this.search||"")}for(var r=this.path.split("/"),o=t.path.split("/"),i="",l=0,s=Math.min(r.length,o.length);s>l&&r[l]===o[l];l++);if(l>0&&(i=r.splice(0,l).join("/")),i){for(var u,a="",c=t.path;c;){if(0==this.path.indexOf(c)){u=this.path.replace(c,"");break}c=c.replace(/\/?[^\/]+\/?$/i,""),a+="../"}return e(a,u,this.file)}return""+this},toLocalFile:function(){var t=e(this.host,this.path,this.file);return i(t)},toLocalDir:function(){var t=e(this.host,this.path,"/");return i(t)},toDir:function(){var t=this.protocol?this.protocol+"://":"";return t+e(this.host,this.path,"/")},isRelative:function(){return!(this.protocol||this.host)},getName:function(){return this.file.replace("."+this.extension,"")}},p.combinePathes=e,p.combine=e,p}),function(){var t={};String.format=function(e){if(~e.indexOf("#{")){for(var n="",r=0,o=arguments[1];;){var i=e.indexOf("#{",r);if(-1==i)break;n+=e.substring(r,i);var l=e.indexOf("}",i);n+=Object.getProperty(o,e.substring(i+2,l)),r=++l}return n+=e.substring(r)}for(var s=1;arguments.length>s;s++){var u=t[s]||(t[s]=RegExp("%"+s,"g"));e=e.replace(u,arguments[s])}return e},Object.defaults=function(t,e){for(var n in e)null==t[n]&&(t[n]=e[n]);return t},Object.clear=function(t,e){if(e instanceof Array)for(var n,r=0,o=e.length;o>r;r++)n=e[r],n in t&&delete t[n];else if("object"==typeof e)for(var i in e)i in t&&delete t[i];return t},Object.extend=function(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)null!=e[n]&&(t[n]=e[n]);return t},Object.getProperty=function(t,e){if("."===e)return t;for(var n=t,r="string"==typeof e?e.split("."):e,o=-1,i=r.length;null!=n&&i>++o;)n=n[r[o]];return n},Object.setProperty=function(t,e,n){for(var r=e.split("."),o=t,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}o[i]=n},Object.lazyProperty=function(t,e,n){if("object"!=typeof e){for(var r=e.split("."),o=t,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}r=null,o.__defineGetter__(i,function(){return delete o[i],o[i]=n(),n=null,o[i]})}else for(var s in e)Object.lazyProperty(t,s,e[s])},Object.clone=function(t){if(null==t)return null;switch(typeof t){case"number":case"string":case"function":return t}if(t instanceof Array){for(var e=[],n=0,r=t.length;r>n;n++)e[n]=Object.clone(t[n]);return e}var o=t.constructor;if("function"==typeof o&&(o===String||o===Number||o===RegExp||o===Date))return new o(t);var i={};for(var l in t)i[l]=Object.clone(t[l]);return i},Object.observe=function(t,e,n){if(null==t.__observers&&Object.defineProperty(t,"__observers",{value:{},enumerable:!1}),t.__observers[e])return t.__observers[e].push(n),void 0;(t.__observers[e]||(t.__observers[e]=[])).push(n);var r=e.split("."),o=t,i=e;r.length>1&&(i=r.pop(),o=Object.getProperty(t,r));var l=o[i];Object.defineProperty(o,i,{get:function(){return l},set:function(n){l=n;for(var r=t.__observers[e],o=0,i=r.length;i>o;o++)r[o](n)}})},Date.format=function(t,e){function n(t){return t>9?t:"0"+t}e||(e="MM/dd/yyyy"),e=e.replace("MM",n(t.getMonth()+1));var r=t.getFullYear();return e.indexOf("yyyy")>-1?e=e.replace("yyyy",r):e.indexOf("yy")>-1&&(e=e.replace("yy",(""+r).substr(2,2))),e=e.replace("dd",n(t.getDate())),e.indexOf("HH")>-1&&(e=e.replace("HH",n(t.getHours()))),e.indexOf("mm")>-1&&(e=e.replace("mm",n(t.getMinutes()))),e.indexOf("ss")>-1&&(e=e.replace("ss",n(t.getSeconds()))),e},RegExp.fromString=function(t,e){return RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e)},Function.invoke=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return function(){return e[n].apply(e,t)}}}(),function(t){function e(){}function n(){}function r(t,e,n){if(t instanceof Array){for(var o,i=[],l=0,s=t.length;s>l;l++)o=r(t[l],e,n),t[l].tagName===u&&s-1>l&&t[l+1].tagName===a&&(l+=1,null==o&&(o=r(t[l].nodes,e,n))),null!=o&&(o instanceof Array?i=i.concat(o):i.push(o));
return i}if(null!=t.content)return{content:t.content,type:t.type};if(t.tagName===u){var c=t.attr.id?e[t.attr.id]:n;return c?null==t.nodes?c:r(t.nodes,e,c):null}var f={tagName:t.tagName||t.compoName,attr:t.attr,type:t.type,controller:t.controller};return t.nodes&&(f.nodes=r(t.nodes,e,n)),f}function o(t,e){if(null==e&&(e={}),t instanceof Array){for(var n=t,r=0,l=n.length;l>r;r++)o(n[r],e);return e}var u=t.tagName;if(null!=u&&u===s){var a=t.attr.id;!a&&console.error("@content has no id specified",t),e[a]&&console.error("@content already exists",a),e[a]=i(t)}return null!=t.nodes&&o(t.nodes,e),e}function i(t){for(var e,n=t.parent;null!=n&&n.tagName!==c;){var r={type:n.type,tagName:n.tagName,attr:n.attr,controller:n.controller,nodes:null};null==e?(e=r,e.nodes=t.nodes):e.nodes=[r],n=n.parent}return null!=e?e:t.nodes}var l=t.mask||Mask,s="@content",u="@placeholder",a="@else",c="layout:view",f="layout:master",h={};e.prototype={constructor:e,render:function(){h[this.attr.id]=this}},l.registerHandler(f,e),n.prototype={constructor:n,renderStart:function(){var t=h[this.attr.master];return null==t?(console.error("Master Layout is not defined for",this),void 0):(null==this.contents&&(this.contents=o(this.nodes),Object.keys&&0===Object.keys(this.contents).length&&console.warn("no contents: @content #someID")),this.nodes=r(t,this.contents).nodes,void 0)}},l.registerHandler(c,n)}(this),obj_extend(globals,this)}).call({},"undefined"!=typeof global?global:window);