(function(globals){function __eval(e,t){"use strict";t&&t.route.params;return eval.call(window,e)}function obj_extend(e,t){for(var n in t)null!=t[n]&&(null==globals[n]||"object"!=typeof globals[n]||"object"!=typeof t[n]?e[n]=t[n]:obj_extend(globals[n],t[n]))}/*!
 * ClassJS v%VERSION%
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, %YEAR% Atma.js and other contributors
 */
!function(e,t){"use strict";function n(){return t(o,r)}var r,o="undefined"==typeof window||null==window.navigator?global:window;return r=e||o,"function"==typeof define&&define.amd?define(n):(n(),void("undefined"!=typeof module&&(module.exports=r.Class)))}(this,function(e,t){"use strict";var n,r,o,l,u,s,a,c,f,h=Array.prototype.slice,p=Array.prototype.sort,d={ModelHost:null},m="__$class__";!function(){n=function(e){return"function"==typeof e},r=function(e){return null!=e&&"object"==typeof e},s=function(e){return null!=e&&"Date"===e.constructor.name&&e instanceof Date},o=function(e){return null!=e&&"number"==typeof e.length&&"function"==typeof e.slice},l=o,u=function(e){return"string"==typeof e},a=function(e){return"string"==typeof e&&""!==e},c=function(e){return null==e?!1:"object"!=typeof e?!1:e.constructor===Object},f=function(t){return void 0===t||t===e}}();var g,v,y;!function(){g=function(e,t){if(v(e))for(var n=0,r=e.length;r>n;n++)t(e[n],n);else t(e)},v=function(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice},y=function(e,t){for(var n=e.length,r=-1;++r<n;)t(e[r])===!0&&(e.splice(r,1),r--,n--)},"function"!=typeof Array.isArray&&(Array.isArray=function(e){return e instanceof Array?!0:null==e||"object"!=typeof e?!1:void 0!==e.length&&"function"==typeof e.slice})}();var _,b,x,w,C,j;!function(){function t(e,t){if(null==t||"object"!=typeof t)return t;var n=this,o=n[e];return o[m]&&o.toJSON?r(o[m],t):t}function r(e,t){var n={};return n.json=t,n[m]=e,n}function o(e,t){var n;return null!=t&&"object"==typeof t&&t[m]&&(n=Q(t[m]),"function"==typeof n?t=new n(t.json):console.error("<class:parse> Class was not registered",t[m])),t}function i(t,n){"function"==typeof t&&(t=t.prototype),null==n&&(n={});var r,o,l;for(o in t)if(l=t[o],r=null==l?null:typeof l,"function"!==r){var u=o.charCodeAt(0);if(!(95===u&&"_id"!==o||u>=65&&90>=u))if("object"!==r)n[o]=r;else{var s=l.constructor,a=s&&s.name;if("Object"!==a&&a&&e[a]===s){n[o]=a;continue}n[o]=i(l)}}return t.__proto__&&i(t.__proto__,n),n}_=function(e,t){R(d.ModelHost||Q.Model,e,t)},b=function(e){return T(d.ModelHost||Q.Model,e)},x=function(e,t){var r=u(e)?b(e):e;return!n(r)&&console.error("<class:patch> Not a Function",e),t.Base=r,r=Q(t),u(e)&&_(e,r),r},w=function(e){return JSON.stringify(e,t)},C=function(e){return JSON.parse(e,o)},j=function(e){return i(e)}}();var N,O,S;!function(){function e(e,t){if(null!=t){"function"==typeof e&&(e=e.prototype),"function"==typeof t&&(t=t.prototype);var n,r;for(n in t)"constructor"!==n&&(r=t[n],null!=r&&(e[n]=r))}}function t(e,t){var n;return n=e?function(t){var n=1===arguments.length&&f(t)?t:arguments;return z(e,this,n)}:q,function(){return this["super"]=n,z(t,this,arguments)}}function o(n,r,o,i,l,u){var a=i,c=i;a.constructor=n.prototype.constructor,null!=o&&(c[s]={},g(o,function(t){e(c[s],t)}),c=c[s]),null!=r&&(c[s]=r.prototype);for(var f in u)null==a[f]&&(a[f]=u[f]);for(var f in l)a[f]=t(a[f],l[f]);n.prototype=a}function i(n,r,o,i,l,u){if(null!=r){var s=function(){};s.prototype=r.prototype,n.prototype=new s,n.prototype.constructor=n}null!=o&&g(o,function(t){delete t.constructor,e(n,t)});var a=n.prototype;M(a,u);for(var c in l)a[c]=t(a[c],l[c]);e(n,i)}function u(e){return n(e)?e.prototype:e}var s="__proto__",a=Object.prototype.toString,f=function(e){return"[object Arguments]"===a.call(e)};N=s in Object.prototype?o:i,O=function(e,t){if(null!=t)if(l(t))for(var o=t.length;--o>-1;)O(e,t[o]);else{var i;n(t)?i=t:r(t.Static)&&(i=t.Static),null!=i&&I(e,i)}},S=function(e,t,n){var r,o;for(r in e)o=e[r],c(o)&&(null!=t&&c(t.prototype[r])&&M(o,t.prototype[r]),null!=n&&g(n,function(e){e=u(e),c(e[r])&&M(o,e[r])}))}}();var k,A,E="__$serialization";!function(){k=function(e){var t,n,r,o=this,i={};null==e&&(e=o[E]);var l;for(t in o)if(l=t,null!=e&&e.hasOwnProperty(t)&&(r=e[t],null!=r&&"object"==typeof r&&(r.key&&(l=r.key),r.hasOwnProperty("serialize")))){if(null==r.serialize)continue;i[l]=r.serialize(o[t])}else if(95!==t.charCodeAt(0)&&"Static"!==t&&"Validate"!==t&&(n=o[t],null!=n))if("_id"!==t){switch(typeof n){case"function":continue;case"object":if(s(n))break;var u=n.toJSON;if(null==u)break;i[l]=n.toJSON();continue}i[l]=n}else i[l]=n;return null!=o._id&&(i._id=o._id),i},A=function(){for(var e,t=this,n=t.length,r=0,o=new Array(n);n>r;r++){if(e=t[r],null!=e&&"object"==typeof e){var i=e.toJSON;if(i===k||i===A){o[r]=e.toJSON();continue}if(null==i){o[r]=k.call(e);continue}}o[r]=e}return o}}();var D,T,R,M,L,P,I,H;!function(){D=function(e){n(e)&&(e=e.prototype);for(var t,r,o=1,i=arguments.length;i>o;o++){t=n(arguments[o])?arguments[o].prototype:arguments[o];for(r in t)if("Static"!==r||null==e.Static)e[r]=t[r];else for(r in t.Static)e.Static[r]=t.Static[r]}return e},T=function(e,t){for(var n=t.split("."),r=n.length,o=-1;++o<r;){if(null==e)return null;e=e[n[o]]}return e},R=function(e,t,n){for(var r,o=t.split("."),i=o.length,l=-1;++l<i-1;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=n},M=function(e,t){for(var n in t)null==e[n]&&(e[n]=t[n]);return e},L=function(e,t){if(null==e&&(e={}),null==t)return e;var n,r;for(r in t)n=t[r],null!=n&&(e[r]=n);return e},function(){function e(e,r,o){if(null==e)return{};if(null==r)return r;var i,l;for(l in r)(o!==!0||null==e[l])&&(i=t(r,l),null!=i?void 0===i.value?n(e,l,i):e[l]=i.value:P(e,r.__proto__));return e}var t=Object.getOwnPropertyDescriptor,n=Object.defineProperty;return null==t?(P=L,void(I=M)):(P=function(t,n){return e(t,n,!1)},void(I=function(t,n){return e(t,n,!0)}))}(),function(){function e(e,n,i){var l,a,c,f;for(a in n)if(null==s||e!==i||s.hasOwnProperty(a)!==!1){switch(a.charCodeAt(0)){case 63://! accept falsy value
if(f=a.substring(1),c=e[f],!c)continue;if(l=t(c,n[a],i),null!=l)return l.setInvalidProperty(f),l;continue;case 45:if(f=a.substring(1),"object"==typeof e&&f in e)return o(f);continue}if(c=e[a],null==c)return r(a);if(l=t(c,n[a],i),null!=l)return l.setInvalidProperty(a),l}if(u)for(a in e)if(!(a in n||"?"+a in n))return o(a)}function t(t,o,u){if(null==o)return null;if("function"==typeof o){var s=o.call(u,t);return null==s||s===!0?null:s===!1?l():i(s)}if(null==t)return r();if("string"==typeof o){var a="string",c="number",f="boolean";switch(o){case a:return typeof t!==a||0===t.length?n(a):null;case c:return typeof t!==c?n(c):null;case f:return typeof t!==f?n(f):null}}if(o instanceof RegExp)return o.test(t)===!1?l():null;if(Array.isArray(o)){if(Array.isArray(t)===!1)return n("array");for(var s,h=-1,p=t.length;++h<p;)if(s=e(t[h],o[0]))return s.setInvalidProperty(h),s;return null}return typeof t!=typeof o?n(typeof t):"object"==typeof t?e(t,o):null}H=function(t){if(null==t)return l("object");s=null,u=!1;for(var n,r,o=arguments.length;--o>0;)switch(r=arguments[o],typeof r){case"string":null==s&&(s={}),s[r]=1;continue;case"boolean":u=r;continue;case"undefined":continue;default:if(1!==o)return l("validation argument at "+o);n=r;continue}return null==n&&(n=t.Validate),null==n?null:e(t,n,t)};var n,r,o,i,l,u=!1,s=null;!function(){function e(e,n,r){return r.type=e,r.property=null,r.setInvalidProperty=t,n.prototype=r,function(e){return new n(e)}}function t(e){return null==this.property?void(this.property=e):void(this.property=e+"."+this.property)}n=e("type",function(e){this.expect=e},{toString:function(){return"Invalid type."+(this.expect?" Expect: "+this.expect:"")+(this.property?" Property: "+this.property:"")}}),r=e("expect",function(e){this.property=e},{toString:function(){return"Property expected."+(this.property?"`"+this.property+"`":"")}}),o=e("unexpect",function(e){this.property=e},{toString:function(){return"Unexpected property"+(this.property?"`"+this.property+"`":"")}}),i=e("custom",function(e){this.error=e},{toString:function(){return"Custom validation: "+this.error+(this.property?" Property: "+this.property:"")}}),l=e("invalid",function(e){this.expect=e},{toString:function(){return"Invalid."+(this.expect?" Expect: "+this.expect:"")+(this.property?" Property: "+this.property:"")}})}()}()}();var F,$;!function(){function e(e,t,n){for(var r in t)n(T(e,r),t[r],r)}function t(e,t,n){for(var r in t)R(e,r,n(T(e,r),t[r],r))}function n(){var e=arguments;return function(t,n,r){for(var o,i=0,l=e.length;l>i;i++)if(o=e[i],o(t,n,r)===!1)return}}function r(e,t,n){return v(e)===!1?(console.warn("<patch> property is not an array",n),!1):void 0}function o(e,t){if(t.hasOwnProperty("$each"))for(var n=0,r=t.$each.length;r>n;n++)e.push(t.$each[n]);else e.push(t)}function i(e,t){e[t>0?"pop":"shift"]()}function l(e,t){y(e,function(e){return c(e,t)})}function u(e,t){return e+t}function s(e,t){return t}function a(){return void 0}F=function(e,t){for(var n in t){var r=p[n];r?r[f](e,t[n],r[h]):console.error("Unknown or not implemented patcher",n)}return e},$=function(e){if(null==e)return"Undefined";var t=!1;for(var n in e)if(t=!0,null==p[n])return"Unsupported patcher: "+n;return t===!1?"No data":null};var c;!function(){c=function(e,t){for(var n in t)if(e[n]!==t[n])return!1;return!0}}();var f=0,h=1,p={$push:[e,n(r,o)],$pop:[e,n(r,i)],$pull:[e,n(r,l)],$inc:[t,u],$set:[t,s],$unset:[t,a],$bit:[t,a]}}();var U,z,B,q,V;!function(){function e(e,t){if(e.length!==t.length)return!1;for(var n=e.length,r=0;n>r;r++)if(e[r]!==t[r])return!1;return!0}U=function(e,t){return function(){return z(e,t,arguments)}},z=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3]);case 5:return e.call(t,n[0],n[1],n[2],n[3],n[4])}return e.apply(t,n)},B=function(e){var t=h.call(arguments,1);return function(){return arguments.length>0&&(t=t.concat(h.call(arguments))),z(e,null,t)}},q=function(){},V=function(t,n){if(0===t.length)return 0;for(var r=n.length,o=-1;++o<r;)if(e(n[o],t))return o+1;return n.push(t),n.length}}();var W={};(function(){!function(e){function t(){this._callbacks=[]}function n(e){function n(e){return function(){i+=1,o[e]=Array.prototype.slice.call(arguments),i===l&&r.done(o)}}var r=new t,o=[];if(!e||!e.length)return r.done(o),r;for(var i=0,l=e.length,u=0;l>u;u++)e[u].then(n(u));return r}function r(e,n){var o=new t;return 0===e.length?o.done.apply(o,n):e[0].apply(null,n).then(function(){e.splice(0,1),r(e,arguments).then(function(){o.done.apply(o,arguments)})}),o}function o(e){var t="";if("string"==typeof e)t=e;else{var n=encodeURIComponent;for(var r in e)e.hasOwnProperty(r)&&(t+="&"+n(r)+"="+n(e[r]))}return t}function i(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return e}function l(e,n,r,l){function u(){d.abort(),m.done(f,"",d)}var d,m=new t,g=l&&l["Content-Type"]||p.contentType;try{d=i()}catch(v){return m.done(c,""),m}if(r)if("GET"===e)n+="?"+o(r),r=null;else switch(g){case s:r=o(r);break;case a:try{r=JSON.stringify(r)}catch(y){return m.done(h,""),m}default:r=o(r)}d.open(e,n),r&&d.setRequestHeader("Content-Type",g);for(var _ in l)l.hasOwnProperty(_)&&d.setRequestHeader(_,l[_]);var b=p.ajaxTimeout;if(b)var x=setTimeout(u,b);return d.onreadystatechange=function(){if(b&&clearTimeout(x),4===d.readyState){var e=!d.status||(d.status<200||d.status>=300)&&304!==d.status;m.done(e,d.responseText,d)}},d.send(r),m}function u(e){return function(t,n,r){return l(e,t,n,r)}}var s="application/x-www-form-urlencoded",a="application/json",c=1,f=2,h=3;t.prototype.then=function(e,n){var r;return this._isdone?r=e.apply(n,this.result):(r=new t,this._callbacks.push(function(){var t=e.apply(n,arguments);t&&"function"==typeof t.then&&t.then(r.done,r)})),r},t.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[]};var p={Promise:t,join:n,chain:r,ajax:l,get:u("GET"),post:u("POST"),put:u("PUT"),del:u("DELETE"),patch:u("PATCH"),ENOXHR:c,ETIMEOUT:f,E_PREPAIR_DATA:h,ajaxTimeout:0,contentType:a};"function"==typeof define&&define.amd?define(function(){return p}):e.promise=p}(this)}).call(W),g(["get"],function(e){W[e]=function(t,n){this.promise[e](t).then(function(e,t,r){return e?void n.onError(e,t,r):void n.onSuccess(t)})}}),g(["del","post","put","patch"],function(e){W[e]=function(t,n,r){this.promise[e](t,n).then(function(e,t,n){r(e,t,n)})}});var J;!function(){J=function(t){if(this===Q||null==this||this===e){var n=function(e){this[E]=L(this[E],t),J.call(this,e)};return n}null!=t&&(this.deserialize?this.deserialize(t):J.deserialize(this,t))},J.serialize=function(e){return n(e.toJSON)?e.toJSON():k.call(e,e[E])},J.deserialize=function(e,t){if(u(t))try{t=JSON.parse(t)}catch(i){return console.error("<json:deserialize>",t),e}if(o(t)&&n(e.push)){e.length=0;for(var l=0,s=t.length;s>l;l++)e.push(t[l]);return e}var a,c,f,h,p,d=e[E];if(null!=d){var m="__desAsKeys";if(a=d[m],null==a){a=d[m]={};for(f in d)"__desAsKeys"!==f&&d[f].hasOwnProperty("key")===!0&&(a[d[f].key]=f)}}for(f in t)h=t[f],c=f,e[c]=null!=d&&(p=d.hasOwnProperty(f)?d[f]:null,a[f]&&(c=a[f]),null!=p&&(r(p)&&(p=p.deserialize),u(p)&&(p=b(p)),n(p)))?h instanceof p?h:new p(h):h;return e}}();var X,K=function(){function e(e){this.route=r(e)}function t(e){var t=i.exec(e);return t?{optional:"?"===(t[2]||t[3]),parts:[t[1],t[4]]}:(t=l.exec(e))?{optional:"?"===t[3],parts:[t[1],t[4],t[5]]}:(console.error("Paths breadcrumbs should be matched by regexps"),{parts:[e]})}function n(e,n){for(var r=e.split(n),o=0,i=r.length;i>o;o++)r[o]=t(r[o]);return r}function r(e){var t=/[^\:\{]\?[^:]/.exec(e),r=null;return t&&(t=t.index+1,r=e.substring(t+1),e=e.substring(0,t)),{path:n(e,"/"),query:null==r?null:n(r,"&")}}function o(e,t,n){for(var r,o,i,l=[],u=0,s=e.length;s>u;u++)if(i=e[u],o=i.parts.slice(0),null!=o[1]){if(r=o[1],o[1]=t[r],null!=o[1])l.push(o.join(""));else if(!i.optional)return console.error("Object has no value, for not optional part - ",r),null}else l.push(o[0]);return l.join(n)}e.prototype={constructor:e,create:function(e){var t,n;return t=o(this.route.path,e,"/"),null==t?null:this.route.query&&(n=o(this.route.query,e,"&"),null==n)?null:t+(n?"?"+n:"")},hasAliases:function(e){for(var t,n=0,r=this.route.path.length;r>n;n++)if(t=this.route.path[n].parts[1],t&&null==e[t])return!1;return!0}};var i=/^([^:\?]*)(\??):(\??)([\w]+)$/,l=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return e}();!function(){function e(e,t,n,r){return null==r?e:(null!=t?z(r,e,t):n.push(r),e)}function t(e){e._done=null,e._fail=null,e._always=null}function n(e,t,n){if(null!=e){for(var r,o=e.length,i=-1;++i<o;)r=e[i],r&&z(r,t,n);e.length=0}}function r(e){return null==e||"object"!=typeof e?!1:e instanceof X?!0:"function"==typeof e.done&&"function"==typeof e.fail}X=function(){},X.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,defer:function(){this._rejected=null,this._resolved=null},isResolved:function(){return null!=this._resolved},isRejected:function(){return null!=this._rejected},isBusy:function(){return null==this._resolved&&null==this._rejected},resolve:function(){var e=this._done,r=this._always;return this._resolved=arguments,t(this),n(e,this,arguments),n(r,this,[this]),this},reject:function(){var e=this._fail,r=this._always;return this._rejected=arguments,t(this),n(e,this,arguments),n(r,this,[this]),this},resolveDelegate:function(){return U(this.resolve,this)},rejectDelegate:function(){return U(this.reject,this)},then:function(e,t){return this.pipe(e,t)},done:function(t){return null!=this._rejected?this:e(this,this._resolved,this._done||(this._done=[]),t)},fail:function(t){return null!=this._resolved?this:e(this,this._rejected,this._fail||(this._fail=[]),t)},always:function(t){return e(this,this._rejected||this._resolved,this._always||(this._always=[]),t)},pipe:function(e){function t(e,t,n){return function(){if(null!=n){var o=n.apply(this,arguments);if(null!=o)return r(o)===!0?void o.pipe(e):void e[t](o)}e[t].apply(e,arguments)}}var n;if("function"==typeof e){n=new X;var o=e,i=arguments.length>1?arguments[1]:null;return this.done(t(n,"resolve",o)).fail(t(n,"reject",i)),n}n=e;for(var l,u=arguments.length,s=1===u,a=1===u,c=0;++c<u;)switch(l=arguments[c]){case"done":s=!0;break;case"fail":a=!0;break;default:console.error("Unsupported pipe channel",arguments[c])}return s&&this.done(n.resolveDelegate()),a&&this.fail(n.rejectDelegate()),this},pipeCallback:function(){var e=this;return function(t){if(null!=t)return void e.reject(t);var n=h.call(arguments,1);z(e.resolve,e,n)}}},X.run=function(e,t){var n=new X;return null==t&&(t=n),e.call(t,n.resolveDelegate(),n.rejectDelegate(),n),n},X.create=function(e){return function(){var t=h.call(arguments),n=new X;return t.unshift(n),z(e,this,t),n}},X.memoize=function(e){var t={},n=[];return function(){var r=h.call(arguments),o=V(n,r);if(null!=t[o])return t[o];var i=t[o]=new X;return r.unshift(i),z(e,this,r),i}}}();var G;!function(){function e(){var e,t,n=h.call(arguments),r=n.shift(),o=this._listeners[r],i=0;if(null==o)return this;for(t=o.length;t>i;i++)e=o[i],z(e,this,n),e._once===!0&&(o.splice(i,1),i--,t--);return this}G=function(){this._listeners={}},G.prototype={constructor:G,on:function(e,t){return null!=t&&(this._listeners[e]||(this._listeners[e]=[])).push(t),this},once:function(e,t){return null!=t&&(t._once=!0,(this._listeners[e]||(this._listeners[e]=[])).push(t)),this},pipe:function(e){var t,n=this;return function(){t=h.call(arguments),t.unshift(e),z(n.trigger,n,t)}},emit:e,trigger:e,off:function(e,t){var n=this._listeners[e];if(null==n)return this;if(1===arguments.length)return n.length=0,this;for(var r=n.length,o=-1;++o<r;)n[o]===t&&(n.splice(o,1),o--,r--);return this}}}();var Y,Q=function(e){var t,n;if(u(e)){if(t=e,1===arguments.length)return b(e);n=arguments[1],n[m]=t}else n=e;var r=n.Base,i=n.Extends,l=n.Static,s=n.Construct,a=null,c=n.Store,h=n.Self,p=n.Override;return null!=r&&delete n.Base,null!=i&&delete n.Extends,null!=l&&delete n.Static,null!=h&&delete n.Self,null!=s&&delete n.Construct,null!=c&&(null==i?i=c:o(i)?i.unshift(c):i=[c,i],delete n.Store),null!=p&&delete n.Override,null==r&&null==i&&null==h?(void 0===n.toJSON&&(n.toJSON=k),a=null==s?function(){}:s,n.constructor=a.prototype.constructor,null!=l&&P(a,l),a.prototype=n,null!=t&&_(t,a),a):(a=function(){if(null!=i)for(var e=i instanceof Array,t=e?i.length:1,n=0,o=null;t>n;n++)o=e?i[n]:i,"function"==typeof o&&z(o,this,arguments);if(null!=r&&z(r,this,arguments),null!=h&&f(this)===!1)for(var l in h)this[l]=U(h[l],this);if(null!=s){var u=z(s,this,arguments);if(null!=u)return u}return this["super"]=null,this},null!=t&&_(t,a),null!=l&&P(a,l),null!=r&&O(a,r),null!=i&&O(a,i),S(n,r,i),N(a,r,i,n,p,{toJSON:k}),n=null,l=null,a)};!function(){function e(e,n,r){var o,i=t(e,n,!0);return r.done(function(){o=h.call(arguments),o.unshift(null),i.apply(null,o)}).fail(function(e){i(e)})}function t(e,t,r){null==r&&(r=!0),e._timeout&&clearTimeout(e._timeout),e.defer(),e._wait++,t&&(e._result||(e._result={}),t in e._result&&console.warn("<await>",t,"already awaiting"),e._result[t]=null);var o=B(n,e,t,r);return e._timeout=setTimeout(o,Y.TIMEOUT),o}function n(e,t,n){if(0===arguments.length)return e._wait=0,void e.reject("408: Timeout");if(0!==e._wait){var r=e._result;if(t){var o=h.call(arguments,3);r[t]={error:n?o.shift():null,arguments:o}}else n&&null!=arguments[3]&&(null==r&&(r=e._result={}),r.__error=arguments[3]);if(0===--e._wait){clearTimeout(e._timeout);var i,l,u=r&&r.__error;if(null==u)for(l in r)if(i=r[l],u=i&&i.error)break;if(u)return void e.reject(u,r);e.resolve(r)}}}Y=Q({Extends:X.prototype,_wait:0,_timeout:null,_result:null,_resolved:[],Construct:function(){for(var t,n=arguments.length,r=-1;++r<n;)t=arguments[r],null!=t&&"function"==typeof t.done&&e(this,null,t)},delegate:function(e,n){return t(this,e,n)},deferred:function(t){return e(this,t,new X)},Static:{TIMEOUT:2e3}})}();var Z,et,tt,nt,rt={fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(e){return(new this).fetch(e)}}};!function(){function e(e,n){return function(){var r=null==e._rejected,o=r?e._resolved:e._rejected,u=r?i:l;t([u,e,n].concat(o))}}function t(e){u.trigger.apply(u,e)}var n,r,o="start",i="fulfilled",l="rejected",u=new G;Z=function(e){u.on(o,e),n=!0},et=function(e,t){u.on(i,e).on(l,t),r=!0},tt=function(e){u.off(i,e).off(l,e).off(o,e)},nt=function(i){return X.prototype.defer.call(this),n&&t([o,this,i]),r&&this.always(e(this,i)),this}}(),Q.Remote=function(){function e(e,n){var r;try{r=JSON.parse(n)}catch(o){return void t(e,o)}e.deserialize(r),e.resolve(e)}function t(e,t,r){var o;if("string"==typeof t&&n(r))try{o=JSON.parse(t)}catch(i){o=i}e.reject(o||t)}function n(e){var t=e.getResponseHeader(u);return null!=t&&-1!==t.toLowerCase().indexOf(s)}function i(e,i,l){return function(u,s,a){if(n(a))try{s=JSON.parse(s)}catch(u){return console.error("<XHR> invalid json response",s),t(e,u,a)}if(i&&i(u,s),u)return t(e,s,a);if("save"===l&&r(s)){if(o(e))for(var c=e.length,f=s.length,h=-1;++h<c&&f>h;)J.deserialize(e[h],s[h]);else e.deserialize(s);return e.resolve(e)}e.resolve(s)}}function l(e){return new a(e)}var u="content-type",s="json",a=function(e){this._route=new K(e)};return D(a,rt,J,X,{defer:nt,serialize:function(){return o(this)?A.call(this):k.call(this)},deserialize:function(e){return J.deserialize(this,e)},fetch:function(e){return this.defer("fetch"),W.get(this._route.create(e||this),this),this},save:function(e){this.defer("save");var t=this.serialize(),n=this._route.create(this),r=this._route.hasAliases(this)?"put":"post";return W[r](n,t,i(this,e,"save")),this},patch:function(e){return this.defer("patch"),F(this,e),W.patch(this._route.create(this),e,i(this)),this},del:function(e){this.defer("del");var t=this.serialize(),n=this._route.create(this);return W.del(n,t,i(this,e)),this},onSuccess:function(t){e(this,t)},onError:function(e,n,r){t(this,n,r)}}),l.onBefore=Z,l.onAfter=et,g(["get","post","put","delete"],function(e){l[e]=function(t,n){var r=n;null!=n.serialize&&(r=n.serialize()),null==r&&n.toJSON&&(r=n.toJSON());var o=new X;return W[e](t,r,i(o)),o}}),l}(),Q.MongoStore=function(){function e(){return c?c:a?"mongodb://"+T+":"+R+"/"+a:null}function t(e){var t,n="_id",o=null;if(u(e))t=e;else if(r(e)&&(t=e.collection,o=e.indexes,null!=e.primaryKey)){n=e.primaryKey;var i={};i[n]=1,null==o&&(o=[]),o.push([i,{unique:!0}])}!t&&console.error("<MongoStore> should define a collection name",e),this._coll=t,this._indexes=o,this._primaryKey=n,null!=o&&P.add(t,o)}var l,s;!function(){l=function(e,t){var n;return function(r){r&&(n=r),0===--e&&t(n)}},s=function(e){return function(t){return t?e.reject(t):void e.resolve()}}}();var a,c,f,p,d,m,g,y,_,b,x,w,C,j,N,O,S,A,E,T="127.0.0.1",R=27017,M={auto_reconnect:!0,native_parser:!0,w:1},L=function(e){e.ip&&(T=e.ip),e.port&&(R=e.port),e.db&&(a=e.db),e.params&&(M=e.params),c=e.connection};!function(){var t,n,r,o,l,s,c,v,k;!function(){function e(e,t,n,r){function o(e){e&&(l=e),0===--s&&r(l)}var l,u=n.length,s=u;if(i=-1,0===u)return r();for(;++i<u;)e(t,n[i][0],n[i][1],o)}t=function(e,t,n,r){var o=R.collection(e);return null==n?o.findOne(t,r):void o.findOne(t,n,r)},n=function(e,t,n,r){function o(e,t){return e?r(e):void t.toArray(r)}var i=R.collection(e);return null==n?i.find(t,o):void i.find(t,n,o)},r=function(e,t,n,r){R.collection(e).update(t,n,u,r)},o=function(t,n,o){e(r,t,n,o)},l=function(e,t,n,r){R.collection(e).update(t,n,r)},s=function(t,n,r){e(l,t,n,r)},c=function(e,t,n){R.collection(e).remove(t,{justOne:!0},n)},v=function(e,t,n){R.collection(e).remove(t,{justOne:!1},n)},k=function(e,t,n){R.collection(e).count(t,n)};var u={upsert:!0,multi:!1}}();var D,T;!function(){function e(e){return null==e?{$query:{},$explain:!0}:e.$query?(e.$explain=!0,e):{$query:e,$explain:!0}}function i(t){return t.forEach(function(t){return[e(t[0]),t[1]]})}function u(e,t){return function(n,r){return g.count++,n?void g.errors.push(n):void a(e,t,r)}}function a(e,t,n,r){if(r=r||{},null!=n&&"number"!=typeof n){if(Array.isArray(n))return void n.forEach(function(n,o){r.isArray=!0,r.index=o,a(e,t,n,r)});if(n.clause)return void n.clause.forEach(function(n,o){r.isClause=!0,r.index=o,a(e,t,n,o)});if(null!=n.millis&&n.millis>=p)return void f("slow",e,t,n,r);if(null!=n.cursor)return-1!==n.cursor.indexOf("BasicCursor")?void f("unindexed",e,t,n,r):m&&m(n,e,t)?void f("custom",e,t,n,r):void 0}}function f(e,t,n,r,o){o.reason=e;var i={coll:t,query:n,plan:r,params:o};d&&d(i),g.slow.push(i)}var h=!1,p=50,d=null,m=null,g={count:0,slow:[],errors:[]},y=t,_=n,b=r,x=o,w=l,C=s,j=c,N=v,O=k;T=function(){return g},D=function(a,f){if(f&&(p=f.slow||p,d=f.onDetect||d,m=f.detector||m),h!==a){if(null==a&&(a=!!h),h=a,h===!1)return t=y,n=_,r=b,o=x,l=w,s=C,c=j,v=N,void(k=O);t=function(t,n,r){y.apply(null,arguments),y(t,e(n),r,u(t,n))},n=function(t,n,r){_.apply(null,arguments),_(t,e(n),r,u(t,n))},r=function(t,n,r){b.apply(null,arguments),b(t,e(n),r,u(t,n))},o=function(e,t){x.apply(null,arguments),x(e,i(t),u(e,t))},l=function(t,n,r){w.apply(null,arguments),w(t,e(n),r,u(t,n))},s=function(e,t){C.apply(null,arguments),C(e,i(t),u(e,t))},c=function(t,n){j.apply(null,arguments),j(t,e(n),u(t,n))},v=function(t,n){N.apply(null,arguments),N(t,e(n),u(t,n))},k=function(t,n){O.apply(null,arguments),O(t,e(n),u(t,n))}}}}(),E=T,A=D;var R,L;p=function(e,t){if(null==R)return P(H(p,e,t));var n=R.collection(e);return null==n?t("<mongo> Collection Not Found: "+e):void t(null,n)},O=function(e){var t=new Q.Deferred;return p(e,function(e,n){return e?t.reject(e):void t.resolve(n)}),t},f=function(e){return null==R?P(H(f,e)):void e(null,R)},S=function(){var e=new X;return f(function(t,n){return t?e.reject(t):void e.resolve(n)}),e},d=function(e,n,r){return null==R?P(H(d,e,n,r)):void t(e,I(n),null,r)},m=function(e,t,r,o){return null==R?P(H(m,e,t,r,o)):(null==r&&(r={}),void n(e,I(t),r,o))},g=function(e,t,n){return null==R?P(H(g,e,t,n)):void k(e,t,n)},y=function(e,t,n){return null==R?P(H(y,e,t,n)):void R.collection(e).insert(t,{safe:!0},n)},_=function(e,t,n){if(null==R)return P(H(_,e,t,n));if(null==t._id)return n("<mongo:update> invalid ID");var r={_id:w(t._id)};l(e,r,t,n)},b=function(e,t,n){var r=t.map(function(e){return[{_id:w(e._id)},e]});s(e,r,n)},C=function(e,t,n,r){if(null==R)return P(H(C,e,t,n,r));var o={_id:w(t)};l(e,o,n,r)},x=function(e,t,n,r){if(null==R)return P(x.bind(null,e,t,r));t=I(t);var o=n?c:v;o(e,t,r)},j=function(e,t,n){if(null==R)return P(H(j,e,t,n));var r=R.collection(e);return Array.isArray(t)?void r.ensureIndex(t[0],t[1],n):void r.ensureIndex(t,n)},w=function(e){return u(e)&&24===e.length?N().ObjectID(e):e},N=function(){return N=function(){return L},L=require("mongodb")};var P=function(){var t,n=[],r=!1;return function(o){function i(e,t){null==e&&(R=t);for(var o=n.length,i=-1;++i<o;)n[i](e);n.length=0,r=!1}return R?o():null==a?o('Database is not set. Call Class.MongoStore.settings({db:"myDbName"})'):(n.push(o),r?void 0:(N(),r=!0,(t=e())?void L.MongoClient.connect(t,M,i):o("<mongo> Invalid connection string")))}}(),I=function(e){if(null==e)return e;if(e.hasOwnProperty("$query")||e.hasOwnProperty("$limit"))return e;e.hasOwnProperty("_id")&&(e._id=w(e._id));var t={62:{0:"$gt",61:"$gte"},60:{0:"$lt",61:"$lte"}};for(var n in e){var r,o=e[n];if("string"==typeof o)switch(r=o.charCodeAt(0)){case 62:case 60:var i=t[r][0];61===o.charCodeAt(1)?(i=t[r][61],o=o.substring(2)):o=o.substring(1),e[n]={},e[n][i]=parseInt(o);continue}}return e},H=function(e){var t=h.call(arguments,1),n=t[t.length-1];return function(r){return r?n(r):(arguments.length>0&&(t=t.concat(arguments)),z(e,null,t))}}}();var P;!function(){function e(e,t,n){for(var r=-1,o=t.length,i=l(o,n);++r<o;)j(e,t[r],i)}function t(t){for(var i=(new X,o.length),u=l(i,t),s=-1;++s<i;)e(o[s][n],o[s][r],u)}P={add:function(e,t){o.push([e,t])},ensureAll:t,ensure:e};var n=0,r=1,o=[]}();var I=function(){function e(e){t.call(this,e)}D(e,rt,J,X,{fetch:function(e){return this._ensureFree()===!1?this:(d(this._coll,e,U(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;var e=this.serialize(),t=null==e._id?y:_;return t(this._coll,e,U(this._inserted,this)),this},del:function(){return this._ensureFree()===!1?this:(this._id?x(this._coll,{_id:this._id},!0,U(this._completed,this)):this._completed("<class:patch> `_id` is not defined"),this)},patch:function(e){if(this._ensureFree()===!1)return this;if(null==this._id)return this._completed("<class:patch> `_id` is not defined");var t=$(e);return null!=t?this._completed(t):(F(this,e),C(this._coll,this._id,e,U(this._completed,this)),this)},Static:{fetch:function(e){return(new this).fetch(e)},resolveCollection:function(){return O((new this)._coll)}},serialize:function(){return k.call(this)},deserialize:function(e){return J.deserialize(this,e),this._id&&(this._id=w(this._id)),this},_busy:!1,_coll:null,_indexes:null,_primaryKey:null,_ensureFree:function(){return this._busy?(console.warn("<mongo:single> transport requested, but is busy for the same instance."),!1):(this.defer(),this._busy=!0,!0)},_completed:function(e){return this._busy=!1,e?this.reject(e):this.resolve(this)},_fetched:function(e,t){null==e&&(null==t?e={message:"Entry Not Found",code:404}:this.deserialize(t)),this._completed(e)},_inserted:function(e,t){null!=t&&null==this._id&&(o(t)&&1===t.length?this._id=t[0]._id:console.error("<mongo:insert-single> expected an array in callback")),this._completed(e)}});var n=function(t){return new e(t)};return n.prototype=e.prototype,n}(),H=function(){function e(e){t.call(this,e)}function r(e,t){var r=e._ctor,o=new r(t);null==o._id&&n(o.deserialize)&&o.deserialize(t),e[e.length++]=o}D(e,X,{fetch:function(e,t){return this._ensureFree()===!1?this:(m(this._coll,e,t,U(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;for(var e,t=[],n=[],r=[],o=this._coll,i=U(this._completed,this),u=0,s=this.length;s>u;u++)e=this[u],null!=e._id?r.push(e.serialize()):(t.push(e.serialize()),n.push(u));if(t.length&&r.length){var a=l(2,i);return y(o,t,this._insertedDelegate(this,a,n)),b(o,r,a),this}return t.length?(y(o,t,this._insertedDelegate(this,this._completed,n)),this):r.length?(b(o,r,i),this):this},del:function(e){if(null==e&&0!==arguments.length)return console.error("<MongoStore:del> - selector is specified, but is undefined"),this;if(this._ensureFree()===!1)return this;var t=null==e?this.toArray():this.remove(e);if(t&&t.length){for(var n,r=[],o=0,i=t.length;i>o;o++)n=t[o],n._id&&r.push(n._id);x(this._coll,{_id:{$in:r}},!1,U(this._completed,this))}else this._completed();return this},Static:{fetch:function(e,t){return(new this).fetch(e,t)},count:function(e){var t=new X;return g(this.prototype._coll,e,function(e,n){return null!=e?void t.reject(n):void t.resolve(n)}),t}},_busy:!1,_coll:null,_indexes:null,_primaryKey:null,_ensureFree:function(){return this._busy?(console.warn("<mongo:collection> requested transport, but is busy by the same instance."),!1):(this._busy=!0,this._resolved=null,this._rejected=null,!0)},_completed:function(e){this._busy=!1,e?this.reject(e):this.resolve(this)},_fetched:function(e,t){if(v(t))for(var n,o=0,i=t.length;i>o;o++)n=t[o],r(this,n);else t&&r(this,t);this._completed(e)},_insertedDelegate:function(e,t,n){function r(){t.call(e)}return function(t,i){if(o(i)===!1)return console.error("<mongo:bulk insert> array expected"),r();if(i.length!==n.length)return console.error("<mongo:bul insert> count missmatch",i.length,n.length),r();for(var l,u=0,s=n.length;s>u;u++)l=n[u],e[l]._id=i[u]._id;r()}}});var i=function(t){return new e(t)};return i.prototype=e.prototype,i}();return{Single:I,Collection:H,settings:L,resolveDb:S,resolveCollection:O,createId:function(e){return w(e)},ensureIndexes:function(e){var t=e.prototype,n=t._indexes,r=t._coll,o=new X;return null==n?o.reject("<No indexes> "+r):(P.ensure(r,n,s(o)),o)},ensureIndexesAll:function(){var e=new X;return P.ensureAll(s(e)),e},profiler:{toggle:A,getData:E}}}(),Q.bind=function(e){for(var t,n=arguments,r=1,o=arguments.length;o>r;r++)t=n[r],e[t]=e[t].bind(e);return e},Q.cfg=function(e,t){if(u(e))return 1===arguments.length?d[e]:void(d[e]=t);if(r(e))for(var n in e)Q.cfg(n,e[n])},Q.Model={},Q.Serializable=J,Q.Deferred=X,Q.EventEmitter=G,Q.Await=Y,Q.validate=H,Q.stringify=w,Q.parse=C,Q.patch=x,Q.properties=j,Q.Collection=function(){function e(e,t){return t instanceof e?t:new e(t)}function t(){var e,t=arguments.length,o=arguments[t-1],i=arguments[t-2];return t>2&&(e=arguments[0]),o._ctor=i,D(o,r,n),null==e?Q(o):Q(e,o)}var n=function(){function t(e,t){if(null==t)return!1;if("function"==typeof t)return t(e);if("object"==typeof t){if(e.constructor===t.constructor&&e.constructor!==Object)return e===t;var n,r;for(var o in t){if(n=e[o],r=t[o],"string"==typeof r){var i=r[0],l=1;if("<"===i||">"===i)switch("="===r[1]&&(i+="=",l++),r=r.substring(l),i){case"<":if(n>=r)return!1;continue;case"<=":if(n>r)return!1;continue;case">":if(r>=n)return!1;continue;case">=":if(r>n)return!1;continue}}if(n!=r)return!1}return!0}return console.warn("No valid matcher",t),!1}function n(e,t){for(var n=this.length,r=-1;++r<n;)e.call(t||this,this[r],r);return this}var r={length:0,push:function(){for(var t=arguments.length,n=-1;++n<t;)this[this.length++]=e(this._ctor,arguments[n]);return this},pop:function(){var e=this[--this.length];return this[this.length]=null,e},shift:function(){if(0===this.length)return null;for(var e=this[0],t=this.length-1,n=0;t>n;n++)this[n]=this[n+1];return this[t]=null,this.length--,e},unshift:function(t){this.length++;for(var n=this.length;--n;)this[n]=this[n-1];return this[0]=e(this._ctor,t),this},splice:function(t,n){var r,o,i,l=this.length;if(t>=l)for(n=0,r=l,o=t;o>r;r++)this[r]=void 0;var u=n,s=t,a=t+u,c=arguments.length-2,f=l+c-u,h=a,p=l,d=f-l;if(d>0)for(r=p;--r>=h;)this[r+d]=this[r];if(0>d)for(r=h;p>r;)this[r+d]=this[r],r++;for(r=s,i=2;i<arguments.length;i)this[r++]=e(this._ctor,arguments[i++]);return this.length=f,this},slice:function(){return z(h,this,arguments)},sort:function(e){return p.call(this,e),this},reverse:function(){for(var e=h.call(this),t=this.length,n=-1;++n<t;)this[n]=e[t-n-1];return this},toString:function(){return h.call(this,0).toString()},each:n,forEach:n,where:function(e){for(var n,r=new this.constructor,o=0,i=this.length;i>o;o++)n=this[o],t(n,e)&&(r[r.length++]=n);return r},remove:function(e){for(var n=-1,r=[],o=0,i=this.length;i>o;o++)t(this[o],e)?r.push(this[o]):this[++n]=this[o];for(o=++n;i>o;o++)this[o]=null;return this.length=n,r},first:function(e){if(null==e)return this[0];var t=this.indexOf(e);return-1!==t?this[t]:null},last:function(e){if(null==e)return this[this.length-1];var t=this.lastIndexOf(e);return-1!==t?this[t]:null},indexOf:function(e,n){if(null==e)return-1;if(null!=n){if(0>n&&(n=0),n>=this.length)return-1}else n=0;for(var r=this.length;r>n;n++)if(t(this[n],e))return n;return-1},lastIndexOf:function(e,n){if(null==e)return-1;if(null!=n){if(n>=this.length&&(n=this.length-1),0>n)return-1}else n=this.length-1;for(;n>-1;n--)if(t(this[n],e))return n;return-1},map:function(e){for(var t=[],n=this.length,r=-1;++r<n;)t[r]=e(this[r]);return t},filter:function(e,t){for(var n=new this.constructor,r=this.length,o=-1;++o<r;)e.call(t||this,this[o])&&n.push(this[o]);return n}};return"undefined"!=typeof Symbol&&Symbol.iterator&&(r[Symbol.iterator]=function(){var e=this,t=-1;return{next:function(){return{value:e[++t],done:t>e.length-1}},hasNext:function(){return t<e.length}}}),r}(),r={toArray:function(){for(var e=new Array(this.length),t=0,n=this.length;n>t;t++)e[t]=this[t];return e},toJSON:A};return t}(),function(){var e,t;!function(){function n(e,t,n){return function(){e[n]=arguments;for(var r,o=0,i=t[n].length;i>o;o++)r=t[n][o],z(r,this,arguments);t[o]=null,e=null,t=null}}e=function(e){var t={},n=[];return function(){var r=V(arguments,n);return null==t[r]?t[r]=z(e,this,arguments):t[r]}},t=function(e){var t={},r={},o=[];return function(){var i=h.call(arguments),l=i.pop(),u=V(i,o);return t[u]?void z(l,this,t[u]):r[u]?void r[u].push(l):(r[u]=[l],i=h.call(i),i.push(n(t,r,u)),void z(e,this,i))}}}(),Q.Fn={memoize:e,memoizeAsync:t}}(),t.Class=Q}),function(e,t){"use strict";var n,r;return"undefined"==typeof exports||e!==exports&&null!=e||(n=r=global),null==n&&(n="undefined"==typeof window?global:window),null==r&&(r=e||n),"undefined"!=typeof include&&"function"==typeof include.js?(r.include=include,void(r.includeLib=include.Lib||n.includeLib)):void t(n,r,n.document)}(this,function(global,exports,document){"use strict";function fn_proxy(e,t){return function(){e.apply(t,arguments)}}function fn_doNothing(e){"function"==typeof e&&e()}function arr_invoke(e,t,n){if(null!=e&&e instanceof Array!=!1)for(var r=0,o=e.length;o>r;r++)"function"==typeof e[r]&&(null==t?e[r].call(n):e[r].apply(n,t))}function arr_ensure(e,t){if(!t)return e;for(var n,r=t.split("."),o=r.length-1,i=0;o>i;i++)n=r[i],e=e[n]||(e[n]={});return n=r[o],e[n]||(e[n]=[])}var bin={js:{},css:{},load:{}},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),reg_subFolder=/([^\/]+\/)?\.\.\//,reg_hasProtocol=/^(file|https?):/i,cfg={path:null,loader:null,version:null,lockedToFolder:null,sync:null,eval:null==document},handler={},hasOwnProp={}.hasOwnProperty,emptyResponse={load:{}},__array_slice=Array.prototype.slice,XMLHttpRequest=global.XMLHttpRequest,Helper={reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),"function"==typeof handler.onerror&&handler.onerror(e)}},XHR=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&t&&t(e,n.responseText)},n.open("GET","object"==typeof e?e.url:e,!0),n.send()},obj_inherit,obj_getProperty,obj_setProperty;!function(){obj_inherit=function(e){"function"==typeof e&&(e=e.prototype);
for(var t,n,r=1,o=arguments.length;o>r;r++){t="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in t)e[n]=t[n]}return e},obj_getProperty=function(e,t){for(var n=t.split("."),r=n.length,o=0;r>o;o++){if(null==e)return null;e=e[n[o]]}return e},obj_setProperty=function(e,t,n){for(var r,o=t.split("."),i=o.length-1,l=-1;++l<i;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=n}}();var path_getDir,path_getFile,path_getExtension,path_resolveCurrent,path_normalize,path_win32Normalize,path_resolveUrl,path_combine,path_isRelative;!function(){function e(e){for(;-1!==e.indexOf("../");)e=e.replace(reg_subFolder,"");return e.replace(/\/\.\//g,"/")}path_getDir=function(e){return e.substring(0,e.lastIndexOf("/")+1)},path_getFile=function(e){return e=e.replace("file://","").replace(/\\/g,"/").replace(/\?[^\n]+$/,""),/^\/\w+:\/[^\/]/i.test(e)?e.substring(1):e},path_getExtension=function(e){var t=e.indexOf("?");return-1===t?e.substring(e.lastIndexOf(".")+1):e.substring(e.lastIndexOf(".",t)+1,t)},path_resolveCurrent=function(){if(null==document)return"undefined"==typeof module?"":path_win32Normalize(module.parent.filename);var e=document.getElementsByTagName("script"),t=e[e.length-1],n=t&&t.getAttribute("src")||"";if("/"===n[0])return n;var r=window.location.pathname.replace(/\/[^\/]+\.\w+$/,"");return"/"!==r[r.length-1]&&(r+="/"),r+n},path_normalize=function(e){return e.replace(/\\/g,"/").replace(/([^:\/])\/{2,}/g,"$1/")},path_win32Normalize=function(e){return e=path_normalize(e),"file:"===e.substring(0,5)?e:"file:///"+e},path_resolveUrl=function(t,n){return reg_hasProtocol.test(t)?e(t):("./"===t.substring(0,2)&&(t=t.substring(2)),"/"===t[0]&&null!=n&&null!=n.base&&(t=path_combine(n.base,t),reg_hasProtocol.test(t))?e(t):"/"===t[0]&&cfg.path&&(t=cfg.path+t.substring(1),reg_hasProtocol.test(t))?e(t):("/"===t[0]?(isWeb===!1||cfg.lockedToFolder===!0)&&(t=t.substring(1)):null!=n&&null!=n.location&&(t=n.location+t),e(t)))},path_isRelative=function(e){var t=e.charCodeAt(0);switch(t){case 47:return!1;case 102:case 104:return reg_hasProtocol.test(e)===!1}return!0},path_combine=function(){for(var e,t="",n=arguments.length,r=-1;++r<n;)e=arguments[r],e&&(e=path_normalize(e),""!==t?("/"!==t[t.length-1]&&(t+="/"),"/"===e[0]&&(e=e.substring(1)),t+=e):t=e);return t}}();var tree_resolveUsage;!function(){function e(t,n,r){if(null==n){console.warn("<include> Usage Not Found:",t),console.warn("- Ensure to have it included before with the correct alias"),console.warn("- Initiator Stacktrace:");for(var o=[],i=r;null!=i;)o.push(i.url),i=i.parent;return console.warn(o.join("\n")),null}for(var l,u,s=n.includes,a=-1,c=s.length;++a<c;)if(l=s[a],u=l.route.alias||Routes.parseAlias(l.route),u===t)return l.resource;return e(t,n.parent,r)}tree_resolveUsage=function(t,n,r){for(var o,i,l,u,s,a=[],c=n.length,f=-1;++f<c;){if(l=i=n[f],u=i.indexOf("."),-1!==u&&(l=i.substring(0,u),i=i.substring(u+1)),s=e(l,t.parent,t),null==s)return null;if(4!==s.state)return t.state=3,s.on(4,r,s,"push"),null;o=s.exports,l!==i&&(o=obj_getProperty(o,i)),"object"==typeof o&&null==o&&console.warn("<include:use> Used resource has no exports",l,t.url),a[f]=o}return a}}();var RoutesLib=function(){var e={},t=/([^\\\/]+)\.\w+$/;return{register:function(t,n,r){if("string"==typeof n&&path_isRelative(n)){var o=r||include,i=o.location||path_getDir(o.url||path_resolveCurrent());path_isRelative(i)&&(i="/"+i),n=i+n}e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r,o,i,l,u,s,a,c,f=n.indexOf("?"),h=n.indexOf("::");if(-1!==h&&(r=n.substring(h+2),n=n.substring(0,h)),-1!==f){for(c=n.substring(f+1).split("&"),i={},u=0,a=c.length;a>u;u++)s=c[u].split("="),i[s[0]]=s[1];n=n.substring(0,f)}if(n=n.split("/"),l=e[t],null==l)return{path:n.join("/"),params:i,alias:r};for(o=l[0],u=1;u<l.length;u++)if(u%2===0)o+=l[u];else{var p=l[u]<<0;if(p>n.length-1&&(p=n.length-1),o+=n[p],u===l.length-2)for(p++;p<n.length;p++)o+="/"+n[p]}return{path:o,params:i,alias:r}},each:function(e,t,n,r,o){var i;if(null!=t)if("lazy"!==e||null!=o)if(t instanceof Array)for(var l=0;l<t.length;l++)this.each(e,t[l],n,r,o);else if("object"!=typeof t){if("string"==typeof t){var u=this.resolve(r,t);return r&&(r+="."+t),void n(r,u,o)}console.error("Include Package is invalid",arguments)}else for(i in t)hasOwnProp.call(t,i)&&this.each(e,t[i],n,i,o);else for(i in t)this.each(e,t[i],n,null,i)},getRoutes:function(){return e},parseAlias:function(e){var n=e.path,r=t.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(e){function t(){Events.ready=fn_doNothing,null!=n&&(arr_invoke(n),n=null)}if(null==e)return{ready:fn_doNothing,load:fn_doNothing};var n=[];return"onreadystatechange"in e?e.onreadystatechange=function(){/complete|interactive/g.test(e.readyState)!==!1&&t()}:e.addEventListener?e.addEventListener("DOMContentLoaded",t):window.onload=t,{ready:function(e){n.unshift(e)}}}(document),ScriptStack=function(){function e(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=e,"onreadystatechange"in n?n.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&t()}:n.onload=n.onerror=t,(o||(o=document.getElementsByTagName("head")[0])).appendChild(n)}function t(){function n(e){e&&"error"===e.type&&console.log("Script Loaded Error",o.url);for(var n=0,r=u.length;r>n;n++)if(u[n]===o){u.splice(n,1);break}return n===r?void console.error("Loaded Resource not found in stack",o):(2.5!==o.state&&o.readystatechanged(3),i=null,void t())}if(!l){if(0===u.length)return void r();if(null==i){var o=i=u[0];if(1!==o.state)return o.state=1,global.include=o,global.iparams=o.route.params,o.source?(__eval(o.source,o),void n()):void e(o.url,n)}}}function n(){if(!l){if(0===u.length)return void r();if(null==i){var e=u[0];if(!(e.state<2)){i=e,e.state=1,global.include=e,__eval(e.source,e);for(var t,o=0,s=u.length;s>o;o++)if(t=u[o],t===e){u.splice(o,1);break}2.5!==e.state&&e.readystatechanged(3),i=null,n()}}}}function r(){for(var e=-1,t=s.length;++e<t;)s[e]();s.length=0}var o,i,l,u=[],s=[];return{load:function(e,r,o){return this.add(e,r),!cfg.eval||o?void t():e.source?(e.state=2,void n()):void XHR(e,function(e,t){t||(console.error("Not Loaded:",e.url),console.error("- Initiator:",e.parent&&e.parent.url||"<root resource>")),e.source=t,e.state=2,n()})},add:function(e,t){if(1===e.priority)return u.unshift(e);if(null==t)return u.push(e);for(var n=u.length,r=-1;++r<n;)if(u[r]===t)return u.splice(r,0,e);u.push(e)},moveToParent:function(e,t){var n,r=u.length,o=-1,i=-1;for(n=0;r>n;n++)if(u[n]===e){i=n;break}if(-1!==i){for(n=0;r>n;n++)if(u[n]===t){o=n;break}-1!==o&&(o>i||(u.splice(i,1),u.splice(o,0,e)))}},pause:function(){l=!0},resume:function(){l=!1,null==i&&this.touch()},touch:function(){var e=cfg.eval?n:t;e()},complete:function(e){return l!==!0&&0===u.length?void e():void s.push(e)}}}(),IncludeDeferred=function(){this.callbacks=[],this.state=-1};IncludeDeferred.prototype={on:function(e,t,n,r){return this===n&&-1===this.state?(t(this),this):(null==r&&(r=this.state<3||this===n?"unshift":"push"),e<=this.state?t(this):this.callbacks[r]({state:e,callback:t}),this)},readystatechanged:function(e){var t,n,r,o;if(e>this.state&&(this.state=e),3===this.state){var i=this.includes;if(null!=i&&i.length)for(t=0;t<i.length;t++)if(4!==i[t].resource.state)return;this.state=4}if(t=0,n=this.callbacks.length,0!==n){for("js"===this.type&&4===this.state&&(o=global.include,global.include=this);n>t&&(r=this.callbacks[t],null==r||r.state>this.state||(this.callbacks.splice(t,1),n--,t--,r.callback(this),!(this.state<4)));t++);null!=o&&(global.include=o)}},ready:function(e){var t=this;return this.on(4,function(){Events.ready(function(){t.resolve(e)})},this)},done:function(e){var t=this;return this.on(4,function(){t.resolve(e)},this)},resolve:function(e){var t=this.includes,n=null==t?0:t.length;if(n>0&&null==this.response){this.response={};for(var r,o,i,l=0;n>l;l++)if(i=t[l],r=i.resource,o=i.route,"undefined"!=typeof r.exports){var u=r.type;switch(u){case"js":case"load":case"ajax":var s=o.alias||Routes.parseAlias(o),a="js"===u?this.response:this.response[u]||(this.response[u]={});if(null!=s){obj_setProperty(a,s,r.exports);break}console.warn("<includejs> Alias is undefined",r)}}}var c=this.response||emptyResponse,f=this;return null==this._use&&null!=this._usage&&(this._use=tree_resolveUsage(this,this._usage,function(){f.state=4,f.resolve(e),f.readystatechanged(4)}),this.state<4)?void 0:this._use?void e.apply(null,[c].concat(this._use)):void e(c)}};var Include,IncludeLib={};!function(IncludeDeferred){function incl_getResource(e,t){var n=e;if(path_isRelative(e)===!0&&(n="/"+n),null!=t)return bin[t][n];for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null}function embedPlugin(source){eval(source)}function enableModules(){return"undefined"==typeof Object.defineProperty?void console.warn("Browser do not support Object.defineProperty"):(Object.defineProperty(global,"module",{get:function(){return global.include}}),void Object.defineProperty(global,"exports",{get:function(){var e=global.include;return e.exports||(e.exports={})},set:function(e){global.include.exports=e}}))}function includePackage(e,t,n){var r=1===n.length?n[0]:__array_slice.call(n);return e instanceof Resource?e.include(t,r):new Resource("js").include(t,r)}function createIncluder(e){return function(){return includePackage(this,e,arguments)}}function doNothing(){return this}function stub_freeze(e){e.js=e.css=e.load=e.ajax=e.embed=e.lazy=e.inject=doNothing}function stub_release(e){for(var t=["js","css","load","ajax","embed","lazy"],n=t.length;-1!==--n;)e[t[n]]=createIncluder(t[n]);e.inject=e.js}Include=function(){IncludeDeferred.call(this)},stub_release(Include.prototype),obj_inherit(Include,IncludeDeferred,{_use:null,_usage:null,isBrowser:!0,isNode:!1,setCurrent:function(e){var t=e.url,n=this.getResourceById(t,"js");if(null==n){"/"===t[0]&&this.base&&(t=this.base+t.substring(1));var n=new Resource("js",{path:t},e.namespace,null,null,t)}n.state<3&&console.error("<include> Resource should be loaded",e),n.state=3,global.include=n},cfg:function(e){switch(typeof e){case"object":var t,n;for(t in e)switch(n=e[t],t){case"loader":for(var r in n)CustomLoader.register(r,n[r]);break;case"modules":n===!0&&enableModules();break;default:cfg[t]=n}break;case"string":if(1===arguments.length)return cfg[e];2===arguments.length&&(cfg[e]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(e){if(null==e)return Routes.getRoutes();if(2===arguments.length)return Routes.register(e,arguments[1],this),this;for(var t in e)Routes.register(t,e[t],this);return this},promise:function(e){for(var t=e.split("."),n=global;t.length;){var r=t.shift();n=n[r]||(n[r]={})}return n},register:function(e){function t(e){return null==s?e:("/"===e.url[0]&&(e.url=s+e.url.substring(1)),"/"===e.parent[0]&&(e.parent=s+e.parent.substring(1)),e.id=e.url,e)}function n(e,t){e.exports=t,e.readystatechanged(4)}var r,o,i,l,u,s=this.base;for(r in e)for(i=e[r],l=i.length,u=-1;++u<l;){o=t(i[u]);var a=o.id,c=o.url,f=o.namespace,h=o.parent&&incl_getResource(o.parent,"js"),p=new Resource,d=o.state;if(a||c){switch(c&&("/"===c[0]&&(c=c.substring(1)),p.location=path_getDir(c)),p.state=null==d?"js"===r?3:4:d,p.namespace=f,p.type=r,p.url=c||a,p.parent=h,p.base=h&&h.base||s,r){case"load":case"lazy":var m=document.querySelector("#includejs-"+a.replace(/\W/g,""));if(null==m){console.error('"%s" Data was not embedded into html',a);break}p.exports=m.innerHTML,CustomLoader.exists(p)&&(p.state=3,CustomLoader.load(p,n))}(bin[r]||(bin[r]={}))[a]=p}}},instance:function(e,t){var n;return null==e?(n=new Include,n.state=4,n):(n=new Resource,n.state=4,n.location=path_getDir(path_normalize(e)),n.parent=t,n)},getResource:function(e,t){return this.base&&"/"===e[0]&&(e=this.base+e.substring(1)),incl_getResource(e,t)},getResourceById:function(e,t){var n=bin[t],r=n[e];return null!=r?r:this.base&&"/"===e[0]&&(r=n[path_combine(this.base,e)],null!=r)?r:this.base&&this.location&&(r=n[path_combine(this.base,this.location,e)],null!=r)?r:this.location&&(r=n[path_combine(this.location,e)],null!=r)?r:null},getResources:function(){return bin},plugin:function(e,t){var n=[],r=0,o=0,i=0,l=function(e,n){o++,embedPlugin(n),o===r-1&&t&&(t(),t=null)};for(Routes.each("",e,function(e,t){n.push("/"===t.path[0]?t.path.substring(1):t.path)}),r=n.length;r>i;i++)XHR(n[i],l);return this},client:function(){return cfg.server===!0&&stub_freeze(this),this},server:function(){return cfg.server!==!0&&stub_freeze(this),this},use:function(){return null==this.parent?(console.error("<include.use> Parent resource is undefined"),this):(this._usage=arguments,this)},pauseStack:fn_proxy(ScriptStack.pause,ScriptStack),resumeStack:fn_proxy(ScriptStack.resume,ScriptStack),allDone:function(e){ScriptStack.complete(function(){function t(){--r<1&&e()}var n=include.getPending("js"),r=n.length;if(0===r)return void e();for(var o=-1,i=r;++o<i;)n[o].on(4,t)})},getPending:function(e){var t,n,r,o=[];for(n in bin)if(null==e||e===n)for(r in bin[n])t=bin[n][r],t.state<4&&o.push(t);return o},Lib:IncludeLib})}(IncludeDeferred);var CustomLoader=function(){function e(e){return"string"==typeof e?!1:"function"==typeof e.ready||"function"==typeof e.process}function t(t){var n=path_getExtension(t),r=cfg.loader[n];if(e(r))return r;var o,i=r;if("object"==typeof i)for(var l in i){o=l,i=i[l];break}return cfg.loader[n]=new Resource("js",Routes.resolve(o,i),o,null,null,null,1)}function n(e,t){return function(n){e(t,n)}}function r(e,t,r,o){if(null==r.process)return void o(t,e);var i=n(o,t),l=r.process(e,t,i);"undefined"!=typeof l&&o(t,l)}function o(e,t,n){function o(e,o){r(o,e,t,n)}return"string"==typeof e.exports?void r(e.exports,e,t,n):t.load?t.load(e,o):void XHR(e,o)}var i={process:function(e){try{return JSON.parse(e)}catch(t){return console.error(t,e),null}}};return cfg.loader={json:i},{load:function(e,n){var r=t(e.url);return r.process?void o(e,r,n):void r.on(4,function(){o(e,r.exports,n)},null,"push")},exists:function(e){if(!e.url)return!1;var t=path_getExtension(e.url);return cfg.loader.hasOwnProperty(t)},register:function(e,t){if("string"==typeof t){var n=include;null==n.location&&(n={location:path_getDir(path_resolveCurrent())}),t=path_resolveUrl(t,n)}cfg.loader[e]=t}}}(),LazyModule={create:function(e,t){for(var n=e.split("."),r=global,o=n[n.length-1];n.length>1;){var i=n.shift();r=r[i]||(r[i]={})}n=null,Object.defineProperty(r,o,{get:function(){delete r[o];try{var n=__eval(t,global.include);null==n||n instanceof Resource||(r[o]=n)}catch(i){i.xpath=e,Helper.reportError(i)}finally{return t=null,e=null,r[o]}}})}},Resource;!function(e,t,n,r){function o(e){var t=e.type,o=e.parent,l=e.url;if(null==document&&"css"===t)return e.state=4,e;if(r.exists(e)===!1)switch(t){case"js":case"embed":n.load(e,o,"embed"===t);break;case"ajax":case"load":case"lazy":XHR(e,i);break;case"css":e.state=4;var u=document.createElement("link");u.href=l,u.rel="stylesheet",u.type="text/css",document.getElementsByTagName("head")[0].appendChild(u)}else("js"===t||"embed"===t)&&n.add(e,e.parent),r.load(e,i);return e}function i(e,t){switch(t||console.warn("Resource cannt be loaded",e.url),e.type){case"js":case"embed":return e.source=t,e.state=2,void n.touch();case"load":case"ajax":e.exports=t;break;case"lazy":LazyModule.create(e.xpath,t);break;case"css":var r=document.createElement("style");r.type="text/css",r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r)}e.readystatechanged(4)}function l(e,t,n){if(null==e)return null;null==n&&(n=[]);for(var r,o=e.length,i=-1;++i<o;)r=e[i].resource,t===r.type&&n.push(r),null!=r.includes&&l(r.includes,t,n);return n}Resource=function(t,r,i,l,u,s,a){e.call(this),this.childLoaded=fn_proxy(this.childLoaded,this);var c=r&&r.path;null!=c&&(this.url=c=path_resolveUrl(c,u)),this.type=t,this.xpath=l,this.route=r,this.parent=u,this.priority=a,this.namespace=i,this.base=u&&u.base,null==s&&c&&(s=(path_isRelative(c)?"/":"")+c);var f=bin[t]&&bin[t][s];return f?(f.state<4&&"js"===t&&n.moveToParent(f,u),f):null==c?(this.state=3,this.location=path_getDir(path_resolveCurrent()),this):(this.state=0,this.location=path_getDir(c),(bin[t]||(bin[t]={}))[s]=this,cfg.version&&(this.url+=(-1===this.url.indexOf("?")?"?":"&")+"v="+cfg.version),o(this))},Resource.prototype=obj_inherit(Resource,e,{state:null,location:null,includes:null,response:null,url:null,base:null,type:null,xpath:null,route:null,parent:null,priority:null,namespace:null,setBase:function(e){return this.base=e,this},childLoaded:function(){var e=this,t=e.includes;if(t&&t.length){if(e.state<3)return;for(var n=0;n<t.length;n++)if(4!==t[n].resource.state)return}e.readystatechanged(4)},create:function(e,t,n,r,o){var i;return this.state=this.state>=3?3:2,this.response=null,null==this.includes&&(this.includes=[]),i=new Resource(e,t,n,r,this,o),this.includes.push({resource:i,route:t}),i},include:function(e,n){var r,o=this,i=[];t.each(e,n,function(t,n,l){(null==o.route||o.route.path!==n.path)&&(r=o.create(e,n,t,l),i.push(r))});for(var l=-1,u=i.length;++l<u;)i[l].on(4,this.childLoaded);return this},pause:function(){this.state=2.5;var e=this;return function(t){1===arguments.length&&(e.exports=t),e.readystatechanged(3)}},getNestedOfType:function(e){return l(this.includes,e)}})}(Include,Routes,ScriptStack,CustomLoader),IncludeLib.Routes=RoutesLib,IncludeLib.Resource=Resource,IncludeLib.ScriptStack=ScriptStack,IncludeLib.registerLoader=CustomLoader.register,exports.include=new Include,exports.includeLib=IncludeLib,function(){cfg.server=!0;var e,t,n,r=require("vm"),o=(global.module||module).constructor;!function(){function r(e){null!=i[e]&&(i[e].close(),i[e]=null)}var o=require("fs"),i={};t=function(e,t){if(cfg.sync)try{var n=o.readFileSync(e,"utf8");t(null,n)}catch(r){console.error("File Read - ",r)}else o.readFile(e,"utf8",t)},n=function(e,t){r(e),i[e]=o.watch(e,t)},e=function(e){return o.existsSync(e)}}();var i,l,u;!function(){function e(e){if(null!=e){e.content=null,e.exports=null;var t=e.parent;return t.create(e.type,e.route,e.namespace,e.xpath).on(4,t.childLoaded)}}function t(e,t){var n=bin[e][t],r=n.includes;delete bin[e][t],null!=r&&r.forEach(function(e){var t=e.resource,n=t.type,r=t.url;"/"!==r[0]&&(r="/"+r),delete bin[n][r]})}i=function(e){var t;return function(){t&&clearTimeout(t),t=setTimeout(function(){var t;"object"==typeof cfg.autoreload&&(t=function(t){t!==!1&&cfg.autoreload.fileChanged(e,"include")}),u(e,t)},150)}},l=function(e){if(null!=e){var n,r,o,i,u=[];for(n in bin)for(r in bin[n])if(i=bin[n][r],o=r.indexOf(e),-1!==o&&o===r.length-e.length){t(n,r);var s=i.parent&&i.parent.url?l(i.parent.url):[i];u.push.apply(u,s)}return 0===u.length&&console.warn("<include:res:remove> Resource is not in cache",e),u}},u=function(t,n){var r=l(t).filter(function(e){return null!=e});if(0===r.length)return void(n&&n(!1));for(var o=r.length,i=o,u=-1;++u<i;)e(r[u]).done(function(){0===--o&&n&&n()})}}(),XMLHttpRequest=function(){},XMLHttpRequest.prototype={constructor:XMLHttpRequest,open:function(e,t){this.url=t},send:function(){-1!==this.url.indexOf("file://")&&(this.url=path_getFile(this.url));var e=this;t(this.url,function(t,r){t&&(console.error(">>",t.code,t.path),r=""),e.readyState=4,e.responseText=r,e.onreadystatechange(),null==t&&cfg.autoreload&&n(e.url,i(e.url))})}},__eval=function(e,t,n){module.exports={},global.include=t,global.require=require,global.exports=module.exports,global.__filename=path_getFile(t.url),global.__dirname=path_getDir(global.__filename),global.module=module,n!==!0&&(e="(function(){ "+e+"\n}())");try{if(n)r.runInThisContext(e,global.__filename);else{var i=global.__filename;module=new o(i,module),module.paths=o._nodeModulePaths(path_getDir(i)),module.filename=i,module._compile(e,i),module.loaded=!0}}catch(l){console.error("Module Evaluation Error",t.url),console.error(l.stack)}if(null==t.exports){var u=module.exports;("object"!=typeof u||Object.keys(u).length)&&(t.exports=module.exports)}},function(){function t(e,n){if(n>=e.includes.length)return e.readystatechanged(4);var r=e.includes[n],o=r.resource,i=r.route.alias,l=o.exports;o.exports=null,o.type="js",o.includes=null,o.state=3,o.parent=null;for(var u in bin.load)if(bin.load[u]===o){delete bin.load[u];break}try{__eval(l,o,!0)}catch(s){console.error("<inject> Evaluation error",o.url,s),o.state=4}o.readystatechanged(3),o.on(4,function(){o.exports&&i&&(global[i]=o.exports),t(e,++n)})}var n,r;obj_inherit(Resource,{isBrowser:!1,isNode:!0,bin_remove:l,bin_tryReload:u,path_getFile:function(){return path_getFile(this.url)},path_getDir:function(){return path_getDir(path_getFile(this.url))},inject:function(){var e=1===arguments.length?arguments[0]:__array_slice.call(arguments);this.state=this.state>=3?3:2;var n=this,r=n.create();return r.url=this.url,r.location=this.location,r.load(e).done(function(){r.state=3,r.on(4,function(){var e=1,t=ruqq.arr.indexOf(n.includes,function(e){return e.resource===r});-1===t&&(t=n.includes.length-1,e=0),n.includes.splice.apply(n.includes,[t,e].concat(r.includes)),n.readystatechanged(3)}),t(r,0)}),n},embed:function(){return this.js.apply(this,arguments)},instance:function(t,i){if("string"==typeof t){var l=module,u=new o(t,l);if(u.filename=path_getFile(t),u.paths=o._nodeModulePaths(path_getDir(u.filename)),null==n){for(var s=process.env.PATH||process.env.path,a=require("path").delimiter,c=s.split(a),f=c.length,h=/([\\\/]npm[\\\/])|([\\\/]npm$)/gi;--f>-1;)if(h.test(c[f])){n=c[f];break}null==n&&"win32"!==process.platform&&["/usr/lib/node_modules","/usr/local/lib/node_modules"].forEach(function(t){null==n&&e(t)&&(n=t)}),n?(-1===n.indexOf("node_modules")&&(n=path_combine(n,"node_modules")),r=path_combine(path_getDir(path_normalize(process.mainModule.filename)),"node_modules")):(n=!1,console.warn("Could not resolve global NPM Directory from system path (%s)",a,s))}r&&u.paths.unshift(r),n&&u.paths.unshift(n),global.module=module=u,global.require=require=u.require.bind(u)}var p=new Resource;return p.state=4,p.location=t,p.parent=i,p}})}(),obj_inherit(Include,{isBrowser:!1,isNode:!0,bin_tryReload:u,bin_remove:l})}()}),function(e,t){"use strict";function n(){return t(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=e&&e!==exports&&e!==i||(e=exports),o=i.document,r=e||i,"function"==typeof define&&define.amd?define(n):n()}(this,function(global,exports,document){"use strict";function util_interpolate(e,t,n,r,o,i,l){for(var u,s,a,c,f,h=e.length,p=-1,d=null,m="",g=!0;++p<h;){if(g===!0)null==d?m+=e[p]:d.push(e[p]);else{if(c=e[p],s=null,a=c.indexOf(":"),-1===a)s=obj_getPropertyEx(c,n,r,i);else{if(u=a>0?c.substring(0,a).trim():"",""===u&&(u="expression"),c=c.substring(a+1),f=custom_Utils[u],null==f){log_error("Undefined custom util `%s`",u);continue}s=f(c,n,r,o,i,l,t)}null!=s&&("object"==typeof s&&null==d&&(d=[m]),null==d?m+=s:d.push(s))}g=!g}return null==d?m:d}function Template(e){this.template=e,this.index=0,this.length=e.length}function VarStatement(){}var coll_each,coll_remove,coll_map,coll_indexOf,coll_find;if(function(){coll_each=function(e,t,n){if(null==n&&(n=e),null==e)return e;for(var r=e.length,o=0;r>o;o++)t.call(n,e[o],o);return n},coll_indexOf=function(e,t){if(null==e)return-1;for(var n=e.length,r=0;n>r;r++)if(e[r]===t)return r;return-1},coll_remove=function(e,t){var n=coll_indexOf(e,t);return-1===n?!1:(e.splice(n,1),!0)},coll_map=function(e,t,n){var r=new Array(e.length);return coll_each(e,function(e,n){r[n]=t.call(this,e,n)},n),r},coll_find=function(e,t,n){for(var r=e.length,o=0;r>o;o++)if(t.call(n||e,e[o],o))return!0;return!1}}(),void 0===Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){coll_each(this,e,t)}),void 0===Array.prototype.indexOf&&(Array.prototype.indexOf=function(e){return coll_indexOf(this,e)}),null==String.prototype.trim&&(String.prototype.trim=function(){var e,t=-1,n=this.length;if(0===n)return this;for(;++t<n&&(e=this.charCodeAt(t),!(e>32)););for(;0!==--n&&(e=this.charCodeAt(n),!(e>32)););return 0!==t&&n!==length-1?this.substring(t,n+1):this}),null==Function.prototype.bind){var _Array_slice;Function.prototype.bind=function(){if(arguments.length<2&&"undefined"==typeof arguments[0])return this;var e=this,t=_Array_slice.call(arguments),n=t.shift();return function(){return e.apply(n,t.concat(_Array_slice.call(arguments)))}}}var is_Function,is_Array,is_ArrayLike,is_String,is_Object,is_notEmptyString,is_rawObject;!function(){is_Function=function(e){return"function"==typeof e},is_Object=function(e){return null!=e&&"object"==typeof e},is_Array=is_ArrayLike=function(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.slice},is_String=function(e){return"string"==typeof e},is_notEmptyString=function(e){return"string"==typeof e&&""!==e},is_rawObject=function(e){return null==e||"object"!=typeof e?!1:e.constructor===Object}}();var obj_getProperty,obj_setProperty,obj_extend,obj_create;!function(){obj_getProperty=function(e,t){if("."===t)return e;for(var n=t.split("."),r=n.length,o=-1;null!=e&&++o<r;)e=e[n[o]];return e},obj_setProperty=function(e,t,n){for(var r,o=t.split("."),i=o.length-1,l=-1;++l<i;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=n},obj_extend=function(e,t){if(null==t)return e||{};if(null==e)return obj_create(t);for(var n in t)e[n]=t[n];return e},obj_create=Object.create||function(e){var t=function(){};return t.prototype=e,new t}}();var arr_remove,arr_each,arr_indexOf,arr_contains;!function(){arr_remove=function(e,t){var n=e.indexOf(t);return-1===n?!1:(e.splice(n,1),!0)},arr_each=function(e,t,n){e.forEach(t,n)},arr_indexOf=function(e,t){return e.indexOf(t)},arr_contains=function(e,t){return-1!==e.indexOf(t)}}();var fn_proxy,fn_apply,fn_doNothing;!function(){fn_proxy=function(e,t){return function(){return fn_apply(e,t,arguments)}},fn_apply=function(e,t,n){var r=n.length;return 0===r?e.call(t):1===r?e.call(t,n[0]):2===r?e.call(t,n[0],n[1]):3===r?e.call(t,n[0],n[1],n[2]):4===r?e.call(t,n[0],n[1],n[2],n[3]):e.apply(t,n)},fn_doNothing=function(){return!1}}();var _Array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_Object_create=obj_create,_Object_hasOwnProp=Object.hasOwnProperty,mode_SERVER="server",mode_SERVER_ALL="server:all",mode_SERVER_CHILDREN="server:children",mode_CLIENT="client",mode_model_NONE="none",__rgxEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},__cfg={allowCache:!0};Template.prototype={skipWhitespace:function(){for(var e=this.template,t=this.index,n=this.length;n>t&&!(e.charCodeAt(t)>32);t++);return this.index=t,this},skipToAttributeBreak:function(){var e,t=this.template,n=this.index,r=this.length;do if(e=t.charCodeAt(++n),35===e&&123===t.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),void this.index++;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>n);this.index=n},sliceToChar:function(e){for(var t,n,r=this.template,o=this.index,i=o,l=!1;(n=r.indexOf(e,o))>-1&&(o=n,92===r.charCodeAt(o-1));)l=!0,o++;return t=r.substring(i,o),this.index=o,l?t.replace(__rgxEscapedChar[e],e):t}};var obj_getPropertyEx,obj_toDictionary;!function(){function e(e,t,n,r){for(var o=e;r>n&&null!=o;)o=o[t[n]],n++;return o}obj_getPropertyEx=function(t,n,r,o){if("."===t)return n;var i,l=t.split("."),u=n,s=-1,a=l.length,c=l[0];for("$c"===c?(u=o,s++):"$a"===c?(u=o&&o.attr,s++):"$u"===c?(u=customUtil_$utils,s++):"$ctx"===c&&(u=r,s++),i=s;null!=u&&++s<a;)u=u[l[s]];if(null==u&&-1===i)for(var f;null!=o;){if(f=o.scope,null!=f&&(u=e(f,l,0,a),null!=u))return u;o=o.parent}return u},obj_toDictionary=function(e){var t,n=[],r=0;for(t in e)n[r++]={key:t,value:e[t]};return n}}();var arr_pushMany;!function(){arr_pushMany=function(e,t){if(null!=t&&null!=e)for(var n=e.length,r=t.length,o=-1;++o<r;)e[n+o]=t[o]}}();var listeners_on,listeners_off,listeners_emit;!function(){listeners_on=function(t,n){(e[t]||(e[t]=[])).push(n)},listeners_off=function(t,n){return null==n?void(e[t]=[]):void arr_remove(e[t],n)},listeners_emit=function(t){var n=e[t];if(null!=n)for(var r=n.length,o=-1,i=_Array_slice.call(arguments,1);++o<r;)n[o].apply(null,i)};var e={compoCreated:null,error:null}}();var throw_,parser_error,parser_warn,log_warn,log_error;!function(){function e(e){function r(n,r,o){this.type="Parser"+e,this.message=n,this.original=r,this.index=o,this.stack=t()}return n(r,Error),r}function t(){var e=(new Error).stack;return null==e?null:e.split("\n").slice(6,8).join("\n")}function n(e,t){Object.create&&(e.prototype=Object.create(t.prototype))}function r(e,t,n,r,s,f,h){t+=o(s)+i(n,r,h)+u(e,n,r)+l(f);var p="error"===e?a:c;return new p(t,n,r)}function o(e){return null==e?"":("number"==typeof e&&(e=String.fromCharCode(e))," Invalid token: `"+e+"`")}function i(e,t,n){if(null==t&&!n)return"";var r=e.substring(0,t).split("\n"),o=r.length,i=t+1-r.slice(0,o-2).join("\n").length;return" at "+(n||"")+"("+o+":"+i+")"}function l(e){var t={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal","var":"VarStatement",expr:"Expression"};return null==e||null==t[e]?"":"\n    , when parsing "+t[e]}function u(e,t,n){if(null==n)return"";var r=t.substring(n);return r.length>30&&(r=r.substring(0,30)+"..."),"\n    Parser "+e+" at: "+r}if(throw_=function(e){log_error(e),listeners_emit("error",e)},parser_error=function(e,t,n,o,i,l){var u=r("error",e,t,n,o,i,l);log_error(u.message),log_warn(u.stack),listeners_emit("error",u)},parser_warn=function(e,t,n,o,i,l){var u=r("warn",e,t,n,o,i,l);log_warn(u.message),log_warn(u.stack),listeners_emit("error",u)},"undefined"==typeof console)log_warn=log_error=function(){};else{var s=Function.prototype.bind;log_warn=s.call(console.warn,console,"MaskJS [Warn] :"),log_error=s.call(console.error,console,"MaskJS [Error] :")}var a=e("Error"),c=e("Warning")}();var obj_inherit;!function(){obj_inherit=function(e){"function"==typeof e&&(e=e.prototype);for(var t,n,r=arguments.length,o=1;r>o;o++){n=arguments[o],t="function"==typeof n?n.prototype:n;for(var i in t){var l=Object.getOwnPropertyDescriptor(t,i);null!=l&&(l.hasOwnProperty("value")?e[i]=l.value:Object.defineProperty(e,i,l))}}return e}}();var compo_renderMode_SERVER="server",compo_renderMode_SERVER_ALL="server:all",compo_renderMode_SERVER_CHILDREN="server:children",compo_renderMode_CLIENT="client",compo_renderMode_BOTH="both",compo_getMetaInfo,compo_getRenderMode,compo_isServerMode,compo_setMode,compo_wrapOnTagName;!function(){function e(e){if(null!=e){var t=e.meta||e.$meta;return null!=t?t:void(e.mode&&(this.mode=e.mode))}}compo_isServerMode=function(e){return compo_getRenderMode(e)===compo_renderMode_SERVER},compo_setMode=function(t,n){t.meta=null==t.meta?new e:obj_create(t.meta),t.meta.mode=n},compo_getMetaInfo=function(t){if(null==t)return new e;var n="function"==typeof t?t.prototype:t;return new e(n)},compo_getRenderMode=function(e){if(null==e)return compo_renderMode_BOTH;var t="function"==typeof e?e.prototype:e,n=t.meta&&t.meta.mode;return null==n||"both"===n?compo_renderMode_BOTH:"number"==typeof n?n:"server"===n||"server:all"===n?compo_renderMode_SERVER:"client"===n?compo_renderMode_CLIENT:compo_renderMode_BOTH},compo_wrapOnTagName=function(e,t){null!=e.tagName&&e.tagName!==t.tagName&&e.tagName!==e.compoName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1})},e.prototype={mode:compo_renderMode_BOTH,modeModel:null,attributes:null,cache:!1}}();var json_dimissCircular;!function(){function e(n){if(is_Array(n)){for(var r=[],o=n.length,i=-1;++i<o;)r[i]=e(n[i]);return r}if(is_Object(n)){if(-1!==t.indexOf(n))return"[object Circular]";t.push(n);var l={};for(var u in n)l[u]=e(n[u]);return l}return n}json_dimissCircular=function(n){return is_Object(n)&&(t=[],n=e(n),t=null),n};var t}();var node_getType;!function(){node_getType=function(e){var t=e.type;return null==t&&(is_Array(e)?t=10:null!=e.tagName?t=1:null!=e.content&&(t=2)),1===t&&null!=custom_Tags[e.tagName]&&(t=4),t}}();var build_childNodes;!function(){build_childNodes=function(e,t,n,r,o,i){var l=e.nodes;
if(null!=l){if(is_Array(l)===!1)return void build(l,t,n,r,o,i);var u,s=l.length;for(u=0;s>u;u++)build(l[u],t,n,r,o,i)}}}();var ExpressionUtil=function(){function e(e,t){null==t&&(t=!1),n=e,o=0,i=e.length,r=new et;var l,C,W=r,K=Y;e:for(;;)if(i>o&&(l=n.charCodeAt(o))<33)o++;else{if(o>=i)break;if(C=_t(l),null==C&&i>o)break;if(C===M){if(t===!0)return[r,o];break}if(t===!0){var G=W.parent;if(null!=G&&G.type===$&&null==G.parent&&C===L)return[r,o]}if(C===M)break;switch(C){case j:W=ht(W,new tt(W)),W=ht(W,new et(W)),o++;continue;case N:var Z=$;K===Q&&(K=Y,Z=B);do W=W.parent;while(null!=W&&W.type!==Z);if(Z===$&&(W=W.parent),null==W){dt("OutOfAst Exception",l);break e}o++;continue;case k:W=ht(W,new ot(W)),C=F,o++;break;case A:for(;null!=W&&W.type!==J;)W=W.parent;o++;continue;case E:if(K!==Q){K=Y;do W=W.parent;while(null!=W&&W.type!==$&&W.type!==J);if(o++,null==W){dt("Unexpected comma",l);break e}if(W.type===J){C=F;break}continue}do W=W.parent;while(null!=W&&W.type!==B);if(null==W){dt("OutOfAst Exception",l);break e}W=W.newArgument(),o++;continue;case T:r=new ct(r),W=r.case1,o++;continue;case R:W=r.case2,o++;continue;case D:l=n.charCodeAt(o+1),l>=48&&57>=l?C=H:(C=W.type===$?L:P,o++);break;case O:if(W.type===z||W.type===V||W.type===q){W=ht(W,new st(W)),W=W.getBody(),o++;continue}W=ht(W,new rt(W)),W=W.body,o++;continue;case S:do W=W.parent;while(null!=W&&W.type!==V&&W.type!==X);o++;continue}if(W.type===$&&(W=ht(W,new tt(W))),u!==C&&d!==C||null!=W.body)switch(C){case u:case s:case c:case a:case f:case p:case h:case m:case g:case v:case y:case _:case b:case x:case w:for(;W&&W.type!==U;)W=W.parent;if(null==W.body)return dt("Unexpected operator",l);W.join=C;do W=W.parent;while(null!=W&&W.type!==$);if(null==W)return dt("Unexpected operator",l);o++;continue;case I:case H:if(null!=W.body&&null==W.join)return dt("Directive expected",l);I===C&&(o++,ht(W,new nt(gt(l))),o++),H===C&&ht(W,new nt(vt(l)));continue;case L:case P:var pt=yt();if(C===L&&("null"===pt&&(pt=null),"false"===pt&&(pt=!1),"true"===pt&&(pt=!0),"string"!=typeof pt)){ht(W,new nt(pt));continue}for(;i>o;){l=n.charCodeAt(o);{if(!(33>l))break;o++}}if(40===l){K=Q,o++;var bt=ht(W,new it(W,pt));W=bt.newArgument();continue}var xt=C===L?lt:ut;W=ht(W,new xt(W,pt));break;case F:if(125===mt())continue;var wt=yt();if(58!==mt())return dt("Object parser. Semicolon expeted",l);o++,W=W.nextProp(wt),C=L;continue}else W=ht(W,new at(W,C)),o++}return null==W.body&&W.type===U?dt("Unexpected end of expression",l):(ft(r),r)}function t(n,r,o,i){var C,j;if(null==n)return null;if("."===n)return r;if(j="string"==typeof n?l.hasOwnProperty(n)===!0?l[n]:l[n]=e(n):n,null==j)return null;var N,O,S,k=j.type;if($===k){var A,E;e:for(N=0,S=j.body.length;S>N;N++)if(O=j.body[N],A=t(O,r,o,i),null!=E&&null!=E.join){if(E.join===p)if(C)C=A;else for(;S>N&&j.body[N].join!==h;N++);if(E.join===h){if(C)break e;if(A){C=A;break e}}switch(E.join){case u:C-=A;break;case s:C+=A;break;case a:C/=A;break;case c:C*=A;break;case f:C%=A;break;case v:C=C!=A;break;case y:C=C!==A;break;case m:C=C==A;break;case g:C=C===A;break;case _:C=C>A;break;case b:C=C>=A;break;case x:C=A>C;break;case w:C=A>=C}E=O}else E=O,C=A}if(U===k)return C=t(j.body,r,o,i),null==j.next?C:pt(j.next,C);if(W===k)return j.body;if(X===k){var D=j.body.body,T=D.length,N=-1;for(C=new Array(T);++N<T;)C[N]=t(D[N],r,o,i);return C}if(J===k){C={};var R=j.props;for(var M in R)C[M]=t(R[M],r,o,i);return C}if(z===k||B===k||V===k||q===k)return pt(j,r,o,i);if(K===k)switch(C=t(j.body,r,o,i),j.prefix){case u:C=-C;break;case d:C=!C}return G===k&&(C=t(j.body,r,o,i),C=t(C?j.case1:j.case2,r,o,i)),C}var n,r,o=0,i=0,l={},u="-",s="+",a="/",c="*",f="%",h="||",p="&&",d="!",m="==",g="===",v="!=",y="!==",_=">",b=">=",x="<",w="<=",C=".",j=20,N=21,O=22,S=23,k=24,A=25,E=26,D=27,T=28,R=29,M=30,L=31,P=32,I=33,H=34,F=35,$=1,U=2,z=3,B=4,q=5,V=6,W=7,J=10,X=11,K=12,G=13,Y=1,Q=2,Z={};Z[C]=1,Z[a]=2,Z[c]=2,Z[u]=3,Z[s]=3,Z[_]=4,Z[b]=4,Z[x]=4,Z[w]=4,Z[m]=5,Z[g]=5,Z[v]=5,Z[y]=5,Z[p]=6,Z[h]=6;var et,tt,nt,rt,ot,it,lt,ut,st,at,ct;!function(){et=function(e){this.parent=e,this.type=$,this.body=[],this.join=null},tt=function(e){this.parent=e},tt.prototype={constructor:tt,type:U,join:null,body:null},nt=function(e){this.type=W,this.body=e,this.join=null},rt=function(e){this.type=X,this.parent=e,this.body=new et(this)},ot=function(e){this.type=J,this.parent=e,this.props={}},ot.prototype={nextProp:function(e){var t=new tt(this);return this.props[e]=t,t}},it=function(e,t){this.parent=e,this.type=B,this.body=t,this.arguments=[],this.next=null},it.prototype={constructor:it,newArgument:function(){var e=new et(this);return this.arguments.push(e),e}},lt=function(e,t){this.type=z,this.parent=e,this.body=t,this.next=null},ut=function(e,t){this.type=q,this.parent=e,this.body=t,this.next=null},st=function(e){this.parent=e,this.body=new tt(this),this.body.body=new et(this.body),this.next=null},st.prototype={type:V,getBody:function(){return this.body.body}},at=function(e,t){this.parent=e,this.prefix=t},at.prototype={constructor:at,type:K,body:null},ct=function(e){this.body=e,this.case1=new et(this),this.case2=new et(this)},ct.prototype={constructor:ct,type:G,case1:null,case2:null}}();var ft,ht;!function(){function e(e){if(0===e.length)return null;var t=new et(e[0].parent);return t.join=e[e.length-1].join,t.body=e,t}ht=function(e,t){switch(e.type){case $:return e.body.push(t),t;case U:if(t.type===q||t.type===V)return e.next=t;case K:return e.body=t;case z:case B:case q:case V:return e.next=t}return dt("Invalid expression")},ft=function(t){if(t.type!==$)return void(null!=t.body&&"object"==typeof t.body&&ft(t.body));for(var n,r,o,i=t.body,l=0,u=i.length;u>l;l++)ft(i[l]);for(l=1;u>l&&(n=i[l],r=i[l-1],!(Z[r.join]>Z[n.join]));l++);if(l!==u){for(o=[i[0]],l=1;u>l;l++){n=i[l],r=i[l-1];var s=Z[r.join];if(s>Z[n.join]&&u-1>l){for(var a,c,f=l;++l<u&&(a=i[l].join,null!=a)&&!(s<=Z[a]););c=i.slice(f,l+1),n=e(c),ft(n)}o.push(n)}t.body=o}}}();var pt,dt;!function(){dt=function(e,t){return parser_error(e,n,o,t,"expr")},pt=function(e,n,r,o){var i,l,u,s,a,c=e,f=e.body;if("$c"===f){l=o;var h=c.next,p=null!=h&&h.body;if(null!=p&&null==l[p]){if(h.type===B&&"function"==typeof Compo.prototype[p])i=o,l=Compo.prototype[p],c=h;else for(;;){if(l=l.parent,null==l)break;if(null!=l[p]){i=l,l=l[p],c=h;break}}null==l&&(f="$c."+p,c=h)}}else if("$a"===f)l=o&&o.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=r;else if(null!=n&&(i=n,l=n[f]),null==l)for(;null!=o&&(i=o.scope,null!=i&&(l=i[f]),null==l);)o=o.parent;if(null==l)return(null==c||null!=c.next)&&log_warn("<mask:expression> Accessor error:",f),null;for(;;){if(c.type===B){for(u=[],s=-1,a=c.arguments.length;++s<a;)u[s]=t(c.arguments[s],n,r,o);l=l.apply(i,u)}if(null==l||null==c.next)break;if(c=c.next,f=c.type===V?t(c.body,n,r,o):c.body,i=l,l=l[f],null==l)break}return l}}();var mt,gt,vt,yt,_t;!function(){mt=function(){for(var e;i>o;){if(e=n.charCodeAt(o),e>32)return e;o++}return null},gt=function(e){for(var t,r,i=!1,l=39===e?"'":'"',u=o;(t=n.indexOf(l,o))>-1&&(o=t,92===n.charCodeAt(t-1));)i=!0,o++;return r=n.substring(u,o),i===!0&&(r=r.replace(__rgxEscapedChar[l],l)),r},vt=function(){for(var e,t,r=o;;){if(e=n.charCodeAt(o),46===e){if(t===!0)return dt("Invalid number",e),null;t=!0}if(!((e>=48&&57>=e||46===e)&&i>o))break;o++}return+n.substring(r,o)},yt=function(){var e,t=o,r=n.charCodeAt(o);if(34===r||39===r)return o++,e=gt(r),o++,e;for(;;){if(o===i)break;if(r=n.charCodeAt(o),36!==r&&95!==r){if(!(r>=48&&57>=r||r>=65&&90>=r||r>=97&&122>=r))break;o++}else o++}return n.substring(t,o)},_t=function(e){if(null==e&&o===i)return null;switch(e){case 40:return j;case 41:return N;case 123:return k;case 125:return A;case 91:return O;case 93:return S;case 44:return E;case 46:return D;case 59:return M;case 43:return s;case 45:return u;case 42:return c;case 47:return a;case 37:return f;case 61:return n.charCodeAt(++o)!==e?(dt("Assignment violation: View can only access model/controllers","="),null):n.charCodeAt(o+1)===e?(o++,g):m;case 33:return 61===n.charCodeAt(o+1)?(o++,61===n.charCodeAt(o+1)?(o++,y):v):d;case 62:return 61===n.charCodeAt(o+1)?(o++,b):_;case 60:return 61===n.charCodeAt(o+1)?(o++,w):x;case 38:return n.charCodeAt(++o)!==e?(dt("Not supported: Bitwise AND",e),null):p;case 124:return n.charCodeAt(++o)!==e?(dt("Not supported: Bitwise OR",e),null):h;case 63:return T;case 58:return R}return e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?L:e>=48&&57>=e?H:34===e||39===e?I:(dt("Unexpected or unsupported directive",e),null)}}();var bt;return function(){function n(e,l,u,s){if(null==e)return null;var a,c,f=e.type;if($===f)for(var h=e.body,p=h.length,d=-1;++d<p;)c=n(h[d],l,u,s),a=o(a,c);if(z===f||q===f||V===f){for(var m,g=e.body,v=e.next;null!=v;){if(m=v.type,B===m)return n(v,l,u,s);if(z!==m&&q!==m&&V!==m)return log_error("Ast Exception: next should be a symbol/function ref"),null;var y=m===V?t(v.body,l,u,s):v.body;if("string"!=typeof y)return log_warn("Can`t extract accessor name",g),null;g+="."+y,v=v.next}return g}switch(f){case U:case K:case G:c=n(e.body,l,u,s),a=o(a,c)}if(G===f&&(c=n(r.case1,l,u,s),a=o(a,c),c=n(r.case2,l,u,s),a=o(a,c)),B===f){for(var _=e.arguments,p=_.length,d=-1;++d<p;)c=n(_[d],l,u,s),a=o(a,c);c=null;var b=e;e:for(;b=b.parent;)switch(b.type){case z:case q:case V:c=b.body+(null==c?"":"."+c);break;case $:case U:break e;default:c=null;break e}null!=c&&(a=o(a,c)),e.next&&(c=n(e.next,l,u,s),a=o(a,{accessor:i(e),ref:c}))}return a}function o(e,t){if(null==e)return t;if(null==t)return e;if(("object"!=typeof e||null==e.length)&&(e=[e]),"object"!=typeof t||null==t.length)return-1===e.indexOf(t)&&e.push(t),e;for(var n=0,r=t.length;r>n;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}function i(e){var t=e;e:for(;t.parent;){switch(t.parent.type){case $:case U:break e}t=t.parent}return l(t,e.next)}function l(e,t){if(e===t||null==e)return null;if("object"!=typeof e)return e;if(null!=e.length&&"function"==typeof e.splice){for(var n=[],r=0,o=e.length;o>r;r++)n[r]=l(e[r],t);return n}var i={};for(var u in e)null!=e[u]&&"parent"!==u&&(i[u]=l(e[u],t));return i}bt=function(t,r,o,i){return"string"==typeof t&&(t=e(t)),n(t,r,o,i)}}(),{parse:e,eval:t,varRefs:bt,evalStatements:function(n,r,o,i){for(var l=e(n).body,u=[],s=l.length,a=-1,c=new et;++a<s;)c.body.push(l[a]),null==l[a].join&&(u.push(t(c,r,o,i)),c.body.length=0);return u}}}(),custom_Utils,custom_Statements,custom_Attributes,custom_Tags,custom_Tags_defs,customUtil_get,customUtil_$utils,customUtil_register,customTag_register;!function(){function e(){custom_Utils={expression:function(e,t,n,r,o){return ExpressionUtil.eval(e,t,n,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,em:null,b:null,strong:null,form:null,audio:null,video:null,canvas:null,svg:null},custom_Tags_defs={}}e(),function(e){function t(e){function t(e,t){this.tagName=e.tagName,this.attr=e.attr,this.expression=e.expression,this.nodes=e.nodes,this.nextSibling=e.nextSibling,this.parent=t,this.components=null}return t.prototype=e,t}customTag_register=function(n,r){null!=r&&"object"==typeof r&&(r.__Ctor=t(r)),e[n]=r}}(custom_Tags),function(e){function t(e){if("parsed"===e.arguments)return r(e.process);var t=fn_proxy(e.process||n,e);return t.util=e,t}function n(e,t,n,r,o,i,l){return"node"===l?(this.nodeRenderStart(e,t,n,r,o),this.node(e,t,n,r,o)):(this.attrRenderStart(e,t,n,r,o,i),this.attr(e,t,n,r,o,i))}function r(e){return function(t,n,r,o,i){var l=ExpressionUtil.evalStatements(t,n,r,i);return e.apply(null,l)}}customUtil_$utils={},customUtil_register=function(n,r){return is_Function(r)?void(e[n]=r):(e[n]=t(r),void("parsed"===r.arguments&&(customUtil_$utils[n]=r.process)))},customUtil_get=function(t){return null!=t?e[t]:e}}(custom_Utils)}();var Dom;!function(){function e(e){var t=this.nodes;if(null==t)return void(this.nodes=[e]);t.push(e);var n=t[t.length-2];n.nextSibling=e}function t(e,t){this.type=Dom.NODE,this.tagName=e,this.parent=t,this.attr={}}function n(e,t){this.content=e,this.parent=t}function r(e,t,n){this.tagName=e,this.parent=t,this.controller=n,this.attr={}}function o(){}var i=1,l=2,u=3,s=4,a=9,c=10,f=15;t.prototype={constructor:t,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:e,stringify:null,__single:null},n.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:s,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:u,nodes:null,appendChild:e},Dom={NODE:i,TEXTNODE:l,FRAGMENT:u,COMPONENT:s,CONTROLLER:a,SET:c,STATEMENT:f,Node:t,TextNode:n,Fragment:o,Component:r}}();var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;!function(e,t,n){function r(e){for(var t=-1;-1!==(t=e.indexOf(u,t))&&e.charCodeAt(t+1)!==f;)t++;if(-1===t)return e;for(var n,r=e.length,i=[],l=0,c=0;;){if(n=o(e,t+2,r,f,h),-1===n)break;for(i[c++]=l===t?"":e.substring(l,t),i[c++]=e.substring(t+2,n),l=t=n+1;-1!==(t=e.indexOf(u,t))&&e.charCodeAt(t+1)!==f;)t++;if(-1===t)break}return r>l&&(i[c]=e.substring(l)),e=null,function(e,t,n,r,o,l){if(null==e){for(var c,f="",h=i.length,p=-1;++p<h;)c=i[p],f+=p%2===1?u+s+c+a:c;return f}return util_interpolate(i,e,t,n,r,o,l)}}var o,i,l,u="~",s="[",a="]",c=126,f=91,h=93;!function(){o=function(e,t,n,r,o){for(var l,u=0,s=t;n>t;t++)if(l=e.charCodeAt(t),34!==l&&39!==l)if(l!==r){if(l===o&&-1===--u)return t}else u++;else t=i(e,t+1,n,34===l?'"':"'");return parser_warn("Group was not closed",e,s),n},l=function(e,t,n){for(var r;n>t;)if(r=e.charCodeAt(t),36!==r&&95!==r){if(!(r>=48&&57>=r||r>=65&&90>=r||r>=97&&122>=r))break;t++}else t++;return t},i=function(e,t,n,r){for(var o=t;-1!==(t=e.indexOf(r,t));){if(92!==e.charCodeAt(t-1))return t;t++}return parser_warn("Quote was not closed",e,o),n}}();var p;!function(){function t(){var e=this.attr,t="var ";for(var n in e)"var "!==t&&(t+=","),t+=n+"="+e[n];return t+";"}p=function(n,r,u,s){var a,c,f=new e("var",s);f.stringify=t;for(var h,p=1,d=2,m=3,g=4,v=p;;)if(u>r&&(c=n.charCodeAt(r))<33)r++;else if(v!==p)if(v!==d)if(v!==m){if(v===g){if(44===c){v=p,r++;continue}break}}else{switch(a=r,r++,c){case 123:case 91:r=o(n,r,u,c,c+2);break;case 39:case 34:r=i(n,r,u,39===c?"'":'"');break;default:for(;u>r&&(c=n.charCodeAt(r),44!==c&&59!==c);)r++;r--}r++,f.attr[h]=n.substring(a,r),v=g}else{if(61!==c)return parser_error("Assignment expected",n,r,c,"var"),[f,r];v=m,r++}else a=r,r=l(n,r,u),h=n.substring(a,r),v=d;return[f,r]}}();var d=2,m=3,g=5,v=6,y=7,_=8,b=9;Parser={parse:function(i){var l,u,s,a,x,w,C,j,N=new n,O=N,S=d,k=m,A=0,E=i.length;e:for(;;)if(E>A&&(w=i.charCodeAt(A))<33)A++;else{if(47===w){if(j=i.charCodeAt(A+1),47===j){for(A++;10!==w&&13!==w&&E>A;)w=i.charCodeAt(++A);continue}if(42===j){A=i.indexOf("*/",A+2)+2,1===A&&(log_warn("<mask:parse> block comment has no end"),A=E);continue}}if(k===g&&(null!=l&&(N.attr["class"]=r(l),l=null),null!=s&&(N.attr[s]=s,s=null,u=null)),null!=u){if(S===g)null==s?s=u:a=u,null!=s&&null!=a&&("class"!==s?N.attr[s]=a:l=null==l?a:l+" "+a,s=null,a=null);else if(k===m){if("var"===u){var D=p(i,A,E,N);N.appendChild(D[0]),A=D[1],S=d,u=null;continue}x=new e(u,N),N.appendChild(x),N=x,S=g}else if(k===_){if(x=new t(u,N),N.appendChild(x),N.__single===!0)do N=N.parent;while(null!=N&&null!=N.__single);S=d}u=null}if(A>=E){S===g&&(null!=l&&(N.attr["class"]=r(l)),null!=s&&(N.attr[s]=s)),w=null;break}if(S===b){for(N=N.parent;null!=N&&null!=N.__single;)N=N.parent;S=d}switch(w){case 123:k=S,S=d,A++;continue;case 62:k=S,S=d,A++,N.__single=!0;continue;case 59:if(null!=N.nodes){A++;continue}case 125:A++,k=S,S=b;continue;case 39:case 34:S===v?S=g:k=S=_,A++;var T=!1,R=!1,M=39===w?"'":'"';for(C=A;(A=i.indexOf(M,A))>-1&&92===i.charCodeAt(A-1);)T=!0,A++;-1===A&&(parser_warn("Literal has no ending",i,C),A=E),A===C&&(j=i.charCodeAt(A+1),(124===j||j===w)&&(R=!0,C=A+2,A=i.indexOf((124===j?"|":M)+M+M,C),-1===A&&(A=E))),u=i.substring(C,A),T===!0&&(u=u.replace(__rgxEscapedChar[M],M)),(S!==g||"class"!==s)&&(u=r(u)),A+=R?3:1;continue}if(S===d){if(k=m,S=m,46===w||35===w){u="div";continue}}else if(S===g)if(46===w)A++,s="class",S=y;else if(35===w)A++,s="id",S=y;else{if(61===w){A++,S=v,k===m&&null==s&&parser_warn("Unexpected tag assignment",i,A,w,S);continue}if(40===w){C=1+A,A=1+o(i,C,E,w,41),N.expression=i.substring(C,A-1),N.type=Dom.STATEMENT;continue}if(null!=s){u=s;continue}}(S===v||S===y)&&(k=S,S=g);var L=null;for(C=A;E>A;){if(w=i.charCodeAt(A),w===c&&i.charCodeAt(A+1)===f){L=!0,++A;do w=i.charCodeAt(++A);while(w!==h&&E>A)}if(39===w||34===w||47===w||60===w||44===w){parser_warn("",i,A,w,S);break e}if(k!==v&&(46===w||35===w))break;if(33>w||61===w||62===w||59===w||40===w||123===w||125===w)break;A++}if(u=i.substring(C,A),""===u){parser_warn("String expected",i,A,w,S);break}if(L===!0){if(S===m){parser_warn("Invalid interpolation (in tag name)",i,A,u,S);break}if(S===g)if("id"===s||k===v)u=r(u);else if("class"!==s){parser_warn("Invalid interpolation (in attr name)",i,A,u,S);break}}}w!==w&&parser_warn("IndexOverflow",i,A,w,S);var P=N.parent;null!=P&&P!==O&&P.__single!==!0&&null!=N.nodes&&parser_warn("Tag was not closed: "+N.parent.tagName,i);var I=O.nodes;return null!=I&&1===I.length?I[0]:O},cleanObject:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)this.cleanObject(e[t]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,t){return e&&2===e.length?t&&1===t.length?(c=e.charCodeAt(0),f=e.charCodeAt(1),h=t.charCodeAt(0),u=e[0],s=e[1],void(a=t)):void log_error("Interpolation End must be of 1 Character"):void log_error("Interpolation Start must contain 2 Characters")},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes}(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component),function(){function e(e,t,n,r){function o(e){return ExpressionUtil.eval(e,t,n,r)}if(o(e.expression))return e.nodes;for(;;){if(e=e.nextSibling,null==e||"else"!==e.tagName)break;var i=e.expression;if(null==i||""===i||o(i))return e.nodes}return null}custom_Statements["if"]={getNodes:e,render:function(t,n,r,o,i,l){var u=e(t,n,r,i);null!=u&&builder_build(u,n,r,o,i,l)}}}(),function(){function e(e,n,r,o,i,l,u,s){builder_build(t(r,e,n[0],n[1],n[2],n[3]),o,i,l,u,s)}function t(e,t,o,i,l,u){return"of"===l?is_Array(t)===!1?(log_error("<ForStatement> Value is not enumerable",t),null):n(e,t,o,i,u):"in"===l?"object"!=typeof t?(log_warn("<ForStatement> Value is not an object",t),null):(is_Array(t)&&log_warn("<ForStatement> Consider to use `for..of` for Arrays"),r(e,t,o,i,u)):void 0}function n(e,t,n,r,i){for(var l,u=-1,s=t.length,a=new Array(s);++u<s;)l={},l[n]=t[u],r&&(l[r]=u),a[u]=o(p,e,l,u,n,i);return a}function r(e,t,n,r,i){var l,u,s,a=[],c=0;for(u in t)s=t[u],l={},l[n]=u,r&&(l[r]=s),a[c++]=o(d,e,l,u,r,i);return a}function o(e,t,n,r,o,l){return{type:Dom.COMPONENT,tagName:e,nodes:t,controller:i(e,n,r,o,l)}}function i(e,t,n,r,o){return{meta:{serializeScope:!0},compoName:e,scope:t,elements:null,propVal:r,key:n,expression:o,renderEnd:l,dispose:u,serializeScope:s}}function l(e){this.elements=e}function u(){this.elements&&(this.elements.length=0)}function s(e){var t=this,n=t.expression,r=t.key,o=t.propVal,i=e[o];return null!=i&&"object"==typeof i&&(e[o]="$ref:("+n+')."'+r+'"'),e}function a(e){m=e,v=e.length,g=0;var t,n,r,o,i;if(i=c(),40===i&&(o=!0,g++,c()),t=f(),i=c(),44===i){if(o!==!0)return h("Parenthese must be used in multiple var declarion");g++,c(),n=f()}if(o){if(i=c(),41!==i)return h("Closing parenthese expected");g++}i=c();var r;return 105===i&&110===m.charCodeAt(++g)&&(r="in"),111===i&&102===m.charCodeAt(++g)&&(r="of"),null==r?h("Invalid FOR statement. (in|of) expected"):(y[0]=t,y[1]=n,y[2]=r,y[3]=m.substring(++g),y)}function c(){for(var e;v>g;g++)if(e=m.charCodeAt(g),!(33>e))return e;return-1}function f(){for(var e,t=g;v>g;g++)if(e=m.charCodeAt(g),e>48&&57>e){if(t===g)return h("Variable name begins with a digit")}else if(!(36===e||95===e||e>=97&&122>=e||e>=65&&90>=e))break;return t===g?h("Variable declaration expected"):m.substring(t,g)}function h(e){throw new Error("<ForStatement parser> "+e+" `"+m.substring(g,20)+"`")}var p="for..of::item",d="for..in::item";custom_Statements["for"]={render:function(t,n,r,o,i,l){a(t.expression);var u=ExpressionUtil.eval(y[3],n,r,i);null!=u&&e(u,y,t.nodes,n,r,o,i,l)},build:e,parseFor:a,createForNode:o,getNodes:t,getHandler:function(e,t){return i(e,t)}},function(){function e(e){function t(){}return t.prototype={meta:{serializeScope:!0},serializeScope:s,type:Dom.COMPONENT,compoName:e,renderEnd:l,dispose:u},t}custom_Tags[p]=e(p),custom_Tags[d]=e(d)}();var m,g,v,y=["prop1","prop2","in|of","expression"]}(),function(){function e(e,n){for(var r=n.length,o=new Array(r),i=e.nodes,l=e.expression,u="."===l?'."':"("+e.expression+')."',s=0;r>s;s++)o[s]=t(i,n[s],u,s);return o}function t(e,t,r,o){return{type:Dom.COMPONENT,tagName:"each::item",nodes:e,controller:n(t,o,r)}}function n(e,t,n){return{compoName:"each::item",model:e,scope:{index:t},modelRef:n+t+'"',attr:null,meta:null}}custom_Statements.each={render:function(t,n,r,o,i,l){var u=ExpressionUtil.eval(t.expression,n,r,i);null!=u&&builder_build(e(t,u),u,r,o,i,l)}}}(),custom_Statements["with"]={render:function(e,t,n,r,o,i){var l=ExpressionUtil.eval(e.expression,t,n,o);builder_build(e.nodes,l,n,r,o,i)}},function(){function e(e,n,r,o,i){if(null==n)return null;for(var l,u,s,a,c=n.length,f=-1;++f<c;)if(l=n[f],"default"!==l.tagName)if("case"===l.tagName)if(u=l.expression){if(t(u,r,o,i)==e){s=l;break}}else log_warn("<mask:switch:case> Expression expected");else log_warn("<mask:switch> Case expected",l.tagName);else a=l;return null==s&&(s=a),null!=s?s.nodes:null}var t=ExpressionUtil.eval;custom_Statements["switch"]={render:function(n,r,o,i,l,u){var s=t(n.expression,r,o,l),a=e(s,n.nodes,r,o,l);null!=a&&builder_build(a,r,o,i,l,u)},getNodes:e}}(),function(){function e(e){this.parent=e,this.compoName="include",this.components=[],this.templates=null}custom_Statements.include={render:function(t,n,r,o,i,l){for(var u,s=ExpressionUtil.evalStatements(t.expression);null!=i&&(u=i.resource,null==u);)i=i.parent;var a=new e(i),c=Compo.pause(a,r);include.instance(u&&u.url).load.apply(u,s).done(function(e){a.templates=e.load,builder_build(t.nodes,n,r,o,a,l),c()})}}}(),custom_Statements["import"]={render:function(e,t,n,r,o,i){var l=e.expression,u=ExpressionUtil.evalStatements(l,t,n,o),s=u[0];if("string"!=typeof s)return void log_error("<mask:import> Invalid argument",l);for(;;){if("include"===o.compoName)break;if(o=o.parent,null==o)break}if(null!=o){var a=o.templates[s];null!=a&&builder_build(Parser.parse(a),t,n,r,o,i)}}},custom_Tags["var"]=VarStatement,VarStatement.prototype={renderStart:function(e,t){var n,r,o=this.parent,i=o.scope;null==i&&(i=o.scope={}),this.model={};for(n in this.attr)r=ExpressionUtil.eval(this.attr[n],e,t,o),this.model[n]=i[n]=r;this.attr={}},onRenderStartClient:function(){var e=this.parent,t=e.scope;null==t&&(t=e.scope={});for(var n in this.model)t[n]=this.model[n]}},function(){function e(e,t){for(var n=0;n<e.length;n++)e[n].style.display=t?"":"none"}custom_Statements.visible={toggle:e,render:function(t,n,r,o,i,l){var u=[];builder_build(t.nodes,n,r,o,i,u),arr_pushMany(l,u);var s=ExpressionUtil.eval(t.expression,n,r,i);e(u,s)}}}();var HtmlDom;!function(){function e(t,n){if(null!=t&&t.nodeType===Dom.FRAGMENT&&(t=t.firstChild),null==t)return null;if(t instanceof HtmlDom.Component==!1)return null;if(":document"===t.compoName)return t;if(null==n&&(n=0),4===n)return null;var r;return r=e(t.nextSibling,n),r?r:e(t.firstChild,++n)}function t(e,t){for(var n=e.firstChild;n&&n.tagName!==t;)n=n.nextSibling;return n}function n(e,t){if("object"==typeof e)return e;var n,o,l,u,f,h,p,d,m,g=0,v=e.length;for(n="up"===t?s:a;v>g;)f=e.charCodeAt(g),33>f||(h=i(e,g+1,v),46===f?(o="class",l=c,u=r(e.substring(g+1,h))):35===f?(o="id",l=c,u=e.substring(g+1,h)):91===f?(d=e.indexOf("=",g),-1===d&&console.error('Attribute Selector: should contain "="'),l=c,o=e.substring(g+1,d),f=e.charCodeAt(d+1),m=34===f||39===f?2:1,u=e.substring(d+m,h-m+1),h++):(l=null,o="tagName",u=e.substring(g,h).toUpperCase()),g=h,null!=p?(null==p.filters&&(p.filters=[]),p.filters.push({key:o,selector:u,prop:l})):p={key:o,prop:l,selector:u,nextKey:n,filters:null});return p}function r(e){return function(t){return-1!==o(t,e)}}function o(e,t,n){if(null==e)return-1;if(null==n&&(n=0),n=e.indexOf(t,n),-1===n)return-1;if(n>0&&e.charCodeAt(n-1)>32)return o(e,t,n+1);var r=e.length,i=t.length;return r-i>n&&e.charCodeAt(n+i)>32?o(e,t,n+1):n}function i(e,t,n){for(var r,o=!1,i=!1;n>t&&(r=e.charCodeAt(t),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)t++;return t}function l(e,t){"string"==typeof t&&(t=n(t));var r=t.prop?e[t.prop]:e,o=!1;if(null==r)return!1;if("function"==typeof t.selector?o=t.selector(r[t.key]):null!=t.selector.test?t.selector.test(r[t.key])&&(o=!0):r[t.key]===t.selector&&(o=!0),o===!0&&null!=t.filters)for(var i,u=0,s=t.filters.length;s>u;u++)if(i=t.filters[u],l(e,i)===!1)return!1;return o}HtmlDom={},obj_extend(Dom,{DOCTYPE:11,UTILNODE:12});var u={area:1,base:1,br:1,col:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,menuitem:1,meta:1,param:1,source:1,track:1,wbr:1};!function(){function n(e,t){if(null==t&&(t={}),t.compoName=e.compoName,t.ID=e.ID,e.components){for(var r,o=[],i=e.components,l=0,u=i.length;u>l;l++)r=i[l],o.push(n(r));t.components=o}return t}HtmlDom.stringify=function(r,o,i,l){if(l=n(l),null==l.components||0===l.components.length)return r.toString();var u=e(r),s={model:i._model.stringify(),ID:i._id},a={type:"m"},c=Meta.stringify(s,a),f=Meta.close(s,a);if(u){var h=t(u,"HTML");if(h){var p=t(h,"BODY");p?(p.insertBefore(new HtmlDom.Comment(c),p.firstChild),p.appendChild(new HtmlDom.Comment(f))):console.warn("Body not found")}return r.toString()}return c+r.toString()+f}}();var s="parentNode",a="firstChild",c="attributes";HtmlDom.Node=function(){},function(){HtmlDom.Node.prototype={parentNode:null,firstChild:null,lastChild:null,nextSibling:null,get length(){for(var e=0,t=this.firstChild;null!=t;)e++,t=t.nextSibling;return e},get childNodes(){for(var e=[],t=this.firstChild;null!=t;)e.push(t),t=t.nextSibling;return e},querySelector:function(e){for(var t,r="string"==typeof e?n(e):e,o=this.firstChild;null!=o;o=o.nextSibling)if(l(o,r))return o;if(null!=o)return o;for(o=this.firstChild;null!=o;o=o.nextSibling)if("function"==typeof o.querySelector&&(t=o.querySelector(r),null!=t))return t;return null},appendChild:function(e){if(null==e)return e;if(e.nodeType===Dom.FRAGMENT){var t=e;if(null==t.firstChild)return t;for(var n=t.firstChild;;){if(n.parentNode=this,null==n.nextSibling)break;n=n.nextSibling}return null==this.firstChild?this.firstChild=t.firstChild:t.lastChild.nextSibling=t.firstChild,t.lastChild=t.lastChild,t}return null==this.firstChild?this.firstChild=this.lastChild=e:(this.lastChild.nextSibling=e,this.lastChild=e),e.parentNode=this,e},insertBefore:function(e,t){var n=this.firstChild;if(n!==t)for(;null!=n&&n.nextSibling!==t;)n=n.nextSibling;if(null==n)return this.appendChild(e);if(e.nodeType===Dom.FRAGMENT){var r=e,o=r.firstChild;if(null==o)return r;for(;null!=o;)o.parentNode=this,o=o.nextSibling;return n===t&&n===this.firstChild?(this.firstChild=r.firstChild,r.lastChild.nextSibling=n,r):(n.nextSibling=r.firstChild,r.lastChild.nextSibling=t,r)}return e.parentNode=this,n===t&&n===this.firstChild?(this.firstChild=e,e.nextSibling=n,e):(n.nextSibling=e,e.nextSibling=t,e)}}}(),HtmlDom.DOCTYPE=function(e){this.doctype=e},HtmlDom.DOCTYPE.prototype={constructor:HtmlDom.DOCTYPE,nodeType:Dom.DOCTYPE,toString:function(){return this.doctype}},HtmlDom.DocumentFragment=function(){},obj_inherit(HtmlDom.DocumentFragment,HtmlDom.Node,{nodeType:Dom.FRAGMENT,toString:function(){for(var e=this.firstChild,t="";null!=e;)t+=e.toString(),e=e.nextSibling;return t}}),HtmlDom.Element=function(e){this.tagName=e.toUpperCase(),this.attributes={}},function(){function e(e){null==e.attributes,this.attr=e.attributes,this.className=this.attr["class"]||""}e.prototype={get length(){return this.className.split(/\s+/).length},contains:function(e){return-1!==o(this.className,e)},remove:function(e){var t=o(this.className,e);if(-1!==t){var n=this.className;this.className=this.attr["class"]=n.substring(0,t)+n.substring(t+e.length)}},add:function(e){-1===o(this.className,e)&&(this.className=this.attr["class"]=this.className+(""===this.className?"":" ")+e)}},obj_inherit(HtmlDom.Element,HtmlDom.Node,{nodeType:Dom.NODE,setAttribute:function(e,t){this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},get classList(){return new e(this)},toString:function(){var e,t,n=this.tagName.toLowerCase(),r=this.attributes,o="<"+n;for(var i in r)e=r[i],o+=" "+i+'="'+("string"==typeof e?e.replace(/"/g,"&quot;"):e)+'"';var l=1===u[n],t=this.firstChild;if(null==t)return o+(l?"/>":"></"+n+">");for(o+=l?"/>":">",l&&(o+="<!--~-->");null!=t;)o+=t.toString(),t=t.nextSibling;return l?o+"<!--/~-->":o+"</"+n+">"},get value(){return this.attributes.value},set value(e){this.attributes.value=e},get selected(){return this.attributes.selected},set selected(e){return e?void(this.attributes.selected="selected"):void delete this.attributes.selected},get checked(){return this.attributes.checked},set checked(e){return e?void(this.attributes.cheched="cheched"):void delete this.attributes.cheched}})}(),HtmlDom.TextNode=function(e){this.textContent=String(e)},function(){HtmlDom.TextNode.prototype={constructor:HtmlDom.TextNode,nodeType:Dom.TEXTNODE,nextSibling:null,toString:function(){return this.textContent?e(this.textContent):""}};var e=function(){function e(e){return n[e]}function t(t){return t.replace(/[&"'<>\/]/g,e)}var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return t}()}(),function(){function e(e,t){null!=e&&(null==e.components&&(e.components=[]),e.components.push(t))}function t(e,t,n,r,o,i){return null!=e?is_Function(e)?new e(t,n,r,o,i):is_Function(e.__Ctor)?new e.__Ctor(t,n,r,o,i):e:{model:t.model,expression:t.expression,modelRef:t.modelRef,container:t.container,meta:compo_getMetaInfo(i),attr:null}}function n(e,t,n,o,i,l){var u=i.appendChild(document.createComment(""));return function(){return r(e,t,n,o,u,l)}}function r(e,t,n,r,o,i){compo_wrapOnTagName(e,t),null!=e.model&&(n=e.model);var l=document.createDocumentFragment(),u=[];if(build_childNodes(t,n,r,l,e,u),null!=l.firstChild&&o.parentNode.insertBefore(l,o),null==e.tagName){var s,a=e.handlers&&e.handlers.attr;for(var c in e.attr)s=null,a&&is_Function(a[c])&&(s=a[c]),null==s&&is_Function(custom_Attributes[c])&&(s=custom_Attributes[c]),null!=s&&s(o,e.attr[c],n,r,u[0],e)}is_Function(e.onRenderEndServer)&&e.onRenderEndServer(u,n,r,o.parentNode),arr_pushMany(i,u)}HtmlDom.Component=function(r,o,i,l,u){var s,a,c,f,h=r.compoName||r.tagName,p=r.controller||custom_Tags[h];if(null!=p&&(f=compo_getMetaInfo(p).cache),null!=f&&(s=Cache.getCompo(o,i,h,p),null!=s))return this.compo=s,s.__cached&&(s.render=fn_doNothing),void e(u,s);s=t(p,r,o,i,l,u);var d=compo_getMetaInfo(s).cache;d&&Cache.cacheCompo(o,i,h,s,d),this.compo=s,this.node=r;var m=compo_getRenderMode(u);(mode_SERVER_ALL===m||mode_SERVER_CHILDREN===m)&&compo_setMode(s,mode_SERVER_ALL),a=obj_extend(s.attr,r.attr),void 0!==a["x-mode"]&&(m=a["x-mode"],compo_setMode(s,m)),void 0!==a["x-mode-model"]&&(s.modeModel=a["x-mode-model"]),compo_isServerMode(this.compo)===!1&&(this.ID=this.compo.ID=++i._id),"client"===m&&(s.render=fn_doNothing),s.attr=a,s.parent=u,null==s.compoName&&(s.compoName=h),null==s.model&&(s.model=o),null==s.nodes&&(s.nodes=r.nodes),this.compoName=s.compoName;
for(c in a)is_Function(a[c])&&(a[c]=a[c]("attr",o,i,l,u,c));return is_Function(s.renderStart)&&s.renderStart(o,i,l),e(u,s),s.async===!0?void s.await(n(s,r,o,i,this)):(compo_wrapOnTagName(s,r),void(is_Function(s.render)&&s.render(o,i,this,s)))},obj_inherit(HtmlDom.Component,HtmlDom.Node,{nodeType:Dom.COMPONENT,compoName:null,instance:null,components:null,ID:null,toString:function(){var e=(this.firstChild,this.compo);if(void 0!==e.__cached)return e.__cached;var t=e.compoName,n=compo_getMetaInfo(e),r=e.attr,o=e.nodes,i=e.scope;if(null!=i&&n.serializeScope){for(var l=e.parent,u=e.model;null==u&&null!=l;)u=l.model,l=l.parent;i=e.serializeScope(i,u)}var s={ID:this.ID,modelID:this.modelID,compoName:t,attr:r,expression:e.expression,mask:"client"===n.mode?mask.stringify(o,0):null,nodes:n.serializeNodes!==!0?null:(e.serializeNodes||mask.stringify)(this.node),scope:i},a={single:null==this.firstChild,type:"t",mode:n.mode},c=Meta.stringify(s,a);if(null!=e.toHtml)c+=e.toHtml();else for(var f=this.firstChild;null!=f;)c+=f.toString(),f=f.nextSibling;return"client"!==n.mode&&(c+=Meta.close(s,a)),n.cache&&(e.__cached=c),c}})}(),HtmlDom.UtilNode=function(e,t,n,r){this.meta={utilType:e,utilName:t,value:n,attrName:r,current:null}},function(){HtmlDom.UtilNode.prototype={nodeType:Dom.UTILNODE,nextSibling:null,firstChild:null,appendChild:function(e){this.firstChild=e},toString:function(){var e=this.meta,t={type:"u",single:null==this.firstChild},n=Meta.stringify(e,t);return null==this.firstChild?n:n+this.firstChild.toString()+Meta.close(e,t)}}}(),HtmlDom.Comment=function(e){this.textContent=e||"",this.textContent&&(this.textContent=this.textContent.replace("<!--","").replace("-->",""))},HtmlDom.Comment.prototype={nextSibling:null,parentNode:null,toString:function(){return""===this.textContent?"":"<!--"+this.textContent.replace(/>/g,"&gt;")+"-->"}},document={createDocumentFragment:function(){return new HtmlDom.DocumentFragment},createElement:function(e){return new HtmlDom.Element(e)},createTextNode:function(e){return new HtmlDom.TextNode(e)},createComment:function(e){return new HtmlDom.Comment(e)},createComponent:function(e,t,n,r,o){return new HtmlDom.Component(e,t,n,r,o)}}}();var builder_build,builder_componentID,build;!function(){var e;!function(){function t(e,t){if(null==t)return-1;var n="m"+ ++e._id;return e._models[n]=t,n}e=function(e,t){this._models={},this._id=t||0,this.append(e)},e.prototype={append:function(e){return t(this,e)},tryAppend:function(e){if(mode_SERVER_ALL===e.mode)return-1;if(mode_model_NONE===e.modeModel)return-1;var n=null!=e.modelRef?"$ref:"+e.modelRef:e.model;return t(this,n)},stringify:function(){return Class.stringify(this._models)}}}(),function(){function e(){}custom_Tags[":document"]=e,e.prototype={isDocument:!0,mode:"server",render:function(e,t,n){var r=this.attr,o=this.nodes,i=r.doctype||"html";delete r.doctype,n.appendChild(new HtmlDom.DOCTYPE("<!DOCTYPE "+i+">"));for(var l,u,s,a,c={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},f=0,h=o.length;h>f;f++)a=o[f],"head"!==a.tagName?"body"!==a.tagName?s=!0:u=a:l=a;if(null==u&&(u={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=l&&c.nodes.push(l),null!=u&&c.nodes.push(u),s)for(var a,p=o.length,f=0;p>f;f++)a=o[f],"head"!==a.tagName&&"body"!==a.tagName&&u.nodes.push(a);var d=this.parent;return d.components=[],build(c,e,t,n,d),n}}}();var t=function(){var e=function(e){return function(t){try{return e.createElement(t)}catch(n){return log_error(t,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),null}}}(document);return function(t,n,r,o,i,l){var u=t.tagName,s=t.attr,a=e(u);if(null!=a){null!=l&&(l.push(a),s["x-compo-id"]=i.ID),null!=o&&o.appendChild(a);var c,f;for(c in s)is_Function(s[c])?(f=s[c]("attr",n,r,a,i,c),f instanceof Array&&(f=f.join(""))):f=s[c],f&&(is_Function(custom_Attributes[c])?custom_Attributes[c](t,f,n,r,a,i,o):a.setAttribute(c,f));return a}}}(),n=function(){var e=function(e){return function(t,n){t.appendChild(e.createTextNode(n))}}(document);return function(t,n,r,o,i){var l=t.content;if(is_Function(l)){var u=l("node",n,r,o,i);if("string"==typeof u)return void e(o,u);for(var s,a="",c=u.length,f=0;c>f;f++)if(s=u[f],"object"!=typeof s)a+=s;else{if(""!==a&&(e(o,a),a=""),null==s.nodeType){a+=s.toString();continue}o.appendChild(s)}return void(""!==a&&e(o,a))}e(o,l)}}();builder_build=function(t,n,r,o,i,l){return null==o&&(o=new HtmlDom.DocumentFragment),null==i&&(i=new Dom.Component),null==r&&(r={_model:null,_ctx:null}),null==r._model&&(r._model=new e(n,Cache.modelID)),null==r._id&&(r._id=Cache.controllerID),build(t,n,r,o,i,l)},build=function(e,r,o,i,l,u){if(null==e)return i;if(null!=o._redirect||null!=o._rewrite)return i;var s,a,c=node_getType(e);if(10===c){var f,h=e.length;for(f=0;h>f;f++)build(e[f],r,o,i,l);return i}var p=e.tagName;if("else"===p)return i;if(15===c){var d=custom_Statements[p];if(null==d){if(null==custom_Tags[p])return log_error("<mask: statement is undefined",p),i;c=4}if(15===c)return d.render(e,r,o,i,l,u),i}if(1===c&&(58===p.charCodeAt(0)?(c=4,e.mode=mode_CLIENT,e.controller=mock_TagHandler.create(p,null,mode_CLIENT)):(i=t(e,r,o,i,l,u),u=null)),2===c)return n(e,r,o,i,l),i;if(4===c){s=document.createComponent(e,r,o,i,l),i.appendChild(s),i=s;var m=s.compo;if(null!=m){var g=-1;if(m.model&&l.model!==m.model&&(r=m.model,g=o._model.tryAppend(m)),null!=m.modelRef&&(g=o._model.tryAppend(m)),-1!==g&&(s.modelID=g),m.async)return s;if(m.render)return s;l=m,e=m,a=[]}}if(build_childNodes(e,r,o,i,l,a),i.nodeType===Dom.COMPONENT){var v=l.onRenderEndServer;null!=v&&l.async!==!0&&v.call(l,a,r,o,i,l)}return arr_pushMany(u,a),i}}();var mask_run;!function(){mask_run=function(){var e,t,n,r,o,i,l=_Array_slice.call(arguments);for(r=l.length,o=-1;++o<r;)i=l[o],i instanceof Node?e=i:is_Function(i)?n=i:is_Object(i)&&(t=i);null==e&&(e=document.body);var u=is_Function(n)?new n:new Compo;u.ID=++builder_componentID,null==t&&(t=u.model||{});var s,a=_Array_slice.call(document.getElementsByTagName("script")),c=!1;for(r=a.length,o=-1;++o<r;)if(s=a[o],"text/mask"===s.getAttribute("type")&&"true"===s.getAttribute("data-run")){var f=builder_build(parser_parse(s.textContent),t,{},null,u);s.parentNode.insertBefore(f,s),c=!0}return c===!1&&log_warn("No blocks found: <script type='text/mask' data-run='true'>...</script>"),is_Function(u.renderEnd)&&u.renderEnd(e,t),Compo.signal.emitIn(u,"domInsert"),u}}();var mask_merge;!function(){function e(e,o,i,u){if(null==e)return null;if(is_Array(e))return t(e,o,i,u);switch(e.type){case x:return l(e,o,i);case b:case C:return r(e,o,i,u);case w:return n(e,o,i,u)}return log_warn("Uknown type",e.type),null}function t(t,n,r,o){for(var i,l,u=[],s=t.length,a=-1;++a<s;){if(l=t[a],l.tagName===g){if(null!=i)continue;if(l.expression&&!d(l.expression,n,r))continue;i=e(t[a].nodes,n,r,o)}else i=e(l,n,r,o);c(u,i)}return u}function n(e,n,r,o){var i=new Dom.Fragment;return i.parent=o,i.nodes=t(e.nodes,n,r,i),i}function r(t,n,r,l){var u=t.tagName;if(64!==u.charCodeAt(0))return i(t,n,r,l);var s=t.attr.id;if(u===_&&null==s)return r.nodes;if(y===u){var a,h=n[t.expression];if(null==h)return log_error("No template node: @"+t.expression),null;if(is_Array(h)===!1)return a=h,e(t.nodes,f(a.nodes,a.nodes,new m(n)),a,l);for(var g=new Dom.Fragment,x=h.length,w=-1;++w<x;)a=h[w],c(g,e(t.nodes,f(a.nodes,a.nodes,new m(n)),a,l));return g}if(v===u){var C=d(t.expression,n,r);return C?e(t.nodes,n,r,l):null}null==s&&(s=u.substring(1));var j=n.$getNode(s);if(null==j)return null;j.parent&&p(l,j.parent);var N,O=j.nodes;if(void 0!==t.attr.as){var S=t.attr.as;N={type:b,tagName:S,attr:o(t.attr,j.attr,n,r),parent:l,nodes:O},N.attr.as=null}if(null==t.nodes)return N||O;var k=e(t.nodes,f(O,O,new m(n)),j,N||l);return null!=N?(N.nodes=k,N):k}function o(e,t,n,r){if(null==e||null==t)return e||t;var o=u(e,n,r);for(var i in t)o[i]=s(t[i],n,r);return o}function i(t,n,r,o){var i=t.tagName||t.compoName;if(":template"===i){var l=s(t.attr.id,n,r);return Mask.templates.register(l,t.nodes),null}if(":import"===i){var l=s(t.attr.id,n,r),a=Mask.templates.resolve(t,l);return e(a,n,r,o)}var c={type:t.type,tagName:i,attr:u(t.attr,n,r),expression:s(t.expression,n,r),controller:t.controller,parent:o};return t.nodes&&(c.nodes=e(t.nodes,n,r,c)),c}function l(e,t,n,r){return{type:e.type,content:s(e.content,t,n),parent:r}}function u(e,t,n){var r,o=_Object_create(e);for(var i in o)r=o[i],null!=r&&(o[i]=s(r,t,n));return o}function s(e,t,n){var r=-1,o=!1,i=e;if("function"==typeof e&&(o=!0,i=e()),"string"!=typeof i||-1===(r=i.indexOf("@")))return e;for(var l,u=i.substring(0,r),s=i.length,c=91===i.charCodeAt(r+1),f=-1;s>r;){if(f=r,c===!0)r=i.indexOf("]",f),-1===r&&(r=s),f+=2;else for(;s>r&&(l=i.charCodeAt(++r),36===l||95===l||46===l||l>=48&&57>=l||l>=65&&90>=l||l>=97&&122>=l););var h=i.substring(f,r),p=c?d:a,m=p(h,t,n);null!=m&&(u+=m),f=c?r+1:r,r=i.indexOf("@",r),-1===r&&(r=s),u+=i.substring(f,r)}return o?parser_ensureTemplateFunction(u):u}function a(e,t,n){var r=e.indexOf(".");if(-1===r)return log_warn("Merge templates. Accessing node",e),"";var o=e.substring(0,r),i=o.substring(1),l=e.substring(r+1),u=null;return null!=n&&("@attr"===o?u=n.attr:o===n.tagName&&(u=n)),null==u&&(u=t.$getNode(i)),null==u?(log_error("Merge templates. Node not found",o),""):obj_getProperty(u,l)}function c(e,t){if(null!=t)if("function"!=typeof t.concat){if(t.type===w)return void c(e,t.nodes);if("function"==typeof e.appendChild)return void e.appendChild(t);var n=e.length;if(n>0){var r=e[n-1];r.nextSibling=t}e.push(t)}else for(var o=t.length,i=0;o>i;i++)c(e,t[i])}function f(e,t,n){if(null==t)return n;if(is_Array(t)){for(var r=t.length,o=-1;++o<r;)f(t===e?t[o]:e,t[o],n);return n}var i=t.type;if(i===x)return n;if(i===b){var l=t.tagName;if(null!=l&&64===l.charCodeAt(0)){var u=l.substring(1);-1!==j.indexOf(" "+u+" ")&&log_error("MaskMerge. Reserved Name",u);var s={tagName:t.tagName,parent:h(e,t),nodes:t.nodes,attr:t.attr,expression:t.expression};if(null==n[u])n[u]=s;else{var a=n[u];is_Array(a)?a.push(s):n[u]=[a,s]}return n}}return f(e,t.nodes,n)}function h(e,t){if(t===e)return null;for(var n,r,o=t.parent;;){if(null==o)break;if(o===e&&e.type!==b)break;var i={type:o.type,tagName:o.tagName,attr:o.attr,controller:o.controller,expression:o.expression,nodes:null,parent:null};null==r?n=r=i:(n.parent=i,n=i),o=o.parent}return r}function p(e,t){for(var n=e,r=t;null!=n&&null!=r;){r.tagName&&(n.tagName=r.tagName),r.expression&&(n.expression=r.expression);for(var o in r.attr)n.attr[o]=r.attr[o];n=n.parent,r=r.parent}}function d(e,t,n){return n&&(t.attr=n.attr),ExpressionUtil.eval(e,t,null,t)}function m(e){this.scope=this,this.parent=e}mask_merge=function(t,n,r){"string"==typeof t&&(t=parser_parse(t)),"string"==typeof n&&(n=parser_parse(n));var o=f(n,n,new m);return e(t,o,r)};var g="@else",v="@if",y="@each",_="@placeholder",b=Dom.NODE,x=Dom.TEXTNODE,w=Dom.FRAGMENT,C=Dom.STATEMENT,j=" else placeholder each attr if parent scope";m.prototype={parent:null,attr:null,scope:null,$getNode:function(e){for(var t,n=this;null!=n;){if(t=n[e],null!=t)return t;n=n.parent}}}}();var cache={},Mask={render:function(e,t,n,r,o){return null!=r&&"function"!=typeof r.appendChild&&(log_error(".render(template[, model, ctx, container, controller]","Container should implement .appendChild method"),log_warn("Args:",arguments)),"string"==typeof e&&(e=_Object_hasOwnProp.call(cache,e)?cache[e]:cache[e]=parser_parse(e)),null==n&&(n={}),builder_build(e,t,n,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,run:mask_run,merge:mask_merge,registerHandler:customTag_register,getHandler:function(e){return null!=e?custom_Tags[e]:custom_Tags},registerStatement:function(e,t){custom_Statements[e]=is_Function(t)?{render:t}:t},getStatement:function(e){return null!=e?custom_Statements[e]:custom_Statements},registerAttrHandler:function(e,t,n){is_Function(t)&&(n=t),custom_Attributes[e]=n},getAttrHandler:function(e){return null!=e?custom_Attributes[e]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(e,t){log_warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",e),this.registerUtility=this.registerUtil,this.registerUtility(e,t)},getUtility:function(e){return log_warn("@getUtility - deprecated - use getUtil(utilName)",e),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:function(e,t){return log_warn("mask.getProperty is deprecated. Use `mask.obj.get`"),obj_getProperty(e,t)},ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(e){global.eval(e)},obj:{get:obj_getProperty,set:obj_setProperty,extend:obj_extend},is:{Function:is_Function,String:is_String,ArrayLike:is_ArrayLike},on:listeners_on,off:listeners_off,delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(e){builder_componentID=e},cfg:function(){var e=arguments;if(0===e.length)return __cfg;var t;if(2===e.length)return t=e[0],void(__cfg[t]=e[1]);var n=e[0];if("object"==typeof n)for(t in n)__cfg[t]=n[t]}};Mask.renderDom=Mask.render;var Meta,mock_TagHandler;!function(){function e(e,t){function n(e){this.tagName=e.tagName,this.compoName=e.tagName,this.attr=e.attr,this.expression=e.expression,this.nodes=e.nodes,this.nextSibling=e.nextSibling,this.parent=t,this.components=null}return n.prototype=e,n}Meta=function(){function e(e){return null==e?"null":"object"!=typeof e?e:(is_Array(e)===!1&&(e=r(e)),JSON.stringify(e))}function t(e){if("#"===l[o]){o++;var t=l.indexOf(s);-1===t&&(t=l.length),e.ID=parseInt(l.substring(o,t),10),o=t}}function n(e){if(o>i-5)return!1;if(l[o++]!==s||" "!==l[o++])return o=-1,!1;var t=o,n=l,r=n.indexOf(":",t),u=n.substring(t,r),a=n.indexOf(s+" ",r),c=n.substring(r+1,a);return"attr"===u&&(c=JSON.parse(c)),e[u]=c,o=a,!0}function r(e){var t=Object.create(e);for(var n in t)t[n]=t[n];return t}var o,i,l,u=30,s=String.fromCharCode(u),a="<!--",c="-->";return{stringify:function(t,n){switch(n.mode){case"server":case"server:all":return""}var r=n.type,o=n.single,i=a+r;t.ID&&(i+="#"+t.ID),i+=s+" ";for(var l in t)"ID"!==l&&null!=t[l]&&(i+=l+":"+e(t[l])+s+" ");return o&&(i+="/"),i+=c},close:function(e,t){switch(t.mode){case"server":case"server:all":return""}return a+"/"+t.type+(e.ID?"#"+e.ID:"")+c},parse:function(e){o=0,l=e,i=e.length;var r={},u=e[o];for("/"===u&&(r.end=!0,o++),r.type=e[o++],t(r);n(r););return-1===o?{}:("/"===e[i-1]&&(r.single=!0),void 0!==r.scope&&(r.scope=JSON.parse(r.scope)),r)}}}();var t=function(){function e(e,t,n){this.meta={ID:n,name:e,value:t}}return e.prototype={toString:function(){var e=this.meta,t={type:"a",single:!0};return Meta.stringify(e,t)}},{create:function(t,n,r){return function(o,i,l,u,s,a,c){return"server"!==r&&c.insertBefore(new e(t,i,++u._id),s),"client"!==r?n(o,i,l,u,s,a):""}}}}();mock_TagHandler=function(){function e(){}return e.prototype={render:function(){},mode:"client"},{create:function(t,n,r){return"client"===r||"client"===n.prototype.mode?e:(n.prototype.mode=r,n)}}}();var n;!function(){function e(e,n,r){return"server"===r?n:function(o,i,l,u,s,a,c){var f=new HtmlDom.UtilNode(c,e,o,a);if("attr"===c&&u.parentNode.insertBefore(f,u),"partial"===r){var h,p=t[c];return is_Function(n[p])===!1?(log_error("Utils partial function is not defined",p),""):(h=n[p](o,i,l,u,s),"node"===c?(f.appendChild(n.element),f):f.meta.current=h)}return"node"===c?f:""}}n={create:e};var t={node:"nodeRenderStart",attr:"attrRenderStart"}}();var r=Mask.registerUtil;Mask.registerAttrHandler=function(e,n,r){if(null==r)return void(custom_Attributes[e]=n);if("string"==typeof r){var o=n;n=r,r=o}custom_Attributes[e]=t.create(e,r,n)},Mask.registerUtil=function(e,t,o){null==o&&is_Object(t)&&(o=t.mode),r(e,null==o?t:n.create(e,t,o))},Mask.registerUtility=Mask.registerUtil,Mask.registerHandler=function(t,n){null!=n&&"object"==typeof n&&(n.__Ctor=e(n)),custom_Tags_defs.hasOwnProperty(t)&&obj_extend(n.prototype,custom_Tags_defs[t]);var r="function"==typeof n?n.prototype:n;return null==r.meta&&(r.meta=r.$meta||{}),r.cache&&(r.meta.cache=r.cache),r.mode&&(r.meta.mode=r.mode),compo_getRenderMode(n)===compo_renderMode_CLIENT?void(custom_Tags[t]=mock_TagHandler.create(t,n,"client")):void(custom_Tags[t]=n)},Mask.compoDefinitions=function(e,t,n){var r=custom_Tags,o=custom_Tags_defs;for(var i in e)o[i]=e[i],void 0===r[i]?r[i]=mock_TagHandler.create(i,null,"client"):obj_extend(r[i].prototype,e[i]);var l=function(){};for(var u in t)"client"===t[u].mode&&Mask.registerUtil(u,l,"client");for(var u in n)"client"===n[u].mode&&Mask.registerAttrHandler(u,l,"client")}}(),function(){function e(e,t,n,r){return HtmlDom.stringify(e,t,n,r)}Mask.render=function(t,n,r,o,i){null!=o&&"function"!=typeof o.appendChild&&(console.error(".render(template[, model, ctx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof t&&(t=_Object_hasOwnProp.call(cache,t)?cache[t]:cache[t]=parser_parse(t)),null==i&&(i=new Dom.Component),null==r&&(r={_model:null,_ctx:null});var l=builder_build(t,n,r,o,i);return r.async===!0?(r.done(function(){r.resolve(e(l,n,r,i))}),null):e(l,n,r,i)}}();var Compo=exports.Compo=function(mask){function domLib_initialize(){null!=domLib&&null!=domLib.fn&&(domLib.fn.compo=function(e){if(0===this.length)return null;var t=Anchor.resolveCompo(this[0]);return null==e?t:find_findSingle(t,selector_parse(e,Dom.CONTROLLER,"up"))},domLib.fn.model=function(e){var t=this.compo(e);if(null==t)return null;for(var n=t.model;null==n&&t.parent;)t=t.parent,n=t.model;return n},function(){var e=["append","prepend","before","after"];["appendMask","prependMask","beforeMask","afterMask"].forEach(function(t,n){domLib.fn[t]=function(r,o,i,l){if(0===this.length)return log_warn("<jcompo> $.",t,"- no element was selected(found)"),this;this.length>1&&log_warn("<jcompo> $.",t," can insert only to one element. Fix is comming ..."),null==i&&(i=2>n?this.compo():this.parent().compo());var u=!1;null==i&&(i={},u=!0),null==i.components&&(i.components=[]);for(var s=i.components,a=s.length,c=mask.render(r,o,l,null,i),f=this[e[n]](c),h=s.length;h>a;a++)Compo.signal.emitIn(s[a],"domInsert");return u&&0!==h&&(log_warn("$.",t,"- parent controller was not found in Elements DOM.","This can lead to memory leaks."),log_warn("Specify the controller directly, via $.",t,"(template[, model, controller, ctx])")),f}})}(),function(){function e(e,t){node_tryDispose(t)}function t(e,t){node_tryDisposeChildren(t)}var n=domLib.fn.remove,r=domLib.fn.empty;domLib.fn.removeAndDispose=function(){return this.each(e),n.call(this)},domLib.fn.emptyAndDispose=function(){return this.each(t),r.call(this)}}())}function SlotHandler(){}var Dom=mask.Dom,_mask_ensureTmplFnOrig=mask.Utils.ensureTmplFn,_mask_ensureTmplFn,_resolve_External,domLib,Class;!function(){function e(){for(var e,t=arguments.length;--t>-1;)if(e=_resolve_External(arguments[t]),null!=e)return e;return null}_mask_ensureTmplFn=function(e){return"string"!=typeof e?e:_mask_ensureTmplFnOrig(e)},_resolve_External=function(e){return t[e]||r[e]||n[e]};var t=global,n=global.atma||{},r=exports||{};domLib=e("jQuery","Zepto","$"),Class=e("Class")}(),null!=global.document&&null==domLib&&log_warn("DomLite is used. You can set jQuery-Zepto-Kimbo via `Compo.config.setDOMLibrary($)`");var selector_parse,selector_match;!function(){function e(e){return function(n){return t(n,e)}}function t(e,n,r){if("string"!=typeof e)return!1;if(null==r&&(r=0),r=e.indexOf(n,r),-1===r)return!1;if(r>0&&e.charCodeAt(r-1)>32)return t(e,n,r+1);var o=e.length,i=n.length;return o-i>r&&e.charCodeAt(r+i)>32?t(e,n,r+1):!0}selector_parse=function(t,n,r){if(null==t&&log_error("<compo>selector is undefined",n),"object"==typeof t)return t;var o,i,l;if(null==o)switch(t[0]){case"#":o="id",t=t.substring(1),i="attr";break;case".":o="class",t=e(t.substring(1)),i="attr";break;default:o=n===Dom.SET?"tagName":"compoName"}return l="up"===r?"parent":n===Dom.SET?"nodes":"components",{key:o,prop:i,selector:t,nextKey:l}},selector_match=function(e,t,n){is_String(t)&&(null==n&&(n=Dom[e.compoName?"CONTROLLER":"SET"]),t=selector_parse(t,n));var r=t.prop?e[t.prop]:e;return null==r?!1:is_Function(t.selector)?t.selector(r[t.key]):null!=t.selector.test?t.selector.test(r[t.key]):r[t.key]==t.selector}}();var find_findSingle;!function(){find_findSingle=function(e,t){if(is_Array(e)){for(var n,r=e.length,o=-1;++o<r;)if(n=find_findSingle(e[o],t),null!=n)return n;return null}return selector_match(e,t)?e:(e=e[t.nextKey],null==e?null:find_findSingle(e,t))}}();var dom_addEventListener,node_tryDispose,node_tryDisposeChildren;!function(){dom_addEventListener=function(e,t,n){return null!=EventDecorator&&(t=EventDecorator(t)),null!=domLib?domLib(e).on(t,n):null!=e.addEventListener?e.addEventListener(t,n,!1):void(e.attachEvent&&e.attachEvent("on"+t,n))},node_tryDispose=function(e){if(e.hasAttribute("x-compo-id")){var t=e.getAttribute("x-compo-id"),n=Anchor.getByID(t);if(n){if(null==n.$||1===n.$.length)return compo_dispose(n),void compo_detachChild(n);var r=_Array_indexOf.call(n.$,e);-1!==r&&_Array_splice.call(n.$,r,1)}}node_tryDisposeChildren(e)},node_tryDisposeChildren=function(e){for(var t=e.firstChild;null!=t;)1===t.nodeType&&node_tryDispose(t),t=t.nextSibling}}();var domLib_find,domLib_on;!function(){domLib_find=function(e,t){return e.filter(t).add(e.find(t))},domLib_on=function(e,t,n,r){return null==n?e.on(t,r):(e.on(t,n,r).filter(n).on(t,r),e)}}();var compo_dispose,compo_detachChild,compo_ensureTemplate,compo_ensureAttributes,compo_attachDisposer,compo_removeElements,compo_prepairAsync,compo_errored,compo_meta_prepairAttributeHandler,compo_meta_executeAttributeHandler;!function(){function e(e){var t=e.template;if(null==t){if(t=e.attr.template,null==t)return null;delete e.attr.template}if("object"==typeof t)return t;if(is_String(t)){if(35===t.charCodeAt(0)&&/^#[\w\d_-]+$/.test(t)){var n=document.getElementById(t.substring(1));if(null==n)return log_warn("Template not found by id:",t),null;t=n.innerHTML}return mask.parse(t)}return log_warn("Invalid template",typeof t),null}compo_dispose=function(e){null!=e.dispose&&e.dispose(),Anchor.removeCompo(e);for(var t=e.components,n=null==t?0:t.length;--n>-1;)compo_dispose(t[n])},compo_detachChild=function(e){var t=e.parent;if(null!=t){var n,r=e.$,o=t.$||t.elements;if(o&&r){var i,l,u=r.length;for(n=o.length;--n>-1;)for(i=o[n],l=u;--l>-1;)if(i===r[l]){o.splice(n,1);break}}var s=t.components;if(null!=s){for(n=s.length;--n>-1;)if(s[n]===e){s.splice(n,1);break}-1===n&&log_warn("<compo:remove> - i`m not in parents collection",e)}}},compo_ensureTemplate=function(t){if(null==t.nodes)return void(t.nodes=e(t));var n=t.meta.template;if(null!=n&&"replace"!==n){var r=e(t);return"merge"===n?void(t.nodes=mask_merge(r,t.nodes,t)):"join"===n?void(t.nodes=[r,t.nodes]):void log_error("Invalid meta.nodes behaviour",n)}},compo_attachDisposer=function(e,t){if(null==e.dispose)return void(e.dispose=t);var n=e.dispose;e.dispose=function(){t.call(this),n.call(this)}},compo_removeElements=function(e){if(e.$)return void e.$.remove();var t=e.elements;if(t)for(var n=-1,r=t.length;++n<r;)t[n].parentNode&&t[n].parentNode.removeChild(t[n]);else{var o=e.components;if(o)for(var n=-1,r=o.length;++n<r;)compo_removeElements(o[n])}},compo_prepairAsync=function(e,t,n){var r=Compo.pause(t,n);e.then(r,function(e){compo_errored(t,e),r()})},compo_errored=function(e,t){e.nodes=mask.parse('.-mask-compo-errored > "~[.]"'),e.model=t.message||String(t),e.renderEnd=fn_doNothing},function(){function e(e){return function(t,n){var o,i,l,u,s=t.attr;for(o in e)if(i=e[o],l=s[o],u=i(t,l,n),null!=u)return r(t,u,o,l),!1;return!0}}function t(e,t,r,l){var u=63===t.charCodeAt(0),s=u?t.substring(1):t,a=s.replace(/-(\w)/g,n),c=r;return"string"==typeof r?c=o[r]:r instanceof RegExp?c=i.regexp(r):"function"==typeof r?c=r:null==r&&(c=i.any()),null==c?void log_error("Function expected for the attr. handler",t):(e[a]=null,e=null,void(l[s]=function(e,t,n){if(null==t)return u?null:Error("Expected");var r=c.call(e,t,e,n,s);return r instanceof Error?r:(e[a]=r,null)}))}function n(e,t){return t.toUpperCase()}function r(e,t,n,r){t.message=e.compoName+" - attribute `"+n+"`: "+t.message,compo_errored(e,t),log_error(t.message,". Current: ",r)}compo_meta_prepairAttributeHandler=function(n){null==n.meta&&(n.meta={attributes:null,cache:null,mode:null});var r=n.meta.attributes,o=null;if(r){var i={};for(var l in r)t(n,l,r[l],i);o=e(i)}n.meta.handleAttributes=o},compo_meta_executeAttributeHandler=function(e,t){var n=e.meta&&e.meta.handleAttributes;return null==n?!0:n(e,t)};var o={string:function(e){return"string"==typeof e?e:Error("String")},number:function(e){var t=Number(e);return t===t?t:Error("Number")},"boolean":function(e,t,n,r){return"boolean"==typeof e?e:e===r?!0:"true"===e||"1"===e?!0:"false"===e||"0"===e?!1:Error("Boolean")}},i={regexp:function(e){return function(t){return e.test(t)?t:Error("RegExp")}},any:function(){return function(e){return e}}}}()}();var compo_create,compo_createConstructor;!function(){compo_create=function(e){var t,n,r=e.length,o=e[r-1];r>1&&compo_inherit(o,_Array_slice.call(e,0,r-1)),null==o&&(o={});var i=_resolve_External("include");null!=i&&(o.__resource=i.url);o.attr;for(n in o.attr)o.attr[n]=_mask_ensureTmplFn(o.attr[n]);var l=o.slots;for(n in l)"string"==typeof l[n]&&(is_Function(o[l[n]])===!1&&log_error("Not a Function @Slot.",l[n]),l[n]=o[l[n]]);compo_meta_prepairAttributeHandler(o),t=o.hasOwnProperty("constructor")?o.constructor:function(){},t=compo_createConstructor(t,o);for(n in CompoProto)null==o[n]&&(o[n]=CompoProto[n]);return t.prototype=o,o=null,t},compo_createConstructor=function(e,t){var n=t.compos,r=t.pipes,o=t.scope,i=t.attr;return null==n&&null==r&&null==i&&null==o?e:function(t,l,u,s,a){if(null!=e){var c=e.call(this,t,l,u,s,a);if(null!=c)return c}null!=n&&(this.compos=obj_create(this.compos)),null!=r&&Pipes.addController(this),null!=i&&(this.attr=obj_create(this.attr)),null!=o&&(this.scope=obj_create(this.scope))}}}();var compo_inherit;!function(){function e(o,i,l){if(null!=o&&null!=i){if("node"===l){var u=o.template||o.nodes,s=i.template||i.nodes;null==u||null==s?o.template=u||s:o.nodes=mask.merge(s,u,o)}var a,c,f,h=!1;for(var p in i)if(a=i[p],null!=a&&"constructor"!==p&&("node"!==l||"template"!==p&&"nodes"!==p))if(c=typeof a,null!=o[p]){if("node"===l){var d="renderStart"===p||"renderEnd"===p||"emitIn"===p||"emitOut"===p||"components"===p||"nodes"===p||"template"===p||"find"===p||"closest"===p||"on"===p||"remove"===p||"slotState"===p||"signalState"===p||"append"===p||"appendTo"===p;if(d===!0)continue}if("pipes"!==l)if("function"!==c){if("object"===c){switch(p){case"slots":case"pipes":case"events":case"attr":e(o[p],a,p);continue}n(o[p],a)}}else f=!1,"slots"===l||"events"===l||"pipe"===l?f=!0:"node"!==l||"onRenderStart"!==p&&"onRenderEnd"!==p||(f=!0),o[p]=r(o[p],a,f),h=!0;else e(o[p],a,"pipe")}else o[p]="object"===c?t(a):a;h===!0&&(null!=o.super&&log_error("`super` property is reserved. Dismissed. Current prototype",o),o.super=null)}}/*! Circular references are not handled */
function t(e){if(null==e)return null;if("object"!=typeof e)return e;if(is_Array(e)){for(var n=e.length,r=-1,o=new Array(n);++r<n;)o[r]=t(e[r]);return o}var i,l,u=obj_create(e);for(i in u)l=u[i],null!=l&&"object"==typeof l&&(u[i]=t(l));return u}function n(e,t){var r,o,i;for(var i in t)r=e[i],o=t[i],null!=r?is_rawObject(r)&&is_rawObject(o)&&n(r,o):e[i]=o}function r(e,t,n){function r(){var e=u._fn||(u._fn=l(u._fn_chain));return e.apply(this,arguments)}if("compoInheritanceWrapper"===e.name)return e._fn_chain.push(t),e;var l=n===!0?i:o,u=r;return u._fn_chain=[e,t],u._fn=null,u}function o(e){for(var t=e.length,n=e[--t];--t>-1;)n=l(e[t],n);return n}function i(e){var t=e.length;return function(){for(var n,r,o,i=t;--i>-1;)r=e[i],null!=r&&(o=fn_apply(r,this,arguments),void 0!==o&&(n=o));return n}}function l(e,t){return function(){this.super=t;var n=fn_apply(e,this,arguments);return this.super=null,n}}function u(e){var t=e.length;return function(){for(var n,r=t;--r>-1;){var o=e[r].apply(this,arguments);null!=o&&(n=o)}return n}}compo_inherit=function(t,n){for(var r,o=n.length,i=o,l=[];--i>-1;)r=n[i],"string"==typeof r&&(r=Mask.getHandler(r)),null!=r?("function"==typeof r&&(l.push(r),r=r.prototype),e(t,r,"node")):log_error("Base component not defined",n[i]);i=-1,o=l.length,o>0&&(t.hasOwnProperty("constructor")&&l.unshift(t.constructor),t.constructor=u(l))}}(mask.merge);var dfr_isBusy;!function(){dfr_isBusy=function(e){return null==e||"function"!=typeof e.then?!1:is_Function(e.isBusy)?e.isBusy():is_Function(e.state)?"pending"===e.state():(log_warn("Class or jQuery deferred interface expected"),!1)}}();var Children_={select:function(e,t){for(var n in t){var r=t[n],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return log_error("Unknown component child",n,t[n]),void log_warn("Is this object shared within multiple compo classes? Define it in constructor!");var l=i.indexOf(":"),u=i.substring(0,l);u=Compo.config.selectors[u],null==u?e.compos[n]=e.$[0].querySelector(i):(i=i.substring(++l).trim(),e.compos[n]=u(e,i));var s=e.compos[n];null!=o&&(null!=s.$&&(s=s.$),Events_.on(e,o,s))}}},Events_={on:function(e,t,n){null==n&&(n=e.$);for(var r,o=t instanceof Array,i=o?t.length:1,l=0;o?i>l:1>l;l++)if(r=o?t[l]:t,r instanceof Array)null!=EventDecorator&&(r[0]=EventDecorator(r[0])),n.on.apply(n,r);else for(var u in r){var s,a,c="string"==typeof r[u]?e[r[u]]:r[u],f=u.indexOf(":");-1!==f?(s=u.substring(0,f),a=u.substring(f+1).trim()):s=u,null!=EventDecorator&&(s=EventDecorator(s)),domLib_on(n,s,a,fn_proxy(c,e))}}},EventDecorator=null,EventDecos=function(){var e=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(e){return!1}}();return{touch:function(t){return e===!1?t:"click"===t?"touchend":"mousedown"===t?"touchstart":"mouseup"===t?"touchend":"mousemove"===t?"touchmove":t}}}(),Pipes=function(){function e(e,t){return function(n){new i(e).emit(t,n)}}function t(e,t){return null==t.pipes[e]?void log_error("Controller has no pipes to be added to collection",e,t):(null==l[e]&&(l[e]=[]),void l[e].push(t))}function n(e,t){for(var n=l[e],r=n.length;--r>-1;)n[r]===t&&n.splice(r,1)}function r(){var e=this,t=e.pipes;for(var r in t)n(r,e)}function o(e){var n=e.pipes;if(null==n)return void log_error("Controller has no pipes",e);for(var o in n)t(o,e);Compo.attachDisposer(e,r.bind(e))}function i(e){return this instanceof i==!1?new i(e):(this.pipeName=e,this)}var l={};return mask.registerAttrHandler("x-pipe-signal","client",function(t,n,r,o,i){for(var l,u=n.split(";"),s=u.length,a=-1;++a<s;)if(l=u[a].trim(),""!==l){var c,f,h=l.indexOf(":"),p=l.substring(0,h),d=l.substring(h+1).trim(),m=d.indexOf(".");if(-1===m)return void log_error('define pipeName "click: pipeName.pipeSignal"');c=d.substring(0,m),f=d.substring(++m);var g=e(c,f);!p&&log_error("Signal: event type is not set",n),dom_addEventListener(i,p,g)}}),i.prototype={constructor:i,emit:function(e){var t,n=l[this.pipeName],r=this.pipeName;if(null==n)return void log_warn("Pipe.emit: No signals were bound to:",r);2===arguments.length&&is_Array(arguments[1])?t=arguments[1]:arguments.length>1&&(t=_Array_slice.call(arguments,1));for(var o,i,u,s,a=n.length;-1!==--a;)o=n[a],i=o.pipes[r],null!=i&&(u=i[e],is_Function(u)&&(u.apply(o,t),s=!0));s||log_warn("Pipe `%s` has not slots for `%s`",r,e)}},i.addController=o,i.removeController=r,{addController:o,removeController:r,pipe:i}}(),Anchor=function(){var e={};return{create:function(t){return null==t.ID?void log_warn("Component should have an ID"):void(e[t.ID]=t)},resolveCompo:function(t){if(null==t)return null;var n,r,o;do{if(r=t.getAttribute("x-compo-id"),r&&(null==n&&(n=r),o=e[r],null!=o&&(o=Compo.find(o,{key:"ID",selector:n,nextKey:"components"}),null!=o)))return o;t=t.parentNode}while(t&&1===t.nodeType);return n&&log_warn("No controller for ID",n),null},removeCompo:function(t){null!=t.ID&&delete e[t.ID]},getByID:function(t){return e[t]}}}(),Compo,CompoProto;!function(){Compo=function(){return this instanceof Compo?void 0:compo_create(arguments)},obj_extend(Compo,{create:function(){return compo_create(arguments)},createClass:function(){var e=compo_create(arguments),t=e.prototype;return t.Construct=e,Class(t)},render:function(e,t,n,r){compo_ensureTemplate(e);var o=[];return mask.render(null==e.tagName?e.nodes:e,t,n,r,e,o),e.$=domLib(o),null!=e.events&&Events_.on(e,e.events),null!=e.compos&&Children_.select(e,e.compos),e},initialize:function(e,t,n,r,o){var i;null==r&&(n&&null!=n.nodeType?(r=n,n=null):t&&null!=t.nodeType&&(r=t,t=null)),"string"==typeof e&&(i=e,e=mask.getHandler(i),e||log_error("Compo not found:",e));var l={controller:e,type:Dom.COMPONENT,tagName:i};null==o&&null!=r&&(o=Anchor.resolveCompo(r)),null==o&&(o=new Dom.Component);var u=mask.render(l,t,n,null,o),s=o.components[o.components.length-1];return null!=r&&(r.appendChild(u),Compo.signal.emitIn(s,"domInsert")),s},find:function(e,t){return find_findSingle(e,selector_parse(t,Dom.CONTROLLER,"down"))},closest:function(e,t){return find_findSingle(e,selector_parse(t,Dom.CONTROLLER,"up"))},dispose:compo_dispose,ensureTemplate:compo_ensureTemplate,attachDisposer:compo_attachDisposer,config:{selectors:{$:function(e,t){var n=domLib_find(e.$,t);return 0===n.length&&log_warn("<compo-selector> - element not found -",t,e),n},compo:function(e,t){var n=Compo.find(e,t);return null==n&&log_warn("<compo-selector> - component not found -",t,e),n}},setDOMLibrary:function(e){domLib!==e&&(domLib=e,domLib_initialize())},getDOMLibrary:function(){return domLib},eventDecorator:function(e){return"function"==typeof e?void(EventDecorator=e):"string"==typeof e?void(EventDecorator=EventDecos[e]):"boolean"==typeof e&&e===!1?void(EventDecorator=null):void 0}},pipe:Pipes.pipe,resource:function(e){for(var t=e;null!=t;){if(t.resource)return t.resource;t=t.parent}return include.instance()},plugin:function(source){eval(source)},Dom:{addEventListener:dom_addEventListener}}),function(){function e(e,t,n){return null==e[t]&&(e[t]=[]),e[t].push(n),e}function t(e,t,n){var r=e[t];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=n?o.apply(this,n):o())}var n={done:function(t){return e(this,"_cbs_done",t)},fail:function(t){return e(this,"_cbs_fail",t)},always:function(t){return e(this,"_cbs_always",t)},resolve:function(){this.async=!1,t(this,"_cbs_done",arguments),t(this,"_cbs_always",arguments)},reject:function(){this.async=!1,t(this,"_cbs_fail",arguments),t(this,"_cbs_always")},_cbs_done:null,_cbs_fail:null,_cbs_always:null},r={async:!0,await:function(e){this.resume=e}};Compo.pause=function(e,t){return null==t.async&&(t.defers=[],obj_extend(t,n)),t.async=!0,t.defers.push(e),obj_extend(e,r),function(){Compo.resume(e,t)}},Compo.resume=function(e,t){e.resume&&e.resume(),e.async=!1;for(var n,r=!1,o=t.defers,i=o.length,l=-1;++l<i;)n=o[l],n!==e?r=r||null!=n:o[l]=null;r===!1&&t.resolve()}}(),CompoProto={type:Dom.CONTROLLER,__resource:null,tagName:null,compoName:null,nodes:null,components:null,expression:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,await:null,meta:{mode:null,modelMode:null,attributes:null,serializeNodes:null,handleAttributes:null},onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(e,t,n){if(1===arguments.length&&null!=e&&e instanceof Array==!1&&null!=e[0]){var r=arguments[0];e=r[0],t=r[1],n=r[2]}if(compo_meta_executeAttributeHandler(this,e)!==!1&&(compo_ensureTemplate(this),is_Function(this.onRenderStart))){var o=this.onRenderStart(e,t,n);void 0!==o&&dfr_isBusy(o)&&compo_prepairAsync(o,this,t)}},renderEnd:function(e,t,n,r){if(1===arguments.length&&e instanceof Array==!1){var o=arguments[0];e=o[0],t=o[1],n=o[2],r=o[3]}Anchor.create(this,e),this.$=domLib(e),null!=this.events&&Events_.on(this,this.events),null!=this.compos&&Children_.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(e,t,n,r)},appendTo:function(e){var t="string"==typeof e?document.querySelector(e):e;if(null==t)return log_warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=this.$,r=0,o=n.length;o>r;r++)t.appendChild(n[r]);return this.emitIn("domInsert"),this},append:function(e,t,n){var r;if(null==this.$){var o="string"==typeof e?mask.compile(e):e;return r=n?find_findSingle(this,selector_parse(n,Dom.CONTROLLER,"down")):this,null==r.nodes?(this.nodes=o,this):(r.nodes=[this.nodes,o],this)}var i=mask.render(e,t,null,null,this);return r=n?this.$.find(n):this.$,r.append(i),this.emitIn("domInsert"),this},find:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"down"))},closest:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"up"))},on:function(){var e=_Array_slice.call(arguments);return arguments.length<3?(log_error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&Events_.on(this,[e]),null==this.events?this.events=[e]:is_Array(this.events)?this.events.push(e):this.events=[e,this.events],this)},remove:function(){return compo_removeElements(this),compo_detachChild(this),compo_dispose(this),this.$=null,this},slotState:function(e,t){return Compo.slot.toggle(this,e,t),this},signalState:function(e,t){return Compo.signal.toggle(this,e,t),this},emitOut:function(e){return Compo.signal.emitOut(this,e,this,arguments.length>1?_Array_slice.call(arguments,1):null),this},emitIn:function(e){return Compo.signal.emitIn(this,e,this,arguments.length>1?_Array_slice.call(arguments,1):null),this}},Compo.prototype=CompoProto}(),function(){function e(t,n,r,o,i){if(null==t)return!1;var l=!1,u=null!=t.slots&&t.slots[n];if("string"==typeof u&&(u=t[u]),"function"==typeof u){l=!0;var s=null!=t.slots.__disabled&&t.slots.__disabled[n];if(s!==!0){var a=null==o?u.call(t,r):u.apply(t,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=t.parent)return e(t.parent,n,r,o,i)||l;if(1===i&&null!=t.components)for(var c,f=t.components,h=f.length,p=0;h>p;p++)c=e(f[p],n,r,o,i),!l&&(l=c);return l}function t(e,n,r,o){if(null==e)return!1;var i=e.slots;if(null!=i&&null!=i[n]&&("string"==typeof i[n]&&(i[n]=e[i[n]]),"function"==typeof i[n])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[n]!==!0)return!0}if(-1===r&&null!=e.parent)return t(e.parent,n,r);if(1===r&&null!=e.components)for(var l=0,u=e.components.length;u>l;l++)if(t(e.components[l],n,r))return!0;return!1}function n(n,r){return t(n,r,-1)===!1?null:function(t){var o=arguments.length>1?_Array_slice.call(arguments,1):null;e(n,r,t,o,-1)}}function r(e,t,n){var r=e.slots;null!=r&&r.hasOwnProperty(t)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[t]=n===!1)}function o(e,t,n){if(r(e,t,n),null!=e.components)for(var i=0,l=e.components.length;l>i;i++)o(e.components[i],t,n)}function i(e,t,n){return null==e.$?void log_warn("Controller has no elements to toggle state"):void domLib().add(e.$.filter("[data-signals]")).add(e.$.find("[data-signals]")).each(function(e,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(t)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")})}function l(e,t,n){for(var l=e,u=e;null!=(l=l.parent);)r(l,t,n),null!=l.$&&0!==l.$.length&&(u=l);o(e,t,n),i(u,t,n)}function u(e,n,o){r(e,n,o),(o||!t(e,n,-1,!0)&&!t(e,n,1,!0))&&i(e,n,o)}mask.registerAttrHandler("x-signal","client",function(e,t,r,o,i,l){for(var u,s=t.split(";"),a="",c=s.length,f=-1;++f<c;)if(u=s[f].trim(),""!==u){var h=u.indexOf(":"),p=u.substring(0,h),d=u.substring(h+1).trim(),m=n(l,d);!p&&log_error("Signal: event type is not set",t),m&&(a+=","+d+",",dom_addEventListener(i,p,m)),!m&&log_warn("No slot found for signal",d,l)}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(Compo,{signal:{toggle:l,emitOut:function(t,n,r,o){var i=e(t,n,r,o,-1);!i&&log_warn("Signal %c%s","font-weight:bold;",n,"was not captured")},emitIn:function(t,n,r,o){e(t,n,r,o,1)},enable:function(e,t){l(e,t,!0)},disable:function(e,t){l(e,t,!1)}},slot:{toggle:u,enable:function(e,t){u(e,t,!0)},disable:function(e,t){u(e,t,!1)},invoke:function(e,t,n,r){var o=e.slots;return null==o||"function"!=typeof o[t]?(log_error("Slot not found",t,e),null):null==r?o[t].call(e,n):o[t].apply(e,[n].concat(r))}}})}();var DomLite;return function(e){function t(e,t,n){if(null==e)return n||e;for(var r=e.length,o=-1;++o<r;)t.call(n||e,e[o],o);return n||e}function n(e,t,n){if(null==e)return-1;for(var r=e.length,o=-1;++o<r;)if(t.call(n||e,e[o],o)===!0)return o;return-1}if(null!=e){Compo.DomLite=DomLite=function(e){return this instanceof DomLite==!1?new DomLite(e):this.add(e)},null==domLib&&(domLib=DomLite);var r=DomLite.fn={constructor:DomLite,length:0,add:function(e){if(null==e)return this;if(is_Array(e)===!0)return t(e,this.add,this);var n=e.nodeType;return 11===n?t(e.childNodes,this.add,this):null==n?"number"==typeof e.length?t(e,this.add,this):(log_warn("Uknown domlite object"),this):(this[this.length++]=e,this)},on:function(){return o.call(this,i,u,arguments)},off:function(){return o.call(this,l,s,arguments)},find:function(e){return t(this,function(t){this.add(c.call(t,e))},new DomLite)},filter:function(e){return t(this,function(t){f(t,e)===!0&&this.add(t)},new DomLite)},parent:function(){var e=this[0];return new DomLite(e&&e.parentNode)},children:function(e){var n=t(this,function(e){this.add(e.childNodes)},new DomLite);return null==e?n:n.filter(e)},closest:function(e){for(var t=this[0],n=new DomLite;null!=t&&null!=t.parentNode;)if(t=t.parentNode,f(t,e))return n.add(t);return n},remove:function(){return t(this,function(e){e.parentNode.removeChild(e)})}};!function(){function e(e,t,n){null!=e&&null!=n&&e.insertBefore(n,t)}function n(t,n,r){var o=null!=n?n.nextSibling:null;e(t,o,r)}var o={append:function(e,t){n(e,e.lastChild,t)},prepend:function(t,n){e(t,t.firstChild,n)},after:function(e,t){n(e.parentNode,e,t)},before:function(t,n){e(t.parentNode,t,n)}};t(["append","prepend","before","after"],function(e){var n=o[e];r[e]=function(e){var r=is_Array(e);return t(this,function(o){return r?void t(e,function(e){n(o,e)}):void n(o,e)})}})}();var o,i,l,u,s,a=e.documentElement,c=a.querySelectorAll,f=function(){var e=a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.matchesSelector;return function(t,n){return null==t||1!==t.nodeType?!1:e.call(t,n)}}();!function(){function e(e,n,r,o){return t(e,function(e){n.call(e,r,o,!1)})}o=function(e,n,r){var o,i=r.length;return 2===i&&(o=e),3===i&&(o=n),null!=o?t(this,function(e){o.apply(DomLite(e),r)}):(log_error("`DomLite.on|off` - invalid arguments count"),this)},i=function(t,r){return e(this,n,t,r)},l=function(t,n){return e(this,r,t,n)},u=function(e,t,n){function r(e){var r=e.target,o=e.currentTarget;if(o!==r)for(;null!=r&&r!==o;){if(f(r,t))return void n(e);r=r.parentNode}}return(n._guards||(n._guards=[])).push(r),i.call(this,e,r)},s=function(e,n,r){return t(r._quards,function(t){l.call(this,e,t)},this)};var n=a.addEventListener,r=a.removeEventListener}(),function(){var e=null!=a.classList,o=e===!0?function(e,t){return e.classList.contains(t)}:function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")};r.hasClass=function(e){return-1!==n(this,function(t){return o(t,e)})};var i;!function(){function e(e,t){e.className+=" "+t}function t(e,t){e.className=(" "+e.className+" ").replace(" "+t+" "," ")}i={add:function(t,n){o(t,n)===!1&&e(t,n)},remove:function(e,n){o(e,n)===!0&&t(e,n)},toggle:function(n,r){var i=o(n,r)===!0?t:e;i(n,r)}}}(),t(["add","remove","toggle"],function(n){var o=e===!1?i[n]:function(e,t){var r=e.classList;r[n].call(r,t)};r[n+"Class"]=function(e){return t(this,function(t){o(t,e)})}})}(),function(){var n=function(t){var n=e.createEvent("Event");return n.initEvent(t,!0,!0),n},o=function(t,r){if(null==r)return n(t);var o=e.createEvent("CustomEvent");return o.initCustomEvent(t,!0,!0,r),o},i=function(e,t){e.dispatchEvent(t)};r.trigger=function(e,n){var r=o(e,n);return t(this,function(e){i(e,r)})}}(),function(){r.attr=function(e,n){return void 0===n?this[0]&&this[0].getAttribute(e):t(this,function(t){t.setAttribute(e,n)})},r.removeAttr=function(e){return t(this,function(t){t.removeAttribute(e)})}}(),Object.setPrototypeOf?Object.setPrototypeOf(r,Array.prototype):r.__proto__&&(r.__proto__=Array.prototype),DomLite.prototype=r,domLib_initialize()}}(global.document),domLib_initialize(),mask.registerHandler(":slot",SlotHandler),SlotHandler.prototype={constructor:SlotHandler,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;mask.Utils.Expression.eval(e,this.model,global,this)}},Compo}(Mask),jmask=exports.jmask=Mask.jmask=function(e){function t(e){return"string"!=typeof e?e:s(e)}function n(e){return this instanceof n==!1?new n(e):null==e?this:e.type===i.SET?e:this.add(e)}var r,o,i=e.Dom,l=e.render,u=e.parse,s=e.Utils.ensureTmplFn,a=(e.Compo||Compo).signal.emitIn;!function(){r=function(e,t){if(is_ArrayLike(e)===!1)return void t(e);for(var n=e.length,r=-1;++r<n;)t(e[r],r)},function(){function e(e,n){return e===n?(t=!0,0):1}o=function(n){if(t=!1,n.sort(e),t===!1)return n;for(var r=[],o=0,i=0,l=n.length-1;l>o;)n[o++]===n[o]&&(r[i++]=o);for(;i--;)n.splice(r[i],1);return n};var t=!1}()}();var c,f;!function(){function e(e){return function(n){return t(n,e)}}function t(e,n,r){if("string"!=typeof e)return!1;if(null==r&&(r=0),r=e.indexOf(n,r),-1===r)return!1;if(r>0&&e.charCodeAt(r-1)>32)return t(e,n,r+1);var o=e.length,i=n.length;return o-i>r&&e.charCodeAt(r+i)>32?t(e,n,r+1):!0}function n(e,t,n){for(var r,o=!1,i=!1;n>t&&(r=e.charCodeAt(t),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||62===r||33>r)||o===!0||i===!0);)t++;return t}c=function(t,s,a){if(null==t&&log_error("selector is null for the type",s),"object"==typeof t)return t;var c,f,h,p,d,m,g,v,y,_,b,x=0,w=t.length;for(c="up"===a?r:s===i.SET?o:l;w>x;)d=t.charCodeAt(x),33>d?x++:62!==d?(m=n(t,x+1,w),46===d?(f="class",h=u,p=e(t.substring(x+1,m))):35===d?(f="id",h=u,p=t.substring(x+1,m)):91===d?(_=t.indexOf("=",x),-1===_&&console.error('Attribute Selector: should contain "="'),h=u,f=t.substring(x+1,_),d=t.charCodeAt(_+1),b=34===d||39===d?2:1,p=t.substring(_+b,m-b+1),m++):(null!=g&&(g.next={type:"any",matcher:null},y=g,g=null),h=null,f=s===i.SET?"tagName":"compoName",p=t.substring(x,m)),x=m,null!=g?(null==g.filters&&(g.filters=[]),g.filters.push({key:f,selector:p,prop:h})):(g={key:f,prop:h,selector:p,nextKey:c,filters:null},null==v&&(v=g),null!=y&&(y.next.matcher=g))):(null==g?v=g={selector:"__scope__",nextKey:c,filters:null,next:{type:"children",matcher:null}}:g.next={type:"children",matcher:null},y=g,g=null,x++);return y&&y.next&&(y.next.matcher=g),v},f=function(e,t,n){if("string"==typeof t&&(null==n&&(n=i[e.compoName?"CONTROLLER":"SET"]),t=c(t,n)),"*"===t.selector)return!0;var r=t.prop?e[t.prop]:e,o=!1;if(null==r)return!1;if("function"==typeof t.selector?o=t.selector(r[t.key]):null!=t.selector.test?t.selector.test(r[t.key])&&(o=!0):r[t.key]===t.selector&&(o=!0),o===!0&&null!=t.filters)for(var l,u=0,s=t.filters.length;s>u;u++)if(l=t.filters[u],f(e,l,n)===!1)return!1;return o};var r="parent",o="nodes",l="components",u="attr"}();var h,p,d,m,g;!function(){h=function(e,t){if(null==t)return e;var n=[];return r(e,function(e){f(e,t)&&n.push(e)}),n},p=function(e,t,n,o){return null==e?n:(null==n&&(n=[]),null==o&&("__scope__"===t.selector?(o=!1,t=t.next.matcher):o=!0),r(e,function(e){if(f(e,t)===!1)return void(null==t.next&&o!==!1&&p(e[t.nextKey],t,n,o));if(null==t.next)return n.push(e),void(o===!0&&p(e[t.nextKey],t,n,o));var r=t.next;o="children"!==r.type,p(e[t.nextKey],r.matcher,n,o)}),n)},d=function(e,t){var n={type:1,tagName:1,compoName:1,controller:1},r={parent:t};for(var o in e)1===n[o]&&(r[o]=e[o]);null!=e.attr&&(r.attr=obj_create(e.attr));var i=e.nodes;if(null!=i&&i.length>0)if(is_ArrayLike(i)===!1)r.nodes=[d(i,r)];else{r.nodes=[];for(var l=i.length,u=0;l>u;u++)r.nodes[u]=d(i[u],r)}return r},m=function(e){for(var t,n=e;null!=n;)t=n,n=n.nodes&&n.nodes[0];return t},g=function(e,t,n,r){if(i.TEXTNODE===e.type)return is_Function(e.content)?e.content("node",t,n,null,r):e.content;var o="";if(null!=e.nodes)for(var l,u=0,s=e.nodes.length;s>u;u++)l=e.nodes[u],o+=g(l,t,n,r);return o}}();var v=n.prototype={constructor:n,type:i.SET,length:0,components:null,add:function(e){var t,n;if("string"==typeof e&&(e=u(e)),is_ArrayLike(e)){for(t=0,n=e.length;n>t;t++)this.add(e[t]);return this}"function"==typeof e&&null!=e.prototype.type&&(e={controller:e,type:i.COMPONENT});var r=e.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",e),this;if(r===i.FRAGMENT){var o=e.nodes;for(t=0,n=o.length;n>t;)this[this.length++]=o[t++];return this}if(r===i.CONTROLLER){if(null!=e.nodes&&e.nodes.length)for(t=e.nodes.length;0!==t;)e.nodes[--t].parent=e;null!=e.$&&(this.type=i.CONTROLLER)}return this[this.length++]=e,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(e,t,n,r){if(this.components=[],1===this.length)return l(this[0],e,t,n,r||this);null==n&&(n=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)l(this[o],e,t,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(e){var t;return t=n(e),t.prevObject=this,t},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(t){var n;if(null!=t)return this.empty().append(t);if(arguments.length)return this;if(0===this.length)n=new i.Node;else if(1===this.length)n=this[0];else{n=new i.Fragment,n.nodes=[];for(var r=-1;++r<this.length;)n.nodes[r]=this[r]}return e.stringify(n)},text:function(e,t,n){if("string"==typeof e&&1===arguments.length){for(var r,o=[new i.TextNode(e)],l=0,u=this.length;u>l;l++)r=this[l],r.nodes=o;return this}for(var r,s="",l=0,u=this.length;u>l;l++)r=this[l],s+=g(r,e,t,n);return s}};return arr_each(["append","prepend"],function(e){n.prototype[e]=function(t){for(var r,o,i=n(t),l=0,u=this.length;u>l;l++){o=this[l],r=i.toArray();for(var s=0,a=r.length;a>s;s++)r[s].parent=o;o.nodes=null!=o.nodes?"append"===e?o.nodes.concat(r):r.concat(o.nodes):r}return this}}),arr_each(["appendTo"],function(e){n.prototype[e]=function(e,t,r,o){return null==o&&(o=this),null!=e.nodeType&&"function"==typeof e.appendChild?(e.appendChild(this.render(t,r,null,o)),a(o,"domInsert"),this):(n(e).append(this),this)}}),function(){function e(e,t,n){e[t]=n}function n(e){var t={};return e.split(";").forEach(function(e){if(""!==e){var n=e.indexOf(":"),r=e.substring(0,n).trim(),o=e.substring(n+1).trim();t[r]=o}}),t}function r(e){var t,n="";for(t in e)n+=t+":"+e[t]+";";return n}function o(e,t){return e+":"+t+";"}v.removeAttr=v.removeProp=function(e){return coll_each(this,function(t){t.attr[e]=null})},v.attr=v.prop=function(e,n){function r(e,n,r){e.attr[n]=t(r)}function o(e,t){for(var n in t)r(e,n,t[n])}if(1===arguments.length)return this.length>0?this[0].attr[e]:null;var i=is_String(e)?r:o;return coll_each(this,function(t){i(t,e,n)})},v.tag=function(e){return 0===arguments.length?this[0]&&this[0].tagName:coll_each(this,function(t){t.tagName=e})},v.css=function(t,i){if(arguments.length<=1&&"string"==typeof t){if(null==this.length)return null;var l=this[0].attr.style;if(null==l)return null;var u=n(l);return null==t?u:u[t]}if(null==t)return this;var s="object"==typeof t?r:o,a="object"==typeof t?obj_extend:e;return coll_each(this,function(e){var o=e.attr.style;if(null==o)return void(e.attr.style=s(t,i));var l=n(o);a(l,t,i),e.attr.style=r(l)})}}(),function(){function e(e){var t=e.attr["class"];return"string"==typeof t?t:""}function t(t,n){return-1!==(" "+e(t)+" ").indexOf(" "+n+" ")}function n(t,n){t.attr["class"]=(e(t)+" "+n).trim()}function r(t,n){t.attr["class"]=(" "+e(t)+" ").replace(" "+n+" ","").trim()}v.hasClass=function(e){return coll_find(this,function(n){return t(n,e)})};var o={add:function(e,r){t(e,r)===!1&&n(e,r)},remove:function(e,n){t(e,n)===!0&&r(e,n)},toggle:function(e,o){var i=t(e,o)===!0?r:n;i(e,o)}};arr_each(["add","remove","toggle"],function(e){var t=o[e];v[e+"Class"]=function(e){return coll_each(this,function(n){t(n,e)})}})}(),obj_extend(n.prototype,{clone:function(){return n(coll_map(this,d))},wrap:function(e){var t=n(e);if(0===t.length)return log_warn("Not valid wrapper",e),this;var r=coll_map(this,function(e){var n=t.clone()[0];if(m(n).nodes=[e],null!=e.parent){var r=coll_indexOf(e.parent.nodes,e);-1!==r&&e.parent.nodes.splice(r,1,n)}return n});return n(r)},wrapAll:function(e){var t=n(e);return 0===t.length?(log_error("Not valid wrapper",e),this):(this.parent().mask(t),m(t[0]).nodes=this.toArray(),this.pushStack(t))}}),arr_each(["empty","remove"],function(e){n.prototype[e]=function(){return coll_each(this,t[e])};var t={remove:function(e){null!=e.parent&&coll_remove(e.parent.nodes,e)},empty:function(e){e.nodes=null}}}),obj_extend(n.prototype,{each:function(e,t){for(var n=0;n<this.length;n++)e.call(t||this,this[n],n);return this},eq:function(e){return-1===e?this.slice(e):this.slice(e,e+1)},get:function(e){return 0>e?this[this.length-e]:this[e]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),arr_each(["filter","children","closest","parent","find","first","last"],function(e){n.prototype[e]=function(t){var r,l,u=[],s=null==t?null:c(t,this.type,"closest"===e?"up":"down");switch(e){case"filter":return n(h(this,s));case"children":for(r=0;r<this.length;r++)l=this[r],null!=l.nodes&&(u=u.concat(null==s?l.nodes:h(l.nodes,s)));break;case"parent":for(r=0;r<this.length;r++)l=this[r].parent,!l||l.type===i.FRAGMENT||s&&f(l,s)||u.push(l);o(u);break;case"closest":case"find":if(null==s)break;for(r=0;r<this.length;r++)p(this[r][s.nextKey],s,u);break;case"first":case"last":var a;for(r=0;r<this.length;r++)if(a="first"===e?r:this.length-r-1,l=this[a],null==s||f(l,s)){u[0]=l;break}}return this.pushStack(u)}}),n}(Mask),Cache=function(){function e(e,n){null==n&&(n=e.cache),null!=n&&(this.__cacheInfo=new t(n))}function t(e){if("object"==typeof e&&e.byProperty){var t=e.byProperty,n=t.indexOf("."),r=t.substring(0,n);switch(t=t.substring(n+1),r){case"model":case"ctx":break;default:return console.error('[CompoCache] - property accessor not valid - should be "[model/ctx].[accessor]"'),null}this.propObjName=r,this.propAccessor=t}return this.expire=e.expire,this}var n=0,r=0,o={};return e.prototype={__null:null,__value:null},t.prototype={prop:void 0,propObjName:null,propAccessor:null,expire:null,getKey:function(e,t){if(null==this.propAccessor)return"__value";var n,r,o=this.propObjName,i=this.propAccessor;return"model"===o&&(n=e),"ctx"===o&&(n=t),r=obj_getProperty(n,i),"undefined"==typeof r?"__value":null==r?"__null":r}},{get controllerID(){return n},get modelID(){return r},cacheCompo:function(t,i,l,u,s){if(__cfg.allowCache!==!1){var a=o[l];null==a&&(a=o[l]=new e(u,s));var c=a.__cacheInfo;null!=c&&(a[c.getKey(t,i)]=u,n=i._id,r=i._model._id)}},getCompo:function(e,t,n){if(__cfg.allowCache===!1)return null;var r=o[n];if(null==r)return null;var i=r.__cacheInfo,l=r[i.getKey(e,t)];return null==l||null==l.__cached?null:l},getCache:function(){return o}}}();!function(e){var t;!function(){function n(e){for(var t="";e--;)t+=" ";return t}function r(e,t,r){var i,l;null==t&&(t=0),null==r&&(i=!0,r=[]);var u=r.length;if(e.type===h.FRAGMENT&&(e=e.nodes),e instanceof Array)for(l=0;l<e.length;l++)o(e[l],t,r);else o(e,t,r);var s=n(t);for(l=u;l<r.length;l++)r[l]=s+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(e,t,n){if("function"==typeof e.stringify)return void n.push(e.stringify(c));if("string"==typeof e.content)return void n.push(a(e.content));if("function"==typeof e.content)return void n.push(a(e.content()));if(l(e))return void n.push(i(e)+";");if(u(e)){var o=c?">":" > ";return n.push(i(e)+o),void r(s(e),f,n)}n.push(i(e)+"{"),r(e.nodes,f,n),n.push("}")}function i(e){var t,n,r=e.tagName;null!=e.attr&&(t=e.attr.id||"",n=e.attr["class"]||""),"function"==typeof t&&(t=t()),"function"==typeof n&&(n=n()),t&&(t=-1!==t.indexOf(" ")?"":"#"+t),n&&(n="."+n.split(" ").join("."));var o="";for(var i in e.attr)if("id"!==i&&"class"!==i){var l=e.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===r&&(t||n)&&(r="");var u="";return e.expression&&(u="("+e.expression+")"),r+t+n+o+u}function l(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function u(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function s(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function a(e){return-1===e.indexOf("'")?"'"+e.trim()+"'":-1===e.indexOf('"')?'"'+e.trim()+'"':'"'+e.replace(/"/g,'\\"').trim()+'"'}t=function(t,n){return null==t?"":("string"==typeof t&&(t=e.parse(t)),null==n?(f=0,c=!0):"number"==typeof n?(f=n,c=0===f):(f=n&&n.indent||4,c=0===f||n&&n.minimizeAttributes),r(t))};var c,f,h=e.Dom}(),e.stringify=t}(Mask),function(e){function t(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null},this.model=null,this.modelRef=null,this.nodes=null,this.parent=null,this.container=null,this.template=null}function n(e,t,n,r){null==e.nodes&&Compo.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,u=ExpressionUtil.eval(l,t,n,e),s=e.nodes;if(e.nodes=null,null!=u){"number"!=typeof u.length&&(u=obj_toDictionary(u)),e.nodes=[],e.model=u,e.modelRef=l,e.template=s,e.container=r;var a=u.length,c=-1;if(null!=a){for(;++c<a;)e.nodes[c]=o("%.each.item",s,u[c],c,r,e);e.append=i.append}}}function r(e,t,n,r){var i=e.attr.repeat.split(".."),l=+i[0],u=+i[1],s=e.nodes;(l!==l||u!==u)&&log_error("Repeat attribute(from..to) invalid",e.attr.repeat),e.nodes=[];for(var a=-1;++a<u;)e.nodes[a]=o("%.repeat.item",s,t,a,r,e)}function o(e,t,n,r,o,i){return{type:Dom.COMPONENT,compoName:e,attr:{},nodes:t,model:n,container:o,parent:i,index:r}}e.registerHandler("%",t),t.prototype={renderStart:function(e,t,o){var i=this.attr;if(null!=i.each||null!=i.foreach)return void n(this,e,t,o);if(null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],e,t,this.parent),void(this.state||(this.nodes=null));if(null!=i["else"]){var l=this.parent.components,u=l&&l[l.length-1];return null!=u&&"%"===u.compoName&&null!=u.attr["if"]?void(u.state&&(this.nodes=null)):void throw_("`% else` should be after `% if='condition'`, got: "+(u&&(u.compoName||u.tagName)))}if(null!=i.use){var s=i.use;return this.model=obj_getProperty(e,s),void(this.modelRef=s)}if(null==i["debugger"]){if(null!=i.visible){var a=ExpressionUtil.eval(i.visible,e,t,this.parent);return void(a||(this.nodes=null))}if(null!=i.log){var c=i.log,f=obj_getProperty(e,c);return void console.log("Key: %s, Value: %s",c,f)}null!=i.repeat&&r(this,e,t,o)}},render:null,renderEnd:null,append:null};var i={append:function(t){var n=new Dom.Component;n.nodes=this.template,n.model=t,e.render(n,t,null,this.container,this)
}}}(Mask),function(){Mask.registerHandler(":html",{$meta:{mode:"server:all"},render:function(e,t,n){if(this.html=jmask(this.nodes).text(e,t,this),n.insertAdjacentHTML)return void n.insertAdjacentHTML("beforeend",this.html);if(n.ownerDocument){var r,o=document.createElement("div"),i=document.createDocumentFragment();for(o.innerHTML=this.html,r=o.firstChild;null!=r;)i.appendChild(r),r=r.nextSibling}},toHtml:function(){return this.html||""},html:null})}(),function(e){function t(){}function n(){var t;for(t in this.attr)break;var n=this.nodes;e.registerHandler(t,Compo({renderStart:function(){this.nodes=e.merge(n,this.nodes||[],this)}}))}custom_Tags.define=t,t.prototype={$meta:{serializeNodes:!0},render:n,onRenderStartClient:n}}(Mask),function(){var e={},t={get:function(t){return e[t]},resolve:function(t,n){var r=e[n];if(null!=r)return r;for(var o=":template[id="+n+"]",i=t.parent,l=null;null!=i;){if(l=jmask(i.nodes).filter(o).get(0),null!=l)return l.nodes;i=i.parent}return log_warn("Template was not found",n),null},register:function(t,n){return null==t?void log_warn("`:template` must be define via id attr."):void(e[t]=n)}};Mask.templates=t,Mask.registerHandler(":template",{render:function(){t.register(this.attr.id,this.nodes)}}),Mask.registerHandler(":import",{renderStart:function(){var e=this.attr.id;return null==e?void log_error("`:import` shoud reference the template via id attr"):void(this.nodes=t.resolve(this,e))}})}(),function(){custom_Statements.log={render:function(e,t,n,r,o){var i=ExpressionUtil.evalStatements(e.expression,t,n,o);i.unshift("Mask::Log"),console.log.apply(console,i)}},customTag_register("debugger",{render:function(){}})}(),function(e,t){function n(e){return e.parentNode.removeChild(e)}function r(e){if(null!=e)for(var t=e.length,r=-1;++r<t;)n(e[r])}function o(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function i(e,t){return t.parentNode.insertBefore(e,t)}function l(){}function u(){}function s(){}function a(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,r=e.components,o=0,i=r.length;i>o;o++)n=r[o],"validate"!==n.compoName?a(n):t.push(n);return t}var c,f,h,p,d,m,g,v,y=!0,_="undefined"!=typeof t?t:e.Compo||global.Compo,b=_.Dom.addEventListener,x=e.registerHandler,w=e.registerAttrHandler,C=e.registerUtil,j=_.config.getDOMLibrary();!function(){function e(e,t){for(var n,r=-1,o=t.length-1;++r<o;)n=t[r],null==e[n]&&(e[n]={}),e=e[n];return e}function t(e){return null==e||"object"!=typeof e?null:"number"==typeof e.length&&"function"==typeof e.slice?w.Array:"function"==typeof e.toUTCString?w.Date:null}function n(n,o,i,l){var s=l.length,c=s>1?e(n,l):n,f=l[s-1],h=c[f];if(s>1&&r(n,l),"length"===f){var p=t(c);if(null!=p)return u(c,p,function(){for(var e=i.length,t=-1;++t<e;)i[t].apply(null,arguments)}),h}return x(c,f,{get:function(){return h},set:function(e){if(e!==h){h=e;var r=0,l=i.length,s=t(e);if(null!=s)for(;l>r;r++)u(e,s,i[r]);if(null!=n[a][b])return void(n[a][b][o]=1);for(r=0;l>r;r++)i[r](e)}},configurable:!0,enumerable:!0}),h}function r(e,t){for(var n,r=i(e),l="",u=t.length-1,s=0;u>s;s++)n=t[s],l+=n+".",o(l,e,n,r),e=e[n]}function o(e,t,n,r){var o,i=t[n];x(t,n,{get:function(){return i},set:function(t){t!==i&&(o=i,i=t,r(e,o))},configurable:!0,enumerable:!0})}function i(e){return function(t,n){var r=e[a];if(null!=r)for(var o in r)if(0===o.indexOf(t)){var i=r[o].slice(0),l=i.length,u=0;if(0!==l){var s,f,p=obj_getProperty(e,o);for(u=0;l>u;u++)s=i[u],h(e,o,s),f=o.substring(t.length),h(n,f,s);for(u=0;l>u;u++)i[u](p);for(u=0;l>u;u++)c(e,o,i[u])}}}}function l(e,t,n){var r=m(e,t);return arr_contains(r,n)===!1&&r.push(n),r}c=function(e,r,o){for(var i=r.split("."),s=i.length,c=-1,f=e;++c<s&&(f=f[i[c]],null!=f);)if(null!=f[a]){var h=i.slice(c+1).join(".");if(null!=f[a][h]){l(f,h,o);var p=l(e,r,o);if(1===p.length){var d=i.splice(0,c);0!==d.length&&n(e,r,p,d,!0)}return}}var p=l(e,r,o);1===p.length&&n(e,r,p,i,!0);var m=obj_getProperty(e,r),g=t(m);null!=g&&u(m,g,o)},f=function(e,t,n){for(var r=t.split("."),o=r.length,i=-1,l=e;++i<o&&(l=l[r[i]],null!=l);)if(null!=l[a]){if(f(l,r.slice(i).join("."),n))return!0;break}var u=e[a];return null==u||null==u[t]?!1:arr_contains(u[t],n)},h=function(e,n,r){for(var o=n.split("."),i=o.length,l=-1,u=e;++l<i&&(u=u[o[l]],null!=u);)if(null!=u[a]){h(u,o.slice(l).join("."),r);break}var c=m(e,n),f=obj_getProperty(e,n);void 0===r?c.length=0:arr_remove(c,r);var p=t(f);null!=p&&s(f,p,r)},p=function(e){var t=e[a];null!=t&&(t[b]={})},d=function(e){var t=e[a],n=null==t?null:t[b];if(null!=n){t[b]=null;var r,o,i,l,u;for(r in n)if(o=e[a][r],l=null==o?0:o.length,0!==l)for(u=-1,i=r===y?e:obj_getProperty(e,r);++u<l;)o[u](i)}},m=function(e,t){var n=e[a];if(null==n&&(n={__dirty:null,__dfrTimeout:null,__mutators:null},x(e,"__observers",{value:n,enumerable:!1})),null==t)return n;var r=n[t];return null==r?n[t]=[]:r},g=function(e,n){var r=t(e);null!=r&&u(e,r,n)},v=function(e,t){s(e,null,t)};var u,s,a="__observers",y="__mutators",_="__dfrTimeout",b="__dirty",x=Object.defineProperty,w={Array:{throttle:!1,methods:["push","unshift","splice","pop","shift","reverse","sort","remove"]},Date:{throttle:!0,methods:["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds"]}};!function(){function e(e,r,o,i){var l=i===!0?n:t;return function(){return l(e,r,o,_Array_slice.call(arguments))}}function t(e,t,n,o){var i=m(e,y),l=t.apply(e,o);return r(e,i,n,o,l),l}function n(e,t,n,o){var i=m(e,y),l=t.apply(e,o),u=e[a];return null!=u[_]?l:(u[_]=setTimeout(function(){u[_]=null,r(e,i,n,o,l)}),l)}function r(e,t,n,r,o){if(0!==t.length){var i=e[a];if(null!=i[b])return void(i[b][y]=1);for(var l,u=t.length,s=-1;++s<u;)l=t[s],"function"==typeof l&&l(e,n,r,o)}}u=function(t,n,r){var o=n.methods,i=n.throttle,l=m(t,y);if(0===l.length)for(var u,s,a=o.length,c=-1;++c<a;)u=o[c],s=t[u],null!=s&&(t[u]=e(t,s,u,i));l[l.length++]=r},s=function(e,t,n){var r=m(e,y);return void 0===n?void(r.length=0):void arr_remove(r,n)}}()}();var N;!function(){N=function(e){return null==e||""===e?null:("string"==typeof e&&(e=new Date(e)),isNaN(e)===!1&&"function"==typeof e.getFullYear?e:null)}}();var O,S,k,A,E;!function(){O=function(e,t,n,r){if(null==e.components)return o(n,r||e.placeholder);var l,u=e.components,s=null,a=!0,c=u.length,f=t-1;if(null==s)for(;++f<c;)if(l=u[f].elements,l&&l.length){s=l[0];break}if(null==s)for(a=!1,f=c>t?t:c;--f>-1;)if(l=u[f].elements,l&&l.length){s=l[l.length-1];break}return null==s&&(s=r||e.placeholder),a?i(n,s):o(n,s)},S=function(t,n,r,o,i){return e.render(n,r,o,i,t)},k=function(e,t){if(null==e)return!1;null!=e.elements&&(r(e.elements),e.elements=null),_.dispose(e);var n=t&&t.components||e.parent&&e.parent.components;return null==n?(log_error("Parent Components Collection is undefined"),!1):arr_remove(n,e)},A=function(e){_.signal.emitIn(e,"domInsert")},E=function(e,t){if("function"==typeof e.dispose){var n=e.dispose;return void(e.dispose=function(){t.call(this),n.call(this)})}e.dispose=t}}();var D,T,R,M,L,P,I,H;!function(){function t(e,t,i,l,u){if(null!=l){if("object"==typeof l){var s=T(l.accessor,t,null,i);return null==s||"object"!=typeof s?void console.error("Binding failed to an object over accessor",l.ref):void e(s,l.ref,u)}var a=l,c=a.split("."),f=c.length;if(f>1){var h=c[0];if("$c"===h)return i=r(i,c.slice(1),f-1),void e(i,a.substring(3),u);if("$a"===h||"$ctx"===h)return}var s=null;o(t,c,f)&&(s=t),null==s&&(s=n(i,c,f)),null==s&&(s=t),e(s,a,u)}}function n(e,t,n){for(var r;null!=e;){if(r=e.scope,null!=r&&o(r,t,n))return r;e=e.parent}return null}function r(e,t,n){for(;null!=e;){if(o(e,t,n))return e;e=e.parent}return e}function o(e,t,n){if(null==e)return!1;for(var r=0;n>r;r++)if(e=e[t[r]],null==e)return!1;return!0}var i=e.Utils.Expression;T=i.eval,I=i.parse,H=i.varRefs,D=function(e,t,n,r){if("."===e)return t;var o=T(e,t,n,r);return null==o?"":o},R=function(e,n,r,o,i){if("."===e)return void g(n,i);var l=I(e),u=H(l,n,r,o);if(null!=u){if("string"==typeof u)return void t(c,n,o,u,i);for(var s,a=null!=u.length&&"function"==typeof u.splice,f=a===!0?u.length:1,h=0;f>h;h++)s=a===!0?u[h]:u,t(c,n,o,s,i)}},M=function(e,n,r,o){if("function"==typeof r&&log_warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return void v(n,o);var i,l=H(e,n,null,r);if(null!=l){if("string"==typeof l)return void t(h,n,r,l,o);for(var i,u=null!=l.length&&"function"==typeof l.splice,s=u===!0?l.length:1,a=0;s>a;a++)i=u===!0?l[a]:l,t(h,n,r,i,o)}},L=function(e,t,n,r,o){var i=0;return function(){if(++i>1)return i=0,void log_warn("<mask:bind:expression> Concurent binder detected",e);var l=D(e,t,n,r);if(arguments.length>1){var u=_Array_slice.call(arguments);u[0]=l,o.apply(this,u)}else o(l);i--}},P=function(e){var t=0;return function(){return++t>1?(t=0,void log_warn("<listener:expression> concurent binder")):(e(),void t--)}}}();var F,$;!function(){F=function(e,t,n){for(var r,o,i,l,u=e.split(";"),s=[],a=0,c=u.length;c>a;a++)r=u[a].split(":"),1===r.length||2===r.length?(i=2===r.length?r[0]:n,o=r[2===r.length?1:0],l=$(o.trim(),i,t),null!=l&&s.push(l)):log_error('Too much ":" in a signal def.',u[a]);return s},$=function(e,t,n){if(n!==!0)return{signal:e,type:t};var r=e.indexOf(".");return-1===r?(log_error("No pipe name in a signal",e),null):{signal:e.substring(r+1),pipe:e.substring(0,r),type:t}}}();var U;!function(){function e(e,t,n){return null==e||"function"!=typeof e[t]?(log_error("BindingProvider.",n,"should be a function. Property:",t),!1):!0}function t(e,t){var n=e.ctr.parent;if(null!=n[t])return n;var r=e.model;return null!=r[t]?r:(log_error("BindingProvider. Accessor `",t,"`should be a function"),null)}function n(e){var t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return t+"-"+(10>n?"0":"")+n+"-"+(10>r?"0":"")+r}function r(e){var t=e.getHours(),n=e.getMinutes();return t+":"+(10>n?"0":"")+n}var o={get:function(e,n){var r=e.objGetter;if(null==r)return D(n,e.model,e.ctx,e.ctr);var o=t(e,r);return null==o?null:o[r](n,e.model,e.ctr.parent)},set:function(e,n,r,o){var i=o.objSetter;if(null==i)return void obj_setProperty(e,n,r);var l=t(o,i);null!=l&&l[i](n,r,o.model,o.ctr.parent)}},i={get:function(t){var n=t.domGetter;if(null==n)return obj_getProperty(t,t.property);var r=t.ctr.parent;return e(r,n,"Getter")===!1?null:r[n](t.element)},set:function(t,n){var r=t.domSetter;if(null==r)return void obj_setProperty(t,t.property,n);var o=t.ctr.parent;e(o,r,"Setter")!==!1&&o[r](n,t.element)}},l={domSet:function(e){return function(t,n){var r=N(n);t.element.value=null==r?"":e(r)}},objSet:function(e){return function(t,n,r){var o=N(r);if(null!=o){var i=N(obj_getProperty(t,n));return null==i?void obj_setProperty(t,n,o):void e(i,o)}}}};U={objectWay:o,domWay:i,SELECT:{get:function(e){var t=e.element,n=t.selectedIndex;if(-1===n)return"";var r=t.options[n],o=r.getAttribute("value");return null==o?r.getAttribute("name"):o},set:function(e,t){var n,r,o,i=e.element,l=i.options,u=l.length;for(o=0;u>o;o++)if(n=l[o],r=n.getAttribute("value"),null==r&&(r=n.getAttribute("name")),r==t)return void(i.selectedIndex=o);log_warn("Value is not an option",t)}},DATE:{domWay:{get:i.get,set:function(e,t){var r=N(t);e.element.value=null==r?"":n(r)}},objectWay:{get:o.get,set:l.objSet(function(e,t){e.setFullYear(t.getFullYear()),e.setMonth(t.getMonth()),e.setDate(t.getDate())})}},TIME:{domWay:{get:i.get,set:l.domSet(r)},objectWay:{get:o.get,set:l.objSet(function(e,t){e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds())})}}}}();var z={};e.registerBinding=function(e,t){z[e]=t};var B;!function(){function t(e){var t=e.expression,n=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(e.binder=L(t,n,e.ctx,e.ctr,r),R(t,n,e.ctx,e.ctr,e.binder),"dual"===e.bindingType){var o=e.ctr.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=e.element,l=o["change-event"]||o.changeEvent||"change",u=e.domChanged.bind(e);b(i,l,u)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function n(e,t,r){if(null!=e){var o=e.slots;(null==o||"function"!=typeof o[t]||o[t].apply(e,r)!==!1)&&n(e.parent,t,r)}}e.BindingProvider=B=function(e,t,n,r){null==r&&(r=":bind"===n.compoName?"single":"dual");var o,i=n.attr;if(this.node=n,this.ctr=n,this.ctx=null,this.model=e,this.element=t,this.value=i.value,this.property=i.property,this.domSetter=i.setter||i["dom-setter"],this.domGetter=i.getter||i["dom-getter"],this.objSetter=i["obj-setter"],this.objGetter=i["obj-getter"],this["typeof"]=i["typeof"]||null,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.domGetter)switch(t.tagName){case"INPUT":if(o=t.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}if("date"===o){var l=U.DATE;this.domWay=l.domWay,this.objectWay=l.objectWay}"number"===o&&(this["typeof"]="Number"),this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=U.SELECT;break;default:this.property="element.innerHTML"}if(i.log&&(this.log=!0,"log"!==i.log&&(this.logExpression=i.log)),i["x-signal"]){var u=F(i["x-signal"],null,"dom")[0],s=u&&u.type;switch(s){case"dom":case"object":this["signal_"+s+"Changed"]=u.signal;break;default:log_error("Signal typs is not supported",u)}}if(i["x-pipe-signal"]){var u=F(i["x-pipe-signal"],!0,"dom")[0],s=u&&u.type;switch(s){case"dom":case"object":this["pipe_"+s+"Changed"]=u;break;default:log_error("Pipe type is not supported")}}if(i["dom-slot"]){this.slots={};var a=n.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[i["dom-slot"]]=function(e,t){this.domChanged(e,t)}}var f=i["object-pipe-slot"]||i["x-pipe-slot"];if(f){var h=f,p=h.indexOf("."),d=h.substring(0,p),u=h.substring(p+1);this.pipes={},this.pipes[d]={},this.pipes[d][u]=function(){this.objectChanged()},_.pipe.addController(this)}if(i.expression){if(this.expression=i.expression,null==this.value&&"single"!==r){var m=H(this.expression);"string"==typeof m?this.value=m:log_warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value},B.create=function(e,t,n,r){var o,i=n.attr.bindingProvider,l=null==i?null:z[i];return"function"==typeof l?new l(e,t,n,r):(o=new B(e,t,n,r),null!=l&&obj_extend(o,l),o)},B.bind=function(e){return t(e)},B.prototype={constructor:B,dispose:function(){M(this.expression,this.model,this.ctr,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return void log_warn("Concurance change detected",this);if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&n(this.ctr,this.signal_objectChanged,[e]),this.pipe_objectChanged){var t=this.pipe_objectChanged;_.pipe(t.pipe).emit(t.signal)}this.locked=!1}},domChanged:function(e,t){if(this.locked===!0)return void log_warn("Concurance change detected",this);this.locked=!0,null==t&&(t=this.domWay.get(this));var r=this["typeof"];if(null!=r){var o=window[r];t=o(t)}var i=!0,l=this.ctr.validations;if(l)for(var u,s=l.length,a=-1;++a<s;)if(u=l[a],u.validate(t,this.element,this.objectChanged.bind(this))===!1){i=!1;break}if(i&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t,this),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&n(this.ctr,this.signal_domChanged,[t]),this.pipe_domChanged)){var c=this.pipe_domChanged;_.pipe(c.pipe).emit(c.signal)}this.locked=!1},objectWay:U.objectWay,domWay:U.domWay},obj_extend(B,{addObserver:c,removeObserver:h})}(),x(":visible",l),l.prototype={constructor:l,refresh:function(e,t){t.style.display=D(this.attr.check,e)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&c(e,this.attr.bind,this.refresh.bind(this,e,n))}},function(){function e(){}x(":bind",e),e.prototype={constructor:e,renderStart:function(e,t,n){this.provider=B.create(e,n,this,"single"),this.provider.objectChanged()}}}(),x(":dualbind",u),u.prototype={constructor:u,renderStart:function(e,t,n){this.provider=B.create(e,n,this),this.provider.objectChanged()},dispose:function(){var e=this.provider,t=e&&e.dispose;"function"==typeof t&&t.call(e)},handlers:{attr:{"x-signal":function(){}}}},function(){function n(){}function r(e,t){this.fn=e,this.message=t}function o(e,t,n){log_warn("Validate Notification:",e,t);var r=j(e).next("."+l);return 0===r.length&&(r=j("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(t).end().show()}function i(e){return j(e).next("."+l).hide()}var l="-validate-invalid";e.registerValidator=function(e,t){u[e]=t},x(":validate",n),n.prototype={constructor:n,attr:{},renderStart:function(e,t,o){if(this.element=o,this.attr.value){var i=n.resolveFromModel(e,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(e,t,n){null==t&&(t=this.element),this.attr&&(null==e&&this.attr.getter&&(e=obj_getProperty({node:this,element:t},this.attr.getter)),null==e&&this.attr.value&&(e=obj_getProperty(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(e),r&&!this.attr.silent)return this.notifyInvalid(t,r,n),!1;return this.makeValid(t),!0},notifyInvalid:function(e,t,n){return o(e,t,n)},makeValid:function(e){return i(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in u!=!1){var t=u[e];this.validators.push(new r(t(this.attr[e],this),this.attr.message))}else log_error("Unknown Validator:",e,this)}}},n.resolveFromModel=function(e,t){return obj_getProperty(e.Validate,t)},n.createCustom=function(e,t){var o=new n;return o.element=e,o.validators=[new r(t)],o},r.prototype.validate=function(e){var t=this.fn(e);return t===!1?this.message||"Invalid - "+e:t},x(":validate:message",t({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,t){var n=this;this.model.message=e,this.compos.button.off().on(function(){n.hide(),t&&t()}),this.$.show()},hide:function(){this.$.hide()}}));var u={match:function(e){return function(t){return new RegExp(e).test(t)}},unmatch:function(e){return function(t){return!new RegExp(e).test(t)}},minLength:function(e){return function(t){return t.length>=parseInt(e,10)}},maxLength:function(e){return function(t){return t.length<=parseInt(e,10)}},check:function(e,t){return function(n){return D("x"+e,t.model,{x:n},t)}}}}(),x(":validate:group",s),s.prototype={constructor:s,validate:function(){for(var e,t=a(this),n=0,r=t.length;r>n;n++)if(e=t[n],!e.validate())return!1;return!0}},function(){function e(e,t,n){return e?null==t||""===t?e+" "+n:e.replace(t,n):n}function t(e){return function(t){e.textContent=t}}function n(t,n,r){return function(o){var i=t.getAttribute(n),l=e(i,r,o);t.setAttribute(n,l),r=o}}function r(t,n,r){return function(o){switch(typeof t[n]){case"boolean":return void(r=t[n]=!!o);case"number":return void(r=t[n]=Number(o));case"string":return void(r=t[n]=e(t[n],r,o));default:return void log_warn("Unsupported elements property type",n)}}}function o(e,o,i,l,u){if("node"===e)return t(i);if("attr"===e){switch(u){case"value":case"disabled":case"checked":case"selected":case"selectedIndex":return r(i,u,l)}return n(i,u,l)}throw Error("Unexpected binder type: "+e)}function i(e,t,n,r,i,l,u,s){var a=o(s,t,i,e,u),c=L(t,n,r,l,a);R(t,n,r,l,c),E(l,function(){M(t,n,l,c)})}C("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,t,n,r,o){var i=D(e,t,n,o);return this.element=document.createTextNode(i),this.current=i},node:function(e,t,n,r,o){return i(this.current,e,t,n,this.element,o,null,"node"),this.element},attrRenderStart:function(e,t,n,r,o){return this.current=D(e,t,n,o)},attr:function(e,t,n,r,o,l){return i(this.current,e,t,n,r,o,l,"attr"),this.current}})}(),w("xx-visible",function(e,t,n,r,o,i){var l=L(t,n,r,i,function(e){o.style.display=e?"":"none"});R(t,n,r,i,l),E(i,function(){M(t,n,i,l)}),D(t,n,r,i)||(o.style.display="none")}),w("x-toggle","client",function(e,t,n,r,o,i){var l=t.substring(0,t.indexOf(":")),u=t.substring(l.length+1),s=H(u);"string"!=typeof s&&(s=s[0]),b(o,l,function(){var e=D(u,n,r,i);obj_setProperty(n,s,e)})}),w("x-class-toggle","client",function(e,t,n,r,o){var i=t.substring(0,t.indexOf(":")),l=t.substring(i.length+1).trim();b(o,i,function(){j(o).toggleClass(l)})}),function(e){function n(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",n);var o=function(){var e={refresh:function(e){this.model=e,this.elements&&(r(this.elements),this.elements=[]),null!=_&&_.dispose(this),i(S(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){M(this.expr,this.originalModel,this,this.binder)}};return function(t,n,r,o){var i=t.attr.use;obj_extend(t,{expr:i,placeholder:document.createComment(""),binder:L(i,n,r,t,e.refresh.bind(t)),originalModel:n,model:D(i,n,r,t),dispose:e.dispose}),R(i,n,r,t,t.binder),o.appendChild(t.placeholder)}}(),l=function(){return function(e,t,n){function r(e){console.log("Logger > Key: %s, Value: %s",o,e)}var o=e.attr.log,i=L(o,t,n,e,r),l=D(o,t,n,e);R(o,t,n,e,i),E(e,function(){M(o,t,e,i)}),r(l)}}(),u=function(){function e(e,t){return function(){return e.apply(t,arguments)}}var t={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(i(S(this,this.template,this.model,this.cntx),this.placeholder),this.$=j(this.elements)):(null==this.$&&(this.$=j(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){M(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(n,r,o,i){var l=n.attr["if"];obj_extend(n,{expr:l,template:n.nodes,placeholder:document.createComment(""),binder:L(l,r,o,n,e(t.refresh,n)),state:!!D(l,r,o,n)}),n.state||(n.nodes=null),R(l,r,o,n,n.binder),i.appendChild(n.placeholder)}}(),s=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return i(S(this,this.template,this.model,this.cntx)),void(this.$=j(this.elements));null==this.$&&(this.$=j(this.elements)),this.$[e?"hide":"show"]()}}};return function(t,n,r,o){var i=t.parent.components,l=i&&i[i.length-1];return t.template=t.nodes,t.placeholder=document.createComment(""),null==l||"%%"!==l.compoName||null==l.attr["if"]?void log_error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'):(l.onchange=e.refresh.bind(t),l.state&&(t.nodes=null),void o.appendChild(t.placeholder))}}(),a=function(){function n(e,t){var n=[];if(null==t||"object"!=typeof t||null==t.length)return n;for(var r,o=0,i=t.length;i>o;o++){switch(r=t[o],typeof r){case"string":case"number":case"boolean":r=t[o]=Object(r)}n[o]=new s(e.template,r,e)}return n}function r(e,t){for(var n=e.components,r=0,o=n.length,l=0,u=null,s=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=n[r],null!=a.elements&&0!==a.elements.length)for(l=0,u=a.elements.length;u>l;l++)s=a.elements[l],s.parentNode.removeChild(s);e:for(l=0,u=t.length;u>l;l++){for(r=0;o>r;r++)if(t[l]===n[r].model){f[l]=n[r];continue e}log_warn("No Model Found for",t[l])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(l=0,u=a.elements.length;u>l;l++)s=a.elements[l],c.appendChild(s);e.components=f,i(c,e.placeholder)}function o(e,t,r,o,i){if(null!=t&&null!=r){var l=t,s=t+r;for(s>e.components.length&&(s=e.components.length);s>l;l++)k(e.components[l],e)&&(l--,s--)}if(null!=o&&i&&i.length){var a=new u,c=n(e,i),f=S(a,c),h=a.components;O(e,o,f),A(a),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[o,0].concat(h))}}function l(e,t){for(var n,r=e.components,o=r.length;--o>-1;)n=r[o],-1!==t.indexOf(n.model)&&k(n,e)}var u=e.Dom.Component,s=function(){function e(e,t,n){this.nodes=e,this.model=t,this.parent=n}var t=u.prototype;e.prototype={compoName:"%%.each.item",constructor:a,renderEnd:function(e){this.elements=e}};for(var n in t)e.prototype[n]=t[n];return e}(),a={append:function(t){var n=new s(this.template,t,this);e.render(n,t,null,this.container,this)}},c={refresh:function(e,t,u,s){var a,c,f=0;if(null==t){if(null!=this.components)for(f=0,c=this.components.length;c>f;f++)a=this.components[f],k(a,this)&&(f--,c--);return this.components=[],this.nodes=n(this,e),i(S(this,this.nodes),this.placeholder),void arr_each(this.components,A)}for(c=e.length;c>f;f++)switch(a=e[f],typeof a){case"string":case"number":case"boolean":e[f]=Object(a)}switch(t){case"push":o(this,null,null,e.length,e.slice(e.length-1));break;case"pop":o(this,e.length,1);break;case"unshift":o(this,null,null,0,e.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var h=u[0],p=1===u.length?this.components.length:u[1],d=u.length>2?e.slice(u[0],u.length-2+u[0]):null;o(this,h,p,h,d);break;case"sort":case"reverse":r(this,e);break;case"remove":null!=s&&s.length&&l(this,s)}},dispose:function(){M(this.expr,this.model,this,this.refresh)}};return function(e,r,o,i){null==e.nodes&&"undefined"!=typeof t&&t.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,u=D(l,r,o,e);obj_extend(e,{expr:l,binder:L(l,r,o,e,c.refresh.bind(e)),template:e.nodes,container:i,placeholder:document.createComment(""),dispose:c.dispose}),i.appendChild(e.placeholder),R(e.expr,r,o,e,e.binder);for(var s in a)e[s]=a[s];e.nodes=n(e,u)}}(),c=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=D(this.expr,this.model,this.cntx,this),t=0,n=this.elements.length;n>t;t++)this.elements[t].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){M(this.expr,this.model,this,this.binder)}};return function(t,n,r){var o=t.attr.visible;obj_extend(t,{expr:o,binder:L(o,n,r,t,e.refresh.bind(t)),dispose:e.dispose}),R(o,n,r,t,t.binder),e.refresh.call(t)}}();n.prototype={constructor:n,elements:null,renderStart:function(e,t,n){var r=this.attr;if(null==r["debugger"])return null!=r.use?void o(this,e,t,n):null!=r.log?void l(this,e,t,n):(this.model=e,null!=r["if"]?void u(this,e,t,n):null!=r["else"]?void s(this,e,t,n):void((null!=r.each||null!=r.foreach)&&a(this,e,t,n)))},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&c(this,this.model,this.cntx)}}}(e),function(){var n,o,l,u,s,a=e.getStatement();!function(){n=function(e,t,n,r,o){return a[e].getNodes(t,n,r,o)},o=function(e,t,n,r,o){if(null==e)return null;var i=[];return builder_build(e,t,n,r,o,i),i},l=function(e,t){e.placeholder=document.createComment(""),t.appendChild(e.placeholder)},u=function(e,t,n,r,o,i){e.parent=i,e.model=n,e.refresh=fn_proxy(e.refresh,e),e.binder=L(e.expr||e.expression,n,r,i,e.refresh),R(e.expr||e.expression,n,r,i,e.binder)},s=function(e,t){if(null!=e)for(var n,r="function"==typeof e.splice,o=r?e.length:1,i=-1;++i<o;)n=r?e[i]:e,n.style.display=t?"":"none"}}(),function(){function t(){}function r(e,t,n,r,o,i,l,u){for(e.model=o,e.ctx=i,e.controller=u,e.refresh=fn_proxy(e.refresh,e),e.binder=P(e.refresh),e.index=n,e.Switch=[{node:t,elements:null}],R(t.expression,o,i,u,e.binder);;){if(t=t.nextSibling,null==t||"else"!==t.tagName)break;e.Switch.push({node:t,elements:null}),t.expression&&R(t.expression,o,i,u,e.binder)}null!=n&&(e.Switch[n].elements=r)}e.registerHandler("+if",{meta:{serializeNodes:!0},render:function(e,t,r,i,l){for(var u=this,s=n("if",u,e,t,i),a=0,c=u;;){if(c.nodes===s)break;if(a++,c=u.nextSibling,null==c||"else"!==c.tagName){a=null;break}}return this.attr["switch-index"]=a,o(s,e,t,r,i,l)},renderEnd:function(e,n,o,i,l){var u=new t,s=this.attr["switch-index"];return u.placeholder=document.createComment(""),i.appendChild(u.placeholder),r(u,this,s,e,n,o,i,l),u},serializeNodes:function(t){for(var n=[t];;){if(t=t.nextSibling,null==t||"else"!==t.tagName)break;n.push(t)}return e.stringify(n)}}),t.prototype={compoName:"+if",ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var t,n=this,r=n.Switch,o=r.length,l=-1,u=n.index,a=n.model,c=n.ctx,f=n.controller;++l<o&&(t=r[l].node.expression,null!=t)&&!D(t,a,c,f););if(u!==l){if(null!=u&&s(r[u].elements,!1),l===o)return void(n.index=null);this.index=l;var h=r[l];if(null!=h.elements)return void s(h.elements,!0);var p=e.render(h.node.nodes,a,c,null,f),d=p.nodeType===Node.DOCUMENT_FRAGMENT_NODE?_Array_slice.call(p.childNodes):p;i(p,n.placeholder),h.elements=d}},dispose:function(){for(var e,t,n=this.Switch,r=n.length,o=-1;++o<r;)e=n[o],t=e.node.expression,t&&M(t,this.model,this.controller,this.binder),e.node=null,e.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function t(){}function n(e,t,n,r,o){if(u=f.getNodes(e,t,n,r,o),c=null,null!=u){for(var i=t.length,l=-1;++l<i&&t[l].nodes!==u;);c=l===i?null:l}}function r(e,t,n,r,o,i,l,u){e.ctx=i,e.expr=t.expression,e.model=o,e.controller=u,e.index=n,e.nodes=t.nodes,e.refresh=fn_proxy(e.refresh,e),e.binder=L(e.expr,o,i,u,e.refresh),e.Switch=new Array(t.nodes.length),null!=n&&(e.Switch[n]=r),R(t.expression,o,i,u,e.binder)}var u,c,f=a["switch"],h="switch-index";e.registerHandler("+switch",{meta:{serializeNodes:!0},serializeNodes:function(t){return e.stringify(t)},render:function(e,t,r,i,l){var s=D(this.expression,e,t,i);return n(s,this.nodes,e,t,i),null==u?null:(this.attr[h]=c,o(u,e,t,r,i,l))},renderEnd:function(e,n,o,i,u){var s=new t,a=this.attr[h];return l(s,i),r(s,this,a,e,n,o,i,u),s}}),t.prototype={compoName:"+switch",ctx:null,model:null,controller:null,index:null,nodes:null,Switch:null,binder:null,refresh:function(t){var r=this,o=r.Switch,l=(o.length,r.index),a=r.model,f=r.ctx,h=r.controller;if(n(t,r.nodes,a,f,h),c!==l){if(null!=l&&s(o[l],!1),null==c)return void(r.index=null);this.index=c;var p=o[c];if(null!=p)return void s(p,!0);var d=e.render(u,a,f,null,h),m=d.nodeType===Node.DOCUMENT_FRAGMENT_NODE?_Array_slice.call(d.childNodes):d;i(d,r.placeholder),o[c]=m}},dispose:function(){M(this.expr,this.model,this.controller,this.binder),this.controller=null,this.model=null,this.ctx=null;var e,t,n,r,o=this.Switch;for(e in o)if(t=o[e],null!=t)for(r=t.length,n=-1;++n<r;)null!=t[n].parentNode&&t[n].parentNode.removeChild(t[n])}}}(),function(){function n(e){this.expr=e.expression,this.nodes=e.nodes}function o(e,t,n,r,o){var i=[];return builder_build(e,t,n,r,o,i),i}a["with"];e.registerHandler("+with",{meta:{serializeNodes:!0},rootModel:null,render:function(e,t,n,r){var i=this.expression,l=this.nodes,u=T(i,e,t,r);return this.rootModel=e,o(l,u,t,n,r)},onRenderStartClient:function(e,t){this.rootModel=e,this.model=T(this.expression,e,t,this)},renderEnd:function(e,t,r,o,i){t=this.rootModel||t;var u=new n(this);return u.elements=e,u.model=t,u.parent=i,u.refresh=fn_proxy(u.refresh,u),u.binder=L(u.expr,t,r,i,u.refresh),R(u.expr,t,r,i,u.binder),l(u,o),u}}),n.prototype={compoName:"+with",elements:null,binder:null,model:null,parent:null,refresh:function(e){if(r(this.elements),this.components){for(var n=this.components.length,l=-1;++l<n;)t.dispose(this.components[l]);this.components.length=0}var u=document.createDocumentFragment();this.elements=o(this.nodes,e,null,u,this),i(u,this.placeholder),A(this)},dispose:function(){M(this.expr,this.model,this.parent,this.binder),this.parent=null,this.model=null,this.ctx=null}}}(),function(){function t(e){this.expr=e.expression,this.nodes=e.nodes}function n(e,t,n,r,o){var i=[];return builder_build(e,t,n,r,o,i),i}var r=a.visible;e.registerHandler("+visible",{meta:{serializeNodes:!0},render:function(e,t,r,o){return n(this.nodes,e,t,r,o)},renderEnd:function(e,n,r,o,i){var l=new t(this);return l.elements=e,l.model=n,l.parent=i,l.refresh=fn_proxy(l.refresh,l),l.binder=L(l.expr,n,r,i,l.refresh),R(l.expr,n,r,i,l.binder),l.refresh(),l
}}),t.prototype={compoName:"+visible",elements:null,binder:null,model:null,parent:null,refresh:function(){var e=D(this.expr,this.model,this.ctx,this);r.toggle(this.elements,e)},dispose:function(){M(this.expr,this.model,this.parent,this.binder),this.parent=null,this.model=null,this.ctx=null}}}(),function(){function t(e){for(var t,n=e.length,r=-1;++r<n;)switch(t=e[r],typeof t){case"string":case"number":case"boolean":e[r]=Object(t)}}function n(e,t){for(var n=e.node.components,r=0,o=n.length,l=0,u=null,s=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=n[r],null!=a.elements&&0!==a.elements.length)for(l=0,u=a.elements.length;u>l;l++)s=a.elements[l],s.parentNode.removeChild(s);e:for(l=0,u=t.length;u>l;l++){for(r=0;o>r;r++)if(t[l]===e._getModel(n[r])){f[l]=n[r];continue e}console.warn("No Model Found for",t[l])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(l=0,u=a.elements.length;u>l;l++)s=a.elements[l],c.appendChild(s);e.components=e.node.components=f,i(c,e.placeholder)}function r(e,t,n,r,o){var i=e.node,l=i.components;null==l&&(l=i.components=[]);var u=(e.prop1,e.prop2,e.type,e.ctx),s=e.node;if(null!=t&&null!=n){var a=t,c=t+n;for(c>l.length&&(c=l.length);c>a;a++)k(l[a],i)&&(a--,c--)}if(null!=r&&o&&o.length){var f,a=l.length,h=e._build(i,o,u,s),p=l.splice(a);for(O(i,r,h,e.placeholder),l.splice.apply(l,[r,0].concat(p)),a=0,f=p.length;f>a;a++)_.signal.emitIn(p[a],"domInsert")}}function o(e,t){for(var n,r=e.components,o=r.length;--o>-1;)n=r[o],-1!==t.indexOf(n.model)&&k(n,e.node)}var l={model:null,parent:null,refresh:function(e,l,u,s){var a,c=0,f=this.node,h=(this.model,this.ctx),p=this.node;if(null==l){var d=f.components;if(null!=d){for(var a=d.length,c=-1;++c<a;)k(d[c],f)&&(c--,a--);d.length=0}var m=this._build(f,e,h,p);return i(m,this.placeholder),void arr_each(f.components,A)}var g=e;switch(t(e),l){case"push":r(this,null,null,g.length-1,g.slice(g.length-1));break;case"pop":r(this,g.length,1);break;case"unshift":r(this,null,null,0,g.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var v=u[0],y=1===u.length?this.components.length:u[1],_=u.length>2?g.slice(u[0],u.length-2+u[0]):null;r(this,v,y,v,_);break;case"sort":case"reverse":n(this,g);break;case"remove":null!=s&&s.length&&o(this,s)}},dispose:function(){M(this.expr||this.expression,this.model,this.parent,this.binder)}};!function(){function n(e,t){this.prop1=t[o],this.prop2=t[i],this.type=t[s],this.expr=t[c],null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var r=a["for"],o="for-prop-1",i="for-prop-2",s="for-type",c="for-expr";e.registerHandler("+for",{meta:{serializeNodes:!0},serializeNodes:function(t){return e.stringify(t)},render:function(e,n,l,u,a){var f=r.parseFor(this.expression),h=this.attr;h[o]=f[0],h[i]=f[1],h[s]=f[2],h[c]=f[3];var p=T(f[3],e,n,u);null!=p&&(is_Array(p)&&t(p),r.build(p,f,this.nodes,e,n,l,this,a))},renderEnd:function(e,t,r,o,i){var l=new n(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),u(l,this,t,r,o,i),l},getHandler:function(e,t){return r.getHandler(e,t)}}),n.prototype={compoName:"+for",model:null,parent:null,refresh:l.refresh,dispose:l.dispose,_getModel:function(e){return e.scope[this.prop1]},_build:function(e,t,n,o){var i=r.getNodes(e.nodes,t,this.prop1,this.prop2,this.type);return builder_build(i,this.model,n,null,o)}}}(),function(){function n(e,t,n,o,i,l){for(var u,s=t.length,a=(new Array(s),0);s>a;a++)u=r(e,a),builder_build(u,t[a],n,o,i,l)}function r(e,t){var n=new o;return n.scope={index:t},{type:Dom.COMPONENT,tagName:"each::item",nodes:e,controller:function(){return n}}}function o(){}function i(e){this.expression=e.expression,this.nodes=e.nodes,null==e.components&&(e.components=[]),this.node=e,this.components=e.components}a.each;e.registerHandler("+each",{meta:{serializeNodes:!0},serializeNodes:function(t){return e.stringify(t)},render:function(e,r,o,i,l){var u=D(this.expression,e,r,i);null!=u&&(t(u),n(this.nodes,u,r,o,this,l))},renderEnd:function(e,t,n,r,o){var l=new i(this,this.attr);return l.placeholder=document.createComment(""),r.appendChild(l.placeholder),u(l,this,t,n,r,o),l}}),e.registerHandler("each::item",o),o.prototype={compoName:"each::item",scope:null,model:null,modelRef:null,parent:null,renderStart:y===!0?function(){var e=this.parent.expression;this.modelRef=""+("."===e?"":"("+e+")")+'."'+this.scope.index+'"'}:null,renderEnd:function(e){this.elements=e},dispose:function(){null!=this.elements&&(this.elements.length=0,this.elements=null)}},i.prototype={compoName:"+each",refresh:l.refresh,dispose:l.dispose,_getModel:function(e){return e.model},_build:function(e,t,r,o){var i=document.createDocumentFragment();return n(e.nodes,t,r,i,o),i}}}()}()}()}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask}),function(e,t){"use strict";null==e&&(e="undefined"!=typeof window&&"undefined"!=typeof document?window:global),e.ruta=t(e)}(this,function(e){"use strict";function t(){return null==v&&(v=new _(b)),v}var n,r=e.mask||Mask,o=!0,i=Array.prototype.slice;!function(){n=function(){var e=i.call(arguments);console.error.apply(console,["Ruta"].concat(e))}}();var l,u,s,a;!function(){function e(e){for(var t,n,r=e.trim().split(/\s+/),o=r.length,i=-1;++i<o;)if(n=r[i],0!==n.length&&(t=n[0],'"'===t||"'"===t))for(var l=i;o>i;i++)if(n=r[i],n[n.length-1]===t){var u=r.splice(l,i-l+1).join(" ").slice(1,-1);r.splice(l,0,u),o=r.length;break}return r}function t(e){for(var t,n,r,o=e.length,i=0,l={},u=[];o>i;i++)r=e[i],"-"!==r[0]?u.push(r):(t=r.replace(/^[\-]+/,""),o-1>i&&"-"!==e[i+1][0]?(n=e[i+1],i++):n=!0,l[t]=n);return{path:u,query:l}}l=function(e){for(var t=e.length,n=0,r=t-1;t>n&&"/"===e[n];n++);for(;r>n&&"/"===e[r];r--);return e.substring(n,r+1)},u=function(e){return e=l(e),""===e?[]:e.split("/")},s=function(e){return"/"+e.join("/")},a=function(n){"string"==typeof n&&(n=e(n));var r=t(n);return m(r)}}();var c,f;!function(){function e(e,t,n){for(var r,o=t.split("."),i=o.length,l=-1;++l<i-1;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=n}function t(e){try{return decodeURIComponent(e)}catch(t){return n("decode:URI malformed"),""}}function r(e){try{return encodeURIComponent(e)}catch(t){return n("encode:URI malformed"),""}}c=function(n,r){null==r&&(r="&");for(var o,i,l={},u=n.split(r),s=0,a=u.length;a>s;s++)o=u[s].split("="),i=null==o[1]?"":t(o[1]),e(l,o[0],i);return l},f=function(e,t){null==t&&(t="&");var n,o,i="";for(n in e)o=e[n],null!=o&&("boolean"==typeof o&&(o=null),i=i+(i?t:"")+n,null!=o&&(i+="="+r(o)));return i}}();var h,p,d;!function(){h=function(e,t){return new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t)},p=function(e){if("^"===e[0])return new RegExp(e);for(var t=e.split("|"),n=0,r=t.length;r>n;n++)t[n]="^"+t[n]+"$";return new RegExp(t.join("|"))},d=function(e){var t=e.indexOf("("),r=e.lastIndexOf(")");if(-1===t||-1===r)return n("Expected alias part with regexp",e),null;var o=e.substring(t+1,r);return{alias:e.substring(1,t),matcher:p(o)}}}();var m,g;!function(){m=function(e){var t=s(e.path);return null==e.query?t:t+"?"+f(e.query,"&")},g=function(e){var t=e.indexOf("?"),n=-1===t?e:e.substring(0,t);return{path:u(n),query:-1===t?null:c(e.substring(t+1),"&")}}}();var v,y=function(){function e(e,t){this.method=36===e.charCodeAt(0)?e.substring(1,e.indexOf(" ")).toUpperCase():null,null!=this.method&&(e=e.substring(this.method.length+2)),this.strict=o,this.value=t,this.definition=e,r(this,e)}function t(){this.routes=[]}var r,i;!function(){function e(e,t){for(var n in e)if(t.test(n))return e[n]}r=function(e,t){var r=t.charCodeAt(0);switch(r){case 33:e.strict=!0,t=t.substring(1);break;case 94:e.strict=!1,t=t.substring(1);break;case 40:var o=1,i=t.length-1;return 41!==t.charCodeAt(t.length-1)&&(n("parser - expect group closing"),i++),void(e.match=new RegExp(t.substring(o,i)))}var l,u,s,a,c,f,h=t.split("/"),d=0,m=h.length,g=h[m-1];u=g.indexOf("?"),u>(1===m?-1:0)&&(l=g.substring(u+1),h[m-1]=g.substring(0,u));for(var v,y,_,b=!0,x=e.path=[];m>d;d++)if(s=h[d],""!==s){a=s.charCodeAt(0),f=s.charCodeAt(1),v=63===a,y=58===(v?f:a),c=0,v&&c++,y&&c++,0!==c&&(s=s.substring(c)),v||b||n("Strict part found after optional",t),v&&(b=!1);var w=s.indexOf("(");if(y&&-1!==w){var i=s.length-1;")"!==s[i]&&(i+=1),_=new RegExp(p(s.substring(w+1,i))),s=s.substring(0,w)}v||y?y&&x.push({alias:s,matcher:_,optional:v}):x.push(s)}if(l){var C=e.query={};h=l.split("&"),d=-1,m=h.length;for(var j,N,O,S;++d<m;)O=h[d],S=O.indexOf("="),-1!==S?(j=O.substring(0,S),N=O.substring(S+1),40===N.charCodeAt(0)&&(N=new RegExp(p(N))),C[j]=N):C[O]="";0===e.path.length&&(e.strict=!1)}},i=function(t,n){var r=n.indexOf("?"),o=-1===r?null:n.substring(r+1),i={path:n,params:null==o?{}:c(o,"&")};if(t.query)for(var l in t.query)if("?"===l[0]&&(l=l.substring(1)),":"===l[0]){var s=d(l),a=s.alias;i.params[a]=e(i.params,s.matcher)}if(-1!==r&&(n=n.substring(0,r)),null!=t.path)for(var f,h,p=u(n),m=t.path,g=m.length,v=p.length,y=0;v>y;y++)if(f=p[y],h=g>y?m[y]:null){if("string"==typeof h)continue;if(h.alias){i.params[h.alias]=f;continue}}return i}}();var l,s;!function(){function e(e,t){for(var n in e)if(t.test(n))return!0;return!1}l=function(e,t,n){for(var r,o=g(e),l=0,u=t.length;u>l;l++)if(r=t[l],s(o,r,n))return r.current=i(r,e),r;return null},s=function(t,n,r){if(null!=r&&null!=n.method&&n.method!==r)return!1;if(n.match)return n.match.test("string"==typeof t?t:m(t));if("string"==typeof t&&(t=g(t)),n.query){var o,i,l=t.query;if(null==l)return!1;for(o in n.query){i=n.query[o];var u=o[0];if(":"!==u){if("?"!==u)if("string"!=typeof i){if(i.test&&!i.test(l[o]))return!1}else{if(null==l[o])return!1;if(i&&l[o]!==i)return!1}}else{var s=d(o);if(null==s||e(l,s.matcher)===!1)return!1}}}var a=n.path,c=a.length;if(0===c)return n.strict?0===t.path.length:!0;for(var f,h=0,p=t.path.length;p>h;h++){if(f=a[h],h>=c)return n.strict!==!0;if("string"==typeof f){if(t.path[h]===f)continue;return!1}if(f.matcher&&f.matcher.test(t.path[h])===!1)return!1;if(f.optional)return!0;if(!f.alias)return!1}return c>h?a[h].optional===!0:!0}}();return e.prototype={path:null,query:null,value:null,current:null},t.prototype={add:function(t,n){return this.routes.push(new e(t,n)),this},get:function(e,t){return l(e,this.routes,t)},clear:function(){return this.routes.length=0,this}},t.parse=function(e,t){var n={};return r(n,e),i(n,t)},t}(),_=function(){function e(e){if("undefined"==typeof window||"onhashchange"in window==!1)return null;this.listener=e;var t=this;return window.onhashchange=function(){t.changed(location.hash)},this}function t(e){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var t=this;return t.listener=e,t.initial=location.pathname,window.onpopstate=function(){return t.initial===location.pathname?void(t.initial=null):void t.changed()},t}function r(r,o){if(this.collection=r||new y,o){var i="hash"===o?e:t;this.emitter=new i(this)}null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&(this.emitter=new e(this)),null==this.emitter&&n("Router can not be initialized - (nor HistoryAPI / nor hashchange")}return"undefined"==typeof window?function(){}:(function(){function t(e){return e.replace(/^[!#/]+/,"/")}e.prototype={navigate:function(e){return null==e?void this.changed(location.hash):void(location.hash=e)},changed:function(e){this.listener.changed(t(e))},current:function(){return t(location.hash)}}}(),t.prototype={navigate:function(e){return null==e?void this.changed():(history.pushState({},null,e),this.initial=null,void this.changed())},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}},r.prototype={changed:function(e){var t=this.collection.get(e);t&&this.action(t)},action:function(e){if("function"==typeof e.value){var t=e.current;e.value(e,t&&t.params)}},navigate:function(e){this.emitter.navigate(e)},current:function(){return this.collection.get(this.currentPath())},currentPath:function(){return this.emitter.current()}},r)}(),b=new y,x={Collection:y,setRouterType:function(e){return null==v&&(v=new _(b,e)),this},setStrictBehaviour:function(e){return o=e,this},add:function(e,n){return t(),b.add(e,n),this},get:function(e){return b.get(e)},navigate:function(e){return t().navigate(e),this},current:function(){return t().current()},currentPath:function(){return t().currentPath()},notifyCurrent:function(){return t().navigate(),this},parse:y.parse,$utils:{pathFromCLI:a,query:{serialize:f,deserialize:c}}};return function(){function e(e){e.preventDefault(),e.stopPropagation(),x.navigate(this.href)}r.registerAttrHandler("x-dynamic",function(t,n,r,o,i){i.onclick=e},"client")}(),x}),function(e){"use strict";function t(e,t){if("object"!=typeof e||null==t)return e;for(var n,r=e,o=t.split("."),i=o.length,l=0;i>l;l++)if(n=o[l],r=r[n],null==r)return r;return r}function n(e,t){for(var n in t)t[n]&&(e[n]=t[n]);return e}function r(e,n,r,o){if("function"==typeof n)return n(e)?e:null;if("undefined"==typeof r)return e==n?e:null;var i=null!=n?t(e,n):e,l=r,u=o;switch(l){case">":return i>u?e:null;case"<":return u>i?e:null;case">=":return i>=u?e:null;case"<=":return u>=i?e:null;case"!=":return i!=u?e:null;case"==":return i==u?e:null}return console.error("InvalidArgumentException: arr.js:check",arguments),null}function o(e){this.items=e}function i(e){o.prototype[e]=function(){var t=arguments.length,n=u[e](this.items,t>0?arguments[0]:null,t>1?arguments[1]:null,t>2?arguments[2]:null,t>3?arguments[3]:null);return n instanceof Array?(this.items=n,this):n}}var l=e.ruqq||(e.ruqq={}),u={where:function(e,t,n,o){var i=[];if(null==e)return i;for(var l,u=0,s=e.length;s>u;u++)l=e[u],null!=r(l,t,n,o)&&i.push(l);return i},each:"undefined"!=typeof Array.prototype.forEach?function(e,t){return null==e?e:(e.forEach(t),e)}:function(e,t){if(null==e)return e;for(var n=0,r=e.length;r>n;n++)t(e[n]);return e},remove:function(e,t,n,o){for(var i=0,l=e.length;l>i;i++)null!=r(e[i],t,n,o)&&(e.splice(i,1),i--,l--);return e},invoke:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift(),r=[],o=0;o<t.length;o++)r.push("function"==typeof t[o][n]?t[o][n].apply(t[o],e):null);return r},last:function(e,t,n,o){if(null==e)return null;if(null==t)return e[e.length-1];for(var i=e.length;i>-1;--i)if(null!=r(e[i],t,n,o))return e[i];return null},first:function(e,t,n,o){if(null==t)return e[0];for(var i=0,l=e.length;l>i;i++)if(null!=r(e[i],t,n,o))return e[i];return null},any:function(e,t,n,o){for(var i=0,l=e.length;l>i;i++)if(null!=r(e[i],t,n,o))return!0;return!1},isIn:function(e,t){for(var n=0;n<e.length;n++)if(t==e[n])return!0;return!1},map:"undefined"!=typeof Array.prototype.map?function(e,t){return null==e?[]:e.map(t)}:function(e,t){var n=[];if(null==e)return n;for(var r=0,o=e.length;o>r;r++)n.push(t(e[r],r));return n},aggr:function(e,t,n){for(var r=0,o=e.length;o>r;r++){var i=n(e[r],t,r);null!=i&&(t=i)}return t},select:function(e,t){if(null==e)return[];for(var n,r=[],o=0,i=e.length;i>o;o++)if(n=e[o],"string"==typeof t)r.push(n[t]);else if("function"==typeof t)r.push(t(n));else if(t instanceof Array){for(var l={},u=0;u<t.length;u++)l[t[u]]=e[o][t[u]];r.push(l)}return r},indexOf:function(e,t,n,o){for(var i=0,l=e.length;l>i;i++)if(null!=r(e[i],t,n,o))return i;return-1},count:function(e,t,n,o){for(var i=0,l=0,u=e.length;u>l;l++)null!=r(e[l],t,n,o)&&i++;return i},distinct:function(e,t){var n=[];if(null==e)return n;for(var r=0,o=e.length;o>r;r++){for(var i=!0,l=0;l<n.length;l++)if(t&&t(e[r],n[l])||null==t&&e[r]==n[l]){i=!1;break}i&&n.push(e[r])}return n},groupBy:function(e,t){for(var n,r,o,i=[],l=e.length,u=-1,s={};++u<l;)if(s[u]!==!0){for(o=e[u],n=[o],r=u;++r<l;)s[r]!==!0&&t(o,e[r])&&(s[r]=!0,n.push(e[r]));i.push(n)}return i}};u.each(["min","max"],function(e){u[e]=function(n,r){if(null==n)return null;for(var o=null,i=0,l=n.length;l>i;i++){var u=t(n[i],r);null!=o?"max"===e&&u>o?o=u:"min"===e&&o>u&&(o=u):o=u}return o}}),l.arr=function(e){return new o(e)},n(l.arr,u);for(var s in u)i(s)}("undefined"!=typeof window?window:global),function(e,t){"use strict";null==e&&(e="undefined"!=typeof window&&"undefined"!=typeof document?window:global),null==e.net&&(e.net={}),e.net.Uri=t(e)}(this,function(){"use strict";function e(e){return e&&"object"==typeof e&&"function"==typeof e.combine}function t(){for(var e,t="",n=0,r=arguments.length;r>n;n++)e=arguments[n],e&&(t?("/"!==t[t.length-1]&&(t+="/"),t+="/"===e[0]?e.substring(1):e):t=e);return t}function n(e){return"/"===e[e.length-1]?e.substring(0,e.length-1):e}function r(e){var t,n=new d;for(t in e)"string"==typeof e[t]&&(n[t]=e[t]);return n}function o(e){return e.replace(/\\/g,"/").replace(/^\.\//,"").replace(/^(\w+):\/([^\/])/,"/$1:/$2")}function i(e){return p.test(e)&&"/"===e[0]?e.substring(1):e}function l(e){var t=c.exec(e.value);null==t&&"/"===e.value[0]&&(e.protocol="file"),null!=t&&(e.protocol=t[1],e.value=e.value.substring(t[0].length))}function u(e){if(null!=e.protocol){if("file"===e.protocol){var t=p.exec(e.value);return void(t&&(e.host=t[1],e.value=e.value.substring(e.host.length)))}var n=e.value.indexOf("/",2);e.host=~n?e.value.substring(0,n):e.value,e.value=e.value.replace(e.host,"")}}function s(e){var t=e.value.indexOf("?");-1!==t&&(e.search=e.value.substring(t),e.value=e.value.substring(0,t))}function a(e){var t=f.exec(e.value),r=null==t?null:t[1];null!=r&&(e.file=r,e.value=e.value.substring(0,e.value.length-r.length),e.value=n(e.value),t=h.exec(r),e.extension=null==t?null:t[1])}var c=/^([a-zA-Z]+):\/\//,f=/([^\/]+(\.[\w\d]+)?)$/i,h=/\.([\w\d]+)$/i,p=/(^\/?\w{1}:)(\/|$)/,d=function(t){return null==t?this:e(t)?t.combine(""):(t=o(t),this.value=t,l(this),u(this),s(this),a(this),this.path=n(this.value),/^[\w]+:\//.test(this.path)&&(this.path="/"+this.path),this)};return d.prototype={cdUp:function(){return this.path?"/"===this.path?this:/^\/?[a-zA-Z]+:\/?$/.test(this.path)?this:(this.path=this.path.replace(/\/?[^\/]+\/?$/i,""),this):this},combine:function(o){if(e(o)&&(o=o.toString()),!o)return r(this);if(p.test(o))return new d(o);var i=r(this);if(i.value=o,s(i),a(i),!i.value)return i;if(o=i.value.replace(/^\.\//i,""),"/"===o[0])return i.path=o,i;for(;/^(\.\.\/?)/gi.test(o);)i.cdUp(),o=o.substring(3);return i.path=n(t(i.path,o)),i},toString:function(){var e=this.protocol?this.protocol+"://":"";return e+=t(this.host,this.path,this.file)+(this.search||""),this.file||this.search||(e+="/"),e},toPathAndQuery:function(){return t(this.path,this.file)+(this.search||"")},toRelativeString:function(e){if("string"==typeof e&&(e=new d(e)),0===this.path.indexOf(e.path)){var n=this.path?this.path.replace(e.path,""):"";return"/"===n[0]&&(n=n.substring(1)),t(n,this.file)+(this.search||"")}for(var r=this.path.split("/"),o=e.path.split("/"),i="",l=0,u=Math.min(r.length,o.length);u>l&&r[l]===o[l];l++);if(l>0&&(i=r.splice(0,l).join("/")),i){for(var s,a="",c=e.path;c;){if(0==this.path.indexOf(c)){s=this.path.replace(c,"");break}c=c.replace(/\/?[^\/]+\/?$/i,""),a+="../"}return t(a,s,this.file)}return this.toString()},toLocalFile:function(){var e=t(this.host,this.path,this.file);return i(e)},toLocalDir:function(){var e=t(this.host,this.path,"/");return i(e)},toDir:function(){var e=this.protocol?this.protocol+"://":"";return e+t(this.host,this.path,"/")},isRelative:function(){return!(this.protocol||this.host)},getName:function(){return this.file.replace("."+this.extension,"")}},d.combinePathes=t,d.combine=t,d}),function(){var e={};String.format=function(t){if(~t.indexOf("#{")){for(var n="",r=0,o=arguments[1];;){var i=t.indexOf("#{",r);if(-1==i)break;n+=t.substring(r,i);var l=t.indexOf("}",i);n+=Object.getProperty(o,t.substring(i+2,l)),r=++l}return n+=t.substring(r)}for(var u=1;u<arguments.length;u++){var s=e[u]||(e[u]=new RegExp("%"+u,"g"));t=t.replace(s,arguments[u])}return t},Object.defaults=function(e,t){for(var n in t)null==e[n]&&(e[n]=t[n]);return e},Object.clear=function(e,t){if(t instanceof Array)for(var n,r=0,o=t.length;o>r;r++)n=t[r],n in e&&delete e[n];else if("object"==typeof t)for(var i in t)i in e&&delete e[i];return e},Object.extend=function(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)null!=t[n]&&(e[n]=t[n]);return e},Object.getProperty=function(e,t){if("."===t)return e;for(var n=e,r="string"==typeof t?t.split("."):t,o=-1,i=r.length;null!=n&&++o<i;)n=n[r[o]];return n},Object.setProperty=function(e,t,n){for(var r=t.split("."),o=e,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}o[i]=n},Object.lazyProperty=function(e,t,n){if("object"!=typeof t){for(var r=t.split("."),o=e,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}r=null,o.__defineGetter__(i,function(){return delete o[i],o[i]=n(),n=null,o[i]})}else for(var u in t)Object.lazyProperty(e,u,t[u])},Object.clone=function(e){if(null==e)return null;switch(typeof e){case"number":case"string":case"function":return e}if(e instanceof Array){for(var t=[],n=0,r=e.length;r>n;n++)t[n]=Object.clone(e[n]);return t}var o=e.constructor;if("function"==typeof o&&(o===String||o===Number||o===RegExp||o===Date))return new o(e);var i={};for(var l in e)i[l]=Object.clone(e[l]);return i},Object.observe=function(e,t,n){if(null==e.__observers&&Object.defineProperty(e,"__observers",{value:{},enumerable:!1}),e.__observers[t])return void e.__observers[t].push(n);(e.__observers[t]||(e.__observers[t]=[])).push(n);var r=t.split("."),o=e,i=t;r.length>1&&(i=r.pop(),o=Object.getProperty(e,r));var l=o[i];Object.defineProperty(o,i,{get:function(){return l},set:function(n){l=n;for(var r=e.__observers[t],o=0,i=r.length;i>o;o++)r[o](n)}})},Date.format=function(e,t){function n(e){return e>9?e:"0"+e}t||(t="MM/dd/yyyy"),t=t.replace("MM",n(e.getMonth()+1));var r=e.getFullYear();return t.indexOf("yyyy")>-1?t=t.replace("yyyy",r):t.indexOf("yy")>-1&&(t=t.replace("yy",r.toString().substr(2,2))),t=t.replace("dd",n(e.getDate())),t.indexOf("HH")>-1&&(t=t.replace("HH",n(e.getHours()))),t.indexOf("mm")>-1&&(t=t.replace("mm",n(e.getMinutes()))),t.indexOf("ss")>-1&&(t=t.replace("ss",n(e.getSeconds()))),t},RegExp.fromString=function(e,t){return new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t)},Function.invoke=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();return function(){return t[n].apply(t,e)}}}(),function(e){function t(){}function n(){}function r(e,t,n){if(e instanceof Array){for(var o,i=[],l=0,u=e.length;u>l;l++)o=r(e[l],t,n),e[l].tagName===s&&u-1>l&&e[l+1].tagName===a&&(l+=1,null==o&&(o=r(e[l].nodes,t,n))),null!=o&&(o instanceof Array?i=i.concat(o):i.push(o));return i}if(null!=e.content)return{content:e.content,type:e.type};if(e.tagName===s){var c=e.attr.id?t[e.attr.id]:n;return c?null==e.nodes?c:r(e.nodes,t,c):null}var f={tagName:e.tagName||e.compoName,attr:e.attr,type:e.type,controller:e.controller};return e.nodes&&(f.nodes=r(e.nodes,t,n)),f}function o(e,t){if(null==t&&(t={}),e instanceof Array){for(var n=e,r=0,l=n.length;l>r;r++)o(n[r],t);return t}var s=e.tagName;if(null!=s&&s===u){var a=e.attr.id;!a&&console.error("@content has no id specified",e),t[a]&&console.error("@content already exists",a),t[a]=i(e)}return null!=e.nodes&&o(e.nodes,t),t}function i(e){for(var t,n=e.parent;null!=n&&n.tagName!==c;){var r={type:n.type,tagName:n.tagName,attr:n.attr,controller:n.controller,nodes:null};null==t?(t=r,t.nodes=e.nodes):t.nodes=[r],n=n.parent}return null!=t?t:e.nodes}var l=e.mask||Mask,u="@content",s="@placeholder",a="@else",c="layout:view",f="layout:master",h={};t.prototype={constructor:t,render:function(){h[this.attr.id]=this}},l.registerHandler(f,t),n.prototype={constructor:n,renderStart:function(){var e=h[this.attr.master];return null==e?void console.error("Master Layout is not defined for",this):(null==this.contents&&(this.contents=o(this.nodes),Object.keys&&0===Object.keys(this.contents).length&&console.warn("no contents: @content #someID")),void(this.nodes=r(e,this.contents).nodes))}},l.registerHandler(c,n)}(this),obj_extend(globals,this)}).call({},"undefined"!=typeof global?global:window);