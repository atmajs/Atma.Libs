(function(globals){function __eval(t,e){"use strict";e&&e.route.params;return eval.call(window,t)}/*!
 * ClassJS v%VERSION%
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, %YEAR% Atma.js and other contributors
 */
!function(t,e){"use strict";function n(){return e(o,r)}var r,o="undefined"==typeof window||null==window.navigator?global:window;return r=t||o,"function"==typeof define&&define.amd?define(n):(n(),void("undefined"!=typeof module&&(module.exports=r.Class)))}(this,function(t,e){"use strict";var n,r,o,i,l,u,s,a,c,f=Array.prototype.slice,h=Array.prototype.sort,p={ModelHost:null},d="__$class__";!function(){n=function(t){return"function"==typeof t},r=function(t){return null!=t&&"object"==typeof t},u=function(t){return null!=t&&"Date"===t.constructor.name&&t instanceof Date},o=function(t){return null!=t&&"number"==typeof t.length&&"function"==typeof t.slice},i=o,l=function(t){return"string"==typeof t},s=function(t){return"string"==typeof t&&""!==t},a=function(t){return null==t?!1:"object"!=typeof t?!1:t.constructor===Object},c=function(e){return void 0===e||e===t}}();var g,v,m;!function(){g=function(t,e){if(v(t))for(var n=0,r=t.length;r>n;n++)e(t[n],n);else e(t)},v=function(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice},m=function(t,e){for(var n=t.length,r=-1;++r<n;)e(t[r])===!0&&(t.splice(r,1),r--,n--)},"function"!=typeof Array.isArray&&(Array.isArray=function(t){return t instanceof Array?!0:null==t||"object"!=typeof t?!1:void 0!==t.length&&"function"==typeof t.slice})}();var _,y,b,x,w,C;!function(){function e(t,e){if(null==e||"object"!=typeof e)return e;var n=this,o=n[t];return o[d]&&o.toJSON?r(o[d],e):e}function r(t,e){var n={};return n.json=e,n[d]=t,n}function o(t,e){var n;return null!=e&&"object"==typeof e&&e[d]&&(n=Y(e[d]),"function"==typeof n?e=new n(e.json):console.error("<class:parse> Class was not registered",e[d])),e}function i(e,n){"function"==typeof e&&(e=e.prototype),null==n&&(n={});var r,o,l;for(o in e)if(l=e[o],r=null==l?null:typeof l,"function"!==r){var u=o.charCodeAt(0);if(!(95===u&&"_id"!==o||u>=65&&90>=u))if("object"!==r)n[o]=r;else{var s=l.constructor,a=s&&s.name;if("Object"!==a&&a&&t[a]===s){n[o]=a;continue}n[o]=i(l)}}return e.__proto__&&i(e.__proto__,n),n}_=function(t,e){D(p.ModelHost||Y.Model,t,e)},y=function(t){return T(p.ModelHost||Y.Model,t)},b=function(t,e){var r=l(t)?y(t):t;return!n(r)&&console.error("<class:patch> Not a Function",t),e.Base=r,r=Y(e),l(t)&&_(t,r),r},x=function(t){return JSON.stringify(t,e)},w=function(t){return JSON.parse(t,o)},C=function(t){return i(t)}}();var k,j,N;!function(){function t(t,e){return function(n){var r=s(n),o=r[e];a(o)&&M(t,o)}}function e(t,e){if(null!=e){"function"==typeof t&&(t=t.prototype),"function"==typeof e&&(e=e.prototype);var n,r;for(n in e)"constructor"!==n&&(r=e[n],null!=r&&(t[n]=r))}}function o(t,e){var n;return n=t?function(e){var n=1===arguments.length&&h(e)?e:arguments;return U(t,this,n)}:B,function(){return this["super"]=n,U(e,this,arguments)}}function l(t,n,r,i,l,u){var s=i,a=i;s.constructor=t.prototype.constructor,null!=r&&(a[c]={},g(r,function(t){e(a[c],t)}),a=a[c]),null!=n&&(a[c]=n.prototype);for(var f in u)null==s[f]&&(s[f]=u[f]);for(var f in l)s[f]=o(s[f],l[f]);t.prototype=s}function u(t,n,r,i,l,u){if(null!=n){var s=function(){};s.prototype=n.prototype,t.prototype=new s,t.prototype.constructor=t}null!=r&&g(r,function(n){delete n.constructor,e(t,n)});var a=t.prototype;M(a,u);for(var c in l)a[c]=o(a[c],l[c]);e(t,i)}function s(t){return n(t)?t.prototype:t}var c="__proto__",f=Object.prototype.toString,h=function(t){return"[object Arguments]"===f.call(t)};k=c in Object.prototype?l:u,j=function(t,e){if(null!=e)if(i(e))for(var o=e.length;--o>-1;)j(t,e[o]);else{var l;n(e)?l=e:r(e.Static)&&(l=e.Static),null!=l&&P(t,l)}},N=function(e,n,r){var o,i;for(o in e)i=e[o],a(i)&&(null!=n&&a(n.prototype[o])&&M(i,n.prototype[o]),null!=r&&g(r,t(i,o)))}}();var O,S,E="__$serialization";!function(){O=function(t){var e,n,r,o=this,i={};null==t&&(t=o[E]);var l;for(e in o)if(l=e,null!=t&&t.hasOwnProperty(e)&&(r=t[e],null!=r&&"object"==typeof r&&(r.key&&(l=r.key),r.hasOwnProperty("serialize")))){if(null==r.serialize)continue;i[l]=r.serialize(o[e])}else if(95!==e.charCodeAt(0)&&"Static"!==e&&"Validate"!==e&&(n=o[e],null!=n))if("_id"!==e){switch(typeof n){case"function":continue;case"object":if(u(n))break;var s=n.toJSON;if(null==s)break;i[l]=n.toJSON();continue}i[l]=n}else i[l]=n;return null!=o._id&&(i._id=o._id),i},S=function(){for(var t,e=this,n=e.length,r=0,o=new Array(n);n>r;r++){if(t=e[r],null!=t&&"object"==typeof t){var i=t.toJSON;if(i===O||i===S){o[r]=t.toJSON();continue}if(null==i){o[r]=O.call(t);continue}}o[r]=t}return o}}();var A,T,D,M,R,L,P,I;!function(){A=function(t){n(t)&&(t=t.prototype);for(var e,r,o=1,i=arguments.length;i>o;o++){e=n(arguments[o])?arguments[o].prototype:arguments[o];for(r in e)if("Static"!==r||null==t.Static)t[r]=e[r];else for(r in e.Static)t.Static[r]=e.Static[r]}return t},T=function(t,e){for(var n=e.split("."),r=n.length,o=-1;++o<r;){if(null==t)return null;t=t[n[o]]}return t},D=function(t,e,n){for(var r,o=e.split("."),i=o.length,l=-1;++l<i-1;)r=o[l],null==t[r]&&(t[r]={}),t=t[r];t[o[l]]=n},M=function(t,e){for(var n in e)null==t[n]&&(t[n]=e[n]);return t},R=function(t,e){if(null==t&&(t={}),null==e)return t;var n,r;for(r in e)n=e[r],null!=n&&(t[r]=n);return t},function(){function t(t,r,o){if(null==t)return{};if(null==r)return r;var i,l;for(l in r)(o!==!0||null==t[l])&&(i=e(r,l),null!=i?void 0===i.value?n(t,l,i):t[l]=i.value:L(t,r.__proto__));return t}var e=Object.getOwnPropertyDescriptor,n=Object.defineProperty;return null==e?(L=R,void(P=M)):(L=function(e,n){return t(e,n,!1)},void(P=function(e,n){return t(e,n,!0)}))}(),function(){function t(t,n,i){var l,a,c,f;for(a in n)if(null==s||t!==i||s.hasOwnProperty(a)!==!1){switch(a.charCodeAt(0)){case 63:
//! accept falsy value
if(f=a.substring(1),c=t[f],!c)continue;if(l=e(c,n[a],i),null!=l)return l.setInvalidProperty(f),l;continue;case 45:if(f=a.substring(1),"object"==typeof t&&f in t)return o(f);continue}if(c=t[a],null==c)return r(a);if(l=e(c,n[a],i),null!=l)return l.setInvalidProperty(a),l}if(u)for(a in t)if(!(a in n||"?"+a in n))return o(a)}function e(e,o,u){if(null==o)return null;if("function"==typeof o){var s=o.call(u,e);return null==s||s===!0?null:s===!1?l():i(s)}if(null==e)return r();if("string"==typeof o){var a="string",c="number",f="boolean";switch(o){case a:return typeof e!==a||0===e.length?n(a):null;case c:return typeof e!==c?n(c):null;case f:return typeof e!==f?n(f):null}}if(o instanceof RegExp)return o.test(e)===!1?l():null;if(Array.isArray(o)){if(Array.isArray(e)===!1)return n("array");for(var s,h=-1,p=e.length;++h<p;)if(s=t(e[h],o[0]))return s.setInvalidProperty(h),s;return null}return typeof e!=typeof o?n(typeof e):"object"==typeof e?t(e,o):null}I=function(e){if(null==e)return l("object");s=null,u=!1;for(var n,r,o=arguments.length;--o>0;)switch(r=arguments[o],typeof r){case"string":null==s&&(s={}),s[r]=1;continue;case"boolean":u=r;continue;case"undefined":continue;default:if(1!==o)return l("validation argument at "+o);n=r;continue}return null==n&&(n=e.Validate),null==n?null:t(e,n,e)};var n,r,o,i,l,u=!1,s=null;!function(){function t(t,n,r){return r.type=t,r.property=null,r.setInvalidProperty=e,n.prototype=r,function(t){return new n(t)}}function e(t){return null==this.property?void(this.property=t):void(this.property=t+"."+this.property)}n=t("type",function(t){this.expect=t},{toString:function(){return"Invalid type."+(this.expect?" Expect: "+this.expect:"")+(this.property?" Property: "+this.property:"")}}),r=t("expect",function(t){this.property=t},{toString:function(){return"Property expected."+(this.property?"`"+this.property+"`":"")}}),o=t("unexpect",function(t){this.property=t},{toString:function(){return"Unexpected property"+(this.property?"`"+this.property+"`":"")}}),i=t("custom",function(t){this.error=t},{toString:function(){return"Custom validation: "+this.error+(this.property?" Property: "+this.property:"")}}),l=t("invalid",function(t){this.expect=t},{toString:function(){return"Invalid."+(this.expect?" Expect: "+this.expect:"")+(this.property?" Property: "+this.property:"")}})}()}()}();var F,H;!function(){function t(t,e,n){for(var r in e)n(T(t,r),e[r],r)}function e(t,e,n){for(var r in e)D(t,r,n(T(t,r),e[r],r))}function n(){var t=arguments;return function(e,n,r){for(var o,i=0,l=t.length;l>i;i++)if(o=t[i],o(e,n,r)===!1)return}}function r(t,e,n){return v(t)===!1?(console.warn("<patch> property is not an array",n),!1):void 0}function o(t,e,n){if(e.hasOwnProperty("$each"))for(var r=0,o=e.$each.length;o>r;r++)t.push(e.$each[r]);else t.push(e)}function i(t,e,n){t[e>0?"pop":"shift"]()}function l(t,e,n){m(t,function(t){return c(t,e)})}function u(t,e,n){return t+e}function s(t,e,n){return e}function a(){return void 0}F=function(t,e){for(var n in e){var r=p[n];r?r[f](t,e[n],r[h]):console.error("Unknown or not implemented patcher",n)}return t},H=function(t){if(null==t)return"Undefined";var e=!1;for(var n in t)if(e=!0,null==p[n])return"Unsupported patcher: "+n;return e===!1?"No data":null};var c;!function(){c=function(t,e){for(var n in e)if(t[n]!==e[n])return!1;return!0}}();var f=0,h=1,p={$push:[t,n(r,o)],$pop:[t,n(r,i)],$pull:[t,n(r,l)],$inc:[e,u],$set:[e,s],$unset:[e,a],$bit:[e,a]}}();var $,U,z,B,q;!function(){function t(t,e){if(t.length!==e.length)return!1;for(var n=t.length,r=0;n>r;r++)if(t[r]!==e[r])return!1;return!0}$=function(t,e){return function(){return U(t,e,arguments)}},U=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);case 4:return t.call(e,n[0],n[1],n[2],n[3]);case 5:return t.call(e,n[0],n[1],n[2],n[3],n[4])}return t.apply(e,n)},z=function(t){var e=f.call(arguments,1);return function(){return arguments.length>0&&(e=e.concat(f.call(arguments))),U(t,null,e)}},B=function(){},q=function(e,n){if(0===e.length)return 0;for(var r=n.length,o=-1;++o<r;)if(t(n[o],e))return o+1;return n.push(e),n.length}}();var V={};(function(){!function(t){function e(){this._callbacks=[]}function n(t){function n(t){return function(){i+=1,o[t]=Array.prototype.slice.call(arguments),i===l&&r.done(o)}}var r=new e,o=[];if(!t||!t.length)return r.done(o),r;for(var i=0,l=t.length,u=0;l>u;u++)t[u].then(n(u));return r}function r(t,n){var o=new e;return 0===t.length?o.done.apply(o,n):t[0].apply(null,n).then(function(){t.splice(0,1),r(t,arguments).then(function(){o.done.apply(o,arguments)})}),o}function o(t){var e="";if("string"==typeof t)e=t;else{var n=encodeURIComponent;for(var r in t)t.hasOwnProperty(r)&&(e+="&"+n(r)+"="+n(t[r]))}return e}function i(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t}function l(t,n,r,l){function u(){d.abort(),g.done(f,"",d)}var d,g=new e,v=l&&l["Content-Type"]||p.contentType;try{d=i()}catch(m){return g.done(c,""),g}if(r)if("GET"===t)n+="?"+o(r),r=null;else switch(v){case s:r=o(r);break;case a:try{r=JSON.stringify(r)}catch(_){return g.done(h,""),g}break;default:r=o(r)}d.open(t,n),r&&d.setRequestHeader("Content-Type",v);for(var y in l)l.hasOwnProperty(y)&&d.setRequestHeader(y,l[y]);var b=p.ajaxTimeout;if(b)var x=setTimeout(u,b);return d.onreadystatechange=function(){if(b&&clearTimeout(x),4===d.readyState){var t=!d.status||(d.status<200||d.status>=300)&&304!==d.status;g.done(t,d.responseText,d)}},d.send(r),g}function u(t){return function(e,n,r){return l(t,e,n,r)}}var s="application/x-www-form-urlencoded",a="application/json",c=1,f=2,h=3;e.prototype.then=function(t,n){var r;return this._isdone?r=t.apply(n,this.result):(r=new e,this._callbacks.push(function(){var e=t.apply(n,arguments);e&&"function"==typeof e.then&&e.then(r.done,r)})),r},e.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var t=0;t<this._callbacks.length;t++)this._callbacks[t].apply(null,arguments);this._callbacks=[]};var p={Promise:e,join:n,chain:r,ajax:l,get:u("GET"),post:u("POST"),put:u("PUT"),del:u("DELETE"),patch:u("PATCH"),ENOXHR:c,ETIMEOUT:f,E_PREPAIR_DATA:h,ajaxTimeout:0,contentType:a};"function"==typeof define&&define.amd?define(function(){return p}):t.promise=p}(this)}).call(V),g(["get"],function(t){V[t]=function(e,n){this.promise[t](e).then(function(t,e,r){return t?void n.onError(t,e,r):void n.onSuccess(e)})}}),g(["del","post","put","patch"],function(t){V[t]=function(e,n,r){this.promise[t](e,n).then(function(t,e,n){r(t,e,n)})}});var J;!function(){J=function(e){if(this===Y||null==this||this===t){var n=function(t){this[E]=R(this[E],e),J.call(this,t)};return n}null!=e&&(this.deserialize?this.deserialize(e):J.deserialize(this,e))},J.serialize=function(t){return n(t.toJSON)?t.toJSON():O.call(t,t[E])},J.deserialize=function(t,e){if(l(e))try{e=JSON.parse(e)}catch(i){return console.error("<json:deserialize>",e),t}if(o(e)&&n(t.push)){t.length=0;for(var u=0,s=e.length;s>u;u++)t.push(e[u]);return t}var a,c,f,h,p,d=t[E];if(null!=d){var g="__desAsKeys";if(a=d[g],null==a){a=d[g]={};for(f in d)"__desAsKeys"!==f&&d[f].hasOwnProperty("key")===!0&&(a[d[f].key]=f)}}for(f in e)h=e[f],c=f,null!=d&&(p=d.hasOwnProperty(f)?d[f]:null,a[f]&&(c=a[f]),null!=p&&(r(p)&&(p=p.deserialize),l(p)&&(p=y(p)),n(p)))?t[c]=h instanceof p?h:new p(h):t[c]=h;return t}}();var X,W=function(){function t(t){this.route=r(t)}function e(t){var e=i.exec(t);return e?{optional:"?"===(e[2]||e[3]),parts:[e[1],e[4]]}:(e=l.exec(t))?{optional:"?"===e[3],parts:[e[1],e[4],e[5]]}:(console.error("Paths breadcrumbs should be matched by regexps"),{parts:[t]})}function n(t,n){for(var r=t.split(n),o=0,i=r.length;i>o;o++)r[o]=e(r[o]);return r}function r(t){var e=/[^\:\{]\?[^:]/.exec(t),r=null;return e&&(e=e.index+1,r=t.substring(e+1),t=t.substring(0,e)),{path:n(t,"/"),query:null==r?null:n(r,"&")}}function o(t,e,n){for(var r,o,i,l=[],u=0,s=t.length;s>u;u++)if(i=t[u],o=i.parts.slice(0),null!=o[1]){if(r=o[1],o[1]=e[r],null!=o[1])l.push(o.join(""));else if(!i.optional)return console.error("Object has no value, for not optional part - ",r),null}else l.push(o[0]);return l.join(n)}t.prototype={constructor:t,create:function(t){var e,n;return e=o(this.route.path,t,"/"),null==e?null:this.route.query&&(n=o(this.route.query,t,"&"),null==n)?null:e+(n?"?"+n:"")},hasAliases:function(t){for(var e,n=0,r=this.route.path.length;r>n;n++)if(e=this.route.path[n].parts[1],e&&null==t[e])return!1;return!0}};var i=/^([^:\?]*)(\??):(\??)([\w]+)$/,l=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return t}();!function(){function t(t,e,n,r){return null==r?t:(null!=e?U(r,t,e):n.push(r),t)}function e(t){t._done=null,t._fail=null,t._always=null}function n(t,e,n){if(null!=t){for(var r,o=t.length,i=-1;++i<o;)r=t[i],r&&U(r,e,n);t.length=0}}function r(t){return null==t||"object"!=typeof t?!1:t instanceof X?!0:"function"==typeof t.done&&"function"==typeof t.fail}X=function(){},X.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,defer:function(){this._rejected=null,this._resolved=null},isResolved:function(){return null!=this._resolved},isRejected:function(){return null!=this._rejected},isBusy:function(){return null==this._resolved&&null==this._rejected},resolve:function(){var t=this._done,r=this._always;return this._resolved=arguments,e(this),n(t,this,arguments),n(r,this,[this]),this},reject:function(){var t=this._fail,r=this._always;return this._rejected=arguments,e(this),n(t,this,arguments),n(r,this,[this]),this},resolveDelegate:function(){return $(this.resolve,this)},rejectDelegate:function(){return $(this.reject,this)},then:function(t,e){return this.pipe(t,e)},done:function(e){return null!=this._rejected?this:t(this,this._resolved,this._done||(this._done=[]),e)},fail:function(e){return null!=this._resolved?this:t(this,this._rejected,this._fail||(this._fail=[]),e)},always:function(e){return t(this,this._rejected||this._resolved,this._always||(this._always=[]),e)},pipe:function(t){function e(t,e,n){return function(){if(null!=n){var o=n.apply(this,arguments);if(null!=o)return r(o)===!0?void o.pipe(t):void t[e](o)}t[e].apply(t,arguments)}}var n;if("function"==typeof t){n=new X;var o=t,i=arguments.length>1?arguments[1]:null;return this.done(e(n,"resolve",o)).fail(e(n,"reject",i)),n}n=t;for(var l,u=arguments.length,s=1===u,a=1===u,c=0;++c<u;)switch(l=arguments[c]){case"done":s=!0;break;case"fail":a=!0;break;default:console.error("Unsupported pipe channel",arguments[c])}return s&&this.done(n.resolveDelegate()),a&&this.fail(n.rejectDelegate()),this},pipeCallback:function(){var t=this;return function(e){if(null!=e)return void t.reject(e);var n=f.call(arguments,1);U(t.resolve,t,n)}}},X.run=function(t,e){var n=new X;return null==e&&(e=n),t.call(e,n.resolveDelegate(),n.rejectDelegate(),n),n},X.create=function(t){return function(){var e=f.call(arguments),n=new X;return e.unshift(n),U(t,this,e),n}},X.memoize=function(t){var e={},n=[];return function(){var r=f.call(arguments),o=q(n,r);if(null!=e[o])return e[o];var i=e[o]=new X;return r.unshift(i),U(t,this,r),i}}}();var K;!function(){function t(){var t,e,n=f.call(arguments),r=n.shift(),o=this._listeners[r],i=0;if(null==o)return this;for(e=o.length;e>i;i++)t=o[i],U(t,this,n),t._once===!0&&(o.splice(i,1),i--,e--);return this}K=function(){this._listeners={}},K.prototype={constructor:K,on:function(t,e){return null!=e&&(this._listeners[t]||(this._listeners[t]=[])).push(e),this},once:function(t,e){return null!=e&&(e._once=!0,(this._listeners[t]||(this._listeners[t]=[])).push(e)),this},pipe:function(t){var e,n=this;return function(){e=f.call(arguments),e.unshift(t),U(n.trigger,n,e)}},emit:t,trigger:t,off:function(t,e){var n=this._listeners[t];if(null==n)return this;if(1===arguments.length)return n.length=0,this;for(var r=n.length,o=-1;++o<r;)n[o]===e&&(n.splice(o,1),o--,r--);return this}}}();var G,Y=function(t){var e,n;if(l(t)){if(e=t,1===arguments.length)return y(t);n=arguments[1],n[d]=e}else n=t;var r=n.Base,i=n.Extends,u=n.Static,s=n.Construct,a=null,f=n.Store,h=n.Self,p=n.Override;return null!=r&&delete n.Base,null!=i&&delete n.Extends,null!=u&&delete n.Static,null!=h&&delete n.Self,null!=s&&delete n.Construct,null!=f&&(null==i?i=f:o(i)?i.unshift(f):i=[f,i],delete n.Store),null!=p&&delete n.Override,null==r&&null==i&&null==h?(void 0===n.toJSON&&(n.toJSON=O),a=null==s?function(){}:s,n.constructor=a.prototype.constructor,null!=u&&L(a,u),a.prototype=n,null!=e&&_(e,a),a):(a=function(){if(null!=i)for(var t=i instanceof Array,e=t?i.length:1,n=0,o=null;e>n;n++)o=t?i[n]:i,"function"==typeof o&&U(o,this,arguments);if(null!=r&&U(r,this,arguments),null!=h&&c(this)===!1)for(var l in h)this[l]=$(h[l],this);if(null!=s){var u=U(s,this,arguments);if(null!=u)return u}return this["super"]=null,this},null!=e&&_(e,a),null!=u&&L(a,u),null!=r&&j(a,r),null!=i&&j(a,i),N(n,r,i),k(a,r,i,n,p,{toJSON:O}),n=null,u=null,a)};!function(){function t(t,n,r){var o,i=e(t,n,!0);return r.done(function(){o=f.call(arguments),o.unshift(null),i.apply(null,o)}).fail(function(t){i(t)})}function e(t,e,r){null==r&&(r=!0),t._timeout&&clearTimeout(t._timeout),t.defer(),t._wait++,e&&(t._result||(t._result={}),e in t._result&&console.warn("<await>",e,"already awaiting"),t._result[e]=null);var o=z(n,t,e,r);return t._timeout=setTimeout(o,G.TIMEOUT),o}function n(t,e,n){if(0===arguments.length)return t._wait=0,void t.reject("408: Timeout");if(0!==t._wait){var r=t._result;if(e){var o=f.call(arguments,3);r[e]={error:n?o.shift():null,arguments:o}}else n&&null!=arguments[3]&&(null==r&&(r=t._result={}),r.__error=arguments[3]);if(0===--t._wait){clearTimeout(t._timeout);var i,l,u=r&&r.__error;if(null==u)for(l in r)if(i=r[l],u=i&&i.error)break;if(u)return void t.reject(u,r);t.resolve(r)}}}G=Y({Extends:X.prototype,_wait:0,_timeout:null,_result:null,_resolved:[],Construct:function(){for(var e,n=arguments.length,r=-1;++r<n;)e=arguments[r],null!=e&&"function"==typeof e.done&&t(this,null,e)},delegate:function(t,n){return e(this,t,n)},deferred:function(e){return t(this,e,new X)},Static:{TIMEOUT:2e3}})}();var Q,Z,tt,et,nt={fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(t){return(new this).fetch(t)}}};!function(){function t(t,n){return function(){var r=null==t._rejected,o=r?t._resolved:t._rejected,u=r?i:l;e([u,t,n].concat(o))}}function e(t){u.trigger.apply(u,t)}var n,r,o="start",i="fulfilled",l="rejected",u=new K;Q=function(t){u.on(o,t),n=!0},Z=function(t,e){u.on(i,t).on(l,e),r=!0},tt=function(t){u.off(i,t).off(l,t).off(o,t)},et=function(i){return X.prototype.defer.call(this),n&&e([o,this,i]),r&&this.always(t(this,i)),this}}(),Y.Remote=function(){function t(t,n){var r;try{r=JSON.parse(n)}catch(o){return void e(t,o)}t.deserialize(r),t.resolve(t)}function e(t,e,r){var o;if("string"==typeof e&&n(r))try{o=JSON.parse(e)}catch(i){o=i}t.reject(o||e)}function n(t){var e=t.getResponseHeader(u);return null!=e&&-1!==e.toLowerCase().indexOf(s)}function i(t,i,l){return function(u,s,a){if(n(a))try{s=JSON.parse(s)}catch(u){return console.error("<XHR> invalid json response",s),e(t,u,a)}if(i&&i(u,s),u)return e(t,s,a);if("save"===l&&r(s)){if(o(t))for(var c=t.length,f=s.length,h=-1;++h<c&&f>h;)J.deserialize(t[h],s[h]);else t.deserialize(s);return t.resolve(t)}t.resolve(s)}}function l(t){return new a(t)}var u="content-type",s="json",a=function(t){this._route=new W(t)};return A(a,nt,J,X,{defer:et,serialize:function(){return o(this)?S.call(this):O.call(this)},deserialize:function(t){return J.deserialize(this,t)},fetch:function(t){return this.defer("fetch"),V.get(this._route.create(t||this),this),this},save:function(t){this.defer("save");var e=this.serialize(),n=this._route.create(this),r=this._route.hasAliases(this)?"put":"post";return V[r](n,e,i(this,t,"save")),this},patch:function(t){return this.defer("patch"),F(this,t),V.patch(this._route.create(this),t,i(this)),this},del:function(t){this.defer("del");var e=this.serialize(),n=this._route.create(this);return V.del(n,e,i(this,t)),this},onSuccess:function(e){t(this,e)},onError:function(t,n,r){e(this,n,r)}}),l.onBefore=Q,l.onAfter=Z,g(["get","post","put","delete"],function(t){l[t]=function(e,n){var r=n;null!=n.serialize&&(r=n.serialize()),null==r&&n.toJSON&&(r=n.toJSON());var o=new X;return V[t](e,r,i(o)),o}}),l}(),Y.LocalStore=function(){function t(t,e){var n=t.create(e);localStorage.removeItem(n)}var e=function(t){this._route=new W(t)};A(e,nt,J,X,{serialize:function(){var t=o(this)?S.call(this):O.call(this);return JSON.stringify(t)},deserialize:function(t){return J.deserialize(this,t)},fetch:function(t){var e=this._route.create(t||this),n=localStorage.getItem(e);if(null==n)return this.resolve(this);if(l(n))try{n=JSON.parse(n)}catch(r){return this.reject(r)}return this.deserialize(n),this.resolve(this)},save:function(t){var e=this._route.create(this),n=this.serialize();return localStorage.setItem(e,n),t&&t(),this.resolve(this)},del:function(e){if(null==e&&0!==arguments.length)return this.reject("<localStore:del> - selector is specified, but is undefined");if(v(this)===!1)return t(this._route,e||this),this.resolve();if(null==e){for(var n=0,r=this.length;r>n;n++)this[n]=null;return this.length=0,t(this._route,this),this.resolve()}var o=this.remove(e);return 0===o.length?this.resolve():this.save()},onError:function(t){this.reject({error:t})}});var n=function(t){return new e(t)};return n.prototype=e.prototype,n}(),Y.bind=function(t){for(var e,n=arguments,r=1,o=arguments.length;o>r;r++)e=n[r],t[e]=t[e].bind(t);return t},Y.cfg=function(t,e){if(l(t))return 1===arguments.length?p[t]:void(p[t]=e);if(r(t))for(var n in t)Y.cfg(n,t[n])},Y.Model={},Y.Serializable=J,Y.Deferred=X,Y.EventEmitter=K,Y.Await=G,Y.validate=I,Y.stringify=x,Y.parse=w,Y.patch=b,Y.properties=C,Y.Collection=function(){function t(t,e){return e instanceof t?e:new t(e)}function e(){var t,e=arguments.length,o=arguments[e-1],i=arguments[e-2];return e>2&&(t=arguments[0]),o._ctor=i,A(o,r,n),null==t?Y(o):Y(t,o)}var n=function(){function e(t,e){if(null==e)return!1;if("function"==typeof e)return e(t);if("object"==typeof e){if(t.constructor===e.constructor&&t.constructor!==Object)return t===e;var n,r;for(var o in e){if(n=t[o],r=e[o],"string"==typeof r){var i=r[0],l=1;if("<"===i||">"===i)switch("="===r[1]&&(i+="=",l++),r=r.substring(l),i){case"<":if(n>=r)return!1;continue;case"<=":if(n>r)return!1;continue;case">":if(r>=n)return!1;continue;case">=":if(r>n)return!1;continue}}if(n!=r)return!1}return!0}return console.warn("No valid matcher",e),!1}function n(t,e){for(var n=this.length,r=-1;++r<n;)t.call(e||this,this[r],r);return this}var r={length:0,push:function(){for(var e=arguments.length,n=-1;++n<e;)this[this.length++]=t(this._ctor,arguments[n]);return this},pop:function(){var t=this[--this.length];return this[this.length]=null,t},shift:function(){if(0===this.length)return null;for(var t=this[0],e=this.length-1,n=0;e>n;n++)this[n]=this[n+1];return this[e]=null,this.length--,t},unshift:function(e){this.length++;for(var n=this.length;--n;)this[n]=this[n-1];return this[0]=t(this._ctor,e),this},splice:function(e,n){var r,o,i,l=this.length;if(e>=l)for(n=0,r=l,o=e;o>r;r++)this[r]=void 0;var u=n,s=e,a=e+u,c=arguments.length-2,f=l+c-u,h=a,p=l,d=f-l;if(d>0)for(r=p;--r>=h;)this[r+d]=this[r];if(0>d)for(r=h;p>r;)this[r+d]=this[r],r++;for(r=s,i=2;i<arguments.length;i)this[r++]=t(this._ctor,arguments[i++]);return this.length=f,this},slice:function(){return U(f,this,arguments)},sort:function(t){return h.call(this,t),this},reverse:function(){for(var t=f.call(this),e=this.length,n=-1;++n<e;)this[n]=t[e-n-1];return this},toString:function(){return f.call(this,0).toString()},each:n,forEach:n,where:function(t){for(var n,r=new this.constructor,o=0,i=this.length;i>o;o++)n=this[o],e(n,t)&&(r[r.length++]=n);return r},remove:function(t){for(var n=-1,r=[],o=0,i=this.length;i>o;o++)e(this[o],t)?r.push(this[o]):this[++n]=this[o];for(o=++n;i>o;o++)this[o]=null;return this.length=n,r},first:function(t){if(null==t)return this[0];var e=this.indexOf(t);return-1!==e?this[e]:null},last:function(t){if(null==t)return this[this.length-1];var e=this.lastIndexOf(t);return-1!==e?this[e]:null},indexOf:function(t,n){if(null==t)return-1;if(null!=n){if(0>n&&(n=0),n>=this.length)return-1}else n=0;for(var r=this.length;r>n;n++)if(e(this[n],t))return n;return-1},lastIndexOf:function(t,n){if(null==t)return-1;if(null!=n){if(n>=this.length&&(n=this.length-1),0>n)return-1}else n=this.length-1;for(;n>-1;n--)if(e(this[n],t))return n;return-1},map:function(t){for(var e=[],n=this.length,r=-1;++r<n;)e[r]=t(this[r]);return e},filter:function(t,e){for(var n=new this.constructor,r=this.length,o=-1;++o<r;)t.call(e||this,this[o])&&n.push(this[o]);return n}};return"undefined"!=typeof Symbol&&Symbol.iterator&&(r[Symbol.iterator]=function(){var t=this,e=-1;return{next:function(){return{value:t[++e],done:e>t.length-1}},hasNext:function(){return e<t.length}}}),r}(),r={toArray:function(){for(var t=new Array(this.length),e=0,n=this.length;n>e;e++)t[e]=this[e];return t},toJSON:S};return e}(),function(){var t,e;!function(){function n(t,e,n){return function(){t[n]=arguments;for(var r,o=0,i=e[n].length;i>o;o++)r=e[n][o],U(r,this,arguments);e[o]=null,t=null,e=null}}t=function(t){var e={},n=[];return function(){var r=q(arguments,n);return null==e[r]?e[r]=U(t,this,arguments):e[r]}},e=function(t){var e={},r={},o=[];return function(){var i=f.call(arguments),l=i.pop(),u=q(i,o);return e[u]?void U(l,this,e[u]):r[u]?void r[u].push(l):(r[u]=[l],i=f.call(i),i.push(n(e,r,u)),void U(t,this,i))}}}(),Y.Fn={memoize:t,memoizeAsync:e}}(),e.Class=Y}),function(t,e){"use strict";var n,r;return"undefined"==typeof exports||t!==exports&&null!=t||(n=r=global),null==n&&(n="undefined"==typeof window?global:window),null==r&&(r=t||n),"undefined"!=typeof include&&"function"==typeof include.js?(r.include=include,void(r.includeLib=include.Lib||n.includeLib)):void e(n,r,n.document)}(this,function(global,exports,document){"use strict";function fn_proxy(t,e){return function(){t.apply(e,arguments)}}function fn_doNothing(t){"function"==typeof t&&t()}function arr_invoke(t,e,n){if(null!=t&&t instanceof Array!=!1)for(var r=0,o=t.length;o>r;r++)"function"==typeof t[r]&&(null==e?t[r].call(n):t[r].apply(n,e))}function arr_ensure(t,e){if(!e)return t;for(var n,r=e.split("."),o=r.length-1,i=0;o>i;i++)n=r[i],t=t[n]||(t[n]={});return n=r[o],t[n]||(t[n]=[])}var bin={js:{},css:{},load:{}},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),reg_subFolder=/([^\/]+\/)?\.\.\//,reg_hasProtocol=/^(file|https?):/i,cfg={path:null,loader:null,version:null,lockedToFolder:null,sync:null,eval:null==document},handler={},hasOwnProp={}.hasOwnProperty,emptyResponse={load:{}},__array_slice=Array.prototype.slice,XMLHttpRequest=global.XMLHttpRequest,Helper={reportError:function(t){console.error("IncludeJS Error:",t,t.message,t.url),"function"==typeof handler.onerror&&handler.onerror(t)}},XHR=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&e&&e(t,n.responseText)},n.open("GET","object"==typeof t?t.url:t,!0),n.send()},obj_inherit,obj_getProperty,obj_setProperty;!function(){obj_inherit=function(t){"function"==typeof t&&(t=t.prototype);for(var e,n,r=1,o=arguments.length;o>r;r++){e="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in e)t[n]=e[n]}return t},obj_getProperty=function(t,e){for(var n=e.split("."),r=n.length,o=0;r>o;o++){if(null==t)return null;t=t[n[o]]}return t},obj_setProperty=function(t,e,n){for(var r,o=e.split("."),i=o.length-1,l=-1;++l<i;)r=o[l],null==t[r]&&(t[r]={}),t=t[r];t[o[l]]=n}}();var path_getDir,path_getFile,path_getExtension,path_resolveCurrent,path_normalize,path_win32Normalize,path_resolveUrl,path_combine,path_isRelative;!function(){function t(t){for(;-1!==t.indexOf("../");)t=t.replace(reg_subFolder,"");return t.replace(/\/\.\//g,"/")}path_getDir=function(t){return t.substring(0,t.lastIndexOf("/")+1)},path_getFile=function(t){return t=t.replace("file://","").replace(/\\/g,"/").replace(/\?[^\n]+$/,""),/^\/\w+:\/[^\/]/i.test(t)?t.substring(1):t},path_getExtension=function(t){var e=t.indexOf("?");return-1===e?t.substring(t.lastIndexOf(".")+1):t.substring(t.lastIndexOf(".",e)+1,e)},path_resolveCurrent=function(){if(null==document)return"undefined"==typeof module?"":path_win32Normalize(module.parent.filename);var t=document.getElementsByTagName("script"),e=t[t.length-1],n=e&&e.getAttribute("src")||"";if("/"===n[0])return n;var r=window.location.pathname.replace(/\/[^\/]+\.\w+$/,"");return"/"!==r[r.length-1]&&(r+="/"),r+n},path_normalize=function(t){return t.replace(/\\/g,"/").replace(/([^:\/])\/{2,}/g,"$1/")},path_win32Normalize=function(t){return t=path_normalize(t),"file:"===t.substring(0,5)?t:"file:///"+t},path_resolveUrl=function(e,n){return reg_hasProtocol.test(e)?t(e):("./"===e.substring(0,2)&&(e=e.substring(2)),"/"===e[0]&&null!=n&&null!=n.base&&(e=path_combine(n.base,e),reg_hasProtocol.test(e))?t(e):"/"===e[0]&&cfg.path&&(e=cfg.path+e.substring(1),reg_hasProtocol.test(e))?t(e):("/"===e[0]?(isWeb===!1||cfg.lockedToFolder===!0)&&(e=e.substring(1)):null!=n&&null!=n.location&&(e=n.location+e),t(e)))},path_isRelative=function(t){var e=t.charCodeAt(0);switch(e){case 47:return!1;case 102:case 104:return reg_hasProtocol.test(t)===!1}return!0},path_combine=function(){for(var t,e="",n=arguments.length,r=-1;++r<n;)t=arguments[r],t&&(t=path_normalize(t),""!==e?("/"!==e[e.length-1]&&(e+="/"),"/"===t[0]&&(t=t.substring(1)),e+=t):e=t);return e}}();var tree_resolveUsage;!function(){function t(e,n,r){if(null==n){console.warn("<include> Usage Not Found:",e),console.warn("- Ensure to have it included before with the correct alias"),console.warn("- Initiator Stacktrace:");for(var o=[],i=r;null!=i;)o.push(i.url),i=i.parent;return console.warn(o.join("\n")),null}for(var l,u,s=n.includes,a=-1,c=s.length;++a<c;)if(l=s[a],u=l.route.alias||Routes.parseAlias(l.route),u===e)return l.resource;return t(e,n.parent,r)}tree_resolveUsage=function(e,n,r){for(var o,i,l,u,s,a=[],c=n.length,f=-1;++f<c;){if(l=i=n[f],u=i.indexOf("."),-1!==u&&(l=i.substring(0,u),i=i.substring(u+1)),s=t(l,e.parent,e),null==s)return null;if(4!==s.state)return e.state=3,s.on(4,r,s,"push"),null;o=s.exports,l!==i&&(o=obj_getProperty(o,i)),"object"==typeof o&&null==o&&console.warn("<include:use> Used resource has no exports",l,e.url),a[f]=o}return a}}();var RoutesLib=function(){var t={},e=/([^\\\/]+)\.\w+$/;return{register:function(e,n,r){if("string"==typeof n&&path_isRelative(n)){var o=r||include,i=o.location||path_getDir(o.url||path_resolveCurrent());path_isRelative(i)&&(i="/"+i),n=i+n}t[e]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(e,n){var r,o,i,l,u,s,a,c,f=n.indexOf("?"),h=n.indexOf("::");if(-1!==h&&(r=n.substring(h+2),n=n.substring(0,h)),-1!==f){for(c=n.substring(f+1).split("&"),i={},u=0,a=c.length;a>u;u++)s=c[u].split("="),i[s[0]]=s[1];n=n.substring(0,f)}if(n=n.split("/"),l=t[e],null==l)return{path:n.join("/"),params:i,alias:r};for(o=l[0],u=1;u<l.length;u++)if(u%2===0)o+=l[u];else{var p=l[u]<<0;if(p>n.length-1&&(p=n.length-1),o+=n[p],u===l.length-2)for(p++;p<n.length;p++)o+="/"+n[p]}return{path:o,params:i,alias:r}},each:function(t,e,n,r,o){var i;if(null!=e)if("lazy"!==t||null!=o)if(e instanceof Array)for(var l=0;l<e.length;l++)this.each(t,e[l],n,r,o);else if("object"!=typeof e){if("string"==typeof e){var u=this.resolve(r,e);return r&&(r+="."+e),void n(r,u,o)}console.error("Include Package is invalid",arguments)}else for(i in e)hasOwnProp.call(e,i)&&this.each(t,e[i],n,i,o);else for(i in e)this.each(t,e[i],n,null,i)},getRoutes:function(){return t},parseAlias:function(t){var n=t.path,r=e.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(t){function e(){Events.ready=fn_doNothing,null!=n&&(arr_invoke(n),n=null)}if(null==t)return{ready:fn_doNothing,load:fn_doNothing};var n=[];return"onreadystatechange"in t?t.onreadystatechange=function(){/complete|interactive/g.test(t.readyState)!==!1&&e()}:t.addEventListener?t.addEventListener("DOMContentLoaded",e):window.onload=e,{ready:function(t){n.unshift(t)}}}(document),ScriptStack=function(){function t(t,e){var n=document.createElement("script");n.type="text/javascript",n.src=t,"onreadystatechange"in n?n.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&e()}:n.onload=n.onerror=e,(o||(o=document.getElementsByTagName("head")[0])).appendChild(n)}function e(){function n(t){t&&"error"===t.type&&console.log("Script Loaded Error",o.url);for(var n=0,r=u.length;r>n;n++)if(u[n]===o){u.splice(n,1);break}return n===r?void console.error("Loaded Resource not found in stack",o):(2.5!==o.state&&o.readystatechanged(3),i=null,void e())}if(!l){if(0===u.length)return void r();if(null==i){var o=i=u[0];if(1!==o.state)return o.state=1,global.include=o,global.iparams=o.route.params,o.source?(__eval(o.source,o),void n()):void t(o.url,n)}}}function n(){if(!l){if(0===u.length)return void r();if(null==i){var t=u[0];if(!(t.state<2)){i=t,t.state=1,global.include=t,__eval(t.source,t);for(var e,o=0,s=u.length;s>o;o++)if(e=u[o],e===t){u.splice(o,1);break}2.5!==t.state&&t.readystatechanged(3),i=null,n()}}}}function r(){for(var t=-1,e=s.length;++t<e;)s[t]();s.length=0}var o,i,l,u=[],s=[];return{load:function(t,r,o){return this.add(t,r),!cfg.eval||o?void e():t.source?(t.state=2,void n()):void XHR(t,function(t,e){e||(console.error("Not Loaded:",t.url),console.error("- Initiator:",t.parent&&t.parent.url||"<root resource>")),t.source=e,t.state=2,n()})},add:function(t,e){if(1===t.priority)return u.unshift(t);if(null==e)return u.push(t);for(var n=u.length,r=-1;++r<n;)if(u[r]===e)return u.splice(r,0,t);u.push(t)},moveToParent:function(t,e){var n,r=u.length,o=-1,i=-1;for(n=0;r>n;n++)if(u[n]===t){i=n;break}if(-1!==i){for(n=0;r>n;n++)if(u[n]===e){o=n;break}-1!==o&&(o>i||(u.splice(i,1),u.splice(o,0,t)))}},pause:function(){l=!0},resume:function(){l=!1,null==i&&this.touch()},touch:function(){var t=cfg.eval?n:e;t()},complete:function(t){return l!==!0&&0===u.length?void t():void s.push(t)}}}(),IncludeDeferred=function(){this.callbacks=[],this.state=-1};IncludeDeferred.prototype={on:function(t,e,n,r){return this===n&&-1===this.state?(e(this),this):(null==r&&(r=this.state<3||this===n?"unshift":"push"),t<=this.state?e(this):this.callbacks[r]({state:t,callback:e}),this)},readystatechanged:function(t){var e,n,r,o;if(t>this.state&&(this.state=t),3===this.state){var i=this.includes;if(null!=i&&i.length)for(e=0;e<i.length;e++)if(4!==i[e].resource.state)return;this.state=4}if(e=0,n=this.callbacks.length,0!==n){for("js"===this.type&&4===this.state&&(o=global.include,global.include=this);n>e&&(r=this.callbacks[e],null==r||r.state>this.state||(this.callbacks.splice(e,1),n--,e--,r.callback(this),!(this.state<4)));e++);null!=o&&"js"===o.type&&(global.include=o)}},ready:function(t){var e=this;return this.on(4,function(){Events.ready(function(){e.resolve(t)})},this)},done:function(t){var e=this;return this.on(4,function(){e.resolve(t)},this)},resolve:function(t){var e=this.includes,n=null==e?0:e.length;if(n>0&&null==this.response){this.response={};for(var r,o,i,l=0;n>l;l++)if(i=e[l],r=i.resource,o=i.route,"undefined"!=typeof r.exports){var u=r.type;switch(u){case"js":case"load":case"ajax":var s=o.alias||Routes.parseAlias(o),a="js"===u?this.response:this.response[u]||(this.response[u]={});if(null!=s){obj_setProperty(a,s,r.exports);break}console.warn("<includejs> Alias is undefined",r)}}}var c=this.response||emptyResponse,f=this;return null==this._use&&null!=this._usage&&(this._use=tree_resolveUsage(this,this._usage,function(){f.state=4,f.resolve(t),f.readystatechanged(4)}),this.state<4)?void 0:this._use?void t.apply(null,[c].concat(this._use)):void t(c)}};var Include,IncludeLib={};!function(IncludeDeferred){function incl_getResource(t,e){var n=t;if(path_isRelative(t)===!0&&(n="/"+n),null!=e)return bin[e][n];

for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null}function embedPlugin(source){eval(source)}function enableModules(){return"undefined"==typeof Object.defineProperty?void console.warn("Browser do not support Object.defineProperty"):(Object.defineProperty(global,"module",{get:function(){return global.include}}),void Object.defineProperty(global,"exports",{get:function(){var t=global.include;return t.exports||(t.exports={})},set:function(t){global.include.exports=t}}))}function includePackage(t,e,n){var r=1===n.length?n[0]:__array_slice.call(n);return t instanceof Resource?t.include(e,r):new Resource("js").include(e,r)}function createIncluder(t){return function(){return includePackage(this,t,arguments)}}function doNothing(){return this}function stub_freeze(t){t.js=t.css=t.load=t.ajax=t.embed=t.lazy=t.inject=doNothing}function stub_release(t){for(var e=["js","css","load","ajax","embed","lazy"],n=e.length;-1!==--n;)t[e[n]]=createIncluder(e[n]);t.inject=t.js}Include=function(){IncludeDeferred.call(this)},stub_release(Include.prototype),obj_inherit(Include,IncludeDeferred,{_use:null,_usage:null,isBrowser:!0,isNode:!1,setCurrent:function(t){var e=t.url,n=this.getResourceById(e,"js");if(null==n){"/"===e[0]&&this.base&&(e=this.base+e.substring(1));var n=new Resource("js",{path:e},t.namespace,null,null,e)}n.state<3&&console.error("<include> Resource should be loaded",t),n.state=3,global.include=n},cfg:function(t){switch(typeof t){case"object":var e,n;for(e in t)switch(n=t[e],e){case"loader":for(var r in n)CustomLoader.register(r,n[r]);break;case"modules":n===!0&&enableModules();break;default:cfg[e]=n}break;case"string":if(1===arguments.length)return cfg[t];2===arguments.length&&(cfg[t]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(t){if(null==t)return Routes.getRoutes();if(2===arguments.length)return Routes.register(t,arguments[1],this),this;for(var e in t)Routes.register(e,t[e],this);return this},promise:function(t){for(var e=t.split("."),n=global;e.length;){var r=e.shift();n=n[r]||(n[r]={})}return n},register:function(t){function e(t){return null==s?t:("/"===t.url[0]&&(t.url=s+t.url.substring(1)),"/"===t.parent[0]&&(t.parent=s+t.parent.substring(1)),t.id=t.url,t)}function n(t,e){t.exports=e,t.readystatechanged(4)}var r,o,i,l,u,s=this.base;for(r in t)for(i=t[r],l=i.length,u=-1;++u<l;){o=e(i[u]);var a=o.id,c=o.url,f=o.namespace,h=o.parent&&incl_getResource(o.parent,"js"),p=new Resource,d=o.state;if(a||c){switch(c&&("/"===c[0]&&(c=c.substring(1)),p.location=path_getDir(c)),p.state=null==d?"js"===r?3:4:d,p.namespace=f,p.type=r,p.url=c||a,p.parent=h,p.base=h&&h.base||s,r){case"load":case"lazy":var g=document.querySelector("#includejs-"+a.replace(/\W/g,""));if(null==g){console.error('"%s" Data was not embedded into html',a);break}p.exports=g.innerHTML,CustomLoader.exists(p)&&(p.state=3,CustomLoader.load(p,n))}(bin[r]||(bin[r]={}))[a]=p}}},instance:function(t,e){var n;return null==t?(n=new Include,n.state=4,n):(n=new Resource("package"),n.state=4,n.location=path_getDir(path_normalize(t)),n.parent=e,n)},getResource:function(t,e){return this.base&&"/"===t[0]&&(t=this.base+t.substring(1)),incl_getResource(t,e)},getResourceById:function(t,e){var n=bin[e],r=n[t];return null!=r?r:this.base&&"/"===t[0]&&(r=n[path_combine(this.base,t)],null!=r)?r:this.base&&this.location&&(r=n[path_combine(this.base,this.location,t)],null!=r)?r:this.location&&(r=n[path_combine(this.location,t)],null!=r)?r:null},getResources:function(){return bin},plugin:function(t,e){var n=[],r=0,o=0,i=0,l=function(t,n){o++,embedPlugin(n),o===r-1&&e&&(e(),e=null)};for(Routes.each("",t,function(t,e){n.push("/"===e.path[0]?e.path.substring(1):e.path)}),r=n.length;r>i;i++)XHR(n[i],l);return this},client:function(){return cfg.server===!0&&stub_freeze(this),this},server:function(){return cfg.server!==!0&&stub_freeze(this),this},use:function(){return null==this.parent?(console.error("<include.use> Parent resource is undefined"),this):(this._usage=arguments,this)},pauseStack:fn_proxy(ScriptStack.pause,ScriptStack),resumeStack:fn_proxy(ScriptStack.resume,ScriptStack),allDone:function(t){ScriptStack.complete(function(){function e(){--r<1&&t()}var n=include.getPending(),r=n.length;if(0===r)return void t();for(var o=-1,i=r;++o<i;)n[o].on(4,e,null,"push")})},getPending:function(t){var e,n,r,o=[];for(n in bin)if(null==t||t===n)for(r in bin[n])e=bin[n][r],e.state<4&&o.push(e);return o},Lib:IncludeLib})}(IncludeDeferred);var CustomLoader=function(){function t(t){return"string"==typeof t?!1:"function"==typeof t.ready||"function"==typeof t.process}function e(e){var n=path_getExtension(e),r=cfg.loader[n];if(t(r))return r;var o,i=r;if("object"==typeof i)for(var l in i){o=l,i=i[l];break}return cfg.loader[n]=new Resource("js",Routes.resolve(o,i),o,null,null,null,1)}function n(t,e){return function(n){t(e,n)}}function r(t,e,r,o){if(null==r.process)return void o(e,t);var i=n(o,e),l=r.process(t,e,i);"undefined"!=typeof l&&o(e,l)}function o(t,e,n){function o(t,o){r(o,t,e,n)}return"string"==typeof t.exports?void r(t.exports,t,e,n):e.load?e.load(t,o):void XHR(t,o)}var i={process:function(t,e){try{return JSON.parse(t)}catch(n){return console.error(n,t),null}}};return cfg.loader={json:i},{load:function(t,n){var r=e(t.url);return r.process?void o(t,r,n):void r.on(4,function(){o(t,r.exports,n)},null,"push")},exists:function(t){if(!t.url)return!1;var e=path_getExtension(t.url);return cfg.loader.hasOwnProperty(e)},register:function(t,e){if("string"==typeof e){var n=include;null==n.location&&(n={location:path_getDir(path_resolveCurrent())}),e=path_resolveUrl(e,n)}cfg.loader[t]=e}}}(),LazyModule={create:function(t,e){for(var n=t.split("."),r=global,o=n[n.length-1];n.length>1;){var i=n.shift();r=r[i]||(r[i]={})}n=null,Object.defineProperty(r,o,{get:function(){delete r[o];try{var n=__eval(e,global.include);null==n||n instanceof Resource||(r[o]=n)}catch(i){i.xpath=t,Helper.reportError(i)}finally{return e=null,t=null,r[o]}}})}},Resource;!function(t,e,n,r){function o(t){var e=t.type,o=t.parent,l=t.url;if(null==document&&"css"===e)return t.state=4,t;if(r.exists(t)===!1)switch(e){case"js":case"embed":n.load(t,o,"embed"===e);break;case"ajax":case"load":case"lazy":XHR(t,i);break;case"css":t.state=4;var u=document.createElement("link");u.href=l,u.rel="stylesheet",u.type="text/css",document.getElementsByTagName("head")[0].appendChild(u)}else("js"===e||"embed"===e)&&n.add(t,t.parent),r.load(t,i);return t}function i(t,e){switch(e||console.warn("Resource cannt be loaded",t.url),t.type){case"js":case"embed":return t.source=e,t.state=2,void n.touch();case"load":case"ajax":t.exports=e;break;case"lazy":LazyModule.create(t.xpath,e);break;case"css":var r=document.createElement("style");r.type="text/css",r.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(r)}t.readystatechanged(4)}function l(t,e,n){if(null==t)return null;null==n&&(n=[]);for(var r,o=t.length,i=-1;++i<o;)r=t[i].resource,e===r.type&&n.push(r),null!=r.includes&&l(r.includes,e,n);return n}Resource=function(e,r,i,l,u,s,a){t.call(this),this.childLoaded=fn_proxy(this.childLoaded,this);var c=r&&r.path;null!=c&&(this.url=c=path_resolveUrl(c,u)),this.type=e,this.xpath=l,this.route=r,this.parent=u,this.priority=a,this.namespace=i,this.base=u&&u.base,null==s&&c&&(s=(path_isRelative(c)?"/":"")+c);var f=bin[e]&&bin[e][s];return f?(f.state<4&&"js"===e&&n.moveToParent(f,u),f):null==c?(this.state=3,this.location=path_getDir(path_resolveCurrent()),this):(this.state=0,this.location=path_getDir(c),(bin[e]||(bin[e]={}))[s]=this,cfg.version&&(this.url+=(-1===this.url.indexOf("?")?"?":"&")+"v="+cfg.version),o(this))},Resource.prototype=obj_inherit(Resource,t,{state:null,location:null,includes:null,response:null,url:null,base:null,type:null,xpath:null,route:null,parent:null,priority:null,namespace:null,setBase:function(t){return this.base=t,this},childLoaded:function(t){var e=this,n=e.includes;if(n&&n.length){if(e.state<3)return;for(var r=0;r<n.length;r++)if(4!==n[r].resource.state)return}e.readystatechanged(4)},create:function(t,e,n,r,o){var i;return this.state=this.state>=3?3:2,this.response=null,null==this.includes&&(this.includes=[]),i=new Resource(t,e,n,r,this,o),this.includes.push({resource:i,route:e}),i},include:function(t,n){var r,o=this,i=[];e.each(t,n,function(e,n,l){(null==o.route||o.route.path!==n.path)&&(r=o.create(t,n,e,l),i.push(r))});for(var l=-1,u=i.length;++l<u;)i[l].on(4,this.childLoaded);return this},pause:function(){this.state=2.5;var t=this;return function(e){1===arguments.length&&(t.exports=e),t.readystatechanged(3)}},getNestedOfType:function(t){return l(this.includes,t)}})}(Include,Routes,ScriptStack,CustomLoader),IncludeLib.Routes=RoutesLib,IncludeLib.Resource=Resource,IncludeLib.ScriptStack=ScriptStack,IncludeLib.registerLoader=CustomLoader.register,exports.include=new Include,exports.includeLib=IncludeLib}),function(t,e){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=e(t)}(this,function(t){"use strict";function e(){return null==x&&(x=new C(j)),x}var n,r,o=t.mask||("undefined"!=typeof Mask?Mask:null),i=!0,l=Array.prototype.slice;!function(){n=function(t,e){if(null==e)return t||{};if(null==t)return r(e);for(var n in e)t[n]=e[n];return t},r=Object.create||function(t){var e=function(){};return e.prototype=t,new e}}();var u;!function(){u=function(){var t=l.call(arguments);console.error.apply(console,["Ruta"].concat(t))}}();var s,a,c,f,h,p;!function(){function t(t){for(var e,n,r=t.trim().split(/\s+/),o=r.length,i=-1;++i<o;)if(n=r[i],0!==n.length&&(e=n[0],'"'===e||"'"===e))for(var l=i;o>i;i++)if(n=r[i],n[n.length-1]===e){var u=r.splice(l,i-l+1).join(" ").slice(1,-1);r.splice(l,0,u),o=r.length;break}return r}function e(t){for(var e,n,r,o=t.length,i=0,l={},u=[];o>i;i++)r=t[i],"-"!==r[0]?u.push(r):(e=r.replace(/^[\-]+/,""),o-1>i&&"-"!==t[i+1][0]?(n=t[i+1],i++):n=!0,l[e]=n);return{path:u,query:l}}s=function(t){for(var e=t.length,n=0,r=e-1;e>n&&"/"===t[n];n++);for(;r>n&&"/"===t[r];r--);return t.substring(n,r+1)},a=function(t){return t=s(t),""===t?[]:t.split("/")},c=function(t){return"/"+t.join("/")},f=function(n){"string"==typeof n&&(n=t(n));var r=e(n);return y(r)},h=function(t){var e=t.indexOf("?");if(-1===e)return null;var n=t.substring(e+1);return d(n,"&")},p=function(t,e){var n="string"!=typeof e?g(e,"&"):e,r=t.indexOf("?");return-1!==r&&(t=t.substring(0,r)),t+"?"+n}}();var d,g;!function(){function t(t,e,n){for(var r,o=e.split("."),i=o.length,l=-1;++l<i-1;)r=o[l],null==t[r]&&(t[r]={}),t=t[r];t[o[l]]=n}function e(t){try{return decodeURIComponent(t)}catch(e){return u("decode:URI malformed"),""}}function n(t){try{return encodeURIComponent(t)}catch(e){return u("encode:URI malformed"),""}}d=function(n,r){null==r&&(r="&");for(var o,i,l={},u=n.split(r),s=0,a=u.length;a>s;s++)o=u[s].split("="),i=null==o[1]?"":e(o[1]),t(l,o[0],i);return l},g=function(t,e){null==e&&(e="&");var r,o,i="";for(r in t)o=t[r],null!=o&&("boolean"==typeof o&&(o=null),i=i+(i?e:"")+r,null!=o&&(i+="="+n(o)));return i}}();var v,m,_;!function(){v=function(t,e){return new RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e)},m=function(t){if("^"===t[0])return new RegExp(t);for(var e=t.split("|"),n=0,r=e.length;r>n;n++)e[n]="^"+e[n]+"$";return new RegExp(e.join("|"))},_=function(t){var e=t.indexOf("("),n=t.lastIndexOf(")");if(-1===e||-1===n)return u("Expected alias part with regexp",t),null;var r=t.substring(e+1,n);return{alias:t.substring(1,e),matcher:m(r)}}}();var y,b;!function(){y=function(t){var e=c(t.path);return null==t.query?e:e+"?"+g(t.query,"&")},b=function(t){var e=t.indexOf("?"),n=-1===e?t:t.substring(0,e);return{path:a(n),query:-1===e?null:d(t.substring(e+1),"&")}}}();var x,w=function(){function t(t,e){this.method=36===t.charCodeAt(0)?t.substring(1,t.indexOf(" ")).toUpperCase():null,null!=this.method&&(t=t.substring(this.method.length+2)),this.strict=i,this.value=e,this.definition=t,n(this,t)}function e(){this.routes=[]}var n,r;!function(){function t(t,e){for(var n in t)if(e.test(n))return t[n]}n=function(t,e){var n=e.charCodeAt(0);switch(n){case 33:t.strict=!0,e=e.substring(1);break;case 94:t.strict=!1,e=e.substring(1);break;case 40:var r=1,o=e.length-1;return 41!==e.charCodeAt(e.length-1)&&(u("parser - expect group closing"),o++),void(t.match=new RegExp(e.substring(r,o)))}var i,l,s,a,c,f,h=e.split("/"),p=0,d=h.length,g=h[d-1];l=g.indexOf("?"),l>(1===d?-1:0)&&(i=g.substring(l+1),h[d-1]=g.substring(0,l));for(var v,_,y,b=!0,x=t.path=[];d>p;p++)if(s=h[p],""!==s){a=s.charCodeAt(0),f=s.charCodeAt(1),v=63===a,_=58===(v?f:a),c=0,v&&c++,_&&c++,0!==c&&(s=s.substring(c)),v||b||u("Strict part found after optional",e),v&&(b=!1);var w=s.indexOf("(");if(_&&-1!==w){var o=s.length-1;")"!==s[o]&&(o+=1),y=new RegExp(m(s.substring(w+1,o))),s=s.substring(0,w)}v||_?_&&x.push({alias:s,matcher:y,optional:v}):x.push(s)}if(i){var C=t.query={};h=i.split("&"),p=-1,d=h.length;for(var k,j,N,O;++p<d;)N=h[p],O=N.indexOf("="),-1!==O?(k=N.substring(0,O),j=N.substring(O+1),40===j.charCodeAt(0)&&(j=new RegExp(m(j))),C[k]=j):C[N]="";0===t.path.length&&(t.strict=!1)}},r=function(e,n){var r=n.indexOf("?"),o=-1===r?null:n.substring(r+1),i={path:n,params:null==o?{}:d(o,"&")};if(e.query)for(var l in e.query)if("?"===l[0]&&(l=l.substring(1)),":"===l[0]){var u=_(l),s=u.alias;i.params[s]=t(i.params,u.matcher)}if(-1!==r&&(n=n.substring(0,r)),null!=e.path)for(var c,f,h=a(n),p=e.path,g=p.length,v=h.length,m=0;v>m;m++)if(c=h[m],f=g>m?p[m]:null){if("string"==typeof f)continue;if(f.alias){i.params[f.alias]=c;continue}}return i}}();var o,l;!function(){function t(t,e){for(var n in t)if(e.test(n))return!0;return!1}o=function(t,e,n){for(var o,i=b(t),u=0,s=e.length;s>u;u++)if(o=e[u],l(i,o,n))return o.current=r(o,t),o;return null},l=function(e,n,r){if(null!=r&&null!=n.method&&n.method!==r)return!1;if(n.match)return n.match.test("string"==typeof e?e:y(e));if("string"==typeof e&&(e=b(e)),n.query){var o,i,l=e.query;if(null==l)return!1;for(o in n.query){i=n.query[o];var u=o[0];if(":"!==u){if("?"!==u)if("string"!=typeof i){if(i.test&&!i.test(l[o]))return!1}else{if(null==l[o])return!1;if(i&&l[o]!==i)return!1}}else{var s=_(o);if(null==s||t(l,s.matcher)===!1)return!1}}}var a=n.path,c=a.length;if(0===c)return n.strict?0===e.path.length:!0;for(var f,h=0,p=e.path.length;p>h;h++){if(f=a[h],h>=c)return n.strict!==!0;if("string"==typeof f){if(e.path[h]===f)continue;return!1}if(f.matcher&&f.matcher.test(e.path[h])===!1)return!1;if(f.optional)return!0;if(!f.alias)return!1}return c>h?a[h].optional===!0:!0}}();return t.prototype={path:null,query:null,value:null,current:null},e.prototype={add:function(e,n){return this.routes.push(new t(e,n)),this},get:function(t,e){return o(t,this.routes,e)},clear:function(){return this.routes.length=0,this}},e.parse=function(t,e){var o={};return n(o,t),r(o,e)},e}(),C=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;this.listener=t;var e=this;return window.onhashchange=function(){e.changed(location.hash)},this}function e(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var e=this;return e.listener=t,e.initial=location.pathname,window.onpopstate=function(){return e.initial===location.pathname?void(e.initial=null):void e.changed()},e}function r(n,r){if(this.collection=n||new w,r){var o="hash"===r?t:e;this.emitter=new o(this)}null==this.emitter&&(this.emitter=new e(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&u("Router can not be initialized - (nor HistoryAPI / nor hashchange")}return"undefined"==typeof window?function(){}:(function(){function e(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){return null==t?void this.changed(location.hash):void(location.hash=t)},changed:function(t){this.listener.changed(e(t))},current:function(){return e(location.hash)}}}(),e.prototype={navigate:function(t,e){if(null==t)return void this.changed();var r="object"==typeof t,o=null;if(null!=e&&e.extend===!0){var i=r?t:h(t),l=h(location.search);if(null!=l&&null!=i){for(var u in l)void 0!==i[u]&&null===i[u]&&delete l[u];i=n(l,i),o=p(o||"",i)}}null==o&&(o=r?p("",t):t),history.pushState({},null,o),this.initial=null,this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}},r.prototype={changed:function(t){var e=this.collection.get(t);e&&this.action(e)},action:function(t){if("function"==typeof t.value){var e=t.current;t.value(t,e&&e.params)}},navigate:function(t,e){this.emitter.navigate(t,e)},current:function(){return this.collection.get(this.currentPath())},currentPath:function(){return this.emitter.current()}},r)}(),k={pathFromCLI:f,query:{serialize:g,deserialize:d,get:function(t){var e=null==t?location.search:t;return h(e)}}},j=new w,N={Collection:w,setRouterType:function(t){return null==x&&(x=new C(j,t)),this},setStrictBehaviour:function(t){return i=t,this},add:function(t,n){return e(),j.add(t,n),this},get:function(t){return j.get(t)},navigate:function(t,n){return e().navigate(t,n),this},current:function(){return e().current()},currentPath:function(){return e().currentPath()},notifyCurrent:function(){return e().navigate(),this},parse:w.parse,$utils:k,_:k};return function(){function t(t){t.preventDefault(),t.stopPropagation(),N.navigate(this.href)}null!=o&&o.registerAttrHandler("x-dynamic",function(e,n,r,o,i){i.onclick=t},"client")}(),N}),function(t){"use strict";function e(t,e){if("object"!=typeof t||null==e)return t;for(var n,r=t,o=e.split("."),i=o.length,l=0;i>l;l++)if(n=o[l],r=r[n],null==r)return r;return r}function n(t,e){for(var n in e)e[n]&&(t[n]=e[n]);return t}function r(t,n,r,o){if("function"==typeof n)return n(t)?t:null;if("undefined"==typeof r)return t==n?t:null;var i=null!=n?e(t,n):t,l=r,u=o;switch(l){case">":return i>u?t:null;case"<":return u>i?t:null;case">=":return i>=u?t:null;case"<=":return u>=i?t:null;case"!=":return i!=u?t:null;case"==":return i==u?t:null}return console.error("InvalidArgumentException: arr.js:check",arguments),null}function o(t){this.items=t}function i(t){o.prototype[t]=function(){var e=arguments.length,n=u[t](this.items,e>0?arguments[0]:null,e>1?arguments[1]:null,e>2?arguments[2]:null,e>3?arguments[3]:null);return n instanceof Array?(this.items=n,this):n}}var l=t.ruqq||(t.ruqq={}),u={where:function(t,e,n,o){var i=[];if(null==t)return i;for(var l,u=0,s=t.length;s>u;u++)l=t[u],null!=r(l,e,n,o)&&i.push(l);return i},each:"undefined"!=typeof Array.prototype.forEach?function(t,e){return null==t?t:(t.forEach(e),t)}:function(t,e){if(null==t)return t;for(var n=0,r=t.length;r>n;n++)e(t[n]);return t},remove:function(t,e,n,o){for(var i=0,l=t.length;l>i;i++)null!=r(t[i],e,n,o)&&(t.splice(i,1),i--,l--);return t},invoke:function(){for(var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift(),r=[],o=0;o<e.length;o++)r.push("function"==typeof e[o][n]?e[o][n].apply(e[o],t):null);return r},last:function(t,e,n,o){if(null==t)return null;if(null==e)return t[t.length-1];for(var i=t.length;i>-1;--i)if(null!=r(t[i],e,n,o))return t[i];return null},first:function(t,e,n,o){if(null==e)return t[0];for(var i=0,l=t.length;l>i;i++)if(null!=r(t[i],e,n,o))return t[i];return null},any:function(t,e,n,o){for(var i=0,l=t.length;l>i;i++)if(null!=r(t[i],e,n,o))return!0;return!1},isIn:function(t,e){for(var n=0;n<t.length;n++)if(e==t[n])return!0;return!1},map:"undefined"!=typeof Array.prototype.map?function(t,e){return null==t?[]:t.map(e)}:function(t,e){var n=[];if(null==t)return n;for(var r=0,o=t.length;o>r;r++)n.push(e(t[r],r));return n},aggr:function(t,e,n){for(var r=0,o=t.length;o>r;r++){var i=n(t[r],e,r);null!=i&&(e=i)}return e},select:function(t,e){if(null==t)return[];for(var n,r=[],o=0,i=t.length;i>o;o++)if(n=t[o],"string"==typeof e)r.push(n[e]);else if("function"==typeof e)r.push(e(n));else if(e instanceof Array){for(var l={},u=0;u<e.length;u++)l[e[u]]=t[o][e[u]];r.push(l)}return r},indexOf:function(t,e,n,o){for(var i=0,l=t.length;l>i;i++)if(null!=r(t[i],e,n,o))return i;return-1},count:function(t,e,n,o){for(var i=0,l=0,u=t.length;u>l;l++)null!=r(t[l],e,n,o)&&i++;return i},distinct:function(t,e){var n=[];if(null==t)return n;for(var r=0,o=t.length;o>r;r++){for(var i=!0,l=0;l<n.length;l++)if(e&&e(t[r],n[l])||null==e&&t[r]==n[l]){i=!1;break}i&&n.push(t[r])}return n},groupBy:function(t,e){for(var n,r,o,i=[],l=t.length,u=-1,s={};++u<l;)if(s[u]!==!0){for(o=t[u],n=[o],r=u;++r<l;)s[r]!==!0&&e(o,t[r])&&(s[r]=!0,n.push(t[r]));i.push(n)}return i}};u.each(["min","max"],function(t){u[t]=function(n,r){if(null==n)return null;for(var o=null,i=0,l=n.length;l>i;i++){var u=e(n[i],r);null!=o?"max"===t&&u>o?o=u:"min"===t&&o>u&&(o=u):o=u}return o}}),l.arr=function(t){return new o(t)},n(l.arr,u);for(var s in u)i(s)}("undefined"!=typeof window?window:global),function(t,e){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),null==t.net&&(t.net={}),t.net.Uri=e(t)}(this,function(t){"use strict";function e(t){return t&&"object"==typeof t&&"function"==typeof t.combine}function n(){for(var t,e=(arguments,""),n=0,r=arguments.length;r>n;n++)t=arguments[n],t&&(e?("/"!==e[e.length-1]&&(e+="/"),e+="/"===t[0]?t.substring(1):t):e=t);return e}function r(t){return"/"===t[t.length-1]?t.substring(0,t.length-1):t}function o(t){var e,n=new g;for(e in t)"string"==typeof t[e]&&(n[e]=t[e]);return n}function i(t){return t.replace(/\\/g,"/").replace(/^\.\//,"").replace(/^(\w+):\/([^\/])/,"/$1:/$2")}function l(t){return d.test(t)&&"/"===t[0]?t.substring(1):t}function u(t){var e=f.exec(t.value);null==e&&"/"===t.value[0]&&(t.protocol="file"),null!=e&&(t.protocol=e[1],t.value=t.value.substring(e[0].length))}function s(t){if(null!=t.protocol){if("file"===t.protocol){var e=d.exec(t.value);return void(e&&(t.host=e[1],t.value=t.value.substring(t.host.length)))}var n=t.value.indexOf("/",2);t.host=~n?t.value.substring(0,n):t.value,t.value=t.value.replace(t.host,"")}}function a(t){var e=t.value.indexOf("?");-1!==e&&(t.search=t.value.substring(e),t.value=t.value.substring(0,e))}function c(t){var e=h.exec(t.value),n=null==e?null:e[1];null!=n&&(t.file=n,t.value=t.value.substring(0,t.value.length-n.length),t.value=r(t.value),e=p.exec(n),t.extension=null==e?null:e[1])}var f=/^([a-zA-Z]+):\/\//,h=/([^\/]+(\.[\w\d]+)?)$/i,p=/\.([\w\d]+)$/i,d=/(^\/?\w{1}:)(\/|$)/,g=function(t){return null==t?this:e(t)?t.combine(""):(t=i(t),this.value=t,u(this),s(this),a(this),c(this),this.path=r(this.value),/^[\w]+:\//.test(this.path)&&(this.path="/"+this.path),this)};return g.prototype={cdUp:function(){return this.path?"/"===this.path?this:/^\/?[a-zA-Z]+:\/?$/.test(this.path)?this:(this.path=this.path.replace(/\/?[^\/]+\/?$/i,""),this):this},combine:function(t){if(e(t)&&(t=t.toString()),!t)return o(this);if(d.test(t))return new g(t);var i=o(this);if(i.value=t,a(i),c(i),!i.value)return i;if(t=i.value.replace(/^\.\//i,""),"/"===t[0])return i.path=t,i;for(;/^(\.\.\/?)/gi.test(t);)i.cdUp(),t=t.substring(3);return i.path=r(n(i.path,t)),i},toString:function(){var t=this.protocol?this.protocol+"://":"";return t+=n(this.host,this.path,this.file)+(this.search||""),this.file||this.search||(t+="/"),t},toPathAndQuery:function(){return n(this.path,this.file)+(this.search||"")},toRelativeString:function(t){if("string"==typeof t&&(t=new g(t)),0===this.path.indexOf(t.path)){var e=this.path?this.path.replace(t.path,""):"";return"/"===e[0]&&(e=e.substring(1)),n(e,this.file)+(this.search||"")}for(var r=this.path.split("/"),o=t.path.split("/"),i="",l=0,u=Math.min(r.length,o.length);u>l&&r[l]===o[l];l++);if(l>0&&(i=r.splice(0,l).join("/")),i){for(var s,a="",c=t.path;c;){if(0==this.path.indexOf(c)){s=this.path.replace(c,"");break}c=c.replace(/\/?[^\/]+\/?$/i,""),a+="../"}return n(a,s,this.file)}return this.toString()},toLocalFile:function(){var t=n(this.host,this.path,this.file);return l(t)},toLocalDir:function(){var t=n(this.host,this.path,"/");return l(t)},toDir:function(){var t=this.protocol?this.protocol+"://":"";return t+n(this.host,this.path,"/")},isRelative:function(){return!(this.protocol||this.host)},getName:function(){return this.file.replace("."+this.extension,"")}},g.combinePathes=n,g.combine=n,g}),function(){var t={};String.format=function(e){if(~e.indexOf("#{")){for(var n="",r=0,o=arguments[1];;){var i=e.indexOf("#{",r);if(-1==i)break;n+=e.substring(r,i);var l=e.indexOf("}",i);n+=Object.getProperty(o,e.substring(i+2,l)),r=++l}return n+=e.substring(r)}for(var u=1;u<arguments.length;u++){var s=t[u]||(t[u]=new RegExp("%"+u,"g"));e=e.replace(s,arguments[u])}return e},Object.defaults=function(t,e){for(var n in e)null==t[n]&&(t[n]=e[n]);return t},Object.clear=function(t,e){if(e instanceof Array)for(var n,r=0,o=e.length;o>r;r++)n=e[r],n in t&&delete t[n];else if("object"==typeof e)for(var i in e)i in t&&delete t[i];return t},Object.extend=function(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)null!=e[n]&&(t[n]=e[n]);return t},Object.getProperty=function(t,e){if("."===e)return t;for(var n=t,r="string"==typeof e?e.split("."):e,o=-1,i=r.length;null!=n&&++o<i;)n=n[r[o]];return n},Object.setProperty=function(t,e,n){for(var r=e.split("."),o=t,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}o[i]=n},Object.lazyProperty=function(t,e,n){if("object"!=typeof e){for(var r=e.split("."),o=t,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}r=null,o.__defineGetter__(i,function(){return delete o[i],o[i]=n(),n=null,o[i]})}else for(var u in e)Object.lazyProperty(t,u,e[u])},Object.clone=function(t){if(null==t)return null;switch(typeof t){case"number":case"string":case"function":return t}if(t instanceof Array){for(var e=[],n=0,r=t.length;r>n;n++)e[n]=Object.clone(t[n]);return e}var o=t.constructor;if("function"==typeof o&&(o===String||o===Number||o===RegExp||o===Date))return new o(t);var i={};for(var l in t)i[l]=Object.clone(t[l]);return i},Object.observe=function(t,e,n){if(null==t.__observers&&Object.defineProperty(t,"__observers",{value:{},enumerable:!1}),t.__observers[e])return void t.__observers[e].push(n);(t.__observers[e]||(t.__observers[e]=[])).push(n);var r=e.split("."),o=t,i=e;r.length>1&&(i=r.pop(),o=Object.getProperty(t,r));var l=o[i];Object.defineProperty(o,i,{get:function(){return l},set:function(n){l=n;for(var r=t.__observers[e],o=0,i=r.length;i>o;o++)r[o](n)}})},Date.format=function(t,e){function n(t){return t>9?t:"0"+t}e||(e="MM/dd/yyyy"),e=e.replace("MM",n(t.getMonth()+1));var r=t.getFullYear();return e.indexOf("yyyy")>-1?e=e.replace("yyyy",r):e.indexOf("yy")>-1&&(e=e.replace("yy",r.toString().substr(2,2))),e=e.replace("dd",n(t.getDate())),e.indexOf("HH")>-1&&(e=e.replace("HH",n(t.getHours()))),e.indexOf("mm")>-1&&(e=e.replace("mm",n(t.getMinutes()))),e.indexOf("ss")>-1&&(e=e.replace("ss",n(t.getSeconds()))),e},RegExp.fromString=function(t,e){return new RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e)},Function.invoke=function(){var t=Array.prototype.slice.call(arguments),e=t.shift(),n=t.shift();return function(){return e[n].apply(e,t)}}}(),function(t){function e(){}function n(){}function r(t,e,n){if(t instanceof Array){for(var o,i=[],l=0,u=t.length;u>l;l++)o=r(t[l],e,n),t[l].tagName===s&&u-1>l&&t[l+1].tagName===a&&(l+=1,null==o&&(o=r(t[l].nodes,e,n))),null!=o&&(o instanceof Array?i=i.concat(o):i.push(o));return i}if(null!=t.content)return{content:t.content,type:t.type};if(t.tagName===s){var c=t.attr.id?e[t.attr.id]:n;return c?null==t.nodes?c:r(t.nodes,e,c):null}var f={tagName:t.tagName||t.compoName,attr:t.attr,type:t.type,controller:t.controller};return t.nodes&&(f.nodes=r(t.nodes,e,n)),f}function o(t,e){if(null==e&&(e={}),t instanceof Array){for(var n=t,r=0,l=n.length;l>r;r++)o(n[r],e);return e}var s=t.tagName;if(null!=s&&s===u){var a=t.attr.id;!a&&console.error("@content has no id specified",t),e[a]&&console.error("@content already exists",a),e[a]=i(t)}return null!=t.nodes&&o(t.nodes,e),e}function i(t){for(var e,n=t.parent;null!=n&&n.tagName!==c;){var r={type:n.type,tagName:n.tagName,attr:n.attr,controller:n.controller,nodes:null};null==e?(e=r,e.nodes=t.nodes):e.nodes=[r],n=n.parent}return null!=e?e:t.nodes}var l=t.mask||Mask,u="@content",s="@placeholder",a="@else",c="layout:view",f="layout:master",h={};e.prototype={constructor:e,render:function(){h[this.attr.id]=this}},l.registerHandler(f,e),n.prototype={constructor:n,renderStart:function(){var t=h[this.attr.master];return null==t?void console.error("Master Layout is not defined for",this):(null==this.contents&&(this.contents=o(this.nodes),Object.keys&&0===Object.keys(this.contents).length&&console.warn("no contents: @content #someID")),void(this.nodes=r(t,this.contents).nodes))}},l.registerHandler(c,n)}(this),module.exports=this}).call({},"undefined"!=typeof global?global:window);